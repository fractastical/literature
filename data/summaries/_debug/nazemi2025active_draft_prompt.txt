=== IMPORTANT: ISOLATE THIS PAPER ===
You are summarizing ONLY the paper below. Do NOT reference or use content from any other papers.
Do NOT mix information from different papers. Only use information from THIS specific paper.

Paper Title: Active Inference for Energy Control and Planning in Smart Buildings and Communities
Citation Key: nazemi2025active
Authors: Seyyed Danial Nazemi, Mohsen A. Jafari, Andrea Matta

REMEMBER: Extract quotes, claims, and findings ONLY from the paper text provided below.

Year: 2025

Key Terms: systems, energy, uncertainty, planning, buildings, smart, communities, active, engineering, data

=== FULL PAPER TEXT ===

Active Inference for Energy Control and Planning in Smart
Buildings and Communities
Seyyed Danial Nazemi 1,*, Mohsen A. Jafari 1, and Andrea Matta 2
Abstractâ€” Active Inference (AIF) is emerging as a powerful struggle with inaccuracies in forecasts, and RL models, which
framework for decision-making under uncertainty, yet its require significant computational resources for training, AIF
potential in engineering applications remains largely employs Bayesian principles to handle uncertainty and make
unexplored. In this work, we propose a novel dual-layer AIF real-time adaptive decisions. This ability to infer latent states
architecture that addresses both building-level and community- and incorporate incomplete or noisy data makes AIF
level energy management. By leveraging the free energy particularly suited for complex and evolving systems with
principle, each layer adapts to evolving conditions and handles non-stationary behavior. Its reliance on generative modeling
partial observability without extensive sensor information and reduces the need for intrusive data collection, addressing
respecting data privacy. We validate the continuous AIF model privacy concerns that are increasingly critical in modern
against both a perfect optimization baseline and a reinforcement
energy systems. These features position AIF as a compelling
learning-based approach. We also test the community AIF
alternative to traditional methods, enabling secure and
framework under extreme pricing scenarios. The results
adaptive energy management. We are motivated by a number
highlight the modelâ€™s robustness in handling abrupt changes.
of factors: (a) many engineering systems are not fully
This study is the first to show how a distributed AIF works in
observable and they are subject to underlying hidden
engineering. It also highlights new opportunities for privacy-
uncertainties, (b) many real-life systems are hybrid and
preserving and uncertainty-aware control strategies in
demonstrate both time- and event-based dynamics, (c) AIF is
engineering applications.
organic in maintaining a perception model that can best
I. INTRODUCTION describe a real process amid the observed outcomes, (d) AIF
by its nature is a non-stationary model and, hence, can describe
Active Inferencing (AIF) is a mathematical framework
non-stationary engineering systems better than traditional
rooted in the Free Energy Principle (FEP), which states that
models, such as RL or MPC, and (e) except for a few sporadic
organisms maintain themselves in states in which they expect
works in the literature, mainly in robotic control, the
to be over a long time. An AIF agent, therefore, aims at
application of AIF to engineering problems is yet to be seen.
minimizing the surprisal of the outcomes or observations that
are experienced through its interactions with the world. AIF In this article, we demonstrate a dual-layer AIF
works based on two models [1], namely, Generative Density architecture for building energy management applications.
(G-density) and Recognition Density (R-density), which, Our reasoning is that building thermal dynamics (e.g.,
respectively, describe the world (actual process) and the temperature changes) are non-stationary, influenced by many
perception of the AIF agent. The generative process generates internal and external factors and uncertainties, some of which
observations and is subject to actions (if any) prescribed by the are not observable nor controllable. For instance, changes in
agent. There are two options before the agent if these occupancy are hard to observe (in real-time) and can
observations do not match the agentâ€™s prediction: (a) update its significantly impact the heat and humidity balance in a
beliefs (perception model), (b) take action to change the world. building zone. Similarly, unsupervised opening of a window
The agent decides on these options using Free energy which (usually an unobservable event) exposes a zone to external air
has retrospective and prospective components, namely, infiltration and can immediately change the heat balance
Variational Free Energy (VFE) and Expected Free Energy within that zone. From where a community manager stands,
(EFE). Minimizing VFE updates the perception model there may be many hidden causes and uncertainties at building
whereas minimizing EFE determines the â€œoptimalâ€ policy to levels that influence their power consumption patterns.
plan. Originally formulated in neuroscience and mathematical Furthermore, for privacy reasons, buildings may refrain from
psychology to explain perception and action in the brain, AIF disclosing internal data to the community manager. AIF
has been utilized for state estimation, control, and decision- allows for these to be inferred from more readily observable
making in robotics [2]. In cognitive science, AIF has been data, such as changes in zone temperature or changes in
linked to goal-directed behavior and epistemic foraging, building power consumption.
providing insights into human decision-making and learning
The proposed dual layer includes continuous AIF agents in
processes [3]. Recent works have also incorporated AIF into
Layer 1 and a discrete AIF agent for the community manager
vehicle navigation, where AIF manages uncertainties without
in Layer 2. A building AIF agent tracks a preferred target set
requiring extensive training or computational resources,
offering significant advantages over traditional methods like by the building manager, e.g., â€œoptimalâ€ cooling conditions for
its occupants. This is accomplished by controlling the heating,
Model Predictive Control (MPC) and Reinforcement Learning
(RL). Unlike deterministic optimization methods, which ventilation, and air conditioning (HVAC) resources amid
1 Seyyed Danial Nazemi and Mohsen A. Jafari are with the Department of 2 Andrea Matta is with the Department of Mechanical Engineering,
Industrial and Systems Engineering, Rutgers, The State University of New Politecnico di Milano, 20156 Milan, Italy.
Jersey, Piscataway, NJ 08854, USA. Email: danial.nazemi@rutgers.edu.
1
internal hidden dynamics and uncertainties within that define hidden states by x ğœ€ğœ’, actions by ğ’‚ğœº ğ”¸ and observation
building. At the community layer, the discrete AIF agent by ğ“ğœ€Î¦ with cardinalities |ğœ’|,|ğ”¸| and |Î¦|, respectively. For
tracks a preferred target, e.g., keeping the community power discrete agents, we define states by ğ’” ğœ– ğ’®, actions by ğ® ğœ– ğ’°,
consumption within the proximity of a day-ahead plan. These and outcomes by ğ’ğœ€ ğ‘‚, with cardinalities |ğ’®|,|ğ’°| and |ğ‘‚|,
day-ahead plans are determined using forecasts and market respectively. For building-level agents, these variables will
pricing schemes. The target tracking is accomplished by have an index of ğ‘›, but we will deliberately drop the index to
managing the peak load, common energy storage system simplify the presentation.
(ESS), and distributed renewables and participating in market
transactions in response to external price signals. Linking the
two layers is a privacy-preserving interaction protocol, which
ensures that occupant-level dataâ€”like real-time schedules or
appliance usageâ€”remain undisclosed, and only partial
observations are maintained by the community. Our
formulation is scalable, and computational costs are far less
than the usual data-driven models, such as RL. In particular,
the formulation can easily extend to many individualized
continuous AIF agents, each with large sets of latent variables
and control actions for a building. The community layer AIF
can accommodate many continuous AIF agents under its
Figure 1. A schematic diagram of a connected building community with two
control, and its action and latent state spaces can be quite large. buildings and one internal resource block connected to the power grid
The work is pioneering in its problem formulation and the AIF
For a continuous agent, we define a likelihood function
approach to control and planning.
ğ‘”( .), which describes how observed data is generated from
Optimization-based approaches have been widely used in hidden states and control actions, and a dynamic function
building energy management. These methods often rely on ğ‘“(.). The latter one, if not known from the physics of the
explicit optimization models solved through heuristic problem, is approximated or trained. For a discrete AIF agent,
algorithms [4], mixed-integer linear programming (MILP) we must define a likelihood matrix ğ‘:o(ğ‘¡)|s(ğ‘¡)>=
[5] or mixed-integer nonlinear programming (MINLP) [6]. ğ´ ğœ– â„(#$%!"#)Ã— (#$%#$%$&#) and a transition matrix
Forecast errors and the computational complexity of multi-
ğ‘( s(ğ‘¡+1)| s(ğ‘¡),ğ‘¢(ğ‘¡)=ğ‘¢)=ğµ[ğ‘¢(ğ‘¡)]:s(ğ‘¡),s(ğ‘¡+1)>]
objective optimization pose significant challenges, limiting
for a one-step transition depending on the action policies. The
their performance and scalability. Model Predictive Control
generative model of each building or the community manager
(MPC) is a relatively popular framework for building energy
defines the respective probabilistic relationship between states
management due to its rolling horizon optimization [7]. MPCs
and outcomes; for instance, for a building agent, we have
can also be resilient to prediction errors, but their performance
ğ‘(ğ“,ğ’™)=ğ‘(ğ“|ğ’™)ğ‘(ğ’™). The prior distribution, ğ‘(ğ’™),
heavily depends on the precision of embedded models.
captures the initial beliefs about the dynamics of hidden states
Reinforcement Learning (RL), Multi-agent RL, and Deep RL
over time. Extensions of this relation can incorporate
methods have been widely applied in energy management to
additional actions and parameters. We are particularly
optimize energy consumption, reduce costs, and enhance
interested in inferring the posterior probability of hidden states
system reliability [8]. Besides training complexity, RL-based
given outcomes, i.e., ğ‘(ğ’™|ğ“). However, directly computing
methods face challenges with scalability and privacy due to
this distribution is often intractable, necessitating the use of
centralized architectures and are susceptible to security
variational inference. We will use ğ‘(.) It to represent
vulnerabilities, such as cyber-attacks. Time-variant and non-
variational (or R-Density), and the Kullback-Leibler (KL)
stationary dynamics and partial information are also major
divergence function will measure the disparity between the
issues with RL-based methods. Model-based RL can mitigate
two distributions. Equation (1) describes the divergence
some of these issues, but planning and model updates are still
function in terms of the VFE and a surprisal term - the negative
isolated. As we will demonstrate, AIF integrates planning and
log probability distribution of outcomes:
model updates into a single framework, ensuring plans always
use the most up-to-date model of the underlying process. *(ğ’™)
ğ· [ğ‘(ğ‘¥)||ğ‘(ğ‘¥|ğœ™)]=ğ”¼ Nln Q=
() *(ğ’™) ,(-|/)
II. PROBLEM STATEMENT AND PRELIMINARIES *(-),(/) *(-)
âˆ«ğ‘(ğ‘¥)ln ğ‘‘ğ‘¥ =âˆ«ğ‘(ğ‘¥)ln ğ‘‘ğ‘¥+lnğ‘(ğœ™) (1)
,(-,/) ,(-,/)
In this article, the community is composed of n=1,â€¦,N
buildings, k=1,2,â€¦,K community shared assets, the energy where the VFE is defined as:
market, and a transactional model that encompasses energy
*(-)
transactions between the community and the rest of the power ğ¹ â‰œâˆ’âˆ«ğ‘(ğ‘¥)ln ğ‘‘ğ‘¥ (2)
,(-,/)
grid. The problem of interest is to formulate continuous AIF
The above equations indicate that minimizing ğ¹ involves
agents at building levels and a discrete agent at the community
reducing the divergence between ğ‘(ğ’™) and ğ‘(ğ’™) while
level to track the respective preferred targets, usually defined
on outcomes and may change dynamically. Figure 1 gives a improving the model's predictive accuracy for ğœ™. Additional
schematic of a connected community. The problem details are presented separately for a building agent and the
formulation consists of the general Bayesian formulation for community agent.
each AIF agent and recognition of its hidden states, actions,
and observations or outcomes. For continuous agents, we will
2
III. BUILDING LEVEL AIF AGENT MODEL This dynamic function framework ensures that the system
leverages historical data, time-of-day patterns, and other prior
For a building continuous AIF model ğ‘”( .) includes a
knowledge to infer hidden states effectively.
deterministic term and a noise term, ğœ€ (ğ‘¡)~ğ’©(0,ğœ2), i.e.,
1 1
The building AIF agent also tries to shape future
ğ‘:ğ“(ğ‘¡)|ğ’™(ğ‘¡),ğ’‚(ğ‘¡)>=ğ‘”:ğ’™(ğ‘¡),ğ’‚(ğ‘¡)>+ğœ€ 1 (ğ‘¡) (3) observations in accordance with some preferences. We
ğ‘¥ 3â€¦ (ğ‘¡) introduce a target (or preferred observation) ğœŒ and define a
where ğ’™(ğ‘¡)=[ ]=ğ ,5675 (ğ‘¡)+ğœ€ 8 (ğ‘¡), ğ ,5675 is prior preference distribution ğ‘(ğœ™;ğœŒ) that assigns higher
ğ‘¥ (ğ‘¡)
|4| probabilities to observations closer to ğœŒ. This modifies the
data on state beliefs and ğœ€ (ğ‘¡)~ğ’©:0,Î£ (ğ‘¡)> and Î£ is the
8 8 8 generative model to ğ‘(ğœ™,ğ‘¥|ğ‘,ğœƒ)=ğ‘(ğœ™|ğ‘¥,ğ‘,ğœƒ) ğ‘(ğ‘¥|ğ‘,ğœƒ).
covariance function capturing uncertainty in the priors. The
Although ğœŒ is a desired state rather than a random variable, it
probability density of hidden states under this model is given
is treated as a prior preference in Active Inference. By
by ğ‘(ğ‘¥)=ğ’©:ğ ,5675 ,ğšº ğ >. For presentation purposes, we will incorporating this into the VFE equation and simplifying the
assume that a building AIF agent has two hidden states, KL divergence equation, the VFE equation becomes:
namely, the occupancy level (ğ‘¥ =ğ‘‚ğ¶ğ¶) and the external
3 ğ¹ =ğ· [ğ‘(ğ‘¥)||ğ‘(ğ‘¥)]âˆ’ğ”¼ [lnğ‘(ğœ™|ğ‘¥)]âˆ’ğ‘™ğ‘›ğ‘(ğœ™;ğœŒ) (6)
infiltration airflow (ğ‘¥ =ğ‘šÌ‡ ). We note that air infiltration () *(-)
2 :-;
can be caused by an open window or door. Moreover, we will
Since ğ‘(ğœ™;ğœŒ) is independent of ğ‘¥, it simplifies to a constant
assume that ğœ™(ğ‘¡), the indoor temperature, is the only sensory
term with respect to ğ‘(ğ‘¥). Hence, the final VFE equation in
data from a building zone. For further simplification, we will
the context of our building energy management problem
assume that the example building has only one zone. These
becomes:
assumptions can be relaxed assuming that the building
multiple zones function independently, and observations are ğ¹ = 3 [ğœ™(ğ‘¡)âˆ’ğ‘‡(ğ‘¡)]2+ 3 [ğœŒ(ğ‘¡)âˆ’ğœ™(ğ‘¡)]2+
statistically independent. The building control agent uses noisy 2M- . 2M/ .
measurement ğœ™(ğ‘¡)~ğ’©(ğ‘‡(ğ‘¡),ğœ2) to refine its beliefs about the 3 âˆ‘ iğœ‡ (ğ‘¡)âˆ’ğœ‡ (ğ‘¡)k 2 (7)
hidden states, i.e., occupancy
1
level and infiltration airflow,
2M0 . 6âˆˆ{DEE,%Ì‡&+$} 6 ,5675,6
where ğœ2 the observation noise variance. Here, the first term describes the observation error, the second
1
term encourages the indoor temperature to align with the target
For illustration purposes and without loss of any setpoint, and the last term penalizes deviations from the prior
generality, we will assume that the building AIF agent beliefs about hidden states. Minimizing this VFE function
manages two control actions: the HVAC airflow (ğ‘ =ğ‘šÌ‡) and with respect to the hidden states ğœ‡ (ğ‘¡) (occupancy level and
3 6
the HVAC supply air temperature (ğ‘ =ğ‘‡ ). These actions infiltration) updates the aggregatorâ€™s posterior states. This is
2 <$,
directly influence the zoneâ€™s thermal dynamics and enable formulated as ğœ‡âˆ— =argminğ¹(ğœ‡,ğ‘,ğœ™), and the iterative
6
real-time adjustments to maintain occupant comfort and
R1
update for each hidden state is given by:
optimize energy usage. By modulating ğ‘šÌ‡, the system can
control the rate of air exchange while ğ‘‡ determines the ğœ‡ (ğ‘¡)â†ğœ‡ (ğ‘¡)âˆ’ğœ‚ ST(;) (8)
temperature of supplied air. These actions i
<
m
$,
pact how quickly
6 6 6SR1(;)
indoor temperatures reach desired setpoints. For example, where ğœ‚ is the learning rate.
6
during periods of high occupancy, increasing airflow or
On the other hand, minimizing VFE with respect to HVAC
lowering supply air temperature can rapidly cool the space and
control actions (ğ‘ (ğ‘¡) and ğ‘ (ğ‘¡)) optimizes the building's
3 2
improve occupant comfort. We now have
temperature control and guides the way toward the target
ğ‘”:ğ’™(ğ‘¡),ğ’‚(ğ‘¡)>=ğ‘‡(ğ‘¡+1)=ğ‘‡(ğ‘¡)+ setpoint ğœŒ(ğ‘¡) while minimizing energy costs. This is
âˆ†ğ‘¡[ %Ì‡(;)>â€™?@#(â€™(;)A@(;)BCDEE(;).*!) E ) " CGH*C%Ì‡&+$(;)>â€™IG@%,"(;)A@(;))I ] f u o p r d m at u e l a f t o e r d c o a n s t ro ğ‘ ls 6 âˆ— i = s g a i r v g en m K b i 1 n y: ğ¹ (ğœ‡,ğ‘,ğœ™), and the iterative
(4)
Here, ğ‘šÌ‡(ğ‘¡) is the HVAC airflow, ğ‘‡
<$,
(ğ‘¡) is the supply air ğ‘
6
; â†ğ‘
6
;âˆ’ğœ
6S
S
K
T
$
(9)
temperature, ğ‘‚ğ¶ğ¶(ğ‘¡) is the occupant-driven internal heat 1
generation, ğ‘šÌ‡ (ğ‘¡)is the infiltration airflow from outside, ğ‘ where ğœ is the learning rate.
:-; , 6
is the airâ€™s specific heat capacity, ğ‘ˆ is the building envelopeâ€™s
J The control goal in the building energy management
heat transfer coefficient, ğ‘‡ (ğ‘¡)is the outdoor temperature,
K%L problem is to adjust the HVAC airflow (ğ‘ ) and supply air
and ğ¶ is the buildingâ€™s effective thermal capacity. Note that 3
L temperature (ğ‘ ) to achieve the target indoor temperature (ğœŒ)
2
with expanded states and actions, ğ‘”:ğ’™(ğ‘¡),ğ’‚(ğ‘¡)> may involve
while minimizing energy use and VFE. By iteratively updating
additional terms and some of these terms may require ğ‘ and ğ‘ , the agent minimizes the free energy in order to align
3 2
approximations, but that discussion is outside the scope of this indoor temperature ğœ™(ğ‘¡) with the target setpoint ğœŒ(ğ‘¡). This
article. For the building agent ğ ,5675 = optimization ensures efficient energy consumption while
iğœ‡ ,ğœ‡ k encodes the expected occupancy maintaining occupant comfort. The building-layer AIF
DEE,,5675 %Ì‡&+$,,5675
profiles and infiltration patterns, which reflect the prior beliefs. simultaneously infers hidden states and optimizes continuous
If a dynamic model is available, such as a Markov process, the HVAC actions. This combined approach allows the system to
prior mean can be replaced with a state transition model: adapt to varying conditions and achieves robust performance
in real-world building environments.
ğ’™(ğ‘¡+1)=ğ‘“:ğ’™(ğ‘¡)>+ğœ€ (ğ‘¡) (5)
- 8
3
IV. COMMUNITY LEVEL DISCRETE AIF AGENT MODEL a. Building actions are represented as ğ‘¢
U
ğœ– {No
Change, Small Reduction, Big Reduction},
For the illustration purposes, we will assume that the
community manager oversees N=2 buildings, K=2 shared b. Shared assets actions are ğ‘¢ ğœ– {Charge, Hold,
VWW
assets (photovoltaic (PV) panels and Energy Storage System Discharge}, and
(ESS)), manages the market Interactions, i.e., energy
purchases or sales in the spot market, and carries out the Day- c. Market actions are denoted as ğ‘¢ X ğœ– {Buy, No
Ahead (DA) planning. The managerâ€™s primary objective is to Transaction, Sell}.
minimize the communityâ€™s net power costs while adhering to
For simplicity, we assume the building actions are the same
the DA energy purchase strategy. On the day of operation, the
for both buildings. The combined action space comprises
manager aims to minimize reliance on the more expensive spot
3Ã—3Ã—3=27 discrete actions. The model structure allows the
market while accounting for penalties related to deviations
manager to balance energy usage, battery operation, and
from the DA plan, underutilization of PV generation, and
market transactions.
inefficient battery discharge. Additionally, the manager strives
to maintain an accurate knowledge of hidden states, such as The discrete AIF model uses two key matrices to represent
building load states and the ESS State of Charge (SoC). To the relationship between observations, hidden states and
achieve these objectives, the aggregator employs a two- transitions under different actions. We start with the
pronged strategy: (1) State inferencing using VFE (similar to observation matrix ğ´ ğœ– â„(#$%!"#)Ã— (#$%#$%$&#) which defines
what was presented above but for a discrete case), and (2) the probability of observing ğ’ given hidden state ğ’”, i.e.,
Policy selection using EFE, which combines a cost function ğ‘(ğ’|ğ’”)=ğ´[ğ’,ğ’”]ğœ– â„2Y Ã— Z[. Here, columns represent hidden
with an entropy term to reduce state uncertainty. By penalizing states and rows correspond to observations. ğ´ is composed of
ambiguity, the manager prioritizes actions that simultaneously the building observation submatrices (A and A ) and the
B1 B2
optimize costs and improve state knowledge of buildings and ESS observation submatrix (A ). The full observation matrix
ESS
common assets under its supervision, and external factors, can be assembled by taking the Kronecker product of these
such as energy market conditions. The community AIF agent submatrices:
implements a rolling horizon approach to balance short-term
ğ´=ğ´ â¨‚ğ´ â¨‚ğ´ (10)
decision-making with long-term optimization. For instance, U3 U2 VWW
actions taken to reduce uncertainty about building states or The transition matrices ğµ[u(ğ‘¡)] ğœ– â„Z[ Ã— Z[ describe how
battery SoC in one step improve the accuracy of subsequent hidden states evolve from one time step to the next under a
decisions. This adaptability allows the framework to respond given action u(ğ‘¡). Since the model includes 27 discrete
dynamically to real-time conditions, such as fluctuations in PV aggregator actions, 27 distinct transition matrices exist. Each
generation or occupant behavior. matrix corresponds to a specific action and captures the
dynamics of both building states and ESS SoC. To construct
The community AIF agent defines two types of hidden
these matrices, we must build the following submatrices: (a)
states in {ğ’” ğœ– ğ’®}, namely,
Building transition submatrices (B and B ) which are 9Ã—9
B1 B2
a. Building States, (ğ‘  U3 ğ‘ğ‘›ğ‘‘ ğ‘  U2 ) ğœ–{High Load, Med and explain how the building states evolve under different
Load, Low Load}, and actions, and (b) ESS transition submatrix (B ) which is 4Ã—4
ESS
and explain the ESS SoC transitions and captures charging,
b. ESS State of Charge, ğ‘  ğœ– {E=Empty, L=Low,
VWW
H=High, F=Full}. discharging, or holding actions. The complete transition
matrix for a given action is formed by combining these
PV states can be inferred from the states of ESS. These hidden
submatrices using the Kronecker product:
states of buildings, when inferred, reflect their occupancy
ğµ=ğµ â¨‚ğµ â¨‚ğµ (11)
levels and infiltration airflow without violating the buildingâ€™s U3 U2 VWW
privacy. For instance, inferring a â€œHigh Loadâ€ state indicates Similar to continuous AIF, the VFE in discrete AIF
to the manager that the building has high occupancy and/or measures how well an approximate variational posterior ğ‘(ğ‘ )
potential energy waste due to open doors or windows. The aligns with the true posterior ğ‘(ğ‘ |ğ‘œ). In discrete AIF, this
combined hidden state space consists of 3Ã—3Ã—4=36 discrete minimization results in an efficient belief update rule:
states. The observation set (ğ’ ğœ– ğ’ª) captures partial signals ğ‘(ğ‘ \) âˆğ‘(ğ‘ ) ğµ[ğ‘¢](ğ‘ \,ğ‘ )ğ´(ğ‘œ\,ğ‘ \) (12)
from buildings and the shared resource block:
This equation indicates that the aggregator updates its belief
a. Energy consumption level signals from buildings, about the hidden state (ğ‘(ğ‘ \)) based on prior beliefs ğ‘(ğ‘ ),
ğ‘œ U3 ,ğ‘œ U2 ğœ– {Up, Same, Down}, and transition dynamics ğµ[ğ‘¢](ğ‘ \,ğ‘ ), and new observations
ğ´(ğ‘œ\,ğ‘ \). Maintaining an accurate posterior belief about
b. Electricity flow signals, ğ‘œ ğœ– {Import, Neutral,
VWW hidden states (which are abstract and high level at the
Export}.
community level), enables more informed and adaptive
By combining these signals, the model forms 3Ã—3Ã—3=27 decision-making. For instance, if building signals indicate a
observation categories. These partial observations update the sudden increase in energy consumption, the manager can
managerâ€™s belief over the 36 hidden states and enable proactively request load reductions or discharge the battery to
dynamic adjustments based on real-time information. mitigate the surge to ensure responsive energy management.
Actions, ğ® ğœ– ğ’°, are defined for buildings, ESS, and market For planning purposes, we will assume that the planning
transactions as follows: horizon is a full day, discretized into 15-minute intervals,
resulting in ninety-six (96) time steps. The manager employs
4
a rolling horizon strategy, such that at each step ğ‘¡, it solves for V. SIMULATION RESULTS
an optimal 4-step sub-horizon policy (ğœ‹ ) over the next 45
;:;CZ In the simulations, each building is represented by a
minutes. This way, the model considers both the immediate
digital twin, namely an EnergyPlus model, which acts like the
and future impacts of its actions. This approach enables the
generative process and is capable of capturing heat transfer
system to adapt dynamically to new information, such as
and airflow between inside and outside of a zone, occupants,
updated occupant signals or changes in electricity prices. At
building enclosure and windows, and energy assets. The
each time step the manager follows this sequence:
simulated community consists of two buildings, each with an
1. Horizon: Set the upcoming time steps (t,â€¦,t+3âˆ†t). HVAC system, and a shared internal resource block with an
2. Sample Policies: Possible action sequences (Ï€= ESS and PV panels. The digital twin integrates real-time
(u ,u ,u ,u )) are generated. factors such as energy usage, occupant schedules, PV
^ ^C3 ^C2 ^CZ
3. Forward-Simulate Outcomes: For each policy, the agent generation, and battery dynamics. The community interacts
predicts its impact on costs, energy usage, and with the energy market through day-ahead scheduling and
uncertainty reduction using EFE. real-time spot market adjustments. The simulations were done
4. Apply First Action: The first action of the selected for reference residential buildings in Newark, NJ, for actual
policy is implemented, while the remaining horizon is representative summer conditions. In the building-layer AIF,
re-evaluated at the next time step with updated a given day is divided into 288 5-minute timesteps. Model
observations. parameters for building-layer agents are detailed in Table I,
while community-layer parameters are summarized in Table
This receding-horizon strategy ensures that decisions are made
II. Electricity prices were sourced from PJM datasets, and
iteratively, with adjustments reflecting real-time conditions.
simulations were executed on an Apple MacBook Pro with an
Our formulation of EFE for a given policy includes epistemic
M4 processor, 16 GB of RAM, and a 10-core CPU.
and extrinsic terms. The epistemic term selects actions that
TABLE I. BUILDING-LAYER AIF MODEL PARAMTERES
improve state estimation and reduce uncertainty, while the
extrinsic term ensures that selected actions align with prior Parameter Value Parameter Value
preferences. We have: Building thermal inertia 2Ã—106 (J/â„ƒ) Comfort band Â±2 (â„ƒ)
Specific heat capacity of 1005 Generated heat by
ğº =ğ· :ğ‘(o;|ğœ‹;)||ğ‘(o;)>+âˆ‘ ğ‘(s;|ğœ‹;)ğ»:ğ‘(o;|s;)> (13) 102 (W)
_ () < air (J/kgâ„ƒ) each occupant
Min. and Max. HVAC Min. and Max. 0 â€“ 0.3
In Equation (13), the first term describes the risk and measures 10-25 (â„ƒ)
supply air temperature HVAC airflow rate (kg/s)
how the agentâ€™s predicted observations ğ‘(o;|ğœ‹;) deviate from
TABLE II. COMMUNITY-LAYER AIF MODEL PARAMTERES
preferred observations ğ‘(o;), and the second term shows the
Parameter Value Parameter Value
ambiguity which captures how uncertain future observations
Maximum PV Panel Battery Cap. and 5 (kWh) -
are, given each hidden state. Higher emphasis on ambiguity Power Generation 20 (kW) Max. Power Output 20 (kW)
means the agent chooses future states that generate
unambiguous and informative outcomes, while stronger
First, we compare the AIF agents to a fully observable and
preference demands can reduce exploration in favor of
deterministic optimization model which is widely regarded as
meeting cost or comfort objectives. For a 4-step horizon, the
the benchmark for decision-making in fully observable
EFE for a policy ğœ‹ can be rewritten with cost and
;:;CZ environments. We employed a MINLP approach, using the
ambiguity terms, as follows:
Gurobi solver with all equations and constraints specified in
ğº =âˆ‘;CZâˆ†;ğ”¼ N[ğ¶ğ‘œğ‘ ğ‘¡(o;,ğ‘¢;)]+ the building-layer AIF model. For the comparison, two types
_$:$34âˆ†$ ; *(â€˜6|_$)
of AIF models were considered: a one-step look-ahead and a
ğ›¼ K%L ğ»:ğ‘(o;|s;)>Q (14) full-horizon AIF.
Equation (15) describes a cost function to align realâ€time
community energy usage with a preâ€defined dayâ€ahead (DA)
energy plan (ğ‘ƒ^ ) while encouraging efficient use of onâ€
;K5b:;
site PV and battery storage and is defined as:
ğ¶ğ‘œğ‘ ğ‘¡(o;,ğ‘¢;)=ğ¶ğ‘œğ‘ ğ‘¡ +ğ‘ƒ (|ğ‘…;|)+ğ‘ƒ +ğ‘ƒ (15)
<,7; c:d Hef UK;
where ğ‘…; =ğ‘ƒ; âˆ’ğ‘ƒ^ .
g@ ;K5b:;
By incorporating ambiguity penalties into the decision-
making process, the manager prioritizes actions that reduce
uncertainty about hidden states. This proactive approach Figure 2. Comparison of predicted indoor temperatures for deterministic
improves decision quality over time as the system becomes optimization and Active Inference models.
Figure 2 compares the predicted indoor temperature of the
more confident in its state estimates. Additionally, the
three models against the desired temperature setpoint. The
integration of cost optimizationâ€”through spot market
deterministic optimization model and the horizon-wide AIF
interactions, adherence to day-ahead plans, and efficient PV
produce identical results, which demonstrate the ability of the
utilizationâ€”ensures the framework minimizes energy costs
horizon-wide AIF to replicate deterministic optimization
while balancing system constraints.
5
when perfect information is available. In contrast, the one- capturing both high and low activity periods with reasonable
step look-ahead AIF exhibits slight deviations during accuracy. Although some discrepancies exist, particularly
transitional periods, due to its shorter planning horizon. These during transitions between occupancy states, the model
deviations highlight an important trade-off in AIF models: demonstrates an overall ability to adapt to dynamic
while a horizon-wide AIF ensures long-term stability, a one- occupancy patterns. This adaptive behavior enables the AIF
step look-ahead approach enhances short-term adaptability model to make optimal real-time HVAC control decisions by
but may introduce minor fluctuations. continuously updating its internal beliefs in response to
Figure 3 compares the AIF with the Deep Deterministic observed conditions.
Policy Gradient (DDPG) algorithm, an actor-critic RL At the community-layer, the AIF agent operates over a 24-
method suited for continuous action spaces like HVAC hour horizon, which is divided into 15-minute intervals using
airflow and supply temperature control. DDPG learns optimal a short-horizon EFE minimization. Figure 5 describes the
policies by interacting with the environment, observing states inferred hidden states of the discrete AIF agent. For example,
(indoor and ambient temperatures), and selecting fluctuations between â€œHigh,Highâ€ and â€œLow,Medâ€ illustrate
corresponding actions. In contrast, AIF explicitly estimates the agentâ€™s changing beliefs about occupancy patterns,
hidden states, such as occupancy and infiltration, while household appliance usage, HVAC power consumption,
optimizing temperature control. The RL model for this and/or other factors that drive building loads. It can also be
comparison consists of two hidden layers with 256 neurons seen that the states occasionally jump within short time spans.
with ReLU activation function. It was trained on one year of This indicates that the agent rapidly updates its hypotheses
simulated data from EnergyPlus for the same reference whenever it sees new signals.
building located in Newark, NJ. The dataset was split into
80% for training and 20% for testing. Both RL and AIF
models aim to maintain room temperature within the desired
range, but they differ in how they handle uncertainty and non-
stationary environmental conditions. Unlike AIF, the RL
model does not have direct access to hidden states, and it
relies only on observed data and its prior training experience
to react and predict indoor temperature. If, for example,
occupant behavior or infiltration rates change abruptly, the
Figure 5. Inferred states of the buildings in the community.
RL controller may require retraining or additional adaptation
mechanisms to maintain performance. AIF, on the other hand,
can rapidly re-estimate hidden states and adjust accordingly.
Figure 3. Comparison of the results of AIF with an RL algorithm for
predicted indoor temperatures. Figure 6. Real-time operation of the community energy management.
Figure 6 integrates real-time operations with day-ahead
planning by visualizing the stacked power contributions from
PV generation, battery adjustments, and spot market
transactions, overlaid on the baseline day-ahead power
purchase. Real-time operations closely follow the day-ahead
plan, with minor deviations managed through dynamic
adjustments in PV, battery, and market actions. The plot also
highlights instances where the day-ahead forecasted demand
exceeds real-time usage. In such cases, the system leverages
excess day-ahead energy to either charge the battery or sell
Figure 4. Comparison of the inferred occupancy profile against the original
surplus power back to the spot market. When PV output is
occupancy profile.
Figure 4 presents a comparison between the original minimal at the beginning of the operation day, the system
occupancy profile used in the EnergyPlus simulation and the predominantly relies on the spot market and battery storage to
occupancy estimated by the AIF model over a 24-hour period. meet residual demands. As PV generation ramps up
The AIF model effectively tracks fluctuations in occupancy, throughout the day, it becomes the primary energy source and
6
reduces the dependency on external sources. During peak spot market. Figure 8 illustrates the systemâ€™s decision-making
demand, the combined utilization of PV generation and for three action types. The model monitors real-time energy
battery storage effectively reduces reliance on the spot consumption in buildings and issues demand reduction
market. Later in the day, as demand decreases and PV requests based on grid conditions and pricing signals. It also
generation subsides, the system shifts its focus to discharging discharges the battery during peak hours to reduce grid
the battery to reduce spot market transactions. This dependence and preserves or recharges it during lower-cost
visualization highlights the framework's ability to balance periods. Moreover, the model determines market transactions
multiple energy sources, adapt to real-time uncertainties, and and decides when to buy, sell, or abstain from trading based
optimize resource utilization for improved cost efficiency. on real-time conditions. This strategy led to decreased power
Figure 7 illustrates the impact of incorporating ambiguity purchases during peak pricing and increased energy sales
into the stepwise EFE values for five values of the ambiguity from battery discharge and surplus PV generation. Overall,
coefficient, ğ›¼ (0.0 to 2.0). Increasing ğ›¼ places greater the results highlight the modelâ€™s effectiveness in optimizing
K%L K%L
emphasis on reducing ambiguity, which generally results in battery usage and market transactions.
higher stepwise costs. However, models with lower ambiguity
can occasionally experience higher costs at specific timesteps, VI. CONCLUSION
depending on how the environment responds to uncertainty.
This paper introduced a dual-layer Active Inference
Interestingly, agents with higher ğ›¼ can sometimes select
K%L architecture for building community energy management,
more effective policies that resolve state uncertainty while
marking the first application of AIF principles to planning and
also reducing overall costs, resulting in lower cumulative
control in energy systems. Two distinct AIF models were
EFE. These exploratory actions incur higher short-term
developed: a continuous framework to control HVAC
expenses but enhance state estimation and long-term
operations at the building level and a discrete framework to
decision-making. However, when environmental feedback
coordinate power flows, battery usage, and external market
offers limited benefits within the simulation horizon, the
interactions at the community level. Both layers try to infer
added costs of minimizing ambiguity may not be recovered.
their respective hidden states from observations and ensure
Thus, while ambiguity minimization can improve outcomes,
that the performance targets are tracked and achieved. At the
it does not universally guarantee lower total costs.
community level, the ambiguity term plays a significant role
in balancing uncertainties with achieving short-term benefits.
The results from the proposed AIF models compared to exact
optimization under full observations and with RL under
similar partial observations. The results show the same or
superior performance by the AIF framework. The formulation
is quite generic and, under some mild assumptions, can be
Figure 7. Impact of ambiguity term on the Expected Free Energy.
extended to communities with a larger number of buildings
and zones within buildings.
REFERENCES
[1] K. Friston, T. FitzGerald, F. Rigoli, P. Schwartenbeck, J. Oâ€™Doherty,
and G. Pezzulo, â€œActive inference and learning,â€ Neuroscience &
Biobehavioral Reviews, vol. 68, pp. 862â€“879, 2016.
[2] P. Lanillos et al., â€œActive Inference in Robotics and Artificial Agents:
Survey and Challenges,â€ arXiv, 2021.
[3] R. Smith, K. J. Friston, and C. J. Whyte, â€œA step-by-step tutorial on
active inference and its application to empirical data,â€ Journal of
Mathematical Psychology, vol. 107, p. 102632, 2022.
[4] H. T. Dinh, J. Yun, D. M. Kim, K.-H. Lee, and D. Kim, â€œA Home
Energy Management System With Renewable Energy and Energy
Storage Utilizing Main Grid and Electricity Selling,â€ IEEE Access,
vol. 8, pp. 49436â€“49450, 2020.
[5] A. Anvari-Moghaddam, H. Monsef, and A. Rahimi-Kian, â€œOptimal
Smart Home Energy Management Considering Energy Saving and a
Comfortable Lifestyle,â€ IEEE Trans. Smart Grid, vol. 6, no. 1, pp.
Figure 8. The aggregator actions under the extreme pricing scenario. 324â€“332, 2015.
[6] S. D. Nazemi, M. A. Jafari, and E. Zaidan, â€œAn Incentive-Based
Optimization Approach for Load Scheduling Problem in Smart
Finally, we evaluate the AIF performance under an
Building Communities,â€ Buildings, vol. 11, no. 6, p. 237, 2021.
extreme real-time pricing (RTP) scenario. We consider a [7] M. Ostadijafari, A. Dubey, and N. Yu, â€œLinearized Price-Responsive
summer day with a power generation shortage and elevated HVAC Controller for Optimal Scheduling of Smart Building Loads,â€
electricity costs. In this scenario, RTP rates were doubled, IEEE Trans. Smart Grid, vol. 11, no. 4, pp. 3131â€“3145, 2020.
with peak-hour prices (16:00â€“20:00) reaching three times the [8] Z. Zhang, A. Chong, Y. Pan, C. Zhang, and K. P. Lam, â€œWhole
building energy model for HVAC optimal control: A practical
baseline, resulting in higher utility bills for end-users. To
framework based on deep reinforcement learning,â€ Energy and
mitigate these costs, the community AIF controller optimizes Buildings, vol. 199, pp. 472â€“490, 2019.
energy management by reducing reliance on the high-priced
7

=== INSTRUCTIONS ===

0. PROFESSIONAL TONE REQUIREMENTS:
   - Begin directly with the paper title or content - NO conversational openings
   - Do NOT use phrases like: 'Okay, here's...', 'Here's a summary...',
     'Let me summarize...', 'I'll extract...', or similar conversational language
   - Start immediately with substantive content in formal academic tone
   - Example BAD: 'Okay, here's a summary of the paper...'
   - Example GOOD: 'This paper investigates [topic]...'

1. Start with exact title: "Active Inference for Energy Control and Planning in Smart Buildings and Communities"

2. EXTRACT QUOTES:
   - Extract 10-15 direct quotes from the paper that support key claims
   - QUOTE EXTRACTION AND FORMATTING:
     * Extract quotes VERBATIM from the paper text - do NOT modify or "correct" them
     * Extract quotes exactly as they appear in the source text
     * Preserve all aspects of the quote exactly as written, including spacing
     * Use proper quotation marks: "quote text" (double quotes)
     * CRITICAL: Only extract quotes that actually appear in the paper text
     * Do NOT generate, invent, or "fix" quotes - extract them exactly as written
   - QUOTE FORMATTING STANDARD:
     * Attribution format: 'The authors state: "quote text"' OR 'According to the paper: "quote text"'
     * Vary attribution phrases to avoid repetition (use: 'The authors state', 'They note',
       'The paper argues', 'According to the research', 'The study demonstrates')
     * Include section context when available: 'In the Introduction, the authors state: "quote text"'
     * Ensure proper spacing around quotes and punctuation
   - Search the full paper text to find relevant quotes
   - Each quote must be verbatim from the paper text (with spacing normalized)

3. IDENTIFY CLAIMS:
   - Identify the main claims and arguments made by the authors
   - State each claim clearly and support it with quotes from the paper
   - Distinguish between primary claims and supporting arguments

4. SUMMARIZE KEY FINDINGS:
   - Summarize the key findings with specific numbers, metrics, and results
   - Include quantitative data: percentages, statistics, measurements
   - Extract numerical results from the results section
   - Present findings with supporting evidence from the paper

5. DESCRIBE METHODS:
   - Describe the methodology, experimental setup, and approach used
   - Include details about: algorithms, procedures, experimental design
   - Explain how the research was conducted
   - Extract specific methodological details from the methods section

6. PRESENT RESULTS:
   - Present the results with quantitative data and statistical significance
   - Include specific numbers, tables, figures mentioned in the paper
   - Extract results from the results section with exact values
   - Support results with quotes or data from the paper

7. NO REPETITION - CRITICAL REQUIREMENT (ENHANCED):
   - CRITICAL: Before writing EACH sentence, check: 'Have I already said this exact idea?'
   - If you've already stated an idea, DO NOT repeat it - move to the next unique point
   - Each sentence must be COMPLETELY UNIQUE - no duplicate ideas, even with different words
   - Each claim appears EXACTLY ONCE - if you've stated it, move to the next unique point
   - Each paragraph must be COMPLETELY UNIQUE - no duplicate paragraphs
   - Do NOT repeat the same sentence, even with slight variations or word changes
   - Do NOT repeat paragraphs or sections - each section must have unique content
   - Each claim should appear only ONCE in the entire summary
   - Vary attribution phrases: use 'The authors state', 'They note', 'The paper argues',
     'According to the research', 'The study demonstrates' - do NOT repeat the same phrase
   - If you find yourself writing similar content, STOP immediately and write something completely different
   - Before each sentence, ask: 'Have I already said this?' If yes, write something new
   - Vary your language: use synonyms, different sentence structures, different perspectives
   - REPETITION CHECKLIST: After writing each sentence, verify it's not a duplicate of any previous sentence

   EXAMPLES OF WHAT NOT TO DO:
   âŒ BAD: 'The authors state: "X". The authors state: "Y". The authors state: "Z".'
   âœ… GOOD: 'The authors state: "X". They further note: "Y". The paper argues: "Z".'

   âŒ BAD: Repeating the same claim 3+ times with slight variations
   âœ… GOOD: State each claim once, then move to the next unique point

8. STRUCTURE:
   - Use markdown headers: ### Overview, ### Methodology, ### Results, ### Discussion
   - Target length: 1000-1500 words
   - Ensure all requested elements (quotes, claims, findings, methods, results) are included
