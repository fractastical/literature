=== IMPORTANT: ISOLATE THIS PAPER ===
You are revising a summary for ONLY the paper below. Do NOT reference or use content from any other papers.
Paper Title: Open Dynamical Systems as Coalgebras for Polynomial Functors, with Application to Predictive Processing
Citation Key: smithe2022open
REMEMBER: Extract quotes, claims, and findings ONLY from the paper text provided below.

Issues to fix:
1. Title mismatch: Paper title 'Open Dynamical Systems as Coalgebras for Polynomial Functors, with Application to Predictive Processing' not found in summary
2. Too short: 31 words (minimum 200)

Current draft:
Okay, I understand. I will follow these instructions precisely to generate a summary of the provided text. I will focus on clarity, conciseness, and adherence to the specified guidelines. Let's begin.

Key terms: systems, processing, space, polynomial, open, application, dynamical, coalgebras

=== FULL PAPER TEXT ===
Open Dynamical Systems as Coalgebras for Polynomial
Functors, with Application to Predictive Processing
TobySt. ClereSmithe
ToposInstitute
toby@topos.institute
We present categories of open dynamical systems with general time evolution as categories of
coalgebrasopindexedbypolynomialinterfaces,andshowhowthisextendsthecoalgebraicframework
to capture common scientific applications such as ordinary differential equations, open Markov
processes,andrandomdynamicalsystems. WethenextendSpivak’soperadOrgtothissetting,and
constructassociatedmonoidalcategorieswhosemorphismsrepresenthierarchicalopensystems;when
theirinterfacesaresimple,thesecategoriessupplycanonicalcomonoidstructures. Weexemplifythese
constructionsusingthe‘Laplacedoctrine’,whichprovidesdynamicalsemanticsforactiveinference,
andindicatesomeconnectionstoBayesianinversionandcoalgebraiclogic.
1 Background
1.1 CloseddynamicalsystemsandMarkovprocesses
Inthisbriefsection,werecalla‘behavioural’approachtodynamicalsystemsoriginallydue(webelieve)
toLawvere;forapedagogicalaccount,see[1]. Thesesystemsare‘closed’inthesensethattheydonot
requireenvironmentalinteractionfortheirevolution,buttheynonethelessformthestartingpointforour
categoriesofmoreopensystems.
Definition1.1. LetpT,`,0qbeamonoid,representingtime. LetX :E besomespace,calledthestate
space. Thenacloseddynamicalsystemϑ withstatespaceX andtimeTisanactionofTonX. WhenT
isalsoanobjectofE,thenthisamountstoamorphismϑ :TˆX ÑX (orequivalently,atime-indexed
familyofX-endomorphisms,ϑptq:X ÑX),suchthatϑp0q“id andϑps`tq“ϑpsq˝ϑptq.
X
Proposition 1.2. When time is discrete, as in the case T “ N, any dynamical system ϑ is entirely
determined by its action at 1:T. That is, letting the state space be X, we have ϑptq“ϑp1q˝t where
ϑp1q˝t means“composeϑp1q:X ÑX withitselft times”.
Example1.3. SupposeX :U ÑTU isavectorfieldonU,withacorrespondingsolution(integralcurve)
χ :RÑU forallx:U;thatis, χ1ptq“Xpχ ptqqandχ p0q“x. Thenlettingthepointxvary,weobtain
x x x
amap χ :RˆU ÑU. Thisχ isacloseddynamicalsystemwithstatespaceU andtimeR.
Proposition 1.4. Closed dynamical systems with state spaces in E and time T are the objects of the
functorcategoryCatpBT,Eq,whereBTdenotesthedeloopingofthemonoidT. Morphismsofdynamical
systemsarethereforenaturaltransformations.
Wewillalsooftenbeinterestedindynamicalsystemswhoseevolutionhas‘side-effects’,suchasthe
generation(or‘mixing’)ofuncertaintyorrandomness. WewilllargelymodelsuchsystemsasKleisli
mapsorcoalgebrasofmonadsmodellingtheseside-effects. Inthecaseofuncertainty,themonadswillbe
so-calledprobabilitymonads,whichwewilloftendenotebyP. SuchamonadP :E ÑE canoftenbe
thought of astaking each setor space X :E to theset (or space) PX of probabilitydistributions over
J.Master&M.Lewis(Eds.):FifthInternational ©T.St.ClereSmithe
ConferenceonAppliedCategoryTheory(ACT2022). ThisworkislicensedundertheCreativeCommons
EPTCS380,2023,pp.307–330,doi:10.4204/EPTCS.380.18 Attribution-ShareAlikeLicense.
308 DynamicalSystemsviaGeneralizedPolynomialCoalgebra
X,andeachmorphismtothecorresponding‘pushforwards’map;themonadmultiplicationisgivenby
“averagingout”uncertainty,andtheunittakesapointtothe‘Dirac’distributionoverit. Withtheseideas
inmind,wecanextendtheconceptsabovetocoverMarkovchainsandMarkovprocesses.
Example1.5(ClosedMarkovchainsandMarkovprocesses). AclosedMarkovchainisgivenbyamap
X ÑPX,whereP :E `ÑE isapro˘babilitymonadonE;thisisequivalentlyaP-coalgebrawithtime
N,andanobjec`tinCat BN,˘ KℓpPq . WithmoregeneraltimeT,oneobtainsclosedMarkovprocesses:
objects in Cat BT,KℓpPq . More explicitly, a closed Markov process is a time-indexed family of
Markov kernels; that is, a morphism ϑ :TˆX ÑPX such that, for all times s,t :T, ϑ “ϑ ‚ϑ
s`t s t
asamorphisminKℓpPq. Notethatcomposition‚inKℓpPqisgivenbytheChapman-Kolmogorov
equation,sothismeansthat ż
ϑ py|xq“ ϑ py|x1qϑ pdx1|xq.
s`t s t
x1:X
1.2 Polynomialfunctors
Wewillusepolynomialfunctorstomodeltheinterfacesofouropensystems,followingSpivakandNiu
[2]. WewillassumethesetobefunctorsE ÑE foralocallyCartesianclosedcategoryE,butwewill
typicallyassumethatE isfurthermoreconcrete,andoftenthatitisinfactSet.
Definition1.6. LetE bealocallyCartesianclosedcategory,anddenotebyyAtherepresentablecopresheaf
yA :“ř EpA,´q : E Ñ E. A polynomial functor p is a coproduct of representable functors, written
p:“ ypi,where pp1q:E istheindexingobject. ThecategoryofpolynomialfunctorsinE isthe
i:pp1q
fullsubcategoryPoly
E
ãÑrE,EsoftheE-copresheafcategoryspannedbycoproductsofrepresentables.
Amorphismofpolynomialsisthereforeanaturaltransformation.
Remark1.7. EverypolynomialfunctorP:E ÑE correspondstoabundle p:E ÑBinE,forwhich
B“Pp1q and for each i:Pp1q, the fibre p
i
is Ppiq. We will henceforth elide the distinction
ř
between a
copresheaf P and its corresponding bundle p, writing pp1q:“B and pris:“ p, where E “ pris. A
i i
naturaltransformation f : pÑqbetweencopresheavesthereforecorrespondstoamapofbundles. Inthe
caseofpolynomials,bytheYonedalemma,thismapisgivenbya‘forwards’map f : pp1qÑqp1qanda
1
familyof‘backwards’maps f# :qrf p-qsÑ pr-sindexedby pp1q, asintheleftdiagrambelow. Given
1
f : pÑqandg:qÑr,theircompositeg˝ f : pÑrisasintherightdiagrambelow.
f# pgfq#
E f˚F F E f˚g˚G G
{ {
p q p r
B B f 1 C B B g 1˝f 1 D
wherepgfq# isgivenbythe pp1q-indexedfamilyofcompositemapsrrg pf p-qqsÝÝ f˚ Ý g Ñ # qrf p-qsÝÑ f# pr-s.
1 1 1
Wecaninterpretthetype pp1qtobeasetorspaceof‘configurations’or‘positions’ofa p-shaped
system, and each pris to be the available ‘inputs’ or ‘directions’ available to the system when it is in
configuration/positioni.
We now recall a handful of useful facts about polynomials and their morphisms, each of which is
explainedinSpivakandNiu[2]andsummarizedinSpivak[3].
ř
Proposition1.8. Polynomialmorphisms pÑycorrespondtosections pp1qÑ prisofthecorrespond-
i
ingbundle p.
T.St. ClereSmithe 309
Proposition 1.9. There is an embedding of E into Poly given by taking objects X :E to the linear
E
polynomialsXy:Poly
E
andmorphisms f :X ÑY tomorphismspf,id
X
q:XyÑYy.
Proposition 1.10. There is a symmet
ř
ric mon
ř
oidal structure pb,yq on Poly
E
that we call tensor, and
whichisgivenonobjectsby pbq:“ yprisˆqrjs andonmorphisms f :“pf ,f#q: pÑ p1
i:pp1q j:qp1q 1
andg:“pg ,g#q:qÑq1 by f bg:“pf ˆg ,f#ˆg#q.
1 1 1
Proposition 1.11. pPoly
E
,
ř
b,yq is s
ř
ymmetric monoidal closed, with internal hom denoted r´,“s.
Explicitly,wehaverp,qs“ y i:pp1q qrf 1piqs. GivenanobjectA:E,wehaverAy,ys–yA.
f:pÑq
Proposition 1.12. The composition of polynomial functors q˝p:E ÑE ÑE induces a monoidal
structure on Poly
E
, which we denote Ÿ, and call ‘composition’ or ‘substitution’. Its unit is again y.
Famously,Ÿ-comonoidscorrespondtocategoriesandtheircomonoidhomomorphismsarecofunctors
[4]. If T is a monoid, then the comonoid structure on y T corresponds witnesses it as the category BT.
MonomialsoftheformSyScanbeequippedwithacanonicalcomonoidstructurewitnessingthecodiscrete
groupoidonS.
2 Open dynamical systems as polynomial coalgebras
2.1 Deterministicsystems
Definition2.1. Adeterministicopendynamicalsystemwithinterface p,statespaceSandtimeTisa
polynomialmorphismβ :SySÑrTy,pssuchthat,foranysectionσ : pÑy,theinducedmorphism
SySÝÑ β rTy,psÝ rT Ý y Ý ,σ Ñ s rTy,ysÝÑ „ y T
isacomonoidhomomorphism.
Toseehowsuchamorphismβ islikean‘open’versionofthecloseddynamicalsystemsintroduced
above,notethatbythetensor-homadjunction,β canequivalentlybewrittenwiththetypeTybSySÑ p.
Inturn,suchamorphismcorrespondstoapairpβo,βuq,whereβo isthecomp
ř
onen
ř
t‘onpositions’with
thetypeTˆSÑ pp1q,andβu isthecomponent‘ondirections’withthetype prβopt,sqsÑS.
t:T s:S
Wewillcallthemapβo theoutputmap,asitchoosesanoutputpositionforeachstateandmomentin
time;andwewillcallthemapβu theupdatemap,asittakesastates:S,aquantityoftimet :T,andan
‘input’in prβopt,sqs,andreturnsanewstate. Wemightimaginethenewstateasbeinggivenbyevolving
thesystemfromsfortimet,andtheinputasbeinggivenatthepositioncorrespondingtops,tq.
Butitisnotsufficienttoconsidermerelysuchpairsβ “pβo,βuqtobeouropendynamicalsystems,
forweneedthemtobelike‘open’monoidactions: evolvingfortimet thenfortimesmustbeequivalent
toevolvingfortimet`s,giventhesameinputs. Itisfairlyeasytoprovethefollowingproposition,whose
T
proofwedeferuntilafterestablishingthecategoriesCoalg ppq.
Proposition2.2. ComonoidhomomorphismsSyS Ñy T correspondbijectivelywithcloseddynamical
systemswithstatespaceS:E,inthesensegivenbyfunctorsBTÑE.
Thisestablishesthatseekingsuchacomonoidhomomorphismwillgiveusthemonoidactionproperty
thatweseek,andsoitremainstoshowthatacompositecomonoidhomomorphismoftheformrTy,σs˝β
isacloseddynamicalsystemwiththe“rightinputs”. Unwindingthiscomposite,wefindthatthecondition
that it be a comonoid homomorphism corresponds to the requirement that, for any t :T, the closure
βσ :TˆSÑSofβ byσ givenby
ÿ
βσptq:“SÝ β Ý o Ý pt Ý q˚ ÝÑ σ prβopt,sqsÝ β Ñ u S
s:S
310 DynamicalSystemsviaGeneralizedPolynomialCoalgebra
constitutesacloseddynamicalsystemonS. Theideahereisthatσ givesthe‘context’inwhichwecan
makeanopensystemclosed,therebyformalizingthe“giventhesameinputs”requirementabove.
Withthisconceptualframeworkinmind,weareinapositiontorenderopendynamicalsystemson
pwithtimeTintoacategory,whichwewilldenotebyCoalg T ppq. ItsobjectswillbepairspS,βqwith
S:E andβ anopendynamicalon pwithstatespaceS;wewilloftenwritethesepairsequivalentlyas
triplespS,βo,βuq,makingexplicittheoutputandupdatemaps. Morphismswillbemapsofstatespaces
thatcommutewiththedynamics:
Proposition2.3. Opendynamicalsystemsover pwithtimeTformacategory,denotedCoalg T ppq. Its
morphismsaredefinedasfollows. Letϑ :“pX,ϑo,ϑuqandψ :“pY,ψo,ψuqbetwodynamicalsystems
over p. Amorphism ř f :ϑ Ñψ consistsinamorphism f :X ÑY suchthat,foranytimet :Tandglobal
sectionσ : pp1qÑ prisof p,thefollowingnaturalitysquarescommute:
i:pp1q
ř
X
ϑoptq˚σ
prϑopt,xqs
ϑuptq
X
x:X
f f
ř
Y prψopt,yqs Y
ψoptq˚σ ψuptq
y:Y
Theidentitymorphismid onthedynamicalsystemϑ isgivenbytheidentitymorphismid onitsstate
ϑ X
spaceX. Compositionofmorphismsofdynamicalsystemsisgivenbycompositionofthemorphismsof
thestatespaces.
Proof. We need to check unitality and associativity of composition. This amounts to checking that
the composite naturality squares commute. But this follows immediately, since the composite of two
commutativediagramsalongacommonedgeisagainacommutativediagram.
WecanalternativelystateProposition2.2asfollows,notingthatthepolynomialycorrespondstoa
trivialinterface,exposingnoconfigurationtoanyenvironmentnorreceivinganysignalsfromit:
Proposition 2.4. Coalg T pyq is equivalent to the classical category CatpBT,Eq of closed dynamical
id
systemsinE withtimeT.
Proof. The trivial interface y corresponds to the trivial bundle id : 1 Ñ 1. Therefore, a dynamical
1
systemoveryconsistsofachoiceofstatespaceSalongwithatrivialoutputmapϑo“ :TˆSÑ1
and a time-indexed update map ϑu : TˆS Ñ S. This therefore has the form of a classical closed
dynamical system, so it remains to check the monoid action. There is only one section of id , which
1
is again id . Pulling this back along the unique map ϑoptq:SÑ1 gives ϑoptq˚id “id . Therefore
1 1 S
the requirement that, given any section σ of y, the maps ϑu˝ϑoptq˚σ form an action means in turn
that so does ϑu :TˆSÑS. Since the pullback of the unique section id along the trivial output map
1
ϑoptq“ :S Ñ1 of any dynamical system in Coalg T pyq is the identity of the corresponding state
id
space id , a morphism f : pϑp˚q,ϑu, q Ñ pψp˚q,ψu, q in Coalg T pyq amounts precisely to a map
S id
f :ϑp˚qÑψp˚q on the state spaces in E such that the naturality condition f ˝ϑuptq“ψuptq˝ f of
Proposition1.4issatisfied,andeverymorphisminCatpBT,EqcorrespondstoamorphisminCoalg T pyq
id
inthisway.
Now that we know that our concept of open dynamical system subsumes closed systems, let us
considersomemoreexamples.
T.St. ClereSmithe 311
Example2.5. ConsideradynamicalsystempS,ϑo,ϑuqwithoutputsbutnoinputs. Suchasystemhasa
‘linear’interface p:“IyforsomeI:E;alternatively,wecanwriteitsinterface pasthe‘bundle’id :IÑI.
I
Asectionofthisbundlemustagainbeid ,andsoϑoptq˚id “id . Onceagain,theupdatemapscollect
I I S
into to a closed dynamical system in CatpBT,Eq; just now we have outputs ϑo :TˆS Ñ pp1q“I
exposedtotheenvironment.
Proposition2.6. Whentimeisdiscrete,aswithT“N,anyopendynamicalsystempX,ϑo,ϑuqover pis
entirely ř determinedbyitscomponentsat1:T. Thatis,wehaveϑoptq“ϑop1q:X Ñ pp1qandϑuptq“
ϑup1q:
x:X
prϑopxqsÑX. A discrete-time open dyn
ř
amical system is therefore a triple pX,ϑo,ϑuq,
wherethetwomapshavetypesϑo:X Ñ pp1qandϑu: prϑopxqsÑX.
x:X
Proof. Suppose σ is a section of p. We require each closure ϑσ to satisfy the flow conditions, that
ϑσp0q“id andϑσpt`sq“ϑσptq˝ϑσpsq. Inparticular,wemusthaveϑσpt`1q“ϑσptq˝ϑσp1q. By
X
induction,thismeansthatwemusthaveϑσptq“ϑσp1q˝t (compareProposition1.2). Thereforewemust
ingeneralhaveϑoptq“ϑop1qandϑuptq“ϑup1q.
Example2.7. Supposex9“ fpx,aqandb“gpxq,with f :XˆAÑTX andg:X Ñş B. Then,asforthe
‘closedş’vectorfieldsofExample1.3,thisinducesanopendynamicalsystempX, f,gq:Coalg R pByAq,
where f :RˆXˆAÑX returnsthepX,Aq-indexedsolutionsof f.
Example2.8. Theprecedingexampleiseasilyextendedtothecaseofageneralpolynomialinterface.
ř
Suppose similarly that x9“ fpx,a x q and b“gşpxq, now with f : x:X prgpxqsşÑTX a ř nd g:X Ñ pp1q.
ThenweobtainanopendynamicalsystempX, f,gq:Coalg R ppq,wherenow f :Rˆ prgpxqsÑX
id x:X
isthe‘update’andg:X Ñ pp1qthe‘output’map.
T T
ItisquitestraightforwardtoextendtheconstructionofCoalg ppqtoanopindexedcategoryCoalg ;
weunravelthisopindexingexplicitlyintheappendix(PropositionA.1).
T T
Proposition 2.9. Coalg extends to an opindexed category Coalg : Poly E Ñ Cat. On objects
(polynomials),itreturnsthecategoriesabove. Onmorphismsofpolynomials,wesimplypost-compose:
givenϕ : pÑqandβ :SySÑrTy,ps,obtainSySÑrTy,psÑrTy,qsintheobviousway.
Atthispoint,thereadermaybewonderinginwhatsensetheseopendynamicalsystemsarecoalgebras.
Toseethis,observethatapolynomialmorphismSySÑqisequivalentlyamapSÑqpSq: thatistosay,a
q-coalgebra. Bysettingq“rTy,ps,weseetheconnectionimmediately;tomakeitclear,inProposition
A.2,wespellitoutforthecaseT“N.
2.2 OpenMarkovprocessesviastochasticpolynomials
JustascoalgebrasSÑ pScorrespondtodiscrete-timedeterministicopendynamicalsystems,coalgebras
SÑ pPS correspond to discrete-time stochastic dynamical systems when P is a probability monad
asintroducedabove. Wehavealreadyseenthat‘closed’MarkovchainscorrespondtomapsSÑPS,
and that Markov processes in general time correspond to functors BT Ñ KℓpPq. Our task in this
sectionisthereforetoconnectthesetwoperspectives,extendingthecategoriesofdeterministiccoalgebras
T
Coalg ppq.
Workingconcretely,itisnothardtospottherelevantadjustment. Wethereforemakethefollowing
definition.
Definition2.10. LetM:E ÑE beamonadonthecategoryE,andlet p:Poly
E
beapolynomialinE. Let
pT,`,0qbeamonoidinE,representingtime. Thena pM-coalgebrawithtimeTconsistsinatripleϑ :“
312 DynamicalSystemsviaGeneralizedPolynomialCoalgebra
ř ř
pS,ϑo,ϑuqofastatespaceS:E andtwom
ř
orphismsϑo:TˆSÑ pp1qandϑu:
t:T s:S
prϑopt,sqsÑ
MS,suchthat,foranysectionσ : pp1qÑ prisof p,themapsϑσ :TˆSÑMSgivenby
i:pp1q
ÿ ÿÿ
SÝ ϑ Ý o Ý p´ Ý q Ý ˚ Ñ σ prϑop´,sqsÝ ϑ Ñ u MS
t:T t:T s:S
` ˘
constituteanobjectinthefunctorcategoryCat BT,KℓpTq ,whereBTisthedeloopingofTandKℓpTq
istheKleislicategoryofT. Oncemore,wecalltheclosedsystemϑσ,inducedbyasectionσ of p,the
closureofϑ byσ.
As before, such pM-coalgebras form a category; and these categories in turn are opindexed by
polynomials.
Proposition 2.11. pM-coalgebras with time T form a category, denoted Coalg T ppq. Its morphisms
M
aredefinedasfollows. Letϑ :“pX,ϑo,ϑuqandψ :“pY,ψo,ψuqbetwo pM-coalgebras. Amorphism
f ř :ϑ Ñψ consistsinamorphism f :X ÑY suchthat,foranytimet :Tandglobalsectionσ : pp1qÑ
prisof p,thefollowingnaturalitysquarescommute:
i:pp1q
ř
X
ϑoptq˚σ
prϑopt,xqs
ϑuptq
MX
x:X
f Mf
ř
Y prψopt,yqs MY
ψoptq˚σ ψuptq
y:Y
The identity morphism id on the pM-coalgebra ϑ is given by the identity morphism id on its state
ϑ X
spaceX. Compositionofmorphismsof pM-coalgebrasisgivenbycompositionofthemorphismsofthe
statespaces.
T T
Proposition2.12. Coalg
M
ppqextendstoanopindexedcategory,Coalg
M
p´q:Poly
E
ÑCat. Suppose
T T
ϕ : pÑqisamorphismofpolynomials. WedefineacorrespondingfunctorCoalg pϕq:Coalg ppqÑ
M M
Coalg T pqq as follows. Suppose pX,ϑo,ϑuq:Coalg T ppq is an object (pM-coalgebra) in Coalg T ppq.
M M M
ThenCoalg T pϕqpX,ϑo,ϑuqisdefinedasthetriplepX,ϕ ˝ϑo,ϑu˝ϑo˚ϕ#q:Coalg T pqq,wherethetwo
M 1 M
mapsareexplicitlythefollowingcomposites:
ÿÿ ÿÿ
TˆX Ý ϑ Ñ o pp1qÝ ϕ Ñ1 qp1q, qrϕ ˝ϑopt,xqsÝ ϑ Ý o Ý ˚ Ý ϕ Ñ # prϑopt,xqsÝ ϑ Ñ u MX.
1
t:Tx:X t:Tx:X
Onmorphisms,Coalg T pϕqpfq:Coalg T pϕqpX,ϑo,ϑuqÑCoalg T pϕqpY,ψo,ψuqisgivenbythesame
M M M
underlyingmap f :X ÑY ofstatespaces.
T T
TheopindexedcategoryCoalg
M
ppqclearlygeneralizesCoalg ,sincewecanalwaystakeM“idE.
T
Yet these concrete definitions obscure the more elegant representation of the objects of Coalg as
morphisms SyS Ñ rTy,ps. Our task is therefore to find a setting in which a similar representation
is possible; to do so, we generalize Poly so that the backwards components of its morphisms may
E
incorporate‘side-effects’modelledbyM. WewillcallthecorrespondingcategoryPoly ,andwillfind
M
T T
thatinstantiatingCoalg inPoly recoversCoalg ppq.
M M
We begin by recallingşthat Poly
E
is equivalent to the category of Grothendieck lenses for the self-
indexing[2,5]: Poly E – E{´op,wheretheoppositeistakenpointwiseoneachE{B. Wewilldefine
T.St. ClereSmithe 313
Poly byanalogy,usingthefollowingindexedcategory. SupposeM isacommutativemonadonE and
M
letι denotetheidentity-on-objectsinclusionE ãÑKℓpMqgivenonmorphismsbypost-composingwith
theunitη ofthemonadstructure. Foreaseofexpositioninthisshortpaper, wewillassumeherethat
E “Set.
Definition2.13. DefinetheindexedcategoryE {´:E opÑCatasfollows. OnobjectsB:E,wedefine
M
E
M
{B to be the full subcategory of KℓpMq{B on those objects ιp:EÑ‚ B which correspond to maps
EÑÝ p BÝ η ÑB MBintheimageofι. Nowsuppose f :CÑBisamapinE. WedefineE {f :E {BÑE {C
M M M
asfollows. ThefunctorE
M
{f takesobjectsιp:EÑ‚ Btoιpf˚pq: f˚EÑ‚ Cwhere f˚pisthepullbackof p
along f inE,includedintoKℓpMqbyι.
TodefinetheactionofE
M
{f onmorphismsα :pE,ιp:EÑ‚ BqÑpF,ιq:FÑ‚ Bq,notethatsincewe
musthaveιq‚α “ιp,α mustcorrespondtoafamilyofmapsα : prxsÑMqrxsforx:B. Thenwecan
x
definepE {fqpαqpointwiseaspE {fqpαq :“α : prfpyqsÑMqrfpyqsfory:C.
M M y fpyq
Dş efinition2.14. WedefinePoly
M
tobethecategoryofGrothendiecklensesforE
M
{´. Thatis,Poly
M
:“
E {´op,wheretheoppositeisagaintakenpointwise.
M
Unwinding this definition, we find that the objects of Poly are the same polynomial functors as
M
constitutetheobjectsofPoly
E
. Themorphisms f : pÑqarepairspf
1
,f#q,where f
1
:BÑCisamapin
E and f# isafamilyofmorphismsqrf
1
pxqsÑ‚ prxsinKℓpMq,makingthefollowingdiagramcommute:
ř ř ř
f#
Mprxs qrf pxqs qrys
x:B b:B 1 y:C
{
ηB ˚p q
f
B B 1 C
Remark 2.15. Note that the tensor b extends to Poly : on objects, it is defined identically to the
M
tensor on Poly
E
. On morphisms f :“pf
1
,f#q: pÑq and g:“pg
1
,g#q: p1 Ñq1, we define the tensor
f bg to have forwards component f
1
ˆg
1
as before, and th`e backwards˘components are defined by
pf bgq# :“qrf pxqsˆq1rg px1qsÑMprxsˆMp1rx1sÑM prxsˆp1rx1s ,wherethesecondarrowis
px,x1q 1 1
givenbythecommutativityofthemonadM. Ontheotherhand,weonlygetaninternalhomsatisfyingthe
adjunctionPoly ppbq,rq–Poly pp,rq,rsqwhenthebackwardscomponentsofmorphisms pbqÑr
M M
are‘uncorrelated’between pandq.
Remark2.16. ForPoly tobehavefaithfullylikethecategoryPoly ofpolynomialfunctorsandtheir
M E
morphisms,weshouldwantthesubstitutionfunctorsE {f :E {CÑE {Btohaveleftandrightadjoints.
M M M
Although we do not spell it out here, it is quite straightforward to exhibit the left adjoints. On the
otherhand,writing f˚ asshorthandforE {f,wecanseethatarightadjointonlyobtainsinrestricted
M
circumstances. DenotetheputativerightadjointbyΠ
f
:E
M
{BÑE
M
{C,andforιp:EÑ‚ Bsupposethat
pΠ Eqrysisgivenbythesetof‘partialsections’σ : f´1tyuÑTE of pover f´1tyuasinthecommutative
f
diagram:
f´1tyu tyu
σ
{
TE
ηB ˚p
B
f
C
Then we would need to exhibit a natural isomorphism E {Bpf˚D,Eq–E {CpD,Π Eq. But this will
M M f
onlyobtainwhenthe‘backwards’componentsh#:DrysÑMpΠ Eqrysareintheimageofι—otherwise,
y f
itisnotgenerallypossibletopull f´1tyuoutofM.
314 DynamicalSystemsviaGeneralizedPolynomialCoalgebra
T
Despitetheserestrictions,wedohaveenoughstructureathandtoinstantiateCoalg inPoly . The
M
onlypieceremainingisthecompositionproductŸ,butforourpurposesitsufficestodefineitsaction
on objects, which is identical to its action on objects in Poly
E
1, and then consider Ÿ-comonoids in
Poly . Thecomonoidlawsforcethestructuremapstobedeterministic(i.e.,intheimageofι),andso
M
Ÿ-comonoidsinPoly
M
arejustŸ-comonoidsinPoly
E
.
Finally, we note that we can define morphisms β :SyS ÑrTy,ps: these again just correspond to
morphismsTybSySÑ p,andtheconditionthatthebackwardsmapsbeuncorrelatedbetweenTyand p
issatisfiedbecauseTyhasatrivialexponent. Unwindingsuchaβ accordingtothedefinitionofPoly
M
indeedgivespreciselyapairpβo,βuqoftherequisitetypes;andacomonoidhomomorphismSySÑy T
inPoly ispreciselyafunctorBTÑKℓpMq,therebyestablishingequivalencebetweentheobjectsof
M
T T
Coalg ppqestablishedinPoly andtheobjectsofCoalg ppq. Theequivalencebetweenthehom-setsis
M M
establishedbyasimilarunwinding. Alltold,inthissection,wehavesketchedtheproofofthefollowing
theorem:
T T
Theorem2.17. ConstructingCoalg ppqinPoly yieldsacategoryequivalenttoCoalg ppq.
M M
2.3 Randomdynamicalsystemsandbundlesystems
Intheanalysisofstochasticsystems, itisoftenfruitfultoconsidertwoperspectives: ononeside, one
considersexplicitlytheevolutionofthedistributionofthestatesofthesystem,byfollowing(forinstance)
aMarkovprocess,orFokker-Planckequation. Ontheotherside,oneconsidersthesystemasifitwerea
deterministicsystem,perturbedbynoisyinputs,givingrisetotheframeworksofstochasticdifferential
equationsandassociatedrandomdynamicalsystems.
Whereasa(closed)Markovprocessistypicallygivenbytheactionofa‘time’monoidonanobject
inaKleislicategoryofaprobabilitymonad,a(closed)randomdynamicalsystemisgivenbyabundle
of closed dynamical systems, where the base system is equipped with a probability measure which it
preserves: the idea being that a random dynamical system can be thought of as a ‘random’ choice of
dynamicalsystemonthetotalspaceateachmomentintime,withthebasemeasure-preservingsystem
beingthesourceoftherandomness[6].
Thisideacorrespondsinnon-dynamicalsettingstothenotionofrandomnesspushback[7,Def. 11.19],
bywhichastochasticmap f :AÑPBcanbepresentedasadeterministicmap f5:ΩˆAÑBwhere
pΩ,ωqisaprobabilityspacesuchthat,foranya:A,pushingω forwardthrough f5p-,aqgivesthestate
fpaq; that is, ω induces a random choice of map f5pω,-q:AÑB. Similarly, under ‘nice’ conditions,
randomdynamicalsystemsandMarkovprocessesdocoincide,althoughtheyhavedifferentsuitabilityin
applications.
Inthissection,wesketchhowthegeneralized-coalgebraicstructuresdevelopedaboveextendalsoto
randomdynamicalsystems,thoughwithmostdetailsdeferredtotheAppendix. Byobservingthatwecan
also‘openup’thebasesystemofarandomdynamicalsystem,weobtainfurthermoreanotionofopen
bundlesystem: abundleofdynamicalsystemsthatiscoherently‘open’overpolynomialsbothinthetotal
spaceandthebasespace.
Definition2.18. SupposeE isacategoryequippedwithaprobabilitymonadP :E ÑE andaterminal
object1:E. AprobabilityspaceinE isanobjectoftheslice1{KℓpPqoftheKleislicategoryofthe
probabilitymonadunder1.
Remark2.19. InordertoconsiderpolynomialsinE,wewilllaterassumeagainthatitislocallyCartesian
closed. AsimpleexampleofalocallyCartesianclosedcategoryequippedwithaprobabilitymonadis
1WeleavethefullexpositionofŸinPoly totheforthcomingextendedversionofthispaper.
M
T.St. ClereSmithe 315
thecategorySetequippedwiththemonadD takingeachsettothesetoffinitely-supportedprobability
distributionsuponit.
Proposition 2.20. There is a forgetful functor 1{KℓpPqÑE taking probability spaces pB,βq to the
underlyingspacesBandtheirmorphisms f :pA,αqÑpB,βqtotheunderlyingmaps f :AÑPB. We
willwriteBtorefertothespaceinE underlyingaprobabilityspacepB,βq,intheimageofthisforgetful
functor.
Definition2.21. LetpB,βqbeaprobabilityspaceinE. Aclosedmetricormeasure-preservingdynamical
systempϑ,βqonpB,βqwithtimeTisacloseddynamicalsystemϑ withstatespaceB:E suchthat,for
allt :T,Pϑptq˝β “β;thatis,eachϑptqisapB,βq-endomorphismin1{KℓpPq.
Proposition2.22. Closedmeasure-preservingdynamicalsystemsinE withtimeTformtheobjectsofa
categoryCatpBT,EqP whosemorphisms f :pϑ,αqÑpψ,βqaremaps f :ϑp˚qÑψp˚qinE between
thestatespacesthatpreservebothflowandmeasure,asinthefollowingcommutativediagram,which
alsoindicatestheircomposition:
Pϑp˚q
Pϑptq
Pϑp˚q
α Pf Pf α
1 Pψp˚q Pψp˚q 1
β Pψptq β
γ
Pg Pg
γ
Pλp˚q Pλp˚q
Pλptq
Definition 2.23. Let pϑ,βq be a closed measure-preserving dynamical system. A closed random
dynamicalsystemoverpϑ,βqisanobjectoftheslicecategoryCatpBT,Eq{ϑ;itisthereforeabundleof
thecorrespondingfunctors.
Example2.24. ThesolutionsXpt,ω;x q:R ˆΩˆMÑM toastochasticdifferentialequationdX “
0 ` t
fpt,Xqdt`σpt,XqdW,whereW :R ˆΩÑM isaWienerprocessinM,definearandomdynamical
t t t `
systemR ˆΩˆMÑM:pt,ω,xqÞÑXpt,ω;x qovertheWienerbaseflowθ :R ˆΩÑΩ:pt,ωqÞÑ
` 0 `
Wps`t,ωq´Wpt,ωqforanys:R .
`
Definition2.25. Letpθ,βqbeaclosedmeasure-preservingdynamicalsysteminE withtimeT,andlet
p:Poly
E
beapolynomialinE. WriteΩ:“θp˚qforthestatespaceofθ,andletπ :SÑΩbeanobject
(bundle) in E{Ω. An open random dynamical system over pθ,βq on the interfac
ř
e p
ř
with state space
π :SÑΩandtimeTconsistsinapairofmorphismsϑo:TˆSÑ pp1qandϑu: prϑopt,sqsÑS,
ř t:Ts:S
suchthat,foranyglobalsectionσ : pp1qÑ prisof p,themapsϑσ :TˆSÑSdefinedas
i:pp1q
ÿ ÿÿ
SÝ ϑ Ý o Ý p´ Ý q Ý ˚ Ñ σ prϑop´,sqsÝ ϑ Ñ u S
t:T t:T s:S
formaclosedrandomdynamicalsysteminCatpBT,Eq{θ,inthesensethat,forallt :Tandsectionsσ,
thefollowingdiagramcommutes:
ř
S
ϑoptq˚σ
prϑopt,sqs
ϑuptq
S
s:S
π π
Ω Ω
θptq
316 DynamicalSystemsviaGeneralizedPolynomialCoalgebra
Proposition2.26. Letpθ,βqbeaclosedmeasure-preservingdynamicalsysteminE withtimeT,andlet
p:Poly
E
beapolynomialinE. Openrandomdynamicalsystemsoverpθ,βqontheinterface pformthe
T
objectsofacategoryRDyn pp,θq. SeeDefinitionA.3intheAppendixfordetails.
T
Proposition 2.27. The categories RDyn pp,θq collect into a doubly-indexed category of the form
RDyn T :Poly
E
ˆCatpBT,EqP ÑCat. SeePropositionA.4intheAppendixfordetails.
Byallowingthebasesystemsofopenrandomdynamicalsystemsinsteadtobearbitrarydynamical
systems,andthenbyopeningthemupsimilarly,oneobtainsnotionsofopenbundledynamicalsystem,and
correspondinglydoubly-opindexedcategoriesoverpairsofpolynomials. Representingthesecategories
T
concisely,aswedidforthecategoriesCoalg ppq,isthesubjectofon-goingwork,andsowedeferthe
M
detailstotheAppendix,inDefinitionA.5,andPropositionsA.6,A.7,andA.8.
3 Hierarchical systems via generalized Org
Inordertoexhibitthemainexampleofthispaper,wewillneedtoconstruct,fromtheopindexedcategories
of pP-coalgebras introduced above, monoidal categories whose objects represent the interfaces of
hierarchicalsystemsandwhosemorphismsrepresentthehierarchicalsystemsthemselves. Informallyput,
wewillthinkofamorphism pÑqinsuchacategoryas“aq-shapedsystemwitha p-shapedhole”. In
ordertoachievethis,wewillinturnadoptandgeneralizetheoperadOrgintroducedbySpivak[8].
Definition3.1(FollowingSpivak[8,Def. 2.19]). Wedefinea(category-enriched,symmetric,coloured)
operad, Org T . Its objects are polynomials, and for any tuple of polynomials pp ,...,p ;p1q of at
M 1 k
leastlength2,thehomcategoryOrg T pp ,...,p ;p1qisgivenbyCoalg T prp b¨¨¨bp ,p1sq. Notethat
M 1 k M 1 k
tyÑrTy,rp,pssu–tTyÑrp,psu. Onanygiveninterface p,theidentitycoalgebraisthereforegivenby
themorphismTyÑrp,psthatconstantlyoutputsid andhastrivialbackwardscomponent. Todefine
p
composition,weusethecanonicalmapsrp,qsbrq,rsÑrp,rsandrp,qsbrp1,q1sÑrpbp1,qbq1s,the
T T T T
pseudofunctorialityofCoalg p´q,andthelaxatorsCoalg ppqˆCoalg pqqÑCoalg ppbqq;since
M M M M
eachofthesecomponentsisassociativeandunital,thecompositioniswell-defined.
Remark3.2. Spivak’soriginaldefinitionofOrgcorrespondstothecasewhereM“idE andT“N.
Forourpresentpurposes,allthatisrequiredistoobtainfromOrga(monoidal)(bi)category2. We
T
therefore restrict Org to a bicategory Hier whose objects are again polynomials and whose hom-
M
T
categories from p to q are given by Org pp,qq; it inherits a monoidal structure from the monoidal
M
T
categoryassociatedtothesymmetricoperadOrg
M
. WewillwriteHier|E todenotetherestrictionofHier
tothelinearpolynomialsAy.
Tobr
ř
ingthing
ř
salittledowntoearth,firstconsiderageneralsystemβ : pÑqinHier. Recallthat
rp,qs“ f:pÑq y i:pp1q qrf 1piqs. β ist ř heref ř oreg ř ivenbyachoiceofstatespaceX alongwithapairofmaps
βo:TˆX ÑPoly pp,qqandβu: qrβopt,sq piqsÑMX.
M t:T x:X i:pp1q 1
Tomakethisalittlemorecomprehensibleagain,suppose p“AyS andq“ByT. ThenPoly pp,qq“
M
EpA,BqˆEpAˆT,Sq,andsobytheuniversalpropertyoftheproduct,βoisequivalentlygivenbyapairof
maps: a‘forwards’outputmapβo:TˆXˆAÑBanda‘backwards’outputmapβo:TˆXˆAˆT ÑS;
1 2
if this reminds you of a category of lenses, then this is no surprise: the subcategory of Poly on the
E
monomials AyS is indeed the category of bimorphic lenses in E. Finally, the update map simplifies to
βu:TˆXˆAˆT ÑMX,whichupdatesthestategiven‘forwards’inputsinAand‘backwards’inputsin
T. WemightdenotethesubcategoryofHieronsuchlinearpolynomialsasHiBi,toindicate‘hierarchical
bidirectional’systems.
2andinfact,wewon’tevenreallyneedtomakeuseofthemonoidalorbicategoricalstructureshere!
T.St. ClereSmithe 317
Takingonefurtherstepdowntheladderofcomplexity,webrieflyconsidersystemsβ :AyÑByin
Hier|E: thesearejusthierarchicalbidirectionalsystemswhereS“T “1. Therefore, inthiscase, the
backwardsoutputmapbecomestrivial,leavingonlyaforwardsoutputmapβo:TˆXˆAÑBandan
updatemaptakinginputsinA,βu:TˆXˆAÑMX. ByfillingintheA-inputs,wegetasystemwith
B-outputs,correspondingtotheinformalintuitionwithwhichweopenedthissection: wehaveaB-shaped
systemwithanA-shapedhole. Compositionofthesesystemscorrespondstoplacingsystemsinparallel
usingbandplugginginterfacesintoholesofthematchingshape.
We end this section by briefly sketching the canonical b-comonoid structure on Hier|E, making
Hier|E intoa‘semi-Markov’[7]or‘copy-discard’[9]category. Notethat,ifasystemhasthetrivialstate
space1,then(i)tensoringwithitisano-op,and(ii)ithasatrivialupdatemap(assumingthatM1–13).
Thus,foreachobjectAy,weobtainadiscardingsystem :AyÑ1ybytakingthetrivialstatespace,
A
trivialupdatemap,andtrivialoutputmap. Thecopyingsystem :AyÑpAˆAqyagainhastrivialstate
A
spaceandupdatemap,butnowtheoutputmap o :TˆAÑAˆAisgivenbytheconstantcopyingmap
A
pt,aqÞÑpa,aq. Itisthenstraightforwardtocheckthecomonoidlaws.
4 Dynamical Bayesian inversion
One consequence of Hier|E being a copy-discard category is that we can instantiate an abstract form
of Bayes’ rule there, giving rise to a notion of when one pP-coalgebraic system can be seen to be
‘predicting’or‘inverting’another. Ingeneral,Bayes’ruleisexpressedasanequalitybetweenmorphisms,
butthisistoostrongfordynamicalsystems,which‘black-box’theirstatespaces: thatistosay,weshould
considertwomorphisms(systems)‘equal’whentheyareobservationallyequivalent—or,moreprecisely,
whentheyarerelatedbya(quasi-)bisimulation.
Definition 4.1. We define a family of relations „ that we collectively call quasi-bisimilarity. Given
systemsϑ :“pX,ϑo,ϑuqandψ :“pY,ψo,ψuqinCoalg T ppqandasectionσ of p, wefirstdefinethe
P
trace4 ortrajectoryofϑ givenσ asthemorphism
ÿÿ
trpθ,σq:“TˆX Ý ϑ Ý o Ý p- Ý q Ý ˚ Ñ σ prϑopt,xqsÝ p Ý ϑ Ý uq Ý Ź Ñ T TˆPX Ý P ÝÝ ϑ Ñ o Ppp1q.
t:Tx:X
Supposing α :1ÑPX and β :1ÑPY to be corresponding initial states, we define ϑ α „ ,β ψ as the
relation
ϑ α „ ,β ψ ðñ @σ :Γppq.@t :T.trpϑ,σqptq‚α “trpψ,σqptq‚β,
wherewewriteg‚ f toindicateKleislicompositiong‚ f “µ˝Pg˝ f (whereµ isthemultiplicationof
themonadP). Wewriteϑ D „ ,D ψ whenthereexistssomeα,β suchthatϑ α „ ,β ψ,andlikewiseforϑ @ „ ,@ ψ,
@,D D,@
ϑ „ ψ,andϑ „ ψ.
Inlightofthisdefinition,wecandefineanappropriatenotionofBayesianinversionforHier|E:
3ThisconditionissatisfiedwhenMisaprobabilitymonadlikethefinite-supportdistributionmonad,forinstance.
4Notethatthisisinanalogywiththecoalgebraictrace,notthetraceoftracedmonoidalcategories.
318 DynamicalSystemsviaGeneralizedPolynomialCoalgebra
Definition4.2. Wesaythatasystemc:XyÑYyinHier|E admitsBayesianinversionwithrespectto
π :yÑXy,ifthereexistsasystemc: :YyÑXysatisfyingtheequation[9,eq. 5]:
π
X Y X Y
c c:
π
D,D
„
c
π π
We call c: the Bayesian inversion of c with respect to π, and call the defining relation the dynamical
π
Bayes’rule.
5 The Laplace doctrine of predictive processing
Inreal-worldsystems,however,evensuchquasi-bisimulationistoostrong. Inthesettingofcomputational
neuroscience,itisproposed[10,11]thatcertainneuralcircuitsimplementapproximateBayesianinference
byoptimizingcertainstatisticalgames[12]. AstatisticalgameconsistsofaBayesianlens—apairofa
‘forwards’stochasticchannelAÑPBanda‘backwards’inversionPAˆBÑPA—equippedwitha
lossfunctiontoevaluatethesystemspredictiveperformance. Embodiedpredictivesystemssuchasbrains
thenrealizethesegamesasdynamicalsystems. Herewesketchthisfunctorialsemantics,usingacategory
of‘hierarchicalbidirectionalStat-systems’,following[12,13].
We noted above that the category HiBi resembles a category of lenses, but it does not sufficiently
resemblethecategoryofBayesianlenses: noticethatthebackwardsmapsofthelatterhavecodomainsof
theformPAˆT ÑPSratherthanAˆT ÑS. Forthisreason,HiBimakesforaninadequatesemantic
category for predictive processing. However, all is not lost, for we can define a modification of HiBi
byanalogytothedefinitionofBayesianlensesasGrothendiecklensesfortheindexedcategoryStatof
state-dependentmaps[13].
Definition5.1. DenotebyHiBiP thefollowing(semi-)(bi)category. ItsobjectsarepairsofobjectsinE,
anditshom-categoriesHiBiPppA,Sq,pB,TqqaregivenbyOrg T
P
pPAyS,ByTq. Compositionisgivenby
thefollowingfamilyofcompositemaps:
HiBiPppA,Sq,pB,TqqˆHiBiPppB,Tq,pC,Uqq
“Org T pPAyS,ByTqˆOrg T pPByT,CyUq
P P
“Coalg T prPAyS,ByTsqˆCoalg T prPByT,CyUsq
P P
ÑCoalg T prPAyS,ByTsbrPByT,CyUsq
P
ÑCoalg T prPAyS,PByTsbrPByT,CyUsq
P
ÑCoalg T prPAyS,CyUsq
P
“HiBiPppA,Sq,pC,Uqq
wherethefourthlineisgeneratedfromthemonadicunitη :BÑPBbyCoalgprPyS,pη qyTsq.
B B
T.St. ClereSmithe 319
Remark5.2. Notethatwesay’semi-’(bi)category: thisisbecauseHiBiP doesnothaveidentities. This
T
isnotproblematicforourworkhere;andofcourseOrg itselfdoeshaveidentities.
P
Wearenowinapositiontosketchthe‘Laplacedoctrine’ofdynamicalsemanticsforapproximate
inference. WefirstrecallthenotionofD-Bayesianinferencegame[12]:
Definition 5.3 (Bayesian inference). Let D : KℓpPqpI,XqˆKℓpPqp1,Xq Ñ R be a measure of
divergence between states on X. Then a (simple) D-Bayesian inference game is a statistical game
pX,XqÑpY,Yqwithfitnessfunctionφ :KℓpPqp1,XqˆKℓpPqpY,XqÑRgivenby
” ´ ¯ı
φpπ,kq“ E D c1 pyq,c:pyq
π π
y„k‚c‚π
wherepc,c1qconstitutesthelenspartofthegameandc: istheexactinversionofcwithrespecttoπ.
π
Write D for the Kullback-Leibler divergence. Given a D -Bayesian inference game pγ,ρ,φq:
KL KL
pX,XqÑpY,Yq where X andY are Euclidean spaces and whose forward and backward channels are
constrained to output Gaussian distributions, the Laplace doctrine returns a hierarchical bidirectional
Stat-systemminimizinganupperboundonthedivergencebetweeneachapproximateposteriorρ and
π
the‘true’posteriorγ:,foranyGaussianstateπ :PX.
π
Remark5.4. Notethatthestatisticalpropertiesofthesystemarenotthefocusofthispaper: thisdoctrine
ismerelybeingusedtoillustratethecoalgebraicframework.
TheLaplacedoctrinehingesonthefollowingapproximation,whoseproofwedefertoA.9.
Lemma5.5(Laplaceapproximation). GivenaD -Bayesianinferencegamepγ,ρ,φq:pX,XqÑpY,Yq
KL
withforwardschannelγ :X ÑPY constrainedtoemitGaussiandistributions,writeµ pxq:R|Y| forthe
γ
meanofγpxqandΣ pxq:R|Y|ˆ|Y| foritscovariancematrix,andassumethatforally:Y,theeigenvalues
γ
ofΣ pyqaresmall.
ρπ
Thenthelossφ :KℓpPqp1,XqˆKℓpPqpY,XqÑRisapproximatelyboundedfromaboveby
” ´ ¯ı
φpπ,kq“ E D ρ pyq,γ:pyq
π π
y„k‚γ‚π” ´ ¯ ı
ď E D ρ pyq,γ:pyq ´logp pyq
π π γ‚π
y„k‚γ‚π“
‰ “ ‰
“ E Fpyq « E FLpyq
y„k‚γ‚π y„k‚γ‚π
whereF iscalledthefreeenergyandwhereFL isitsLaplaceapproximation,
` ˘
FLpyq“E µ pyq,y ´S rρ pyqs (1)
pπ,γq ρπ X π
“´logp py|µ pyqq´logp pµ pyqq´S rρ pyqs
γ ρπ π ρπ X π
where S rρ pyqs“E r´logp px|yqs is the Shannon entropy of ρ pyq, and p :Y ˆX Ñr0,1s,
x π x„ρπpyq ρπ π γ
p : X Ñ r0,1s, and p : X ˆY Ñ r0,1s are density functions for γ, π, and ρ respectively. The
π ρπ π
approximationisvalidwhenΣ satisfies
ρπ
` ˘` ˘
Σ pyq“ B2E µ pyq,y ´1 . (2)
ρπ x pπ,γq ρπ
With this approximation in hand, and given such a statistical game pγ,ρ,φq, we will construct
a hierarchical bidirectional Stat-system Laplacepγ,ρ,φq performing approximate stochastic gradient
320 DynamicalSystemsviaGeneralizedPolynomialCoalgebra
descentonthelossfunction,withrespecttothestatisticalparametersoftheinversionsρ . Wewillworkin
π
discretetime,T“N,althoughallofwhatfollowscanbedoneincontinuoustime,T“R ,byreplacing
`
thediscreteupdatestepsbystochasticdifferentialequations.
Since the entropy S rρ pyqs depends only on the variance Σ pyq, to optimize the mean µ pyq it
X π ρπ ρπ
sufficestoconsideronlytheenergyE pµ pyq,yq. Wehave
pπ,γq ρπ
E px,yq“´logp py|xq´logp pxq
pπ,γq γ π
A E
@ D
1 1
“´ ε py,xq,Σ pxq´1 ε py,xq ´ ε pxq,Σ ´1ε pxq
γ γ γ π π π
2 b b2
`log p2πq|Y|detΣ pxq`log p2πq|X|detΣ
γ π
andastraightforwardcomputationshowsthat
B E px,yq“´B µ pxqTΣ pxq´1 ε py,xq`Σ ´1ε pxq.
x pπ,γq x γ γ γ π π
Letη py,xq:“Σ pxq´1 ε py,xqandη pxq:“Σ ´1ε pxq,sothat
γ γ γ π π π
B E px,yq“´B µ pxqTη py,xq`η pxq. (3)
x pπ,γq x γ γ π
Note that E defines a function XˆY ÑR. We will use the domain XˆY of this function as the
pπ,γq
ÑÝ
statespaceofoursystem. Toavoidambiguity,wewillwrite X toindicatethespaceX whenitisused
ÐÝ
asaninputinthe‘forwards’direction,and Y toindicatethespaceY whenitisusedasaninputinthe
‘backwards’direction.
OursystemLaplacepγ,ρ,φqwillthereforehavethetype
ÑÝ ÑÝ
pXˆY, βo:XˆYˆPX Ñ Y ,
1
ÑÝ ÐÝ ÐÝ
βo:XˆYˆPX ˆY Ñ X,
2
ÑÝ ÐÝ
βu:XˆYˆPX ˆY ÑPpXˆYqq.
We define βo to be the projection of the second factorY of the state space ontoY, and βo to be the
1 ÑÝ ÐÝ 2
projectionofthefirstfactorX ontoX. Theupdatemapβu:XˆYˆPX ˆY ÑPpXˆYqisthengiven
bycomposingthecommutativity(or‘doublestrength’)ofthemonadP,dst:PXˆPY ÑPpXˆYq,
afterthefollowingmap(representedasastringdiagraminE):
X
Y
PX
ρu
PX
Y
PY
γÐ
wherep´qÐ:“µ P ˝Pp´qdenotesKleisliextension(forµ P themultiplicationofthemonadP),so
thatγÐ:“µ P ˝Ppγq:PX ÑPY.
Y
Inturn,themapρu:XˆPXˆY ÑPX isdefinedby
ρu:XˆPXˆY ÑR|X|ˆR|X|ˆ|X|ãÑPX
´ ¯
px,π,yqÞÑ x´λB E px,yq,Σ˚ pyq
x pπ,γq ρπ
T. St. ClereSmithe 321
wheretheinclusionintoPX pickstheGaussianstatewiththegivenstatisticalparameters,whereλ :R
`
issomechoiceof“learningrate”,whereΣ˚ pyqisasaboveandinEquation(2),andwhereB E px,yq
ρπ x pπ,γq
isasinEquation(3).
Observethatthefactorρu performsapproximatestochasticgradientdescentonthefreeenergy: fora
giveninputy:Y,themeantrajectoryofthesystemfollowstheupdatelaw µ ÞÑµ ´λB E pµ ,yq,
ρ ρ µρ pπ,γq ρ
and,whenΣ pyq“Σ˚pyq,wehaveB E pµ ,yq«B Fpyq. Notealsothattheupdatemapρudepends
ρ ρ µρ pπ,γq ρ µρ
onaprior,justastheinversionmapρ ofthelenspγ,ρqdoes.
AfulltreatmentoftheLaplacedoctrinewillappearinaforthcomingsequealtotheauthor’s[12].
6 Conclusions; current and future work
In this work we have sketched a framework for treating open dynamical systems of a general nature
as coalgebras for certain polynomial functors or—in the case of systems with side-effects such as
randomness—certaingeneralizationsthereof. Althoughwehaveattemptedtogiveawideoverviewofthe
applicabilityofthesestructures,withaparticularfocusontheadaptivesystemsofprimaryinteresttothe
author,weareawarethatwehavebarelyscratchedthesurfaceoftheiruseandrelationships. Here,we
brieflylistsomeavenuesofcurrentandfuturework.
Our current principal focus is on exploring the connections between these structures and other
compositionaltreatmentsofdynamicalsystems. Inparticular,relatingourcategoriestotherespective
frameworksofMyers[14],Libkind[15]andBaezandcolleagues(e.g.,[16]). Evidently,thestructures
presentedherearemostcloselyinlinewiththeapproachesexploredbySpivak[8,17],andareparticularly
interested in generalizing his topos-theoretic perspective: given that the category of discrete-time
T
deterministicsystemsoverapolynomial pformsatopos,wesuspectthatsotoodoesCoalg ppq. Weare
alsoseekingtheconnectionsbetweentheseputativetopoiandthetopoiofbehaviourtypes[17]aswell
aswithcoalgebraiclogic[18],particularlyinitsmodalforms. Wehopethatwecanfurtherdevelopthe
theoryofPoly tosupportsomeofthesemethods,too.
M
Finally,thereareanumberofwaysinwhichthisframeworkshouldbemademoreelegant. Inparticular,
we hope to cast a number of properties instead as structures, including the comonoid-homomorphism
property of our main definition, and the explicit definitions of random and bundle dynamical systems.
Withparticularrespecttothelatter,weexpecttheretobeaninductivestoryofnestedparameterization,
whichappearstotheauthortohaveanopetopicshapecloselyconnectedtotheParaconstruction[19].
7 References
[1] F.W.LawvereandS.H.Schnauel.ConceptualMathematics:AFirstIntroductiontoCategories.
Cambridge,UKNewYork:CambridgeUniversityPress,2009. ISBN:978-0-511-80419-9. DOI:
10.1017/CBO9780511804199.
[2] DavidISpivakandNelsonNiu.PolynomialFunctors:AGeneralTheoryofInteraction.(Inpress),
2021.URL:https://raw.githubusercontent.com/ToposInstitute/poly/main/Book-Poly.pdf.
[3] DavidI.Spivak.AReferenceforCategoricalStructuresonPoly.02/01/2022.arXiv:2202.00534.
preprint.
[4] DanelAhmanandTarmoUustalu.“DirectedContainersasCategories”.In:EPTCS207,2016,pp.
89-98(04/05/2016).DOI:10.4204/EPTCS.207.5.arXiv:1604.01187.
322 DynamicalSystemsviaGeneralizedPolynomialCoalgebra
[5] DavidI.Spivak.Poly:AnAbundantCategoricalSettingforMode-DependentDynamics.05/05/2020.
arXiv:2005.01894.preprint.
[6] Ludwig Arnold. Random Dynamical Systems. Springer Berlin Heidelberg, 1998. 612 pp. ISBN:
978-3-540-63758-5.DOI:10.1007/978-3-662-12878-7.URL:https://doi.org/10.1007/978-3-662-
12878-7.
[7] TobiasFritz.“ASyntheticApproachtoMarkovKernels,ConditionalIndependenceandTheorems
onSufficientStatistics”.In:AdvancesinMathematics370.107239(08/19/2019). DOI:10.1016/j.
aim.2020.107239.arXiv:1908.07021v3.
[8] David I. Spivak. “Learners’ Languages”. In: Electronic Proceedings in Theoretical Computer
Science372(03/01/2021),pp.14–28.DOI:10.4204/EPTCS.372.2.arXiv:2103.01189.
[9] KentaChoandBartJacobs.“DisintegrationandBayesianInversionviaStringDiagrams”.In:Math.
Struct.Comp.Sci.29(2019)938-971(08/29/2017). DOI:10.1017/S0960129518000488.arXiv:
1709.00322v3.
[10] K. Friston. “A Theory of Cortical Responses”. In: Philos. Trans. R. Soc. Lond., B, Biol. Sci.
360.1456(04/2005),pp.815–836.DOI:10.1098/rstb.2005.1622.pmid:15937014.
[11] ChristopherLBuckleyetal.“TheFreeEnergyPrincipleforActionandPerception:AMathematical
Review”.In:JournalofMathematicalPsychology81(05/24/2017),pp.55–79.DOI:10.1016/j.jmp.
2017.09.004.arXiv:1705.09156v1.
[12] Toby St Clere Smithe. Compositional Active Inference I: Bayesian Lenses. Statistical Games.
09/09/2021.arXiv:2109.04461.preprint.
[13] Toby St Clere Smithe. Bayesian Updates Compose Optically. 05/31/2020. arXiv: 2006.01631.
preprint.
[14] David Jaz Myers. “Double Categories of Open Dynamical Systems (Extended Abstract)”. In:
ElectronicProceedingsinTheoreticalComputerScience333(02/08/2021),pp.154–167. ISSN:
2075-2180.DOI:10.4204/EPTCS.333.11.arXiv:2005.05956.URL:http://arxiv.org/abs/2005.05956
(visitedon11/16/2022).
[15] Sophie Libkind. An Algebra of Resource Sharing Machines. 07/28/2020. arXiv: 2007.14442.
preprint.
[16] John C. Baez, Kenny Courser, and Christina Vasilakopoulou. “Structured versus Decorated
Cospans”. In: Compositionality 4.3 (09/01/2022). DOI: 10.32408/compositionality-4-3. arXiv:
2101.09363.
[17] PatrickSchultz,DavidISpivak,andChristinaVasilakopoulou.“DynamicalSystemsandSheaves”.
In:AppliedCategoricalStructures28(2020),pp.1–57. DOI:10.1007/s10485-019-09565-x.arXiv:
1609.08086.
[18] BartJacobs.IntroductiontoCoalgebra.Vol.59.CambridgeUniversityPress,2017. ISBN:978-
1-107-17789-5. URL: https://www.cambridge.org/gb/academic/subjects/mathematics/logic-
categories-and-sets/introduction-coalgebra-towards-mathematics-states-and-observation.
[19] MatteoCapucci,BrunoGavranovic´,andTobySt.ClereSmithe.“ParameterizedCategoriesand
Categories by Proxy”. In: Category Theory 2021. Category Theory. Genoa, 2021. URL: https:
//www.youtube.com/watch?v=lYs6Bs6JK9Q.
T.St. ClereSmithe 323
A Extra proofs and structures
T T
Proposition A.1. Coalg ppq extends to a polynomially-indexed category, Coalg : Poly E Ñ Cat.
T
Suppose ϕ : p Ñ q is a morphism of polynomials. We define a corresponding functor Coalg pϕq :
Coalg T ppqÑCoalg T pqqasfollows. SupposepX,ϑo,ϑuq:Coalg T ppqisanobject(dynamicalsystem)
inCoalg T ppq. ThenCoalg T pϕqpX,ϑo,ϑuqisdefinedasthetriplepX,ϕ ˝ϑo,ϑu˝ϑo˚ϕ#q:Coalg T pqq,
1
wherethetwomapsareexplicitlythefollowingcomposites:
ÿÿ ÿÿ
TˆX Ý ϑ Ñ o pp1qÝ ϕ Ñ1 qp1q, qrϕ ˝ϑopt,xqsÝ ϑ Ý o Ý ˚ Ý ϕ Ñ # prϑopt,xqsÝ ϑ Ñ u X.
1
t:Tx:X t:Tx:X
On morphisms, Coalg T pϕqpfq:Coalg T pϕqpX,ϑo,ϑuqÑCoalg T pϕqpY,ψo,ψuq is given by the same
underlyingmap f :X ÑY ofstatespaces.
Proof. WeneedtocheckthatCoalg T pϕqpX,ϑo,ϑuqsatisfiestheflowconditionsofDefinition2.1,that
T T
Coalg pϕqpfq satisfies the naturality condition of Proposition 2.3, and that Coalg is
ř
functorial with
respecttopolynomials. Webeginwiththeflowcondition. Givenasectionτ :qp1qÑ qrjsofq,we
j:qp1q
requiretheclosuresCoalg T pϕqpϑqτ :TˆX ÑX givenby
ÿ ÿÿ ÿÿ
X Ý ϑ Ý o Ý p´ Ý q Ý ˚ Ñ τ qrϕ ˝ϑopt,xqsÝ ϑ Ý o Ý ˚ Ý ϕ Ñ # prϑopt,xqsÝ ϑ Ñ u X
1
t:T t:Tx:X t:Tx:X
tosatisfyCoalg T pϕqpϑqτp0q“id andCoalg T pϕqpϑqτps`tq“Coalg T pϕqpϑqτpsq˝Coalg T pϕqpϑqτptq.
X
Notethatthefollowingdiagramcommutes,bythedefinitionofϕ#,
ř ř
ϕ# ϕ˚τ
pris qrϕ piqs 1 pp1q
1
i:pp1q i:pp1q
p ϕ˚q
1
pp1q pp1q
so that ϕ#˝ϕ˚τ is a section of p. Therefore, letting σ :“ϕ#˝ϕ˚τ, for Coalg T pϕqpϑqτ to satisfy the
1 1
flowconditionforτ reducestoϑσ satisfyingtheflowconditionforσ. Butthisisgivenexhypothesiby
Definition2.1,foranysuchsectionσ,soCoalg T pϕqpϑqτ satisfiestheflowconditionforτ. Andsinceτ
T
wasanysection,weseethatCoalg pϕqpϑqsatisfiestheflowconditiongenerally.
T
TheproofthatCoalg pϕqpfqsatisfiesthenaturalityconditionofProposition2.3proceedssimilarly.
Supposingagainthatτ isanysectionofq,werequirethefollowingdiagramtocommuteforanytime
t :T:
ř ř
X
ϑoptq˚ϕ
1
˚τ
qrϕ ˝ϑopt,xqs
ϑoptq˚ϕ#
prϑopt,xqs
ϑuptq
X
1
x:X x:X
f f
ř ř
Y
ψoptq˚ϕ
1
˚τ
qrϕ ˝ψopt,xqs
ϑoptq˚ϕ#
prψopt,xqs
ψuptq
Y
1
y:Y y:Y
324 DynamicalSystemsviaGeneralizedPolynomialCoalgebra
Againlettingσ :“ϕ#˝ϕ˚τ,weseethatthisdiagramreducesexactlytothediagraminProposition2.3
1
bythefunctorialityofpullback,andsince f makesthatdiagramcommute,itmustalsomakethisdiagram
commute.
T
Finally, to show that Coalg is functorial with respect to polynomials amounts to checking that
compositionandpullbackarefunctorial;butthisisabasicresultofcategorytheory.
PropositionA.2. WhenT“N,thecategoryCoalg N ppqofopendynamicalsystemsover pwithtimeN
isequivalenttothetopos p-Coalgof p-coalgebras[8].
Proof. p-Coalg has as objects pairs pS,βq where S:E is an object in E, β :SÑ pŸS is a morphism
ofpolynomials(interpretingSastheconstantcopresheafonthesetS),andŸdenotesthecomposition
monoidalproductinPoly
E
(i.e.,composingthecorrespondingcopresheave
ř
sE ÑE). Astraightforward
computationshowsthat,interpretedasanobjectinE, pŸScorrespondsto Spris. Bytheuniversal
ř i:pp1q
propertyofthedependentsum,amo
ř
rphismβ :SÑ
i:pp1q
Spris thereforecorrespondsbijectivelytoa
pairofmapsβo:SÑ pp1qandβu: prβopsqsÑX. ByProposition2.6,suchapairisequivalently
s:S
adiscrete-timeopendynamicalsystemover pwithstatespaceS: thatis,theobjectsof p-Coalgarein
N
bijectionwiththoseofCoalg ppq.
` ˘ ` ˘
Next,weshowthatthehom-sets p-Coalg pS,βq,pS1,β1q andCoalg N ppq pS,βo,βuq,pS1,β1o,β1uq
areinbijection. Amorphism f :pS,βqÑpS1,β1qof p-coalgebrasisamorphism f :SÑS1 betweenthe
statespacessuchthatβ1˝ f “ppŸ fq˝β. Unpackingthis,wefindthatthismeansthefollowingdiagram
inE mustcommuteforanysectionσ of p:
ř ř
S prβopsqs pris pp1q
s:S i:pp1q
{
βo
S pp1q
f
f
β1o
S1 pp1q
ř ř
S1 prβ1ops1qs pris pp1q
s1:S1 i:pp1q
{
βu
σ
β1u σ
Pulling the arbitrary section σ back along the ‘output’ maps βo and β1o means that the following
T.St. ClereSmithe 325
commutes:
ř
S
βu
prβopsqs
βo˚σ
S
s:S
S
f
f
S1
ř
S1 prβ1ops1qs S1
β1u
s1:S1
β1o˚σ
Forgettingtheverticalprojectionsoutofthepullbacksgives:
ř
S
βu
prβopsqs
βo˚σ
S
s:S
S
f
f
S1
ř
S1 prβ1ops1qs S1
β1u
s1:S1
β1o˚σ
Finally,bycollapsingtheidentitymapsandreflectingthediagramhorizontally,weobtain
ř
S
βo˚σ
prβopsqs
βu
S
s:S
f f
ř
S1 prβ1ops1qs S1
β1o˚σ
s1:S1
β1u
N
which we recognize from Proposition 2.3 as the defining characteristic of a morphism in Coalg ppq.
Finally,wenotethateachofthesestepsisbijective,andsowehavethedesiredbijectionofhom-sets.
326 DynamicalSystemsviaGeneralizedPolynomialCoalgebra
DefinitionA.3(Categoryofopenrandomdynamicalsystemsover p). Writingϑ :“pπ ,ϑo,ϑuqand
X
ψ :“ pπ ,ψo,ψuq, a morphism f : ϑ Ñ ψ is a map f : X ÑY in E making the following diagram
Y
commuteforalltimest :Tandsectionsσ of p:
ř
X
ϑoptq˚σ
prϑopt,xqs
ϑuptq
X
x:X
πX πX
f θptq f
Ω Ω
πY πY
ř
Y prψopt,yqs Y
ψoptq˚σ ψuptq
y:Y
Identitiesaregivenbytheidentitymapsonstate-spaces. Compositionisgivenbypastingofdiagrams.
PropositionA.4(Opindexedcategoryofopenrandomdynamicalsystemsoverpolynomials). Bythe
T
universal property of the product ˆ in Cat, it suffices to define the actions of RDyn separately on
morphismsofpolynomialsandonmorphismsofclosedmeasure-preservingsystems.
Supposethereforethatϕ : pÑqisamorphismofpolynomials. Then,foreachmeasure-preserving
system pθ,βq:CatpBT,EqP, we define the functor RDyn T pϕ,θq:RDyn T pp,θqÑRDyn T pq,θq as
follows. Letϑ :“pπ :X ÑΩ,ϑo,ϑuq:RDyn T pp,θqbeanobject(openrandomdynamicalsystem)in
X
RDyn T pp,θq. Then RDyn T pϕ,θqpϑq is defined as the triple pπ ,ϕ ˝ϑo,ϑu˝ϕo˚ϕ#q:RDyn T pq,θq,
X 1
wherethetwomapsareexplicitlythefollowingcomposites:
ÿÿ ÿÿ
TˆX Ý ϑ Ñ o pp1qÝ ϕ Ñ1 qp1q, qrϕ ˝ϑopt,xqsÝ ϑ Ý o Ý ˚ Ý ϕ Ñ # prϑopt,xqsÝ ϑ Ñ u X.
1
t:Tx:X t:Tx:X
Onmorphisms f :pπ :X ÑΩ,ϑo,ϑuqÑpπ :Y ÑΩ,ψo,ψuq,theimage
X Y
RDyn T pϕ,θqpfq:RDyn T pϕ,θqpπ ,ϑo,ϑuqÑRDyn T pϕ,θqpπ ,ψo,ψuq
X Y
isgivenbythesameunderlyingmap f :X ÑY ofstatespaces.
Next, suppose that φ : pθ,βq Ñ pθ1,β1q is a morphism of closed measure-preserving dynamical
systems,andletΩ1:“θ1p˚qbethestatespaceofthesystemθ1. ByProposition2.22,themorphismφ
correspondstoamapφ :ΩÑΩ1 onthestatespacesthatpreservesbothflowandmeasure. Therefore,
foreachpolynomial p:Poly
E
,wedefinethefunctorRDyn T pp,φq:RDyn T pp,θqÑRDyn T pp,θ1qby
post-composition. Thatis,supposegivenopenrandomdynamicalsystemsandmorphismsoverpp,θqas
T.St. ClereSmithe 327
T
inthediagramofProposition2.26. ThenRDyn pp,φqreturnsthefollowingdiagram:
ř
X
ϑoptq˚σ
prϑopt,xqs
ϑuptq
X
x:X
φ˝πX φ˝πX
f f
Ω1 Ω1
θ1ptq
φ˝πY φ˝πY
ř
Y prψopt,yqs Y
ψoptq˚σ ψuptq
y:Y
Thatis,RDyn T pp,φqpϑq:“pφ˝π ,ϑo,ϑuqandRDyn T pp,φqpfqisgivenbythesameunderlyingmap
X
f :X ÑY onstatespaces.
T
Proof. We need to check: the naturality condition of Definition 2.25 for both RDyn pϕ,θqpϑq and
T T T T
RDyn pp,φqpϑq;functorialityofRDyn pϕ,θqandRDyn pp,φq;and(pseudo)functorialityofRDyn
withrespecttobothmorphismsofpolynomialsandofclosedmeasure-preservingsystems.
WebeginbycheckingthattheconditionsofDefinition2.25aresatisfiedbytheobjects
RDyn T pϕ,θqpπ ,ϑo,ϑuq:RDyn T pq,θq
X
andmorphisms
RDyn T pϕ,θqpfq:RDyn T pϕ,θqpπ ,ϑo,ϑuqÑRDyn T pϕ,θqpπ ,ψo,ψuq
X Y
ř
T
intheimageofRDyn pϕ,θq. Givenasectionτ :qp1qÑ qrjsofq,weneedtocheckthattheclosure
j:qp1q
RDyn T pϕ,θqpϑqτ formsaclosedrandomdynamicalsysteminCatpBT,Eq{θ. Thatistosay,forallt :T
andsectionsτ,weneedtocheckthatthefollowingnaturalitysquarecommutes:
ř ř
X ϑoptq˚τ qrϕ ˝ϑopt,xqs ϑoptq˚ϕ# prϑopt,xqs ϑu X
1
x:X x:X
πX πX
Ω Ω
θptq
Asbefore,wefindthatϕ#˝ϕ˚τ isasectionof p,sothatcommutativityofthediagramabovereducesto
1
commutativity of the diagram in Definition 2.25. Similarly, given a morphism f : pπ ,ϑo,ϑuq Ñ
X
pπ ,ψo,ψuq, we need to check that the diagram in Proposition 2.26 induced for RDyn T pϕ,θqpfq
Y
commutes for all times t : T and sections τ of q. But given such a section τ, the diagram for
RDyn T pϕ,θqpfq reduces to that for f and the section ϕ#˝ϕ˚τ of p, which commutes ex hypothesi;
1
T
andfunctorialityofRDyn pϕ,θqfollowsimmediately.
328 DynamicalSystemsviaGeneralizedPolynomialCoalgebra
T
Next,wecheckthattheconditionsofDefinition2.25aresatisfiedintheimageofRDyn pp,φq. Itis
T
clearbythedefinitionoftheactionofRDyn pp,φqthattheconditionthatthediagraminPropositionA.1
T
commutesissatisfied,fromwhichitfollowsbypastingthatRDyn pp,φqisfunctorial. Wethereforejust
havetochecktheinduceddiagraminDefinition2.25commutes. Considerthefollowingdiagram:
ř
X
ϑoptq˚σ
prϑopt,xqs
ϑuptq
X
x:X
πX πX
θptq
Ω Ω
φ φ
θ1ptq
Ω1 Ω1
Thetopsquarecommutesexhypothesi,thebottomsquarecommutesbythedefinitionofmorphismof
closed measure-preserving dynamical systems (Proposition 2.22), and the outer square is the induced
diagramweneedtocheck,whichthereforecommutesbythepastingofcommutingsquares.
T
Finally,wecheckthatRDyn isfunctorialwithrespecttomorphismsofpolynomialsandmorphisms
ofclosedmeasure-preservingdynamicalsystems. Thesereducetocheckingthatpullbackandcomposition
arefunctorial,whichweagainleavetothededicatedreader.
Definition A.5 (Open bundle dynamical system). Let p,b:Poly E be polynomials in E, and let θ :“
pθp˚q,θo,θuq:Coalg T pbqbeanopendynamicalsystemoverb. Anopenbundledynamicalsystemover
id
pp,b,θqisapairpπ ,ϑqwhereϑ :“pϑp˚q,ϑo,ϑuq:Coalg T ppqisanopendynamicalsystemover p
ϑθ id
andπ :ϑp˚qÑθp˚qisabundleinE,suchthat,foralltimet :Tandsectionsσ of pandς ofb,the
ϑθ
followingdiagramscommute,therebyinducingabundleofcloseddynamicalsystemsπ σς :ϑσ Ñθς in
ϑθ
CatpBT,Eq:
ř
ϑp˚q
ϑoptq˚σ
prϑopt,wqs
ϑuptq
ϑp˚q
w:ϑp˚q
πϑθ πϑθ
ř
θp˚q
θoptq˚ς
brθopt,xqs
θuptq
θp˚q
x:θp˚q
PropositionA.6(Categoryofopenbundledynamicalsystemsoverpp,bq). Letp,b:Poly
E
bepolynomials
inE,andletθ :“pθp˚q,θo,θuq:Coalg T pbqbeanopendynamicalsystemoverb. Openbundledynamical
id
T
systems over pp,b,θq form the objects of a category BunDyn pp,b,θq. Morphisms f :pπ ,ϑqÑ
ϑθ
pπ ,ρqaremaps f :ϑp˚qÑρp˚qinE makingthefollowingdiagramcommuteforalltimest :Tand
ρθ
T.St. ClereSmithe 329
sectionsσ of pandς ofb:
ř
ϑp˚q
ϑoptq˚σ
prϑopt,wqs
ϑuptq
ϑp˚q
w:ϑp˚q
πϑθ πϑθ
ř
f θp˚q
θoptq˚ς
brθopt,xqs
θuptq
θp˚q f
x:θp˚q
πρθ πρθ
ř
ρp˚q prρopt,yqs ρp˚q
ρoptq˚σ ρuptq
y:ρp˚q
Thatis, f isamaponthestatespacesthatinducesamorphismpπ ,ϑσqÑpπ ,ρσqinCatpBT,Eq{θς
ϑθ ρθ
ofbundlesoftheclosures. Identitymorphismsarethecorrespondingidentitymaps,andcompositionisby
pasting.
PropositionA.7(Opindexedcategoryofopenbundledynamicalsystems). Varyingthepolynomials p
T T
inBunDyn pp,b,θqinducesanopindexedcategoryBunDyn p´,b,θq:Poly
E
ÑCat. Onpolynomials
T
p, it returns the categories BunDyn pp,b,θq of Proposition A.6. On morphisms ϕ : p Ñ q of
T T T
polynomials, define the functors BunDyn pϕ,b,θq : BunDyn pp,b,θq Ñ BunDyn pq,b,θq as in
T
Proposition2.27. Thatis,supposepπ ,ϑq:BunDyn pp,b,θqisobject(openbundledynamicalsystem)
ϑθ
inBunDyn T pp,b,θq,whereϑ :“pϑp˚q,ϑo,ϑuq. ThenitsimageBunDyn T pϕ,b,θqpπ ,ϑqisdefined
ϑθ
asthepairpπ ,ϕϑq,whereϕϑ :“pϑp˚q,φ ˝ϑo,ϑu˝ϑo˚ϕ#q. Onmorphisms f :pπ ,ϑqÑpπ ,ρq,
ϑθ 1 ϑθ ρθ
T
BunDyn pϕ,b,θqpfqisagaingivenbythesameunderlyingmap f :ϑp˚qÑρp˚qofstatespaces.
T
Proof. The proof amounts to the proof for Proposition 2.27 that RDyn pϕ,θq constitutes an indexed
category, except that the closed base dynamical system θ of that Proposition is here replaced, for any
section ς of b, by the closure θς by ς of the open dynamical system θ : Coalg T pbq of the present
id
Proposition. Theproofgoesthroughaccordingly,sincetherelevantdiagramsareguaranteedtocommute
foranysuchς bytheconditionsinDefinitionA.5andPropositionA.6.
Proposition A.8 (Doubly-opindexed category of open bundle dynamical systems). Letting the base
T T
systemθ alsovaryinducesadoubly-opindexedcategoryBunDyn p´,b,“q:Poly
E
ˆCoalg
id
pbqÑCat.
T T
Given a polynomial p:Poly E and morphism φ :θ Ñρ in Coalg id pbq, the functor BunDyn pp,b,φq:
T T
BunDyn pp,b,θqÑBunDyn pp,b,ρq is defined by post-composition, as in Proposition 2.27 for the
T
actionofRDyn onmorphismsofthebasesystemsthere. Moreexplicitly,suchamorphismφ corresponds
to a map φ : θp˚q Ñ ρp˚q of state spaces in E. Given an object pπ ,ϑq of BunDyn T pp,b,θq,
ϑθ
T
we define BunDyn pp,b,φqpπ ,ϑq:“pφ ˝π ,ϑq. Given a morphism f :pπ ,ϑqÑpπ ,ρq in
ϑθ ϑθ ϑθ ρθ
T T
BunDyn pp,b,θq, its image BunDyn pp,b,φqpfq:pφ˝π ,ϑqÑpφ˝π ,ρq is given by the same
ϑθ ρθ
underlyingmap f :ϑp˚qÑρp˚qofstatespaces.
T
Proof. AsforPropositionA.7,theproofhereamountstotheproofforProposition2.27thatRDyn pp,φq
constitutesanindexedcategory,exceptagaintheclosedsystemsarereplacedby(theappropriateclosures
of)openones,andthemeasure-preservingstructureisforgotten.
330 DynamicalSystemsviaGeneralizedPolynomialCoalgebra
Proof A.9(ProofoftheLaplaceapproximation). FirstnotethattheKLdivergenceisboundedfromabove
bythefreeenergysincelogp pyqisalwaysnegative.
γ‚π
Next,wecanwritethedensityfunctionsas:
b
@ D
1
logp py|xq“ ε ,Σ ´1ε ´log p2πq|Y|detΣ
γ γ γ γ γ
2
b
@ D
1
logp px|yq“ ε ,Σ ´1ε ´log p2πq|X|detΣ
ρπ
2
ρπ ρπ ρπ
b
ρπ
@ D
1
logp pxq“ ε ,Σ ´1ε ´log p2πq|X|detΣ
π π π π π
2
whereforclaritywehaveomittedthedependenceofΣ onxandΣ ony,andwhere
γ ρπ
ε :YˆX ÑY :py,xqÞÑy´µ pxq,
γ γ
ε :XˆY ÑX :px,yqÞÑx´µ pyq,
ρπ ρπ
ε :Xˆ1ÑX :px,˚qÞÑx´µ .
π π
Then,notethatwecanwritethefreeenergyFpyqasthedifferencebetweenexpectedenergyandentropy:
„ ȷ
p px|yq
Fpyq“ E log ρπ
x„ρπpyq“ p γ py|xq¨p π pxq ‰
“ E ´logp py|xq´logp pxq ´S rρ pyqs
γ π X π
x„ρπpyq“
‰
“ E E px,yq ´S rρ pyqs
pπ,γq X π
x„ρπpyq
Next,sincetheeigenvaluesofΣ pyqaresmallforally:Y,wecanapproximatetheexpectedenergyby
ρπ
itssecond-orderTaylorexpansionaroundthemeanµ pyq:
ρπ
@ ` ˘ ` ˘` ˘ ` ˘D
1
Fpyq«E pµ pyq,yq` ε µ pyq,y , B2E µ pyq,y ¨ε µ pyq,y
pπ,γq “ ρπ ‰ 2 ρπ ρπ x pπ,γq ρπ ρπ ρπ
´S ρ pyq .
X π
` ˘` ˘
where B2E µ pyq,y istheHessianofE withrespecttoxevaluatedatpµ pyq,yq.
x pπ,γq ρπ pπ,γq ρπ
Notethat
@ ` ˘ ` ˘` ˘ ` ˘D “` ˘` ˘ ‰
ε µ pyq,y , B2E µ pyq,y ¨ε µ pyq,y “tr B2E µ pyq,y Σ pyq , (4)
ρπ ρπ x pπ,γq ρπ ρπ ρπ x pπ,γq ρπ ρπ
thattheentropyofaGaussianmeasuredependsonlyonitscovariance,
“ ‰ ` ˘
1
S ρ pyq “ logdet 2πeΣ pyq ,
X π
2
ρπ
andthattheenergyE pµ pyq,yqdoesnotdependonΣ pyq. Wecanthereforewritedowndirectlythe
pπ,γq ρπ ρπ
covarianceΣ˚ pyqminimizingFpyqasafunctionofy. Wehave
ρπ
` ˘` ˘
1 1
B Fpyq« B2E µ pyq,y ` Σ ´1.
Σρπ 2 x pπ,γq ρπ 2 ρπ
SettingB Fpyq“0,wefindtheoptimum
Σρπ
` ˘` ˘
Σ˚ pyq“ B2E µ pyq,y ´1 .
ρπ x pπ,γq ρπ
Finally,onsubstitutingΣ˚ pyqinequation(4),weobtainthedesiredexpression
ρπ
` ˘
Fpyq«E µ pyq,y ´S rρ pyqs“:FLpyq.
pπ,γq ρπ X π

=== REVISE TO ===
PROFESSIONAL TONE: Begin directly with content - NO conversational openings like 'Okay, here's...'

1. Fix all issues above
2. Title: "Open Dynamical Systems as Coalgebras for Polynomial Functors, with Application to Predictive Processing"
3. Include 10-15 quotes from paper text
   - Extract quotes VERBATIM from the paper text - do NOT modify or "correct" them
   - Use consistent quote formatting: 'The authors state: "quote"' or vary attribution phrases
   - Vary attribution phrases to avoid repetition
   - CRITICAL: Only extract quotes that actually appear in the paper text
4. ELIMINATE ALL REPETITION - each sentence must be unique
   - Check before each sentence: 'Have I already said this?' If yes, write something new
   - Vary attribution phrases - do NOT repeat 'The authors state' multiple times
5. Extract methodology, results with numbers, key quotes
6. 1000-1500 words, structured with ### headers

Generate COMPLETE revised summary.