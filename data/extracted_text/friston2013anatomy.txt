HYPOTHESIS AND THEORY ARTICLE
published: 25 September 2013
doi: 10.3389/fnhum.2013.00598
The anatomy of choice: active inference and agency
Karl Friston1*, Philipp Schwartenbeck1, Thomas FitzGerald1, Michael Moutoussis1,
Timothy Behrens1,2 and Raymond J. Dolan1
1 The Wellcome Trust Centre for Neuroimaging, Institute of Neurology, University College London, London, UK
2 Centre for Functional MRI of the Brain, The John Radcliffe Hospital, Oxford, UK
Edited by:
James W. Moore, Goldsmiths,
University of London, UK
Reviewed by:
Giovanni Pezzulo, National Research
Council of Italy, Italy
Daniel A. Braun, Max Planck
Institute for Biological Cybernetics,
Germany
*Correspondence:
Karl Friston, The Wellcome Trust
Centre for Neuroimaging, Institute
of Neurology, University College
London, 12 Queen Square,
WC1N 3BG London, UK
e-mail: k.friston@ucl.ac.uk
This paper considers agency in the setting of embodied or active inference. In brief,
we associate a sense of agency with prior beliefs about action and ask what sorts
of beliefs underlie optimal behavior. In particular, we consider prior beliefs that action
minimizes the Kullback–Leibler (KL) divergence between desired states and attainable
states in the future. This allows one to formulate bounded rationality as approximate
Bayesian inference that optimizes a free energy bound on model evidence. We show
that constructs like expected utility, exploration bonuses, softmax choice rules and
optimism bias emerge as natural consequences of this formulation. Previous accounts
of active inference have focused on predictive coding and Bayesian ﬁltering schemes
for minimizing free energy. Here, we consider variational Bayes as an alternative
scheme that provides formal constraints on the computational anatomy of inference and
action—constraints that are remarkably consistent with neuroanatomy. Furthermore, this
scheme contextualizes optimal decision theory and economic (utilitarian) formulations as
pure inference problems. For example, expected utility theory emerges as a special case
of free energy minimization, where the sensitivity or inverse temperature (of softmax
functions and quantal response equilibria) has a unique and Bayes-optimal solution—that
minimizes free energy. This sensitivity corresponds to the precision of beliefs about
behavior, such that attainable goals are afforded a higher precision or conﬁdence. In turn,
this means that optimal behavior entails a representation of conﬁdence about outcomes
that are under an agent’s control.
Keywords: active inference, agency, Bayesian, bounded rationality, embodied cognition, free energy, inference,
utility theory
INTRODUCTION
This paper addresses the nature of probabilistic beliefs about
control that constitute a sense of agency. By separating beliefs
about control from action per se, one can formulate behavior as a
pure inference problem. This allows one to describe goal-directed
behavior and decision-making in terms of prior beliefs about how
one should behave. It is these beliefs about controlled behavior
that we associate with a representation or sense of agency. Here,
we take a somewhat formal approach and illustrate the ideas using
game theory and Markov decision processes. Our aim is to under-
stand behavior in terms of approximate Bayesian inference and
ask whether standard variational schemes can shed light on the
functional anatomy of decision-making in the brain.
Our wider aim is to place heuristics in decision theory (in psy-
chology) and expected utility theory (in economics) within the
setting of embodied cognition or inference. In brief, we treat the
problem of selecting a sequence of behaviors—to optimize some
outcome—as a pure inference problem. We assume that policies
are selected under the prior belief
1 they minimize the diver-
gence (relative entropy) between a probability distribution over
states that can be reached and states agents believe they should
1In this paper, beliefs about states refer to a probability distribution over
states.
occupy—states or goals that agents believe, ap r i o r i ,have high
utility. By formulating the problem in this way, three important
aspects of optimal decision-making emerge:
• First, because relative entropy can always be decomposed into
entropy and expected utility, the ensuing policies maximize
expected utility and the entropy over ﬁnal states. Entropy is a
measure of average uncertainty (e.g., the entropy of a coin toss
is much greater than the entropy of an unsurprising outcome,
like the sun rising tomorrow). This decomposition is closely
related to the distinction between extrinsic and intrinsic reward
in embodied cognition and artiﬁcial intelligence. In this set-
ting, utility or extrinsic reward is supplemented with intrinsic
reward to ensure some efﬁcient information gain, exploratory
behavior or control over outcomes. Important examples here
include artiﬁcial curiosity ( Schmidhuber, 1991 ), empower-
ment (Klyubin et al., 2005), information to go (Tishby and
Polani, 2011) and computational complexity ( Ortega and
Braun, 2011, 2013). Indeed, the causal generation of entropic
forces in nonequilibrium systems has been proposed recently as
a general mechanism for adaptive behavior ( Wissner-Gross and
Freer, 2013). In the present context, an intrinsically rewarding
policy maximizes the opportunity to explore (or the entropy
of) future states.
Frontiers in Human Neuroscience www.frontiersin.org September 2013 | Volume 7 | Article 598 | 1
HUMAN NEUROSCIENCE
Friston et al. Agency and inference
• Second, because policies are inferred, they are associated with a
conﬁdence or precision that is itself optimized. This furnishes a
unique and Bayes-optimal sensitivity or inverse temperature—
of the sort associated with softmax choice rules and quantal
response equilibria ( McKelvey and Palfrey, 1995 ).
• Third, because policy optimization is absorbed into the more
general problem of inferring hidden states of the world, infer-
ences about policies depend upon inferences about hidden
states and vice versa. This means that beliefs about hidden
states depend upon the conﬁdence in policies—leading to an
optimism bias ( Sharot et al., 2012 ), in which inferences about
ambiguous states are biased toward those that support an
optimal policy.
In what follows, we motivate the premises that underlie this for-
mulation and unpack its implications using formal arguments
and simulations. The basic idea is that behavior can be cast as
inference: in other words, action, and perception are integral
parts of the same inferential process and one only makes sense
in light of the other. It is fairly straightforward to show that self-
organizing systems are necessarily inferential in nature ( Friston,
2012). This notion dates back to the writings of Helmholtz and
Ashby, who emphasized modeling and inference as necessary
attributes of systems—like ourselves—that endure in a changing
world ( Helmholtz, 1866/1962; Ashby, 1947; Conant and Ashby,
1970). This idea has been formalized recently as minimizing a
variational free energy bound on Bayesian model evidence—to
provide a seamless link between occupying a limited number of
attracting states and Bayesian inference about the causes of sen-
sory input ( Dayan et al., 1995; Friston, 2010 ). In the context of
behavior, we suppose that inference underlies a sense of agency.
A corollary of this perspective is that agents must perform
some form of active Bayesian inference. Bayesian inference can be
approximate or exact, where exact inference is rendered tractable
by making plausible assumptions about the approximate form
of probabilistic representations—representations that are used
to predict responses to changes in the sensorium. In general,
exact inference is intractable and cannot be realized biophysically.
This is because—for non-trivial models—the posterior distribu-
tions over unknown quantities do not have an analytic form.
This means the challenge is to understand how agents perform
approximate Bayesian inference. Conversely, in classical (nor-
mative) formulations, it is assumed that agents optimize some
e x p e c t e dv a l u eo ru t i l i t yf u n c t i o no ft h e i rs t a t e s .T h eq u e s t i o n
then reduces to how the brain maximizes value ( Camerer, 2003;
Daw and Doya, 2006; Dayan and Daw, 2008 ).
Normative approaches assume that perfectly rational agents
maximize value, without considering the cost of optimization
(Von Neumann and Morgenstern, 1944 ). In contrast, bounded
rational agents are subject to information processing costs and do
not necessarily choose the most valuable option ( Simon, 1956 ).
Several attempts to formalize bounded rationality, in probabilis-
tic terms, have focused on the Boltzmann distribution, where
optimal behavior corresponds to picking states with a high value
or low energy. In this setting, perfect rationality corresponds to
choosing states from a low temperature distribution, whose prob-
ability mass is concentrated over the state with the highest value
(Ortega and Braun, 2011 ). In particular, quantal response equi-
librium (QRE) models of bounded rationality assume that choice
probabilities are prescribed by a Boltzmann distribution and that
rationality is determined by a temperature parameter ( McKelvey
and Palfrey, 1995; Haile et al., 2008 ). Boltzmann-like stochastic
choice rules have a long history in the psychology and eco-
nomics literature, particularly in the form of logit choice models
(Luce, 1959; Fudenberg and Kreps, 1993 ) .T h e s ec h o i c er u l e s
are known as softmax rules and are used to describe stochastic
sampling of actions, especially in the context of the exploration-
exploitation dilemma ( Sutton and Barto, 1998; Cohen et al.,
2007). In this setting, the temperature parameter models the sen-
sitivity of stochastic choices to value. This paper suggests that
sensitivity can itself be optimized and corresponds to the conﬁ-
dence or precision associated with beliefs about the consequences
of choices.
So what does active inference bring to the table? In active
inference, there is no value function: free energy is the only
quantity that is optimized. This means that bounded rational-
ity must emerge from free energy minimization and the value of
a state (or action) is a consequence of behavior, as opposed to
its cause. In other words, the consequences of minimizing free
energy are that some states are occupied more frequently than
others—and these states can be labeled as valuable. We will see
later that the frequency with which states are visited depends on
prior beliefs—suggesting an intimate relationship between value
and prior beliefs. Crucially, in active inference, parameters like
sensitivity or inverse temperature must themselves minimize free
energy. This means that sensitivity ceases to be a free parame-
ter that is adjusted to describe observed behavior and becomes
diagnostic of the underlying (approximate) Bayesian inference
(that can be disclosed by observed choices). We will see later
that sensitivity corresponds to the precision of beliefs about future
states and behaves in a way that is remarkably similar to the
ﬁring of dopaminergic cells in the brain. Furthermore, QRE,
logit choice models and softmax rules can be derived as for-
mal consequences of free energy minimization, using variational
Bayes.
Variational Bayes or ensemble learning is a ubiquitous scheme
for approximate Bayesian inference ( Beal, 2003 ). Variational
Bayes rests on a partition or separation of probabilistic repre-
sentations (approximate posterior probability distributions) that
renders Bayesian inference tractable. A simple example would be
estimating the mean and precision (inverse variance) of some
data, under the assumption that uncertainty about the mean
does not depend upon uncertainty about the variance and vice
versa. This simple assumption enables a straightforward compu-
tation of descriptive statistics that would otherwise be extremely
difﬁcult: see ( MacKay, 2003 , p. 422) for details. In biological
terms, a partition into conditionally independent representa-
tions is nothing more or less than functional segregation in the
brain—in which specialized neuronal systems can be regarded
as performing variational Bayesian updates by passing mes-
sages to each other. These messages ensure that posterior beliefs
about states of (and actions on) the world are internally con-
sistent. We will try to relate variational Bayes to the functional
anatomy of inference and action selection in the brain. This
Frontiers in Human Neuroscience www.frontiersin.org September 2013 | Volume 7 | Article 598 | 2
Friston et al. Agency and inference
provides a functional account of both neuronal representations
and functional integration (message passing) among different
systems.
Previous accounts of free energy minimization in the brain
have focused on continuous time formulations and predictive
coding as a neurobiologically plausible variational scheme. In
this paper, we take a slightly more abstract approach and con-
sider discrete time representations using variational Bayes. This
necessarily implies a loss of biological realism; however, it pro-
vides an explicit model of discrete behaviors or choices. In
particular, the resulting scheme converges, almost exactly, on
the free energy formulation of decision-making under infor-
mational costs proposed by ( Braun et al., 2011; Ortega and
Braun, 2011 ). These authors accommodate nearly all optimal
control, expected utility and evidence accumulation schemes
under a single utility-based free energy minimization frame-
work. The free energy minimization considered in this paper
can be regarded as a special case of their general formula-
tion, where the utility function is the log-likelihood of out-
comes and their causes, under a generative model. This is
important, because it connects utility-based schemes to varia-
tional Bayes and, more generally, inferential schemes that may
underwrite biological self-organization ( Ashby, 1947; Friston,
2012).
Although variational Bayes relies upon discrete updates, vari-
ational updates still possess a dynamics that can be compared
to neuronal responses, particularly dopaminergic responses. In
a companion paper (Friston et al., under review), we focus on
this, because understanding the computational role of dopamine
is important for understanding the psychopathology and patho-
physiology of conditions like Parkinson’s disease, schizophrenia
and autism. In this paper, we focus on the functional anatomy
implied by variational message passing in the brain and try
to relate this to behavior from a psychological and economic
perspective.
This paper comprises six sections: The ﬁrst introduces active
inference and sets up the basic ideas and notation. The second
describes a fairly generic model of control or agency, in which
purposeful behavior rests on prior beliefs that agents will mini-
mize the (relative) entropy of their ﬁnal states. We will see that
this leads naturally to expected utility theory and exploration
bonuses. The third section considers the inversion of this gen-
erative model using variational Bayes, with a special focus on
mean ﬁeld assumptions and implicit message passing. The fourth
section considers the implications for the functional anatomy
of inference and decision-making; namely, reciprocal message
passing between systems supporting perceptual inference, action
selection and evaluating precision. This section shows how key
aspects of classical theory emerge; such as the distinction between
perceptual inference about states of the world and action selec-
tion, quantal response equilibria, sensitivity and softmax choice
rules. The ﬁfth section uses simulations of a particular game
(a waiting game with time sensitive contingencies) to illus-
trate the basic phenomenology of decision-making under active
inference. The ﬁnal section considers the cognitive anatomy of
decision-making in terms of temporal discounting and marginal
utility.
ACTIVE INFERENCE
In active inference, beliefs about (hidden or ﬁctive) states of
the world maximize model evidence or the marginal likeli-
hood of observations. In contrast to classic formulations, active
inference makes a distinction between action as a physical
state of the real world and beliefs about (future) action that
we will refer to as control states—it is these that constitute
a sense of agency. This changes the problem fundamentally
from selecting an optimal action (a real variable) to mak-
ing optimal inferences about control (a random variable). In
other words, under the assumption that action is sampled from
posterior beliefs about control, we can treat decision-making
and action selection as a pure inference problem that neces-
sarily entails optimizing beliefs about behavior and its conse-
quences. This optimization appeals to the principle of free energy
minimization.
THE FREE-ENERGY PRINCIPLE AND ACTIVE INFERENCE
The free-energy principle ( Friston et al., 2006 ) tries to explain
how agents restrict themselves to a small number of attracting
states. This behavior is equivalent to minimizing the Shannon
entropy of the distribution over the outcomes they experience.
Under ergodic assumptions, this entropy is (almost surely) the
long-term time average of self-information or surprise (Birkhoff,
1931). Negative surprise ln P(˜o|m) is the log likelihood of out-
comes ˜o = (o
0,..., ot ), marginalized over their causes—also
known as the Bayesian model evidence of model m.I ti st h e r e -
fore sufﬁcient to minimize surprise—at each point in time—to
minimize its time average or Shannon entropy.
However, to evaluate surprise it is necessary to marginalize
over the hidden causes of outcomes. This is the difﬁcult prob-
lem of exact Bayesian inference. This problem can be ﬁnessed
by using a proxy for surprise that does not depend on knowing
the causes of observations. The proxy is variational free energy
that, by construction, is an upper bound on surprise ( Feynman,
1972; Hinton and van Camp, 1993 ). This means that if agents
minimize free energy they minimize surprise (approximately).
Coincidentally, they maximize model evidence (approximately)
and implicitly engage in approximate Bayesian inference ( Dayan
et al., 1995; Friston, 2010 ). Put simply, although agents can never
know the causes of their observations, the causes can be inferred.
Crucially, the free energy that underpins this inference needs a
generative model of how observations were caused—a model that
can itself be optimized with respect to free energy (cf. Bayesian
model selection in statistics).
These arguments suggest that action must minimize varia-
tional free energy, because outcomes can only be changed by
action. This is active inference(Friston et al., 2010 ), which extends
the minimization of free energy implicit in approximate Bayesian
inference to include action. This means that behavior mini-
mizes surprise or maximizes model evidence; either exactly—to
produce perfectly rational behavior, or approximately—to mini-
mize a variational bound to produce bounded rational behavior.
There is a fairly developed literature on variational free energy
minimization and active inference; covering things from per-
ceptual categorization of bird songs, through to action observa-
tion ( Friston, 2010 ). Most of this work uses generative models
Frontiers in Human Neuroscience www.frontiersin.org September 2013 | Volume 7 | Article 598 | 3
Friston et al. Agency and inference
based upon differential equations. In this paper, we consider
generative models based upon Markovian processes and revisit
some of the key results in the context of decision-making and
uncertainty.
In what follows, we use the usual conventions of uppercase
to denote matrices and lowercase for vectors. In addition, we
use bold typeface to indicate true variables in the world and
italic typeface for hidden or ﬁctive variables. The sufﬁcient statis-
tics (event probabilities) of categorical distributions over discrete
states {1,..., J} are denoted by J × 1v e c t o r s
⌢
s ∈[ 0,1].T h e ∼
notation denotes collections of variables over time.
Deﬁnition
Active inference rests on the tuple (/Omega1,S,A, P, Q,R,S,U):
• Aﬁ n i t es e to fo b s e r v a t i o n s/Omega1
• A ﬁnite set of true states and actions S × A
• A ﬁnite set of ﬁctive or hidden states S × U
• A generative processover observations, states and action
R (˜o,˜s,a) = Pr ({o0,..., ot }= ˜o,{s0,..., st }= ˜s,A = a)
• A generative modelover observations and hidden states
P(˜o,˜s, ˜u|m) = Pr ({o0,..., ot }= ˜o, {s0,..., st }= ˜s,
{u0,..., uT }= ˜u)
• An approximate posterior probability over hidden states with
sufﬁcient statistics μ ∈ Rd such that
Q(˜s, ˜u|μ) = Pr({s0,..., st }= ˜s, {u0,..., uT }= ˜u),
Remarks
Here, m denotes the form of a generative model or probability
distribution entailed by an agent. For clarity, we will omit the
conditioning on m unless necessary. In this setup, the genera-
tive process describes transitions among real states of the world
that depend upon action and generate outcomes. The agent is
equipped with a generative model of this process, where action
is replaced by a subset of hidden states called control states
U. Although we allow for any action (control) from any state,
only a subset may be allowable from any given state. Finally,
the sufﬁcient statistics of the approximate posterior encode a
probability distribution over hidden states S × U at times t ∈
{0,..., T}. In other words, the sufﬁcient statistics—or param-
eters of the distribution—represent the probability of hidden
states.
As it stands, the above deﬁnition does not describe a process.
This is because the dependencies among real states and sufﬁcient
statistics are not speciﬁed. In other words, the agent’s generative
model of observations P(˜o,˜s, ˜u|m) and its approximate posterior
distribution over their causes Q(˜s, ˜u|μ) does not refer to the pro-
cess of eliciting outcomes through action R(˜o,˜s,a).T oc o u p l et h e
agent to its environment, we have to specify how its sufﬁcient
statistics depend upon observations and how its action depends
upon sufﬁcient statistics. In active inference, the sufﬁcient statis-
tics minimize free energy and the ensuing beliefs about control
states prescribe action:
μ
t = arg min μF (˜o,μ)
Pr (at = ut ) = Q (ut |μt ) (1)
This is usually portrayed in terms of perception (inference
about hidden states) and action (a choice model in which
action is a function of inferred states). Usually, sufﬁcient statis-
tics are associated with the internal states of an agent (such
as neuronal activity or connection strengths) and action is
associated with the state of its effectors. In more general for-
mulations, action would select outcomes with the lowest free
energy ( Friston et al., 2012a ). However, for simplicity, we have
assumed that actions are sampled from posterior beliefs about
control states—noting that the actions which minimize free
energy produce outcomes that are the most likely under poste-
rior beliefs. In short, sufﬁcient statistics and implicit posterior
beliefs about the state of the world minimize free energy, while
action is selected from posterior beliefs about control states.
We will see later that these posterior beliefs depend crucially
upon prior beliefs about states that will be occupied in the
future.
Figure 1provides a schematic of the resulting cycle of action
and perception, where posterior expectations (sufﬁcient statis-
tics) minimize free energy and prescribe action (left panel). In this
setting, free energy is deﬁned in relation to the generative model
(right panel). Notice that the generative model does not need to
know about action: from its point of view, the world contains
(ﬁctive) control states that determine transitions among hidden
states generating outcomes. In other words, optimizing poste-
rior beliefs about control states produces action automatically but
the agent does not know this—in the sense we are aware of the
to
taA
t
sS
ts
tu
Pr ( | )tt t tau Q u
arg min ( , )t Fo
action
perception
world    agent
Active inference (Markovian) generative model
to
tsS
tuU
(|, )ttPo s
Likelihood model
Prior beliefs
11(, | , , )tt t tPs u s u
FIGURE 1 | Left panel:this is a schematic of the dependencies among
variables underlying active inference. Here, a generative process
representing state transitions in the real world generates observations or
outcomes that are used to update the internal states of an agent. These
internal states encode the sufﬁcient statistics of an approximate posterior
distribution over variables deﬁned by a generative model (right panel).
Particular sufﬁcient statistics, encoding beliefs about choices or control
states are reﬂexively transcribed into action, which affects real state
transitions—thereby closing the action–perception cycle. Right panel:
notice that the generative model, which deﬁnes free energy has a much
simpler form. It simply supposes that there are mutually dependent hidden
and control states that conspire to produce observations.
Frontiers in Human Neuroscience www.frontiersin.org September 2013 | Volume 7 | Article 598 | 4
Friston et al. Agency and inference
sensory consequences of our motor reﬂexes but not the reﬂexes
per se.
One can express free energy in a number of ways:
F (˜o,μ) = EQ [−ln P (˜o,˜s, ˜u|m)] − H [Q (˜s, ˜u|μ)]
= DKL [Q (˜s, ˜u|μ)||P (˜s, ˜u|˜o)] − ln P (˜o|m)
= DKL[Q(˜s, ˜u|μ)||P(˜s, ˜u|m)] + EQ[−ln P (˜o|˜s, ˜u)](2)
The ﬁrst equality expresses free energy as a Gibbs energy
(expected under the approximate posterior) minus the entropy
of the approximate posterior. This speaks to why it is called a
free energy. The second equality shows that free energy is an
upper bound on surprise, because the ﬁrst relative entropy or
Kullback–Leibler (KL) divergence term is non-negative by Gibbs
inequality ( Beal, 2003 ). This means minimizing free energy cor-
responds to minimizing the divergence between the approximate
and true posterior. This formalizes the notion of unconscious
inference in perception ( Helmholtz, 1866/1962; Dayan et al.,
1995; Dayan and Hinton, 1997 ) and—under some simplifying
assumptions—reduces to predictive coding ( Rao and Ballard,
1999). The third equality shows that minimizing free energy is
the same as maximizing the expected log likelihood of observa-
tions or accuracy, while minimizing the divergence between the
approximate posterior and prior beliefs about hidden variables.
This divergence is known as model complexity(Spiegelhalter et al.,
2002; Penny et al., 2004 ), ensuring that inference is both accurate
and parsimonious (cf. Occam’s razor).
In summary, if agents resist a natural tendency to disor-
der (occupy a limited number of characteristic states), then
they become implicit Bayesian modelers of their environment.
This is consistent with the good regulator hypothesis ( Conant
and Ashby, 1970 ) and accounts of (unconscious) inference and
perception in the brain ( Helmholtz, 1866/1962; Gregory, 1968;
Dayan et al., 1995 ). Crucially, this requires agents to entertain
beliefs about the control of state transitions producing outcomes.
This means we have moved beyond classic formulations—in
which deterministic actions are selected—and have to consider
posterior beliefs about putative choices. These beliefs determine
the states that are eventually sampled. In the next section, we con-
sider the optimization of posterior beliefs; both in terms of their
content and the conﬁdence or precision with which they are held.
A GENERATIVE MODEL OF AGENCY
We have seen that a generative model is necessary to furnish a
free energy bound on surprise or Bayesian model evidence. This
model comprises prior beliefs that determine the states an agent
or model will frequent. These beliefs specify the attracting states
(goals) that action will seek out. In this section, we consider the
form of these beliefs and how they can be understood in terms of
expected utility.
THE GENERATIVE MODEL
The Markovian models considered here rest on transitions among
hidden states that are coupled to transitions among control
states. This is illustrated in terms of a hidden Markov model
or ﬁnite state (epsilon) machine ( Ellison et al., 2011 )i nt h e
upper panel of Figure 2.I nt h eg e n e r a lf o r m so ft h e s em o d e l s ,
control states modify the transition probabilities among hidden
states, while hidden states modify the transitions among control
states (as denoted by the connections with circles). This sort of
model allows context-sensitive transitions among states generat-
ing outcomes—that themselves can induce changes in the control
states providing the context. The lower panels of Figure 2illus-
trate a particular example that we will use later—in which there
are two states that control transitions among ﬁve hidden states
(see ﬁgure legend for details).
The generative model used to model these (irreversible
Markovian) processes can be expressed in terms of future control
states ˜u = (u
t ,..., uT ) as follows:
P(˜o,˜s, ˜u,γ| ˜a, m) = P (˜o|˜s)P (˜s, ˜u|γ, ˜a) P (γ|m)
P(o0,..., ot |s0,..., st ) =
∏ t
i = 0 P(oi|si) (3)
P(s0,..., st , ˜u|γ, a0,..., at − 1) = P(˜u|st )P(s0|m)
∏ t
i = 1
P(si|si − 1, ai − 1)
ln P(˜u|st ) =− γ · DKL[P(sT |st , ˜u)||P(sT |m)]
Remarks
The ﬁrst equality expresses the model in terms of the like-
lihood of observations given the hidden and control states
(ﬁrst term) and empirical prior beliefs (subsequent terms).
Empirical priors are probability distributions over unknown vari-
ables that depend on other unknown variables—and are an
inherent part of any hierarchical model. The likelihood (sec-
ond equality) says that observations depend on, and only on,
concurrent hidden states. The third equality expresses beliefs
about state transitions that embody Markovian dependen-
cies among successive hidden states. For simplicity, we have
assumed that the agent knows its past actions by observing
them.
The important part of this model lies in the last equality.
This describes prior beliefs about control sequences or poli-
cies that determine which actions are selected. These beliefs
take the form of a Boltzmann distribution, where the pol-
icy with the largest prior probability minimizes the relative
entropy or divergence between the distribution over ﬁnal states,
given the current state and policy, and the marginal distribu-
tion over ﬁnal states. This marginal distribution encodes goals
in terms of (desired) states the agent believes it should visit
from current state. Crucially, the precision of beliefs about
policies is determined by a hidden variable γ ∈ R
+ that has
to be inferred. In essence, this model represents past hid-
den states and future choices, under the belief that control
from the current state will minimize the divergence between
the distribution over ﬁnal states and a prior distribution or
goal.
PRIOR BELIEFS, ENTROPY AND EXPECTED UTILITY
Basing beliefs about future choices on relative entropy is for-
mally related to optimization schemes based on KL control;
particularly risk sensitive control; e.g., ( van den Broek et al.,
Frontiers in Human Neuroscience www.frontiersin.org September 2013 | Volume 7 | Article 598 | 5
Friston et al. Agency and inference
Generative model
1u 2u
1s
2s
3sHidden states
Control states
1(| , , )tt tPs s u
 )
1
 |
 ,
t
s
 u
1(| , , )tt tPu u s
 )
1
 |
 ,
t
u
??
Reject or stay
Low offer High offer
??
Accept or shift
Low offer High offer
0000
0000
(0 ) 1100
00010
00001
p
q
u r
000
 0
p
000
 0
000
 0
p
000
 0
q
 000
 0
q
1
 0
 0
0)
 1
r
0
 0
 0
 1
 0
1
 0
 0
1
r
0
 0
 0
 1
 0
0
 0
 0
 1
 0
0
 0
 0
 0
 1
B
00000
00000
(1 ) 00111
10000
01000
u
0000
 0
0000
 0
0000
 0
0000
 0
0000
 0
1
 1
 1
1
)
 0
 0
1
 000
 0
1
 1
 1
0
 0
1
 000
 0
1
 000
 0
0
 1
 0
 0
 0
B
p q
r
FIGURE 2 | Upper panel:this is an example of a generative model, based on
a hierarchical hidden Markov model. The key feature of this model is that
there are two sets of states; hidden states and control states. The transitions
among one set of states depend upon the state occupied in the other set.
Lower panels: this provides an example of a particular generative model in
which there are two control states; reject (stay) or accept (shift). The control
state determines the transitions amongst the hidden states which, in this
example, comprise a low offer (ﬁrst state), a high offer (second state), a
no-offer state (third state), and absorbing states that are entered whenever a
low (fourth state) or high (ﬁfth state) offer is accepted. The probability of
moving from one state to another is one, unless speciﬁed by the values of
the (control dependent) transition probabilities shown in the middle row. For
example, the parameter r controls the rate of offer withdrawal (cf. a hazard
rate). Note that absorbing states—that re-enter themselves with unit
probability—render this Markovian process irreversible. We will use this
example in simulations of choice behavior.
2010). This is also a cornerstone of utility-based free energy
treatments of bounded rationality ( Ortega and Braun, 2011 ).
These schemes consider optimal agents to minimize the KL
divergence between controlled and desired outcomes. All we
have done here is to equip agents with a sense of agency
or prior beliefs that they are KL optimal. These beliefs are
then enacted through active inference. The advantage of this
is that the precision of beliefs about control can now be
optimized—because we have effectively cast the optimal con-
trol problem as an inference problem. These arguments may
seem a bit abstract but, happily, concrete notions like explo-
ration, exploitation and expected utility emerge as straightfor-
ward consequences:
The relative entropy or divergence can be thought of as
a prediction error that is nuanced in an important way: it
reports the mismatch—not between expected and observed
outcomes—but between the ﬁnal outcomes expected with and
without considering the current state: in other words, the
difference between what can be attained from the current
state and the goals encoded by prior beliefs. Unlike clas-
sic reward prediction errors, this probabilistic prediction error
is a difference between probability distributions over states.
Mathematically, this divergence can be decomposed into two
terms that have important implications for behavior. From
Equation 3:
ln P (˜u|s
t ) = γ · Q
Q (˜u|st ) =− DKL [P (sT |st , ˜u)||P (sT |m)]
=
∑
sT
P (sT |st , ˜u) ln P (sT |m)
P (sT |st , ˜u)
= H [P (sT |st , ˜u)]  
exploration bonus
+
∑
sT
P (sT |st , ˜u)c (sT |m)  
expected utility
(4)
This expresses the log likelihood of a policy as a precision
weighted value Q (˜u|st ).T h i s value is an attribute of policies
available from the current state, where the value of a pol-
icy is the negative divergence between the states entailed by
the policy and goal states. In other words, a valuable pol-
icy (or state) minimizes relative entropy. We use Q (˜u|s
t ) to
emphasize the analogous role of action value in Q-learning
(Watkins and Dayan, 1992 ). Equation 4 shows that value can
be decomposed into terms. The ﬁrst is the entropy (intrinsic
reward) of the distribution over ﬁnal states, given the current
state and policy. The second is the expected utility of the ﬁnal
Frontiers in Human Neuroscience www.frontiersin.org September 2013 | Volume 7 | Article 598 | 6
Friston et al. Agency and inference
state, where utility (extrinsic reward) or negative cost is the log
probability of the ﬁnal state, under the prior goals c (sT |m) =
ln P (sT |m).
These deﬁnitions help us connect to classic formulations and
highlight an important difference between the value of choices
and the utility of states. Utility is a ﬁxed attribute of states that
agents are attracted to. In contrast, the value of a policy is con-
text sensitive and depends upon the current state. Because utility
is deﬁned in terms of a probability distribution—which sums
to one—the utility (log probability) of any state is negative and
can be at most zero (i.e., cost is non-negative). This setup high-
lights the relative nature of utility ( T obler et al., 2005; Jocham
et al., 2012 ), because the value of a policy is determined by the
difference among the utilities of outcomes.
EXPLORATION, EXPLOITATION AND NOVELTY
This decomposition of value means that agents (believe they)
will maximize the entropy of their ﬁnal states while maximiz-
ing expected utility. The relative contribution of entropy and
expected utility depends upon the precision of prior beliefs
about the ﬁnal state or, equivalently, the relative utility of dif-
ferent states. If these beliefs are very precise (informative), they
will dominate and the agent will (believe it will) maximize
expected utility. Conversely, with imprecise (ﬂat) prior beliefs
that all ﬁnal states are equally valuable, the agent will try to
keep its options open and maximize the entropy over those
states: in other words, it will explore according to the maximum
entropy principle ( Jaynes, 1957). This provides a simple account
of exploration-exploitation that is consistent with expected util-
ity theory. The entropy term implies that (beliefs about) choices
are driven not just to maximize expected value but to explore
all options in a way that confers an exploratory aspect on
behavior. In the absence of (or change in) beliefs about ulti-
mate states, there will be a bias toward visiting all (low cost)
states with equal probability. Similarly, the novelty bonus(Kakade
and Dayan, 2002 ) of a new state is, in this formulation, con-
ferred by the opportunity to access states that were previously
unavailable—thereby increasing the entropy over ﬁnal states.
As indicated in Equation (4), this means that the value of a
choice comprises an exploration bonus and an expected utility,
where the former depends upon the current state and the latter
does not.
In summary, if agents occupy a limited set of attracting states,
it follows that their generative models must be equipped with
prior beliefs that controlled state transitions will minimize the
divergence between a distribution over attainable states and a dis-
tribution that speciﬁes states as attractive. These prior beliefs can
be expressed in terms of relative entropy that deﬁnes the value
of policies. This value has exactly the same form as the objective
functions in KL control schemes that grandfather conventional
utility-based schemes ( Kappen et al., 2012; Ortega and Braun,
2011). The value of a policy can be decomposed into its expected
utility and an exploration or novelty bonus that corresponds to
the entropy over ﬁnal states. In this setting, notions like value,
expected utility and exploration bonus are consequences of the
underlying imperative to minimize (relative) entropy, entailed by
t h ep r i o r so fa na g e n t ’ sg e n e r a t i v em o d e l .
The balance between exploration (entropy) and exploitation
(expected value) is uniquely determined by the relative utility of
future states and not by the temperature parameter—the pre-
cision or inverse temperature applies to both exploratory and
utilitarian behavior (see Equation 4). In other words, explorative
behavior is not just a random version of exploitative behavior
but can itself be very precise, with a clearly deﬁned objective
(to maximize the entropy of ﬁnal outcomes). In fact, precision
plays a fundamental role in moderating an optimism bias when
forming beliefs about hidden states of the world ( Sharot et al.,
2012) .T os e et h i sc l e a r l y ,w en e e dt oc o n s i d e rt h en a t u r eo fm o d e l
inversion.
VARIATIONAL BAYESIAN INVERSION
This section illustrates active inference using variational Bayesian
inversion of the generative model above. T o simplify notation,
we will represent allowable policies with π ∈{ 1,..., K},w e r e
each policy prescribes a sequence of control states (˜u|π) =
(ut ,..., uT |π). The model considered in the remainder of this
paper is parameterized as follows:
P
(
ot = i|st = j, A
)
= Aij
P
(
st + 1 = i|st = j, π, B
)
= B(ut |π)ij
ln P
(
π = i|st = j, γ, Q
)
= Qij · γ − ln Zπ
P (sT = i|c) = ci
P
(
s0 = i|d
)
= di
P (γ|m) = /Gamma1(α, β) (5)
P
(
sT = i|st = j, π, c
)
= T(π)ij
T(π) = B(ut |π)B(ut + 1|π)... B(uT |π)
Qij = ln cT · T(π =i)j − ln T(π = i)T
j · T(π =i)j
∑
i Aij = 1,
∑
i B(ut )ij = 1,
∑
i ci =1,
∑
i di = 1
Categorical distributions over observations, given the hidden
states, are parameterized by the matrix A that maps, proba-
bilistically, from hidden states to outcomes. Similarly, the tran-
sition matrices B(u
t ) encode transition probabilities from one
state to the next, under the current control state of a pol-
icy. The vectors c and d encode the prior distribution over
the last and ﬁrst states, respectively. The former parame-
ters specify the priors on control, where utility is c(s
T |m) =
ln P(sT |m) = ln c. The prior over precision has a gamma distri-
bution with shape and rate parameters (in this paper) α = 8a n d
β = 1.
The K × J matrix Q contains the values of allowable poli-
cies from current states, where the normalization constant Zπ
ensures that the probabilities over policies sum to one. Finally,
the matrices T(π) encode the probability of transition from the
current state to a ﬁnal state, under a particular policy. This is
the composition of transition matrices from the present time
Frontiers in Human Neuroscience www.frontiersin.org September 2013 | Volume 7 | Article 598 | 7
Friston et al. Agency and inference
until the end of the game. Transition probabilities to the ﬁnal
state determine the entropy and expected utility that comprise
value (last equality). Here, T(π = i)
j is a column vector of prob-
abilities over ﬁnal states, under the i-th policy and j-th current
state.
APPROXIMATE BAYESIAN INFERENCE
Having speciﬁed the exact form of the generative model, we now
need to ﬁnd the sufﬁcient statistics of the approximate posterior
density that minimizes free energy. This is equivalent to approx-
imate Bayesian inference about hidden variables ψ = (˜s, ˜u,γ).
Variational Bayes now provides a generic and relatively simple
scheme for approximate Bayesian inference that ﬁnesses the com-
binatoric and analytic intractability of exact inference ( Beal, 2003;
Fox and Roberts, 2012 ).
The efﬁciency of variational Bayes rests on replacing posterior
dependencies among hidden variables with dependencies among
the sufﬁcient statistics of marginal probabilities over subsets. This
allows one to factorize the (approximate) posterior distribution
into marginal distributions, which greatly reduces the size of the
state space that has to be represented. This is because one does
not have to represent the joint distribution over different subsets.
To illustrate this, consider a distribution over all combinations
of J hidden states and K control states at every point in time:
Q(˜s, ˜u).T h eu n d e r l y i n gs t a t es p a c e S
1 × U1 × ... × ST × UT
would require an untenable number (J × K)T of sufﬁcient statis-
tics or probabilities—the example below would require (5 × 2)16
sufﬁcient statistics, which is more than the number of synapses in
the brain.
However, if we exploit the Markovian dependencies among
successive states, we can use a mean ﬁeld assumption to
reduce the number of sufﬁcient statistics dramatically. The
particular mean ﬁeld assumption we will use is (see also
Figure 3):
Q
(
˜s, ˜u, γ|μ
)
= Q
(
s0|
⌢
s 0
)
... Q
(
st |
⌢
s t
)
Q
(
˜u|
⌢
π
)
Q
(
γ|
⌢
β
)
Q
(
st = j|
⌢
s t
)
=
⌢
stj :
∑
j
⌢
s tj = 1
Q
(
˜u = k|
⌢
π
)
=
⌢
πk:
∑
k
⌢
πk = 1
Q
(
γ|
⌢
β
)
= /Gamma1
(
α,
⌢
β
)
(6)
Here, we have assumed a factorization over (past) hidden states,
(future) control states and precision. Furthermore, we have fac-
torized successive states over time, which means we only have
to represent the current state explicitly. These particular mean
ﬁeld assumptions are not approximations, because the true gen-
erative process is Markovian. Conversely, the factorization with
respect to precision is an approximation, because the true poste-
rior will show (mild) conditional dependencies between precision
and hidden states.
The marginal over control states has not been factorized
because the ﬁnal outcome depends, in general, on the particu-
lar history of choices. In other words, generally speaking, any
o u t c o m ed e p e n d su p o nt h es e q u e n c eo fc h o i c e si nt h ep a s t .
However, there are potentially a vast number of control sequences
or policies that could require an enormous number of sufﬁcient
statistics. This problem can be ﬁnessed by only considering allow-
able or ap r i o r iplausible policies. In the example below, there
is no point in accepting an offer more than once. Therefore, we
The generative model
Hidden states ts
to
01,, taa
Action
,,tTuu
Control states
c
,
B
AFull priors
Empirical priors – control states
Empirical priors – hidden states
Likelihood
1ts
1ts
1to
() ( ) ( ) ( ),,, | , | , | , |Posu am PosPsu aP m/tildenosp/tildenosp/tildenosp /tildenosp /tildenosp /tildenosp /tildenosp/tildenosp /tildenospγγ γ =
() |,tt i jPo i s j AA== =
() 0|( | )
t
iiiPos Po s/tildenosp/tildenosp
== ∏
()
()
()
0
|
|
|( , )
Ti
i
Ps i
Ps i
Pm
cc
dd
γα β
==
==
=Γ
()
()
l n | [ (| , ) | | (| ) ]
ln | , ,
tK L T t T
ti j
Pu s D Ps s u Ps m
Pu i s j QQ
/tildenosp/tildenosp
/tildenosp
γ
γ
=− ⋅
== = ⋅
()
ln
|, , ( )Tt i j
Z
Ps is ju u cT/tildenosp/tildenosp
πγ −
== =
()
()
1
10
1
,|, (|) ( |,)
|, , ( | )
t
ti i i i
tt t i j
Psu a P us Ps s a
Ps is ju u u BB
/tildenosp/tildenosp /tildenosp /tildenosp
/tildenosp/tildenosp
γ
−
+=
+
=
== =
∏
FIGURE 3 | This ﬁgure illustrates the temporal dependencies
among hidden states and control states in the generative model
considered in this paper. This Bayesian graph illustrates the
dependencies among successive hidden states and how they depend
upon action in the past and control states in the future. Note that
future control states depend upon the current state because it
depends upon the relative entropy or divergence between
distributions over the ﬁnal state that are, and are not, conditioned
on the current state. The resulting choices depend upon the
precision of beliefs about control states, which, in turn depend upon
the parameters of the model. Observed outcomes depend on, and
only on, the hidden states at any given time.
Frontiers in Human Neuroscience www.frontiersin.org September 2013 | Volume 7 | Article 598 | 8
Friston et al. Agency and inference
only need to consider policies in which an offer is accepted once
during the game. There is nothing lawful about this restriction;
however, it is particularly appropriate for irreversible Markovian
processes that have absorbing states (that render further action
pointless). These processes are ubiquitous in game theory where,
having made a choice, there is no going back. This allows one to
reduce the number of sufﬁcient statistics for policies from K
T to
(K − 1) × T by only allowing policies in which a choice uτ > 1i s
made at t = τ and ut = 1 otherwise.
T h ed e t a i l so ft h em e a nﬁ e l da s s u m p t i o na b o v ea r en o tt e r -
ribly important. The main point here is that the formalism
of variational Bayes allows one to specify constraints on the
form of the approximate posterior that makes prior assump-
tions or beliefs about allowable choices explicit. For example, in
(Friston et al., 2012a ) we used a mean ﬁeld assumption where
every choice could be made at every time point. Equation (6)
assumes the approximate marginal over precision is, like its con-
jugate prior, a gamma distribution; where the shape parameter
is the same as the prior α = 8 and the rate parameter is opti-
mized. This rate parameter corresponds to temperature in classic
formulations. Crucially, it is no longer a free parameter but
a sufﬁcient statistic of the unknown precision of beliefs about
policies.
VARIATIONAL UPDATES
Variational Bayes optimizes the sufﬁcient statistics μ ∈ R+ with
a series of variational updates. It is straightforward to show ( Beal,
2003) that the marginal distributions Q(ψi|μi) that minimize free
energy can be expressed in terms of the variational energies V(ψi)
of each subset:
ln Q (ψi|μi) = V (ψi) + ln Zi ⇒ ∂F (˜o,μ)
∂μi
= 0
V (ψi) = EQ (ψ\i) [ln P(˜o, ψ|m)]
ψ =
(
s0,..., st , ˜u, γ
)
μ =
( ⌢
s 0,...,
⌢
s t ,
⌢
π,
⌢
β
)
(7)
The variational energies are just the (negative) Gibbs energies
in Equation (2), expected under the Markov blanket Q(ψ\i) of
each subset. Loosely speaking, the Markov blanket contains all
subsets, apart from the subset in question. The important thing
about this result is that it expresses the optimal sufﬁcient statistics
of one subset in terms of the others. This allows one to itera-
tively re-evaluate each subset, given the others, until convergence.
This is, in essence, variational Bayes. Given the generative model
in Equation (5) and the mean ﬁeld assumption in Equation (6),
Equation (7) furnishes the following remarkably simple updates
(starting from prior beliefs):
⌢
s t = σ
(
ln AT ·
⌢
o t +ln B (at − 1) ·
⌢
s t − 1 +
⌢
γ · QT ·
⌢
π
)
⌢
π = σ
(⌢
γ · Q ·
⌢
s t
)
⌢
β = β−
⌢
π
T
·Q ·
⌢
s t
⌢
γ = α
⌢
β
σ (V) = exp(V)∑
i, j exp
(
Vij
) (8)
These expressions follow in a straightforward way from the varia-
tional energies in Equation (7): see the Appendix and (Beal, 2003)
for details. These updates assume the parameters of the model
are known. If they are not, then it is relatively straightforward to
extend the variational Bayesian scheme above to include varia-
tional updates for learning unknown parameters, as described in
Chapter 3 of ( Beal, 2003 ). The only special consideration is the
use of conjugate (Dirichlet) priors over the parameters.
In summary, variational Bayes involves iterating updates to
ﬁnd the sufﬁcient statistics that minimize free energy and, implic-
itly, provide Bayesian estimates of the hidden variables. This
means the sufﬁcient statistics change over two timescales—a
fast timescale that updates posterior beliefs given the current
observations—and a slow timescale that updates posterior beliefs
as new observations become available and action is taken. We have
previously speculated ( Friston et al., 2012a ) that this separation
of temporal dynamics may be related to nested electrophysi-
ological oscillations, such as phase coupling between gamma
and theta oscillations in prefrontal–hippocampal interactions
(Canolty et al., 2006 ). This speaks to biological implementations
of variational Bayes, which we now consider in terms of neuronal
and cognitive processing.
THE FUNCTIONAL ANATOMY OF DECISION-MAKING
The variational scheme above has a computational form that
resembles many aspects of neuronal processing in the brain.
If we assume that neuronal activity encodes sufﬁcient statis-
tics, then the variational update scheme could provide a
metaphor for functional segregation—the segregation of repre-
sentations corresponding to the mean ﬁeld assumption, and
functional integration —the recursive (reciprocal) exchange of
sufﬁcient statistics during approximate Bayesian inference. In
terms of the updates themselves, the expectations of hidden
states and policies are softmax functions of mixtures of the
other expectations. This is remarkable because these updates
are derived from basic variational principles and yet they have
exactly the form of neural networks that use integrate and
ﬁre neurons—and are not dissimilar to real neurons with
sigmoid activation functions. Furthermore, the softmax func-
tions are of linear mixtures of sufﬁcient statistics (neuronal
activity) with one key exception; namely, the modulation by
precision when updating beliefs about the current state of
the world and selecting the next action. It is tempting to
equate this modulation with the neuromodulation by ascend-
ing neurotransmitter systems such as dopamine that send pro-
jections to (prefrontal) systems involved in working memory
(Goldman-Rakic, 1997; Moran et al., 2011 ) and striatal systems
involved in action selection ( O’Doherty et al., 2004; Surmeier
et al., 2009 ). We now consider each of the variational updates
from a cognitive and neuroanatomical perspective (see Figure 4
for a summary):
Frontiers in Human Neuroscience www.frontiersin.org September 2013 | Volume 7 | Article 598 | 9
Friston et al. Agency and inference
a
VTA/SN
Prefrontal Cortex
Premotor Cortex
Inferotemporal Cortex
Striatum
to
S
t
r
iat
u
m
11ln ln ( ) TT
tt t t
t
T
t
so a s
s
s
Pr
emot
o
r
 C
P
l
n
 l
n
 (
t
 t
o
 a
 1
 1
)
 t
s
t
s
t
s
AB Q
Q
Q
t
s
 Pr
emot
o
P
l
n
 l
n
 (
 )
T
t
 t
o
 a
 s
 1
t
1
 )
 s
A
 B
 Q
Q
T
Q
Q
t
s
Q
 t
s
Q
T
t
s
T
T
 Q
T
T
Variational updates
Perception
Action selection
Precision
Functional anatomy
ts
t
s
FIGURE 4 | This ﬁgure illustrates the cognitive and functional anatomy
implied by the variational scheme—or more precisely, the mean ﬁeld
assumption implicit in variational updates.Here, we have associated the
variational updates of expected states with perception, of future control
states (policies) within action selection and, ﬁnally, expected precision with
evaluation. The forms of these updates suggest the sufﬁcient statistics from
each subset are passed among each other until convergence to an internally
consistent (Bayes optimal) solution. In terms of neuronal implementation, this
might be likened to the exchange of neuronal signals via extrinsic connections
among functionally specialized brain systems. In this (purely iconic)
schematic, we have associated perception (inference about the current state
of the world) with the prefrontal cortex, while assigning action selection to
the basal ganglia. Crucially, precision has been associated with dopaminergic
projections from the ventral tegmental area and substantia nigra that,
necessarily, project to both cortical (perceptual) and subcortical (action
selection) systems. See main text for a full description of the equations.
PERCEPTION
The ﬁrst variational step updates beliefs about the current state
of the world using observed outcomes and representations of the
preceding state. This confers a temporal contiguity on inference,
where empirical prior beliefs about the current state conspire with
sensory evidence to produce posterior beliefs. However, there is
a third term that corresponds to expected value of each state,
averaged over policies. This term can be thought of as an opti-
mism bias in the sense that, when precision is high, perception is
biased toward the state that has the greatest potential to realize the
agent’s goal. We can now see why precision moderates this bias,
much like dopamine ( Sharot et al., 2012 ). Figure 4ascribes these
updates to the frontal cortex—under the assumption that neu-
ronal populations here encode working memory for the current
state of the world ( Goldman-Rakic et al., 1992 ). The functional
anatomy in Figure 4 should not be taken too seriously—it is
just used to illustrate the segregation and reciprocal message
passing that follows from the computational logic of variational
Bayes.
ACTION SELECTION
The second variational update is a softmax function of the
expected value of competing choices under the current state.
Figure 4 places this update in the striatum, where the expected
value of a policy requires posterior beliefs about the current state
from prefrontal cortex and expected precision from the ventral
tegmental area. Crucially, this is exactly the softmax choice rule
that predominates in QRE theory and other normative models
(Haile et al., 2008 ). Again, it is remarkable that this rule follows
directly from basic variational principles. However, utilitarian
formulations overlook the symmetry between the expected value
over states—that provides the value of a choice, and the expected
value over choices—that provides the value of a state. In other
words, there are two expected values, one for action Q ·
⌢
s and
one for perception QT ·
⌢
π.F u r t h e r m o r e ,t h ee x p e c t e dv a l u eo v e r
choices and states
⌢
π
T
· Q ·
⌢
s t speciﬁes the optimal precision or
inverse temperature, which is overlooked in classic treatments.
Neurobiologically, the softmax policy updates would correspond
to a winner-take-all or biased competition among competing
choices or policies, where competition is modulated by precision.
This is the second key role of precision; namely, to modulate the
selection of competing representations of future action: cf. ( Cisek,
2007; Frank et al., 2007; Jocham et al., 2012 ).
EVALUATING PRECISION
The ﬁnal variational step estimates the precision of prior
beliefs about policies, using posterior expectations about hidden
states and choices. We have associated expected precision with
dopaminergic projections from the ventral tegmental area (and
substantia nigra), which must be in receipt of messages from the
prefrontal cortex and striatum. One of the key insights, afforded
by the variational scheme, is that precision has to be optimized. So
what would happen if (estimated) precision was too high or too
low? If precision was zero, then perception would be unbiased and
represent a veridical representation of worldly states. However,
there would be a failure of action selection in the sense that the
value of all choices would be the same. One might plausibly asso-
ciate this with the pathophysiology of Parkinson’s disease—that
involves a loss of dopaminergic cells and a poverty of action
Frontiers in Human Neuroscience www.frontiersin.org September 2013 | Volume 7 | Article 598 | 10
Friston et al. Agency and inference
selection. Conversely, if precision was too high, precise choices
are made but there would be a predisposition to false percep-
tual inference—through the augmentation of optimism bias. This
might be a metaphor for the positive symptoms of schizophrenia,
putatively associated with hyper-dopaminergic states ( Fletcher
and Frith, 2009 ). In short, there is an optimal precision for any
context and the expected precision has to be evaluated carefully
on the basis of current beliefs about the state of the world.
Inspection of the update for expected precision shows that it is
an increasing asymptotic function of value, expected under cur-
rent beliefs about states and choices (see Figure 5). This means
that the optimal precision depends upon the attainability of
goals: if a goal cannot be obtained from the current state, then
precision will be small—reﬂecting a reduced conﬁdence in pre-
dictions about behavior. Conversely, if there is a clear and precise
path from the current state to a goal, then precision will be
high. This means that precision reports the attainability of goals
in terms of value. Mathematically, value can never be greater
than zero (because the KL divergence is always non-negative).
This means that precision increases to its upper bound of α,
when value increases to zero (see Figure 5). In short, precision
r e p o r t st h ee x p e c t e dv a l u eo v e rs t a t e sa n dp o l i c i e sa n dp l a y sa
dual role in biasing perceptual inference and action selection: on
the one hand, it biases perceptual inference toward prior beliefs
about future (choice dependent) outcomes. On the other hand, it
encodes the conﬁdence that a goal can be attained and increases
the precision of action selection.
In summary, this section has considered the implications
of variational Bayes for cognitive architectures and functional
anatomy. The mean ﬁeld assumption, enforced by the combi-
natorics and intractability of exact Bayesian inference, implies a
segregation of inference into separable cognitive processes and
t
-8 -7 -6 -5 -4 -3 -2 -1 00
1
2
3
4
5
6
7
8
Expected value
Expected precision
Precision and value
8
1
T
ts
Q
T s
Q
FIGURE 5 | The strictly increasing, monotonic relationship between
expected precision and expected value.Note that value never exceeds
zero. This is because a Kullback–Leibler divergence can never be less than
zero; by Gibbs inequality.
their neuronal substrates (functional segregation). The particu-
lar mean ﬁeld assumption used here implies distinct perceptual,
choice and evaluation processes that can be associated with dis-
tributed cortical and subcortical systems in the brain. Crucially,
every system (encoding the sufﬁcient statistics of a marginal dis-
tribution) must receive signals from every system to which it
sends signals. We will now look more closely at this reciprocal
message passing.
DECISION-MAKING UNDER UNCERTAINTY
This section looks at simulated decision-making using the scheme
above. The focus here will be on the circular dependencies
between representations of hidden states and precision. This cir-
cular causality is one of the most important features of the
variational scheme and means that one can consider not just the
computational role of precision but also how it is controlled by
the representations (posterior expectations) it optimizes.
Figure 2(lower panels) provides an example of a simple “lim-
ited offer” game in which the agent has to choose between a low
offer—that might be withdrawn at any time—and a high offer—
that may replace the low offer with some ﬁxed probability. The
problem the agent has to solve is how long to wait. If it waits
too long the low offer may be withdrawn and it will end up with
nothing. Conversely, if it chooses too soon, it may miss the oppor-
tunity to accept a high offer. The probabilistic contingencies are
shown in Figure 2in terms of control dependent transition prob-
abilities B(u
t ), where there are two control states (reject or accept)
and ﬁve hidden states (low offer, high offer, no offer, accepted low
offer, and accepted high offer). We can specify prior goals over the
ﬁnal states with a softmax function of utilities. Unless otherwise
stated we will use:
P(s
T |θ) = c = σ
(
[1, 1,1,2,4]T
)
(9)
This means the agent believes it will accept the high offer
exp(4 − 2) = 7.39 times more than the low offer, which, in turn
is exp (2 − 1) = 2.718 times more likely than having accepted
neither. To make things more interesting, we increased the prob-
ability of offer withdrawal with time such that the hazard rate:
r = 1 − (1 −
1
16 )t . This also illustrates time-dependent transition
probabilities that the variational scheme can handle with ease.
Finally, the probability that a low offer changes into a high offer
( p r o v i d e di ti sn o tw i t h d r a w n )w a sﬁ x e ds ot h a tt h ep r o b a b i l i t yo f
receiving a high offer over T = 16 trials was a half. This means the
hazard rate in Figure 2becomes q = (1 − r) · (1 − (1 −
1
2 )1/ T ).
For simplicity, we assumed the sensory mapping was the identity
matrix such that A = I.
Figure 6, shows the results of a single game after iterating the
variational updates of the previous section. In this example, the
low offer was replaced with a high offer on the eleventh trial,
which the agent accepted. It accepts because this is most prob-
able choice—in the face of a high offer—under its prior beliefs
that it is most likely to have accepted the higher offer at the end
of the game. The expected probabilities of staying (rejecting) or
shifting (accepting) are shown in the upper right panel (in green
and blue, respectively), as a function of time for each trial (dotted
lines) and the ﬁnal beliefs (full lines). The interesting thing here
Frontiers in Human Neuroscience www.frontiersin.org September 2013 | Volume 7 | Article 598 | 11
Friston et al. Agency and inference
is that prior to the high offer, the agent believes that it will accept
the low offer three or four trials in the future. Furthermore, the
propensity to accept (in the future) increases as time goes on (see
dotted lines). This means that it waits, patiently, because it thinks
it is more likely to accept an offer in the future than to accept the
current offer.
The expected precision of these posterior beliefs is shown in
the lower left panel and declines gently until the high offer is
made. At this point the expected precision increases markedly,
and then remains constant until the end of the game (at its
maximum value of eight). This reﬂects the fact that the ﬁnal
outcome is assured with a high degree of conﬁdence, once the
high offer has been made and subsequently accepted. These
precisions are the expected precisions after convergence of the
variational iterations. The equivalent dynamics in the lower
right panel show the expected precision over all updates in
terms of simulated dopamine responses. These responses are
a least squares deconvolution of the variational updates using
an exponentially decaying kernel with a time constant of eight
iterations. In other words, convolving the simulated dopamine
responses with an exponential decay function would reproduce
the Bayes optimal updates. This (de)convolution accounts for
the postsynaptic effects of dopamine that, we imagine, decay
exponentially after its release. The resulting updates are quite
revealing and show phasic responses to the arrival of new sensory
Inferred states
Time
Hidden state
2 4 6 8 10 12 14 16
1
2
3
4
5
2 4 6 8 10 12 14 16
0
0.2
0.4
0.6
0.8
1
Time
Control state
Inferred policy
2 4 6 8 10 12 14 16
3
4
5
6
7
8
Latency (offers)
Precision of beliefs
Expected precision
Latency (iterations)
Precision of beliefs
Simulated dopamine responses
stay
shift
?
?
20 40 60 80 100 120
0
1
2
3
4
FIGURE 6 | This ﬁgure shows the results of a simulation of 16 trials,
where a low offer was replaced by high offer on the 11th trial, which
was accepted on the subsequent trial.The upper leftpanel shows the
expected states as a function of trials or time, where the states are deﬁned
in Figure 2.T h e upper rightpanel shows the corresponding expectations
about control in the future, where the dotted lines are expectations during
earlier trials and the full lines correspond to expectations during the ﬁnal
trial. Blue corresponds to reject (stay) and green to accept (shift). The lower
panels show the time-dependent changes in expected precision, after
convergence on each trial ( lower left) and deconvolved updates after each
iteration of the variational updates ( lower right).
information that converge to tonic values, which minimize free
energy.
This pattern of precision encoding can be compared with
another realization, in which the low offer was withdrawn after
the fourth trial: Figure 7 shows the results of this simulation,
where the expected control states and precision are exactly the
same as in the previous simulation, until the offer is withdrawn.
At this point, the agent moves to the no-offer state and remains
there until the end of the game. Notice that there is still an
increasing propensity to accept, even though the agent knows that
accepting is futile. This is because all allowable policies entail a
choice but with no preference for when that choice is made. This
is because neither the entropy nor the expected utility of the ﬁnal
state is affected by subsequent choices. In this instance, precision
falls at the point the offer is withdrawn and remains low until the
last trial. Interestingly, at the point the offer is withdrawn, there
is a profound suppression of simulated dopamine ﬁring, followed
by phasic bursts on subsequent cues that gently increase with the
increasing probability of choosing—despite the fact that nothing
can be changed. This illustrates the interdependency of expec-
tations about precision and hidden states of the world—which
change after the offer has been withdrawn. Many readers will have
noticed a similarity between the dynamics of precision and the
ﬁring of dopaminergic cells in reinforcement learning paradigms,
which we discuss further in (Friston et al., under review).
For people familiar with previous discussions of dopamine
in the context of active inference, the correspondence between
precision and dopaminergic neurotransmission will come as no
?
?
Inferred states
Time
Hidden state
2 4 6 8 10 12 14 16
1
2
3
4
5
2 4 6 8 10 12 14 16
0
0.2
0.4
0.6
0.8
1
Time
Control state
Inferred policy
2 4 6 8 10 12 14 16
1.9
2
2.1
2.2
2.3
2.4
2.5
2.6
2.7
Latency (offers)
Precision of beliefs
Expected precision
Latency (iterations)
Precision of beliefs
Simulated dopamine responses
stay
shift
20 40 60 80 100 120
0
1
2
3
4
FIGURE 7 | This ﬁgure uses the same format as the previous ﬁgure;
however, here, the low offer was withdrawn on the ﬁfth trial, leading
to a decrease in expected precision.Note the difference (divergence)
between the expected states on the 15th (penultimate) and 16 (ﬁnal) trial.
It is this large divergence (or more exactly the divergence between
distributions over the ﬁnal state) that leads to a small value and associated
precision.
Frontiers in Human Neuroscience www.frontiersin.org September 2013 | Volume 7 | Article 598 | 12
Friston et al. Agency and inference
surprise—exactly the same conclusions have been reached when
examining predictive coding schemes ( Friston et al., 2012b )
and hierarchical inference using volatility models ( Mathys et al.,
2011) .“ I nb r i e f ,t h ee m e r g e n tr o l eo fd o p a m i n ei st or e p o r tt h e
precision or salience of perceptual cues that portend a predictable
sequence of sensorimotor events. In this sense, it mediates the
affordance of cues that elicit motor behavior ( Cisek, 2007 ); in
much the same way that attention mediates the salience of cues
in the perceptual domain.” ( Friston et al., 2012b ,p .2 ) .
TEMPORAL DISCOUNTING AND MARGINAL UTILITY
This section considers the relative contribution of entropy (explo-
ration) and expected utility to choice behavior and how these
contribution change with context and time. Generally, when rela-
tive utilities are large, they will dominate value (overshadowing
entropy) and behavior will conform to expected utility theory.
Figure 8 shows this numerically in terms of the probability of
accepting over successive trials with, and without, the entropy
term. Here, we precluded withdrawal of the low offer (and its
acceptance) and increased the utility of the low offer from zero to
eight. Inspection of the upper panels shows that the choice proba-
bilities are essentially the same—with a tendency to wait until the
last trial until the low offer becomes more attractive than the high
offer (at a utility of four). However, there are subtle differences
that are revealed in the lower panels.
These panels show the equivalent results but now in terms of
the probability distribution over the latency or number of trials
Latency (offers)
Utility of low offer
Value with novelty bonus
2 4 6 8 10 12 14
0
1
2
3
4
5
6
7
8
Latency (offers)
Utility of low offer
Expected utility
2 4 6 8 10 12 14
0
1
2
3
4
5
6
7
8
Latency (offers)
Utility of low offer
Latency of accepting
2 4 6 8 10 12 14 16
0
1
2
3
4
5
6
7
8
Latency (offers)
Utility of low offer
Latency of accepting
2 4 6 8 10 12 14 16
0
1
2
3
4
5
6
7
8
High offer
High offer
FIGURE 8 | The upper panels show the probability of accepting with
(left) and without (right) the entropy or novelty part of value, where
the low offer remained available and action was precluded.These
probabilities are shown as a function of trial number and the relative utility
of the low offer (white corresponds to high probabilities). The lower panels
show the same results but in terms of the probability distribution over the
latency or time to choice. Note that including the entropy in value slightly
delays the time to choice—to ensure a greater latitude of options. This is
particularly noticeable in the ambiguous situation when the low offer has
the same utility as the high offer (of four).
until an offer is accepted. This is simply the cumulative proba-
bility of waiting until a particular latency, times the probability
of accepting at the latency in question. Here, one sees a slight
increase in the latency when value includes the entropy term. This
reﬂects the fact that accepting an offer precludes other outcomes
and therefore reduces the entropy of the distribution over ﬁnal
states. Intuitively, there is value in keeping ones options open: cf.
an o v e l t yb o n u s(Krebs et al., 2009 ).
Figure 9shows the underlying changes in entropy and expec-
tations as a function of trial number (with a low offer utility of
two). The upper left panel shows the probability of staying or
accepting and the associated uncertainty or entropy of beliefs
about the policy. One can see that this uncertainty increases
as the propensity to accept increases. When the agent has in
mind a 50–50 probability of accepting, the entropy peaks, shortly
before the last offer. The entropy (red) and expected utility
(blue) underlying these choices are shown in the right panel and
demonstrate—in this example—a complementary dependency
on time. As time progresses, the expected utility ﬁrst falls and then
increases, while the entropy does the converse. This suggests that
2 4 6 8 10 12 14 16
0
0.05
0.1
0.15
0.2
Offer
Expected values
Expected utility and entropy
Expected utility
(temporal discounting)
Entropy
(exploration bonus)
2 4 6 8 10 12 14
0.1
0.2
0.3
0.4
0.5
0.6
0.7
0.8
0.9
Offer
Probability and entropy (nats)
Uncertainty about action
Entropy over choices
-6 -5 -4 -3 -2 -1
-7
-6
-5
-4
-3
-2
-1
0
Marginal utility
utility of low and high offers
Expected marginal utility
()Tcs
 -
3
g
m
a
r
g
i
n
a
(
 )
T
c
 s
()l n( | )TTcs Ps
 )
l
n
 (
 |
T
P
 s
FIGURE 9 | Upper left panel:the probability of accepting an offer as a
function of time or trials. Note that the probability of accepting (green)
increases over time to approach and surpass the probability of rejection.
This produces an increase in the uncertainty about action—shown in red.
Upper right panel: these are the expected utility and entropy components
of expected value as a function of trial number. The key result here is the
time-dependent change in expected utility, which corresponds to temporal
discounting of the expected utility: i.e., the expected utility of the ﬁnal state
is greater when there are fewer intervening trials. Lower panel:t h e
marginal utility of the high offer (green) and low offer (blue) as a function of
the relative utility of the high offer. Marginal utility is deﬁned here as
expected utility times expected precision. The multiple curves correspond
to the marginal utilities as a function of trial number (and do not differ
greatly because expected precision changes more slowly over time—for a
given utility—than it changes over utility—for a given time).
Frontiers in Human Neuroscience www.frontiersin.org September 2013 | Volume 7 | Article 598 | 13
Friston et al. Agency and inference
the agent believes it is more likely to secure an offer later in the
game, because it now knows the offer has not been withdrawn;
in other words, the possibility of an early withdrawal cannot be
discounted at the beginning of the game.
This dynamic speaks directly to temporal discounting in inter-
temporal choice: consider the expected utility on the eighth trial.
This is the utility of a ﬁnal outcome eight trials in the future.
Notice that this is substantially less than the expected utility of the
ﬁnal outcome two trials in the future. In other words, the expected
utility of the outcome decreases, the further it recedes into the
future. This is the essence of temporal discounting, which—in
this example—can be explained simply by prior beliefs that the
offer will be withdrawn before the ﬁnal outcome is reached. This
withdrawal probability is known as a hazard function, whose rate
changes with time in our example (the parameter r in Figure 2).
TEMPORAL DISCOUNTING
Temporal discounting is an emergent property of Bayes optimal
inference about choice behavior that depends upon the gener-
ative model and, implicitly, prior beliefs about time sensitive
contingencies—or at least it can be formulated as such ( Sozou,
1998). The form of temporal discounting depends upon the gen-
erative model and can be quite complicated. This is because the
discounting of expected utility depends upon inference about the
current state, future choices and precision—all of which change
with time in an interdependent fashion. Having said this (eco-
nomic) hyperbolic discounting can be derived under a simple
generative model of losing a reward, given exponential priors on
the hazard rate ( Sozou, 1998 ). Although hyperbolic (or expo-
nential) discounting may be sufﬁcient for descriptive purposes,
simply optimizing a temporal discounting parameter ( Daw and
T ouretzky, 2002), in light of observed behavior, cannot disam-
biguate among the prior beliefs an agent may entertain. To under-
stand the nature of temporal discounting, one has to understand
the generative model upon which that discounting is based—and
use observed choice behaviors to select among competing models
or hypotheses.
MARGINAL UTILITY AND PRECISION
We have been careful to distinguish between utility ln P (sT |θ) =
c (sT )—an attribute of the ﬁnal state and value Q(˜u|st )—an
attribute of choices available from the current state. This means
that the value of the current state depends upon how easy it is
to access the ﬁnal state. Furthermore, the ensuing choice depends
upon precision, suggesting that the effect of value on choice can
be expressed in terms of an effective utility γ · c(s
T ) that we
will call marginal utility (for consistency with economic theory).
Assuming the entropy term in Equation (4) small enough to be
ignored, it is easy to see that expected marginal utility directly
informs choices:
ln P (˜u|s
t ) =
∑
sT
P(sT |st , ˜u)(γ · c(sT ))  
expected marginal utility
(10)
Generally, as the utility of a particular ﬁnal state increases, pre-
cision increases more slowly—because the implicit distribution
over ﬁnal states is less likely to be realized. Intuitively, the marginal
utility depends on the conﬁdence that a goal can be reached. This
leads to a convex relationship between marginal utility and util-
ity: cf. the law of diminishing marginal utility ( Kauder, 1953 ).
The lower panel of Figure 9 illustrates this relationship. Here,
we increased the relative utility of the high offer from two to
eight and evaluated the marginal utility of accepting the low
and high offers (by precluding offer withdrawal and action). The
result is a characteristic convex relationship, in which marginal
utility decreases more slowly with the utility of the high offer—
reaching its maximum at zero. Conversely, the marginal utility
of the low offer decreases more slowly as the utility of the low
offer falls. In the current setup, this asymmetry results from the
nature of utility and its dependency upon precision. However,
there may be interesting connections here with Prospect Theory
(Kahneman and Tversky, 1979 ) that appeal to a reference point
for utility—deﬁned here in terms of equiprobable outcomes.
In summary, many classic phenomena in utilitarian and eco-
nomic theory resurface here as natural consequences of Bayes
optimal (active) inference under a relatively simple generative
model. This is potentially important, because choice behavior
c a n ,i np r i n c i p l e ,b eu s e dt oa d j u d i c a t ea m o n ga l t e r n a t i v em o d e l s
used by subjects.
CONCLUSION
This paper has considered agency from a rather elementary and
formal perspective; namely, that a sense of agency rests upon
prior beliefs about how one will behave. Irrespective of how these
beliefs are described, they must—in some sense—entail the belief
that our behavior will converge on outcomes that deﬁne who we
are—in terms of our characteristic states. This can be formalized
in terms of prior beliefs that controlled state transitions minimize
a relative entropy or KL divergence—endowing behavior with a
purpose that can be characterized by the states we believe should
be occupied. The ensuing scheme appears to have construct
validity in relation to normative accounts in psychology and eco-
nomics. Furthermore, the computational anatomy afforded by
variational Bayes ﬁts comfortably with neuronal message passing
in the brain.
In reinforcement learning, there is an important distinction
between model-free and model-based systems ( Daw et al., 2005 ).
In contrast, active inference is quintessentially model-based—so
does this preclude model-free schemes? Active inference accom-
modates the distinction between model-free and model-based
by placing model-free schemes at the lower levels of hierarchi-
cal generative models. This enables higher levels to contextualize
lower level (reﬂexive or habitual) inference and consequent action
selection. We have not addressed this issue in this paper; largely
because our focus has been on inference about hidden states,
while learning corresponds to optimizing the parameters of the
generative model—such as the probability transition matrices
that encode environmental contingencies and which hidden states
can and cannot be controlled.
The arguments in this paper are based upon—and lead to—a
number of points, which we now brieﬂy rehearse:
• Optimal behavior can be cast as a pure inference problem, in
which valuable outcomes are deﬁned in terms of prior beliefs
Frontiers in Human Neuroscience www.frontiersin.org September 2013 | Volume 7 | Article 598 | 14
Friston et al. Agency and inference
about future states. However, exact Bayesian inference (per-
fect rationality) cannot be realized physically, which means
that optimal behavior rests on approximate Bayesian inference
(bounded rationality).
• Variational free energy provides a bound on Bayesian model
evidence (marginal likelihood) that is optimized by bounded
rational behavior. This requires (approximate Bayesian) infer-
ence on both hidden states of the world and (future) control
states. This mandates beliefs about action (control) that are
distinct from action per se—beliefs that entail a precision.
• These beliefs can be cast in terms of minimizing the relative
entropy or divergence between prior goals—over ﬁnal states—
and conditional distributions, given the current state of the
world and future choices.
• Value can be equated with negative divergence and comprises
entropy (exploration or novelty bonus) and expected utility
(utilitarian) terms that account for exploratory and exploitative
behavior respectively.
• Beliefs about the state of the world depend upon expected value
over choices, while beliefs about choices depend upon expected
value over states. Beliefs about precision depend upon expected
value under both states and choices.
• Precision has to be optimized to balance prior beliefs about
choices and sensory evidence for hidden states. In other words,
precision has to nuance an inherent optimism bias when infer-
ring the current state of the world.
• Variational Bayes provides a formal account of how posterior
expectations about hidden states of the world, control states
and precision depend upon each other; and may provide a
metaphor for message passing in the brain.
• Variational Bayes induces distinct probabilistic representations
(functional segregation) of hidden states, control states and
precision—and highlights the role of reciprocal message pass-
ing. This may be particularly important for expected precision
that is required for optimal inference about hidden states
(perception) and control states (action selection).
One might ask why these conclusions do not follow from norma-
tive accounts of optimal behavior. One reason is that normative
accounts do not distinguish between action and beliefs about
action (control). These beliefs entail both content (expectations)
and uncertainty (precision). This means that both expectations
about behavior and the precision of these beliefs have to be opti-
mized. It is the optimization of precision that provides a complete
account of bounded rationality (approximate Bayesian inference)
and a putative account of the control of dopaminergic ﬁring; cf.
(Gurney et al., 2001 ).
This account considers dopamine to report the precision of
divergence or prediction errors (in their nuanced or non-classical
sense) and partly resolves the dialectic between dopamine as
r e p o r t i n gr e w a r dp r e d i c t i o ne r r o r s(Schultz et al., 1997 )a n d
the predictability of rewards ( Fiorillo et al., 2003; Redgrave and
Gurney, 2006; Schultz et al., 2008 ). The notion that dopamine
encodes precision is now receiving support from several lines
of evidence; from purely theoretical treatments of hierarchical
Bayesian inference ( Mathys et al., 2011 ), from theoretical neu-
robiology ( Frank et al., 2007; Fletcher and Frith, 2009; Friston
et al., 2012b; Pellicano and Burr, 2012 ) and from empirical stud-
ies ( Fiorillo et al., 2008; Coull et al., 2011; Galea et al., 2012;
Zokaei et al., 2012 ). Having said this, a proper validation of active
inference will require careful model comparison using empirical
choice behaviors and a detailed mapping between putative model
variables and their neuronal correlates.
Indeed, the aim of this work was to provide a comprehensive
but formal model of choice behavior that contextualizes deci-
sions in the more general setting of embodied or active inference
about states of the world; e.g., ( Pezzulo and Castelfranchi, 2009 ).
In this setting, the ability to compare different formulations of
approximate Bayesian inference (in terms of different mean ﬁeld
approximations and prior beliefs) becomes crucial—because dif-
ferent formulations correspond to different hypotheses about
how subjects optimize their behavior. We hope to use Bayesian
model selection to characterize individual subjects, in terms of
their prior beliefs using generative models of the sort introduced
in this paper. This may be useful in the study of intersubject vari-
ability or indeed differences between normal subjects and those
with psychiatric syndromes or addictive behaviors. The advantage
of having a variational scheme with dynamics (that can be applied
to these models) is that, in principle, one can localize the neu-
ronal correlates of implicit Bayesian updates with neuroimaging.
More generally, the theoretical approach adopted in this paper
highlights the necessarily intimate relationship between inferring
states of the world and optimal behavior ( Toussaint and Storkey,
2006; Gläscher et al., 2010 ), the conﬁdence or precision of that
inference ( De Martino et al., 2012 ), and the functional plurality
of dopaminergic neuromodulation ( Schultz, 2007).
In terms of leveraging active inference to further understand
the neurobiology of decision-making, there are several predic-
tions that could be explored—using either choice behavior or
functional neuroimaging. One key prediction is that choices will
systematically maximize the entropy over outcomes that have the
same (relative) utility. In principle, it should be possible to design
behavioral experiments that manipulate entropy and expected
utility in an orthogonal fashion, to establish whether entropy rep-
resents an intrinsic drive. Furthermore, transcribing this sort of
paradigm to fMRI should establish the validity of the putative
functional segregation implied by the variational message pass-
ing scheme considered above. Indeed, we have used the game
described in this paper as the basis of an fMRI experiment—and
will be reporting the results in the near future. The neurobiologi-
cal plausibility of variational message passing remains something
of an open question. However, there is one comforting point of
convergence between variational Bayes and more neurobiologi-
cally plausible predictive coding schemes ( Bastos et al., 2012 ): this
is the fact that the solution for both is exactly the same. In other
words, it may be possible to formulate variational Bayes using
neuronal dynamics that implement a gradient descent on varia-
tional free energy. Interestingly, this is precisely the (Variational
Laplace) scheme used routinely in data analysis ( Friston et al.,
2007).
ACKNOWLEDGEMENTS
The Wellcome Trust funded this work. Michael Moutoussis is also
supported by the NIHR Biomedical Research Centre.
Frontiers in Human Neuroscience www.frontiersin.org September 2013 | Volume 7 | Article 598 | 15
Friston et al. Agency and inference
REFERENCES
Ashby, W. R. (1947). Principles of
the self-organizing dynamic system.
J. Gen. Psychol. 37, 125–128. doi:
10.1080/00221309.1947.9918144
Bastos, A. M., Usrey, W. M., Adams,
R. A., Mangun, G. R., Fries, P ., and
Friston, K. J. (2012). Canonical
microcircuits for predictive cod-
ing. Neuron 76, 695–711. doi:
10.1016/j.neuron.2012.10.038
Beal, M. J. (2003). Variational
Algorithms for Approximate Bayesian
Inference. Ph.D. thesis, University
College London.
Birkhoff, G. D. (1931). Proof of
the ergodic theorem. Proc. Natl.
Acad. Sci. U.S.A. 17, 656–660. doi:
10.1073/pnas.17.12.656
Braun, D. A., Ortega, P . A., Theodorou,
E., and Schaal, S. (2011). “Path
integral control and bounded
rationality, ” in IEEE Symposium on
Adaptive Dynamic Programming
and Reinforcement Learning
(ADPRL) (Paris: IEEE), 202–209
Camerer, C. F. (2003). Behavioural
studies of strategic thinking
in games. Trends Cogn. Sci. 7,
225–231. doi: 10.1016/
S1364-6613(03)00094-9
Canolty, R. T., Edwards, E., Dalal, S. S.,
Soltani, M., Nagarajan, S. S., Kirsch,
H. E., et al. (2006). High gamma
power is phase-locked to theta oscil-
lations in human neocortex. Science
313, 1626–1628. doi: 10.1126/sci-
ence.1128115
Cisek, P . (2007). Cortical mecha-
n i s m so fa c t i o ns e l e c t i o n :t h e
affordance competition hypoth-
esis. Philos. Trans. R. Soc. Lond.
B Biol. Sci. 362, 1585–1599. doi:
10.1098/rstb.2007.2054
C o h e n ,J .D . ,M c C l u r e ,S .M . ,a n dY u ,A .
J. (2007). Should I stay or should I
go. How the human brain manages
the trade-off between exploitation
and exploration. Philos. Trans R.
Soc. Lond. B Biol. Sci.362, 933–942.
doi: 10.1098/rstb.2007.2098
Conant, R. C., and Ashby, R. W. (1970).
Every good regulator of a system
must be a model of that system.
Int. J. Systems. Sci. 1, 89–97. doi:
10.1080/00207727008920220
Coull, J. T., Cheng, R. K., and Meck,
W. (2011). Neuroanatomical and
neurochemical substrates of timing.
Neuropsychopharmacology 36, 3–25.
doi: 10.1038/npp.2010.113
Daw, N. D., and Doya, K. (2006).
The computational neurobiology
of learning and reward. Curr.
Opin. Neurobiol. 16, 199–204. doi:
10.1016/j.conb.2006.03.006
Daw, N. D., Niv, Y., and Dayan, P .
(2005). Uncertainty-based com-
petition between prefrontal and
dorsolateral striatal systems for
behavioral control. Nat. Neurosci.8,
1704–1711. doi: 10.1038/nn1560
Daw, N. D., and Touretzky, D. S. (2002).
Long-term reward prediction in
TD models of the dopamine
system. Neural Comput. 14,
2567–2583. doi: 10.1162/08997660
2760407973
Dayan, P ., and Daw, N. D. (2008).
Decision theory, reinforcement
learning, and the brain. Cogn.
Affect. Behav. Neurosci.8, 429–453.
doi: 10.3758/CABN.8.4.429
Dayan, P ., and Hinton, G. E. (1997).
Using expectation maximiza-
tion for reinforcement learning.
Neural Comput. 9, 271–278. doi:
10.1162/neco.1997.9.2.271
Dayan, P ., Hinton, G. E., and Neal,
R. (1995). The helmholtz machine.
Neural Comput. 7, 889–904. doi:
10.1162/neco.1995.7.5.889
De Martino, B., Fleming, S. M.,
Garrett, N., and Dolan, R. J. (2012).
Conﬁdence in value-based choice.
Nat. Neurosci. 16, 105–110. doi:
10.1038/nn.3279
E l l i s o n ,C .J . ,M a h o n e y ,J .R . ,J a m e s ,
R. G., and Crutchﬁeld, J. P . (2011).
Information symmetries in irre-
versible processes. Chaos 21,
037107. doi: 10.1063/1.3637490
Feynman, R. P . (1972). Statistical
Mechanics. Reading, MA: Benjamin.
Fiorillo, C. D., Newsome, W. T., and
Schultz, W. (2008). The tempo-
ral precision of reward predic-
tion in dopamine neurons. Nat.
Neurosci. 11, 966–973. doi: 10.1038/
nn.2159
Fiorillo, C. D., Tobler, P . N., and
Schultz, W. (2003). Discrete coding
of reward probability and uncer-
tainty by dopamine neurons. Science
299, 1898–1902. doi: 10.1126/sci-
ence.1077349
Fletcher, P . C., and Frith, C. D. (2009).
Perceiving is believing: a Bayesian
approach to explaining the pos-
itive symptoms of schizophrenia.
Nat. Rev. Neurosci. 10, 48–58. doi:
10.1038/nrn2536
Fox, C., and Roberts, S. (2012). A tuto-
rial on variational Bayes. Artif. Intell.
Rev. 38, 85–95. doi: 10.1007/s10462-
011-9236-8
Frank, M. J., Scheres, A., and Sherman,
S. J. (2007). Understanding
decision-making deﬁcits in neuro-
logical conditions: insights from
models of natural action selec-
tion. Philos. Trans. R. Soc. Lond.
B Biol. Sci. 362, 1641–1654. doi:
10.1098/rstb.2007.2058
Friston, K. (2010). The free-energy
principle: a uniﬁed brain theory.
Nat. Rev. Neurosci.11, 127–138. doi:
10.1038/nrn2787
Friston, K. (2012). A free energy
principle for biological systems.
Entropy 14, 2100–2121. doi:
10.3390/e14112100
Friston, K., Kilner, J., and
Harrison, L. (2006). A free
energy principle for the brain.
J. Physiol. Paris. 100, 70–87. doi:
10.1016/j.jphysparis.2006.10.001
Friston, K., Mattout, J., Trujillo-
Barreto, N., Ashburner, J., and
Penny, W. (2007). Variational free
energy and the Laplace approxima-
tion. Neuroimage 34, 220–234. doi:
10.1016/j.neuroimage.2006.08.035
Friston, K. J., Daunizeau, J., Kilner,
J., and Kiebel, S. J. (2010). Action
and behavior: a free-energy formu-
lation. Biol. Cybern. 102, 227–260.
doi: 10.1007/s00422-010-0364-z
Friston, K., Samothrakis, S., and
Montague, R. (2012a). Active
inference and agency: optimal
control without cost functions.
Biol. Cybern. 106, 523–541. doi:
10.1007/s00422-012-0512-8
Friston, K. J., Fitzgerald, T., Galea, J.
M., Adams, R., Brown, H., Dolan,
R. J., et al. (2012b). Dopamine,
affordance and active inference.
PLoS Comput. Biol.8:e1002327. doi:
10.1371/journal.pcbi.1002327
Fudenberg, D., and Kreps, D. (1993).
Learning mixed equilibria. Game.
Econ. Behav. 5, 320–367. doi:
10.1006/game.1993.1021
Galea, J. M., Bestmann, S., Beigi, M.,
Jahanshahi, M., and Rothwell,
J. C. (2012). Action reprogram-
ming in Parkinson’s disease:
response to prediction error is
modulated by levels of dopamine.
J. Neurosci. 32, 542–550. doi:
10.1523/JNEUROSCI.3621-11.2012
Gläscher, J., Daw, N., Dayan, P ., and
O’Doherty, J. P . (2010). States versus
rewards: dissociable neural predic-
tion error signals underlying model-
based and model-free reinforcement
learning. Neuron 66, 585–595. doi:
10.1016/j.neuron.2010.04.016
Goldman-Rakic, P . S. (1997). The corti-
cal dopamine system: role in mem-
ory and cognition. Adv. Pharmacol.
42, 707–711. doi: 10.1016/S1054-
3589(08)60846-7
Goldman-Rakic, P . S., Lidow, M. S.,
Smiley, J. F., and Williams, M. S.
(1992). The anatomy of dopamine
in monkey and human prefrontal
cortex. J. Neural Transm. Suppl.36,
163–177.
Gregory, R. L. (1968). Perceptual illu-
sions and brain models. P r o c .R .S o c .
Lond. B Biol. Sci.171, 179–196. doi:
10.1098/rspb.1968.0071
Gurney, K., Prescott, T. J., and
Redgrave, P . (2001). A compu-
tational model of action selection
in the basal ganglia. I. A new
functional anatomy. Biol. Cybern.
84, 401–410. doi: 10.1007/PL000
07984
Haile, P . A., Hortaçsu, A., and Kosenok,
G. (2008). On the empirical con-
tent of quantal response equilib-
rium. Am. Econ. Rev. 98, 180–200.
doi: 10.1257/aer.98.1.180
Helmholtz, H. (1866/1962).
“Concerning the perceptions in
general,” in Treatise on Physiological
Optics, 3rd Edn. Vol. 3. Transl. J.
Southall (New Y ork, NY: Dover).
H i n t o n ,G .E . ,a n dv a nC a m p ,D .
(1993). “Keeping neural net-
works simple by minimizing the
description length of weights,” in
Proceedings of COLT-93, 5–13. doi:
10.1145/168304.168306
Jaynes, E. T. (1957). Information the-
ory and statistical mechanics. Phys.
Rev. Ser. II 106, 620–630. doi:
10.1103/PhysRev.106.620
Jocham, G., Hunt, L. T., Near, J., and
Behrens, T. E. (2012). A mecha-
nism for value-guided choice based
on the excitation-inhibition bal-
ance in prefrontal cortex. Nat.
Neurosci. 15, 960–961. doi: 10.1038/
nn.3140
Kahneman, D., and Tversky, A. (1979).
Prospect theory: an analysis of deci-
sion under risk. Econometrica 47,
263–291. doi: 10.2307/1914185
Kakade, S., and Dayan, P .
(2002). Dopamine: general-
ization and bonuses. Neural
Netw. 15, 549–559. doi:
10.1016/S0893-6080(02)00048-5
Kappen, H. J., Gomez, Y., and Opper,
M. (2012). Optimal control as a
graphical model inference prob-
lem. Mach. Learn.87, 159–182. doi:
10.1007/s10994-012-5278-7
Kauder, E. (1953). Genesis of the
marginal utility theory: from aris-
t o t l et ot h ee n do ft h ee i g h t e e n t h
century. Econ. J. 63, 638–650. doi:
10.2307/2226451
Klyubin, A. S., Polani, D., and Nehaniv,
C. L. (2005). “Empowerment: a uni-
versal agent-centric measure of con-
trol,” in The 2005 IEEE Congress on
Evolutionary Computation. Vol. 1,
128–135.
Krebs, R. M., Schott, B. H.,
Schütze, H., and Düzel, E.
(2009). The novelty explo-
ration bonus and its attentional
modulation. Neuropsychologia
47, 2272–2281. doi: 10.1016/
j.neuropsychologia.2009.01.015
Luce, R. D. (1959). Individual Choice
Behavior. Oxford, UK: Wiley.
MacKay, D. J. (2003). Information
Theory, Inference and Learning
Algorithms. Cambridge, UK:
Cambridge University Press.
Frontiers in Human Neuroscience www.frontiersin.org September 2013 | Volume 7 | Article 598 | 16
Friston et al. Agency and inference
Mathys, C., Daunizeau, J., Friston, K.
J., and Stephan, K. E. (2011). A
Bayesian foundation for individual
learning under uncertainty.
Front. Hum. Neurosci. 5:39. doi:
10.3389/fnhum.2011.00039
McKelvey, R., and Palfrey, T. (1995).
Quantal response equilibria for
normal form games. Game.
Econ. Behav. 10, 6–38. doi:
10.1006/game.1995.1023
Moran, R. J., Symmonds, M., Stephan,
K .E . ,F r i s t o n ,K .J . ,a n dD o l a n ,R .J .
(2011). An in vivo assay of synaptic
function mediating human cogni-
tion. Curr. Biol.21, 1320–1325. doi:
10.1016/j.cub.2011.06.053
O’Doherty, J., Dayan, P ., Schultz, J.,
Deichmann, R., Friston, K., and
Dolan, R. J. (2004). Dissociable roles
of ventral and dorsal striatum in
instrumental conditioning. Science
304, 452–454.
Ortega, P . A., and Braun, D. A. (2011).
Information, utility and bounded
rationality. Lect. Notes Artif. Int.
6830, 269–274. doi: 10.1007/978-3-
642-22887-2_28
Ortega, P . A., and Braun, D. A. (2013).
Thermodynamics as a theory of
decision-making with information-
processing costs. Proc. R. Soc.
A 469, 2153. doi: 10.1098/rspa.
2012.0683
Pellicano, E., and Burr, D. (2012).
When the world becomes ‘too
real’: a Bayesian explanation
of autistic perception. Trends
Cogn. Sci. 16, 504–510. doi:
10.1016/j.tics.2012.08.009
Penny, W. D., Stephan, K. E., Mechelli,
A., and Friston, K. J. (2004).
Comparing dynamic causal models.
Neuroimage 22, 1157–1172. doi:
10.1016/j.neuroimage.2004.03.026
Pezzulo, G., and Castelfranchi, C.
(2009). Thinking as the control of
imagination: a conceptual frame-
work for goal-directed system.
Psychol. Res. 73, 559–577. doi:
10.1007/s00426-009-0237-z
Rao, R. P ., and Ballard, D. H. (1999).
Predictive coding in the visual cor-
tex: a functional interpretation of
some extra-classical receptive-ﬁeld
effects. Nat. Neurosci.2, 79–87. doi:
10.1038/4580
Redgrave, P ., and Gurney, K. (2006).
The short-latency dopamine signal:
a role in discovering novel actions.
Nat. Rev. Neurosci.7, 967–975. doi:
10.1038/nrn2022
Schmidhuber, J. (1991). “Curious
model-building control systems,”
in Proceedings in IEEE International
Joint Conference on Neural Networks,
Vol. 2, (Singapore), 1458–1463.
Schultz, W. (2007). Multiple
dopamine functions at differ-
ent time courses. Annu. Rev.
Neurosci. 30, 259–288. doi: 10.1146/
annurev.neuro.28.061604.135722
Schultz, W., Dayan, P ., and Montague,
P . R. (1997). A neural substrate
of prediction and reward. Science
275, 1593–1599. doi: 10.1126/sci-
ence.275.5306.1593
Schultz, W., Preuschoff, K., Camerer,
C., Hsu, M., Fiorillo, C. D., Tobler,
P . N., et al. (2008). Explicit neu-
ral signals reﬂecting reward uncer-
tainty. Philos. Trans. R. Soc. Lond.
B Biol. Sci. 363, 3801–3811. doi:
10.1098/rstb.2008.0152
Sharot, T., Guitart-Masip, M., Korn, C.
W., Chowdhury, R., and Dolan, R.
J. (2012). How dopamine enhances
an optimism bias in humans.
Curr. Biol. 22, 1477–1481. doi:
10.1016/j.cub.2012.05.053
Simon, H. A. (1956). Rational
choice and the structure of the
environment. Psychol. Rev. 63,
129–138. doi: 10.1037/h0042769
Sozou, P . D. (1998). A Discounting
framework for choice with delayed
and probabilistic rewards. Proc. R.
Soc. Lond. B 265, 2015–2020. doi:
10.1098/rspb.1998.0534
Spiegelhalter, D. J., Best, N. G., Carlin,
B. P ., and van der Linde, A. (2002).
Bayesian measures of model com-
plexity and ﬁt. J. R. Statist. Soc.
B 64, 583–639. doi: 10.1111/1467-
9868.00353
Surmeier, D., Plotkin, J., and Shen,
W. (2009). Dopamine and synaptic
plasticity in dorsal striatal circuits
controlling action selection. Curr.
Opin. Neurobiol. 19, 621–628. doi:
10.1016/j.conb.2009.10.003
S u t t o n ,R .S . ,a n dB a r t o ,A .G .
(1998). Reinforcement Learning: An
Introduction. Cambridge, MA: MIT
Press.
Tishby, N., and Polani, D. (2011).
“Information theory of decisions
and actions,” in Perception-
Action Cycle Springer Series in
Cognitive and Neural Systems,e d s
V . Cutsuridis, A. Hussain, and
J. G. Taylor (Berlin: Springer),
601–636.
Tobler, P . N., Fiorillo, C. D., and
Schultz, W. (2005). Adaptive coding
of reward value by dopamine neu-
rons. Science 307, 1642–1645. doi:
10.1126/science.1105370
Toussaint, M., and Storkey, A. (2006).
“Probabilistic inference for solv-
ing discrete and continuous state
markov decision processes,” in
Proceedings of the 23rd International
Conference on Machine Learning,
945–952.
van den Broek, J. L., Wiegerinck, W.
A., and Kappen, H. J. (2010). Risk-
sensitive path integral control. UAI
6, 1–8.
Von Neumann, J., and Morgenstern,
O. (1944). Theory of Games and
Economic Behavior. Princeton, NJ:
Princeton University Press.
Watkins, C. J., and Dayan, P . (1992). Q-
learning. Mach. Learn. 8, 279–292.
doi: 10.1007/BF00992698
Wissner-Gross, A. D., and Freer, C.
E. (2013). Causal Entropic Forces.
Phys. Rev. Lett. 110:168702. doi:
10.1103/PhysRevLett.110.168702
Zokaei, N., Gorgoraptis, N., and
Husain, M. (2012). Dopamine
modulates visual working mem-
ory precision. J. Vis. 12, 350. doi:
10.1167/12.9.350
Conﬂict of Interest Statement: The
authors declare that the research
was conducted in the absence of any
commercial or ﬁnancial relationships
that could be construed as a potential
conﬂict of interest.
Received: 14 July 2013; accepted: 04
September 2013; published online: 25
September 2013.
Citation: Friston K, Schwartenbeck P ,
FitzGerald T, Moutoussis M, Behrens
T and Dolan RJ (2013) The anatomy
of choice: active inference and agency.
Front. Hum. Neurosci. 7:598. doi:
10.3389/fnhum.2013.00598
This article was submitted to the journal
Frontiers in Human Neuroscience.
Copyright © 2013 Friston,
Schwartenbeck, FitzGerald, Moutoussis,
Behrens and Dolan. This is an open-
access article distributed under the terms
of the Creative Commons Attribution
License (CC BY). The use, distribution
or reproduction in other forums is per-
mitted, provided the original author(s)
or licensor are credited and that the
original publication in this journal
is cited, in accordance with accepted
academic practice. No use, distribution
or reproduction is permitted which does
not comply with these terms.
Frontiers in Human Neuroscience www.frontiersin.org September 2013 | Volume 7 | Article 598 | 17
Friston et al. Agency and inference
APPENDIX
The variational energies associated with each subset of hidden
variables are derived by isolating terms in the generative model
that depend upon the subset in question and evaluating their
expectation, under their Markov blanket:
V (s
t ) = EQ(ψ\st )
[
ln P (ot |st ) + ln P
(
st |d
)
+ ln P (st |st − 1,at − 1)
+ ln P (˜u|st ,γ)]
= ln AT ·
⌢
ot + [t = 0] · ln d + [t > 0] · ln B (at − 1) ·
⌢
s t − 1
+
⌢
γ · QT ·
⌢
π
V (˜u) = EQ(ψ\˜u) [ln P (˜u|st ,γ)]
=
⌢
γ · Q ·
⌢
s t
V (γ) = EQ(ψ\γ) [ln P (˜u|st ,γ) + ln P (γ|β)]
= γ ·
⌢
π
T
· Q ·
⌢
s t + (α − 1) ln γ − βγ
= ln Q (γ) = (α − 1)ln (γ) −
⌢
βγ − ln Zγ
The Iverson brackets [t = 0] return a value of one when the
expression is true and zero otherwise.
Frontiers in Human Neuroscience www.frontiersin.org September 2013 | Volume 7 | Article 598 | 18