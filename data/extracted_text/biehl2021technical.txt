entropy
Article
A Technical Critique of Some Parts of the Free Energy Principle
Martin Biehl 1,∗,†
 , Felix A. Pollock 2,∗,†
 and Ryota Kanai 1
/gid00030/gid00035/gid00032/gid00030/gid00038/gid00001/gid00033/gid00042/gid00045/gid00001
/gid00048/gid00043/gid00031/gid00028/gid00047/gid00032/gid00046
Citation: Biehl, M.; Pollock, F.A.;
Kanai, R. A Technical Critique of
Some Parts of the Free Energy
Principle. Entropy 2021, 23, 293.
https://doi.org/10.3390/e23030293
Academic Editor: Kevin H. Knuth
Received: 16 September 2020
Accepted: 24 February 2021
Published: 27 February 2021
Publisher’s Note:MDPI stays neutral
with regard to jurisdictional claims in
published maps and institutional afﬁl-
iations.
Copyright: © 2021 by the authors.
Licensee MDPI, Basel, Switzerland.
This article is an open access article
distributed under the terms and
conditions of the Creative Commons
Attribution (CC BY) license (https://
creativecommons.org/licenses/by/
4.0/).
1 Araya Inc., Tokyo 107-6024, Japan; kanair@araya.org
2 School of Physics and Astronomy, Monash University, Clayton, VIC 3800, Australia
* Correspondence: martin@araya.org (M.B.); felix.pollock@monash.edu (F.A.P .)
† These authors contributed equally to this work.
Abstract: We summarize the original formulation of the free energy principle and highlight some
technical issues. We discuss how these issues affect related results involving generalised coordinates
and, where appropriate, mention consequences for and reveal, up to now unacknowledged, differ-
ences from newer formulations of the free energy principle. In particular, we reveal that various
deﬁnitions of the “Markov blanket” proposed in different works are not equivalent. We show that
crucial steps in the free energy argument, which involve rewriting the equations of motion of systems
with Markov blankets, are not generally correct without additional (previously unstated) assump-
tions. We prove by counterexamples that the original free energy lemma, when taken at face value,
is wrong. We show further that this free energy lemma, when it does hold, implies the equality of
variational density and ergodic conditional density. The interpretation in terms of Bayesian inference
hinges on this point, and we hence conclude that it is not sufﬁciently justiﬁed. Additionally, we
highlight that the variational densities presented in newer formulations of the free energy principle
and lemma are parametrised by different variables than in older works, leading to a substantially
different interpretation of the theory. Note that we only highlight some speciﬁc problems in the
discussed publications. These problems do not rule out conclusively that the general ideas behind
the free energy principle are worth pursuing.
Keywords: free energy principle; stochastic differential equations; Markov blanket
1. Overview
In [1], it was argued that the internal coordinates of an ergodic random dynamical
system with a Markov blanket necessarily appear to engage in active Bayesian inference.
Here, we reproduce the argument supporting this interpretation in detail and highlight
at which points it faces technical issues. In the course of our critique, we also mention
issues of some closely related alternative arguments. In cases where our results have
clear consequences for the more recent related publications [2,3], we also mention those.
In particular, we point out a conceptual difference in these latter works that has not
previously been acknowledged. However, our analysis thereof does not go beyond a few
remarks. In an additional section, we discuss the effect of our argument on [4]. The logical
structure of the present paper is depicted in Figure 1. We note that the technical issues
presented here do not affect the validity of approaches where a (expected) free energy
minimizing agent is assumed a priori, as presented in, e.g., [5]. None of [1–4] make this
assumption; they instead aim to identify the conditions under which such agents will
emerge within a given stochastic process. We criticize speciﬁc formal issues in the latter
publications but leave open whether they can be ﬁxed. We now brieﬂy introduce the setting
of [1] and then sketch the content of this paper. We now brieﬂy introduce the setting of [1]
and then sketch the content of this paper.
Entropy 2021, 23, 293. https://doi.org/10.3390/e23030293 https://www.mdpi.com/journal/entropy
Entropy 2021, 23, 293 2 of 24
Equation (1), ergodicity,
Conditions 1 and 2 Condition 2
Condition 1
Condition 3


fψ(ψ, s)
fs(ψ, s, a)
fa(s, a, λ)
fλ(a, λ)


Gaussian and
Markov ω
Equation (4)
Equations (19) and (20) Equations (21) and (22) Equations (17) and (18)
∃q(Ψ|λ) s.t.
Equations (29) and (30)
∃q(Ψ|λ) s.t.
Equations (37) and (38)
∃q(Ψ|λ) s.t.
Equations (39) and (40)
Equations (35) and (36)
Equation (42)
Interpretation as
Bayesian inference
Step 2
Step 3
Step 3
[2]
Step 3, general
Step 4
Step 5
Step 6
Step 7
[3]
Figure 1. Argument visualization. Numbers labelling edges indicate corresponding steps in this
paper. Struck out edges indicate implications that we prove incorrect. The main argument in [1] takes
the left path. The box in the top right indicates the relations between Conditions 1 to 3 and their role
in [3]. Merged edges indicate a logical AND combination of the parent nodes.
The starting point is a random dynamical system whose evolution is governed by the
stochastic differential equation:
˙x = f (x) +ω, (1)
where the system state x and vector ﬁeld f (x) are multi-dimensional and ω is a Gaussian
noise term. There is an additional assumption that the system is ergodic, such that the
steady state probability density p∗(x) is well deﬁned (In the original paper, the ergodic
Entropy 2021, 23, 293 3 of 24
density is simply denoted p(x). We here add a star to highlight that it is a time independent
probability density.). In this case, −ln p∗(x) plays the role of a potential function, in the
sense that f can be formulated in terms of its gradients [6,7].
It is then assumed that there is a coordinate systemx = (ψ, s, a, λ) with ψ = (ψ1, ...,ψnψ ),
s = (s1, ...,sns ), a = (a1, ...,ana ), and λ = (λ1, ...,λnλ ), referred to as external, sensory,
active, and internal coordinates (these are called “states” in [1]), respectively, such that the
following condition holds:
Condition 1. The function f (x) can be written as:
f (x) =


fψ(ψ, s, a)
fs(ψ, s, a)
fa(s, a, λ)
fλ(s, a, λ)

. (2)
This particular structure is described as “[formalizing] the dependencies implied by
the Markov blanket” [ 1]. In contrast, more recent works [ 2,3] formulated the Markov
blanket in terms of the statistical dependencies of the ergodic density p∗(x) =p∗(ψ, s, a, λ).
Speciﬁcally, the following condition is presented:
Condition 2. The ergodic density factorises as:
p∗(ψ, s, a, λ) =p∗(ψ|s, a)p∗(λ|s, a)p∗(s, a). (3)
In other words, the internal and external coordinates are independently distributed
when conditioned on the sensory and active coordinates. This means we have two different
formal expressions of what constitutes a Markov blanket in these publications, and their
relationship has not previously been established.
Taking Condition 1 to hold, the argument of [ 1] then proceeds along the follow-
ing steps:
Step 2 Rewrite the vector ﬁeld f (ψ, s, a, λ) describing the dynamics of the system in terms
of the gradient of the negative logarithm of the ergodic density p∗(ψ, s, a, λ) of that
system.
Step 3 Rewrite the components fλ(s, a, λ) and fa(s, a, λ) of the vector ﬁeld f (ψ, s, a, λ) in
terms of only partial gradients of the negative logarithm of p∗(ψ, s, a, λ).
Step 4 Assert (in the free energy lemma) the existence of a densityq(ψ|λ) over the external
coordinates ψ parameterized by the internal coordinates λ and that f (ψ, s, a, λ) can
again be rewritten, this time in terms of a free energy depending on q(Ψ|λ) (here,
and whenever it would otherwise be ambiguous, we use a capitalized Ψ to indicate
full distributions, rather than the probability density for a speciﬁc value of ψ).
Step 5 Claim that the equivalence of the equations of motion in Step 3 and Step 4 implies
that certain partial gradients of the KL divergence betweenq(Ψ|λ) and the conditional
ergodic density p∗(Ψ|s, a, λ) must vanish.
Step 6 Claim that it follows from Step 5 thatq(Ψ|λ) and p∗(Ψ|s, a, λ) are “rendered” equal.
Step 7 Interpret:
• p∗(Ψ|s, a, λ) as a posterior over external coordinates given particular values of
sensor, active, and internal coordinates,
• q(Ψ|λ) as encoding Bayesian beliefs about the external coordinates by the inter-
nal coordinates, and
• their equality as the internal coordinates appearing to “solve the problem of
Bayesian inference”.
In the present paper, we make the following main observations:
Entropy 2021, 23, 293 4 of 24
• The re-expression of Equation (1) in the form chosen in Step 2 is derived under restric-
tive assumptions, including that the system is subject to Gaussian and Markov noise.
• Conditions 1 and 2 are independent of each other.
• Conditions 1 and 3 together lead to a system where the interpretation of s and a as
sensory and active coordinates is questionable.
• Under both Conditions 1 and 2, the expressions of fλ(s, a, λ) and fa(s, a, λ) resulting
from Step 3 are not as general as those contained in the result of Step 2. The more
general alternative expression derived in [2] remains insufﬁciently general.
• Under both Conditions 1 and 2, the free energy lemma, when taken at face value, is
wrong and cannot be salvaged by using alternatives in Step 3.
• Under both Conditions 1 and 2, contrary to Step 6, the vanishing of the gradient of
the KL divergence does not imply the equality of q(Ψ|λ) and p∗(Ψ|s, a, λ).
• As a consequence, the basic preconditions for the interpretations in Step 7 are not
implied by either of the two proposed Markov blankets Conditions 1 and 2.
The latter [ 4] presents an argument almost identical to the one in the original [ 1].
In Section 8, we discuss how our observations apply to this publication.
2. Expression via the Gradient of the Ergodic Density
Here, we introduce the expression of the system’s dynamics Equation (1) in the form
used for the free energy lemma (Lemma 2.1 in [1]). This form expresses the dynamics of
the internal and active coordinates of the given ergodic random dynamical system in terms
of the gradient of the ergodic density p∗(x). In accordance with the results of [7], f (x) is
rewritten as (see Equation (2.5) in [1]):
f (x) = (Γ + R) ·∇ln p∗(x), (4)
where Γ is the diffusion matrix, which we will take to be block diagonal (in [1], and later
work such as [2], Γ is taken to be proportional to the identity matrix), and R is an antisym-
metric matrix, deﬁned through the relation:
MR + RMT = MΓ −ΓMT, (5)
with
Mij = ∇j fi(x). (6)
Here, and in all of [ 1–4], both Γ and R are assumed constant. We emphasise here that,
for general nonlinear models, these matrices can vary with the coordinates and
Equation (5) holds only approximately [8,9] (the exact conditions under which these matri-
ces can be chosen to be constant can be found in [9,10] and, for the discrete state case, [11]).
Moreover, Equation (4) is derived in the literature under the explicit assumption that the
ﬂuctuations ω be Gaussian and Markov [6,7]. For the counterexamples we present here,
we restrict ourselves to the class of Ornstein–Uhlenbeck processes, for which R and Γ are
always constant, and the ergodic density p∗(x) =p∗(ψ, s, a, λ) is necessarily a multivariate
Gaussian with zero mean. Speciﬁcally, following [7],
p∗(ψ, s, a, λ) := 1
Z exp
[
−1
2 (ψ, s, a, λ)U(ψ, s, a, λ)⊤
]
, (7)
where (ψ, s, a, λ) is a row vector and Z is a suitable normalisation constant. From
Equation (4), it can be seen that,
U = −(Γ + R)−1 M; (8)
though we emphasise here that strict relations between M and U can only be made because
of the assumption that Γ and R are coordinate independent [12]. This concludes Step 2.
Entropy 2021, 23, 293 5 of 24
Before moving on to Step 3, we note that, under the assumptions implicit in Step 2,
we can express Conditions 1 and 2 in terms of the matrices M and U (in the nonlinear case,
these matrices can still be deﬁned in terms of the derivatives of the force vector ﬁeld and
potential, respectively; however, they will be generally coordinate-dependent, even whenΓ
and R are not [8]). Firstly, since it effectively states that ∇ψ fa(x) =∇ψ fλ(x) =∇λ fs(x) =
∇λ fψ(x) =0,
Condition 1 ⇔ Maψ = Mλψ = Msλ = Mψλ = 0, (9)
with Mαβ a block sub-matrix of M in general. Secondly, because of the multivariate
Gaussian nature of p∗(ψ, s, a, λ), the dependencies of conditional distributions are encoded
in the inverse U of the covariance matrix; we therefore have that:
Condition 2 ⇔ Uψλ = Uλψ = 0, (10)
where Uαβ is a block sub-matrix of U. These implications bring us to our ﬁrst observation:
Observation 1. Neither Condition 1 (the vector ﬁeld dependency structure) nor Condition 2
(conditional independence in the ergodic distribution) imply the other:
Condition 1 ⇏ Condition 2 (11)
Condition 1 ⇍ Condition 2. (12)
Proof. In Appendix A, we provide direct counterexamples, using the equivalent constraints
on the matrices M and U in Equations (9) and (10), for the implication in either direction.
That is, there exists a system obeying Condition 1 that does not obey Condition 2 (proving
Equation (11)), and there exists one obeying Condition 2 that does not obey Condition 1
(proving Equation (12)).
Henceforth, unless otherwise stated, we will assume both Conditions 1 and 2. Any
implications that fail to hold in this special case cannot hold generally .
3. Re-Expression Using only Partial Gradients
For Step 3, we focus on the components fλ = (fλ1 , ..., fnλ ) and fa = (fa1 , ..., fna ) of f .
Without loss of generality, we can rewrite them from Equation (4) as:
fa(s, a, λ) =
(
Raψ ·∇ψ + Ras ·∇s + (Γaa + Raa ) ·∇a
+Raλ ·∇λ) ln p∗(ψ, s, a, λ), (13)
fλ(s, a, λ) =
(
Rλψ ·∇ψ + Rλs ·∇s + (Γλλ + Rλλ) ·∇λ
+Rλa ·∇a) ln p∗(ψ, s, a, λ), (14)
where Γnm (Rnm) is the block of Γ (R) connecting derivatives with respect to the m coor-
dinates to the time derivatives of the n coordinates. The expectation value with respect
to p∗(ψ|s, a, λ) leaves the left-hand side of these equations unchanged. A few manipula-
tions ([2] cf. Equation (12.14), p. 129) reveal that, on the right-hand side, this leads to the
ergodic density p∗(ψ, s, a, λ) being replaced by the marginalised ergodic density p∗(s, a, λ)
so that we get:
fa(s, a, λ) =
(
Raψ ·∇ψ + Ras ·∇s + (Γaa + Raa ) ·∇a
+Raλ ·∇λ) ln p∗(s, a, λ) (15)
fλ(s, a, λ) =
(
Rλψ ·∇ψ + Rλs ·∇s + (Γλλ + Rλλ) ·∇λ
+Rλa ·∇a) ln p∗(s, a, λ). (16)
Entropy 2021, 23, 293 6 of 24
Since ∇ψ ln p∗(s, a, λ) =0, the terms involving ∇ψ drop out:
fa(s, a, λ) =(Ras ·∇s + (Γaa + Raa ) ·∇a + Raλ ·∇λ) ln p∗(s, a, λ), (17)
fλ(s, a, λ) =(Rλs ·∇s + Rλa ·∇a + (Γλλ + Rλλ) ·∇λ) ln p∗(s, a, λ). (18)
We are not aware of how to further simplify this equation without additional assumptions.
However, in (Equations (2.5) and (2.6) of [1]), all of the off-diagonal terms are implicitly
assumed to vanish, i.e., Equation (4) is equated with:
fa(s, a, λ) = (Γaa + Raa ) ·∇a ln p∗(s, a, λ), (19)
fλ(s, a, λ) = (Γλλ + Rλλ) ·∇λ ln p∗(s, a, λ). (20)
This equation is the result of Step 3.
More recently (Appendix B of [2]), a more detailed discussion of Equation (4) was pre-
sented, where it was claimed that Condition 1 implies Condition 2 (cf. our Observation 1)
along with the following simpliﬁcation of Equations (17) and (18) ([2], Equations (12.8)–
(12.11), (12.15), pp. 126–129):
fa(s, a, λ) =((Γaa + Raa ) ·∇a + Raλ ·∇λ) ln p∗(s, a, λ), (21)
fλ(s, a, λ) =(Rλa ·∇a + (Γλλ + Rλλ) ·∇λ) ln p∗(s, a, λ). (22)
However, Equations (21) and (22) are still provably less general than Equations (13)and (14),
even when both Conditions 1 and 2 are satisﬁed.
Observation 2. Given a random dynamical system obeying Equation (1), ergodicity, and both
Conditions 1 and 2, none of Equations (19)–(22) generally hold.
Proof. By counterexample, see Appendix B. There, we show explicitly that a model satisfy-
ing the above assumptions does not satisfy the equations in question.
In order to arrive at Equations (21) and (22) from Equations (17) and (18) in general,
one must remove the offending “solenoidal ﬂow” terms by ﬁat. That is, one assumes
Ras = Rλs = 0. In [2], Equation (12.4), the following, even stronger, condition was assumed
as an alternative starting point (along with Condition 2):
Condition 3. The blocks of the R matrix appearing in Equation (4) coupling (s, a) coordinates to
λ and ψ coordinates and ψ coordinates to λ coordinates vanish, i.e.,
Rψs = Rψa = Rψλ = Rsλ = Raλ = 0. (23)
This is claimed to imply Mψλ = Mλψ = 0, but not the full Condition 1. However,
in [3], both Conditions 1 and 3 were assumed (along with Ras = 0). This prompts our
next observation.
Observation 3. In a system satisfying both Conditions 1 and 3, the internal coordinates cannot be
directly inﬂuenced by the sensory coordinates: fλ(s, a, λ) =fλ(a, λ), and the external coordinates
cannot be directly inﬂuenced by the active coordinates: f ψ(ψ, s, a) =fψ(ψ, s).
Proof. From Equation (5), it follows that:
M = (Γ + R)MT(Γ −R)−1, (24)
with the inverse replaced by a pseudoinverse if Γ −R is not invertible. Therefore, if
Γαβ = δαβ Γαα and Rαβ = δαβ Rαα for blocks of coordinates labelled by α and β, then:
Mαβ = (Γαα + Rαα)MT
βα(Γββ −Rββ )−1, (25)
and Mβα = 0 ⇒Mαβ = 0.
Entropy 2021, 23, 293 7 of 24
Condition 3 implies that only the nonzero blocks of R are Rψψ, Rss, Rsa, Ras, Raa,
and Rλλ, and Γ is assumed to be block diagonal. As noted in Equation (9), Condition 1
requires that Maψ = Mλψ = Msλ = Mψλ = 0. Through Equation (25), these together imply
that Mλs = Mψa = 0, and hence that:
f (x) =


fψ(ψ, s)
fs(ψ, s, a)
fa(s, a, λ)
fλ(a, λ)

, (26)
as shown.
In this case, the four sets of coordinates interact in a chain, and it is questionable
whether the s and a coordinates can be meaningfully interpreted, respectively, as sensory
inputs to the internal coordinates or their boundary-mediated inﬂuence on the external
coordinates.
4. Free Energy Lemma
The relation of the dynamics of the internal coordinates to Bayesian beliefs is made
by introducing a density (called the variational density) q(Ψ|λ) that is then interpreted as
encoding a Bayesian belief. It is parameterized by the internal coordinates λ and claimed
to be “arbitrary”. We take this “at face value” and consider q(Ψ|λ) to be parameterized
only by λ and, therefore, to be independent of (s, a). (We note that there is a convention
in the literature on variational Bayesian inference, e.g., in [ 13], to drop the observed
variables/data in the variational density. It is possible that in [ 1], (s, a) was seen as
observed variables and dropped from the variational density q(Ψ|λ) as in this convention.
However, the reason that dropping the observed variables is justiﬁed in the established
convention is that those observed variables are ﬁxed throughout the minimization of the
variational free energy and the parameters of the variational density do not inﬂuence
the observed data in any way. In other words, the variational density is optimized for a
single data point. In [ 1], the data point was continuously changing and partially doing
so with dependence on the parameter λ as ˙a = fa(s, a, λ). These differences and their
consequences are non-trivial and beyond the scope of this paper, so we assume that the
variational density does not depend on (s, a).) If q(Ψ|λ) is allowed to depend on (s, a),
Observation 4 does not apply, and the free energy lemma is made trivially true by setting
q(ψ|s, a, λ) := p∗(ψ|s, a, λ). The existence of the variational density q(Ψ|λ) is asserted by
the free energy lemma (see Lemma 2.1 in [1]) (Explicitly, the free energy lemma asserts the
existence of a free energy F(s, a, λ) in terms of which f (ψ, s, a, λ) can be expressed and not
the existence of q(Ψ|λ). However, since the free energy is deﬁned as a functional of q(Ψ|λ),
it exists if and only if a suitable q(Ψ|λ) exists.).
More precisely, the free energy lemma (and Step 4) asserts that for every ergodic
density (equivalently as expressed in [1], for every Gibbs energy G(x) := −ln p∗(ψ, s, a, λ))
p∗(ψ, s, a, λ) of a system obeying Equations (19) and (20), there is a free energy F(s, a, λ),
deﬁned as:
F(s, a, λ) : = −ln p∗(s, a, λ) +
∫
q(ψ|λ) ln q(ψ|λ)
p∗(ψ|s, a, λ) dψ (27)
= −ln p∗(s, a, λ) +DKL[q(Ψ|λ)||p∗(Ψ|s, a, λ)], (28)
in terms of the “posterior density”p∗(Ψ|s, a, λ) (here, we keep the conditioning argumentλ,
as in [1], and do not explicitly assume Condition 2, though our conclusions are unaffected
by it), such that Equations (19) and (20) can be rewritten as:
fa(s, a, λ) =−(Γ + R)aa ·∇a F(s, a, λ), (29)
fλ(s, a, λ) =−(Γ + R)λλ ·∇λF(s, a, λ). (30)
Entropy 2021, 23, 293 8 of 24
It is worth considering what a proof of the free energy lemma could look like. A proof
of the existence of a free energy (and therefore of the free energy lemma) would need to
show that, for every system satisfying the given assumptions, there always exists a q(Ψ|λ)
such that the right-hand sides of Equations (29) and (30) are equal to the right-hand sides
of Equations (19) and (20). Expanding Equations (29) and (30) using (28) leads to:
fa(s, a, λ) = (Γ + R)aa ·∇a ln p∗(s, a, λ)
−(Γ + R)aa ·∇a DKL[q(Ψ|λ)||p∗(Ψ|s, a, λ)], (31)
fλ(s, a, λ) = (Γ + R)λλ ·∇λ ln p∗(s, a, λ)
−(Γ + R)λλ ·∇λ DKL[q(Ψ|λ)||p∗(Ψ|s, a, λ)]. (32)
For the equality of the right-hand sides to those of Equations (19) and (20), we need:
(Γ + R)aa ·∇a DKL[q(Ψ|λ)||p∗(Ψ|s, a, λ)] =0 (33)
(Γ + R)λλ ·∇λ DKL[q(Ψ|λ)||p∗(Ψ|s, a, λ)] =0. (34)
In other words, these equations say that the free energy lemma holds if any of the following
three conditions (of strictly increasing strengths) are given:
1. There is a q(Ψ|λ) such that the partial gradients ∇a and ∇λ of the KL divergence
between the variational density and the conditional ergodic density are elements of
the nullspaces of (Γ + R)aa and (Γ + R)λλ, respectively.
2. There is a q(Ψ|λ) such that the gradients of the KL divergence to p∗(Ψ|s, a, λ) are
equal to the nullvector:
∇a DKL[q(Ψ|λ)||p∗(Ψ|s, a, λ)] =0, (35)
∇λ DKL[q(Ψ|λ)||p∗(Ψ|s, a, λ)] =0, (36)
Then, they are always elements of the nullspaces of (Γ + R)aa and (Γ + R)λλ, respec-
tively.
3. There is a q(Ψ|λ) such that q(Ψ|λ) = p∗(Ψ|s, a, λ) (and hence, p∗(Ψ|s, a, λ) =
p∗(Ψ|λ)), which implies that the KL divergence to p∗(Ψ|s, a, λ) vanishes for all a, λ
and the two partial gradients are always nullvectors and therefore elements of the
according nullspaces.
The free energy lemma can then be proven by showing that one of these three cases
follows from the conditions of the lemma. However, no attempt was made in [1] to establish
this. Instead, the given proof discusses the purported consequences of the existence of a
suitable q(Ψ|λ). These will be discussed in Steps 5 and 6.
Even if the free energy lemma does not hold for systems obeying Equations (19)and (20),
one might expect that the systems instead only satisfy the more generalEquations (21) and (22)
or the most generalEquations (17)and (18). For these systems, the free energy lemma would
require that there is aq(Ψ|λ) such that:
fa(s, a, λ) =((Γaa + Raa ) ·∇a + Raλ ·∇λ)F(s, a, λ), (37)
fλ(s, a, λ) =(Rλa ·∇a + (Γλλ + Rλλ) ·∇λ)F(s, a, λ). (38)
or:
fa(s, a, λ) =(Ras ·∇s + (Γaa + Raa ) ·∇a + Raλ ·∇λ)F(s, a, λ), (39)
fλ(s, a, λ) =(Rλs ·∇s + Rλa ·∇a + (Γλλ + Rλλ) ·∇λ)F(s, a, λ), (40)
hold, respectively. However, we ﬁnd this not to be the case in general.
Observation 4. Given a random dynamical system obeying Equation (1), ergodicity,
Conditions 1 and 2, there need not exist a free energy expressed in terms of a variational den-
sity q(Ψ|λ) such that:
Entropy 2021, 23, 293 9 of 24
(i) Equations (29) and (30) hold if Equations (19) and (20) do;
(ii) Equations (37) and (38) hold if Equations (19) and (20) do not hold, but Equations (21)and (22)
do;
(iii) Equations (39) and (40) hold if neither Equations (19) and (20) nor Equations (21) and (22)
hold, but Equations (17) and (18) do.
Proof. In Appendix C, we derive a set of conditions on the R and U matrices and on the
putative variational density q(Ψ|λ), which follow from each of the pairs of equations in
Cases (i–iii). We show that, in general, each pair leads to a contradiction, and in each case,
we provide a counterexample that falls into the according system class.
Before proceeding, we note that later works presented an alternative version of the
free energy lemma, where the conditioning argument of q(Ψ|λ) was replaced by the most
likely value of λ conditional on the (s, a) coordinates [2,3]. We here concern ourselves with
the version apparent in [1], where q(Ψ|λ) is parametrised by the internal states themselves,
but we brieﬂy comment on the interpretation of the alternative approach in Step 7.
5. Vanishing Gradients
As mentioned in Step 4, the proof of the free energy lemma in [1] only discussed its
consequences. The ﬁrst proposed consequence is that expressing the vector ﬁeld in terms
of a free energy as in Equations (29) and (30) “requires” that the gradients with respect to a
and λ of the KL divergence vanish, i.e., that Equations (35) and (36) hold.
We mentioned in Step 4 that the implication in the opposite direction holds. This
can be seen from Equations (33) and (34). However, if the nullspace of (Γ + R)aa or
(Γ + R)λλ is non-trivial, then the gradient may be a non-zero element of this subspace and
Equations (29) and (30) will still hold. In that case, the vanishing gradients would not be
necessary for the free energy lemma.
The conditions under which a non-trivial nullspace exists were discussed in [ 7].
In short, the nullspace is guaranteed to be trivial in the special case where Γ is positive
deﬁnite. Whether or not ergodic systems with a Markov blanket can ever admit a non-trivial
nullspace, and hence divergences in Equations (31) and (32) with non-vanishing gradients,
is not immediately clear. However, in order to establish the necessity of Equations (35)
and (36), this remains to be proven.
6. Equality of Q(Ψ|λ) and P∗(Ψ|s, a, λ)
The proof of the free energy lemma in [ 1] also proposes that the vanishing of the
gradients of the KL divergence, of the variational density q(Ψ|λ) from the conditional
ergodic density p∗(Ψ|s, a, λ), implies the equality of these densities. We mentioned in
Equations (5) that the implication in the opposite direction holds. This can also be seen from
Equations (33) and (34). Concerning the implication in the direction proposed by [1], let us
now assume that for a given system of Equations (19) and (20) holds, a variational density
q(Ψ|λ) does exist, and the gradients of the KL divergence of the variational and ergodic
densities vanish, i.e., Equations (35) and (36) hold. Then, consider the argument by [1] in
this direct quote (comments in square brackets by us):
“However, Equation (2.6) [Equations (19) and (20) above] requires the gradients of
the divergence to be zero [Equations (35) and (36)], which means the divergence
must be minimized with respect to internal states. This means that the variational
and posterior densities must be equal:
q(ψ|λ) =p[∗](ψ|s, a, λ) ⇒DKL = 0 ⇒
{
(Γ + R) ·∇λ DKL = 0,
(Γ + R) ·∇a DKL = 0.
In other words, the ﬂow of internal and active states minimizes free energy,
rendering the variational density equivalent to the posterior density over external
states.”
Entropy 2021, 23, 293 10 of 24
The ﬁrst problem in the above quote is that the minimization of the divergence does
not follow from the vanishing gradients. On the contrary, since Equations (35) and (36)
must hold for all (s, a, λ), the KL divergence:
DKL[q(Ψ|λ)||p∗(Ψ|s, a, λ)]
cannot depend on (λ, a); it therefore has no extremum (and thus no minimum) with respect
to either of these coordinates.
The second problem pertains to the identiﬁcation of the two distributions at a min-
imum. In general, if we try to ﬁnd the minimum of a KL divergence between a given
probability density p1(Y) and a family of densities p2(Y|θ) parameterized by θ, then
the lowest possible value of zero is achieved only if there is a parameter θ1 such that
p2(Y|θ1) =p1(Y). If there is no such θ1, then the minimum value will be larger than zero.
Therefore, even if the divergence were minimized, it would not need to be zero. More
generally, the divergence K(s) need not be zero for any value of s.
There is therefore no satisfactory reason given why the variational density q(Ψ|λ) and
the posterior density p∗(Ψ|s, a, λ) should be equal or have low KL divergence. In fact, they
need not be (Note that, since any q(Ψ|λ) that does not depend on (s, a) is an element of the
set of those that do, Observation 5 remains true for the case where we allow this dependence.
In that case, the free energy lemma holds because we can set q(Ψ|s, a, λ) := p∗(Ψ|s, a, λ),
and thus, a q exists for which the densities are actually equal. However, the claim here is
that for every q that obeys the conditions in Observation 5, we must have equality.).
Observation 5. Given a random dynamical system obeying Equation (1), ergodicity, Conditions 1
and 2. Then if, additionally,
(i) Equations (19) and (20) hold and the free energy lemma holds, i.e., there exists a probability
density q(Ψ|λ) such that Equations (29) and (30) hold, or
(ii) Equations (21) and (22) hold and there exists q(Ψ|λ) such that Equations (37) and (38) hold,
or
(iii) Equations (17) and (18) hold and there exists q(Ψ|λ) such that Equations (39) and (40) hold,
then there is no c ≥0 for which it can be guaranteed that:
DKL[q(Ψ|λ)||p∗(Ψ|s, a, λ)] < c. (41)
In particular, it does not follow from these conditions that:
q(Ψ|λ) =p∗(Ψ|s, a, λ). (42)
Proof. By example, see Appendix D. To show that the implication does not generally
hold for a given system and densities q(Ψ|λ) that obey Equations (19), (20), (29), and (30),
Equations (21), (22), (37), and (38), or Equations (17), (18), (39), and (40), we only have
to consider a system that obeys all three pairs of equations, Equations (19) and (20),
Equations (21) and (22), and Equations (21) and (22), and for which a suitable q(Ψ|λ) exist.
For this system, we then need to show that the q(Ψ|λ) that obey Equations (29) and (30)
are not necessarily equal (or similar) to p∗(Ψ|s, a, λ).
We use a variant of the model used in Appendix B as such a counterexample. This sys-
tem obeys all three of Equations (19) and (20), Equations (21) and (22), and
Equations (21) and (22), and the nullspace of the associated Γ + R is trivial. We identify a
set of possible q(Ψ|λ) satisfying Equations (29) and (30), which implies that the gradients
of the KL divergence between those q(Ψ|λ) and p∗(Ψ|s, a, λ) vanish, i.e., Equations (35)
and (36) hold. We then demonstrate that for the q(Ψ|λ) in this set, the value of the KL
divergence to p∗(Ψ|s, a, λ) can be arbitrarily large.
Entropy 2021, 23, 293 11 of 24
7. Interpretation
Finally, we turn our attention to the interpretation in terms of Bayesian inference, i.e.,
Step 7. We again quote directly from [1]:
Because (by Gibbs inequality) this divergence [DKL[q(ψ|λ)||p∗(ψ|s, a, λ)]] cannot
be less than zero, the internal ﬂow will appear to have minimized the divergence
between the variational and posterior density. In other words, the internal states
will appear to have solved the problem of Bayesian inference by encoding poste-
rior beliefs about hidden (external) states, under a generative model provided by
the Gibbs energy.
We showed that, in general, there is no suitable variational density that is only pa-
rameterized by the internal coordinate λ. We then showed that, even if there is a suitable
variational density (including those parameterized by all of (s, a, λ)), it can be arbitrarily
different from the posterior density. Since the arguments for the internal ﬂow appearing to
minimize the divergence between variational and posterior density are therefore incorrect,
there is no reason why the internal states should appear to have solved the problem of
Bayesian inference.
As mentioned in Step 4, some newer works (e.g., [ 2,3]) formulated a different
free energy principle, where the variational density of beliefs is parametrised not by
the internal coordinates λ, but by ¯λ(s, a) =arg maxλ p∗(λ|s, a), the most likely value of the
internal coordinates given the sensory and active ones. In this case, Observations 4 and 5
do not apply. However, the new parameters ¯λ(s, a) are strictly a function of the sensory
and active coordinates. This means we have a Markov chain (with capitalisations indi-
cating random variables associated with the corresponding lower case coordinates (or
functions of coordinates)) Λ →(S, A) → ¯Λ and, by the data processing inequality [ 14],
the mutual information between the both sensory and active coordinates and the belief
parameter ¯λ upper bounds that are between the internal coordinates and the belief pa-
rameter. It is therefore not clear to what extent the internal coordinates λ, rather than the
active and sensory coordinates (s, a) themselves, can be said to be encoding beliefs about
the external coordinates. Note also that, on any given trajectory, unless the distribution
p∗(λ|s, a) is sufﬁciently peaked and unimodal, the internal coordinates are not guaranteed
to spend most of their time close to their most likely conditional value, and (by deﬁnition if
Condition 2 holds) they will not be better predictors of the external coordinates than those
in the Markov blanket.
Generally, λ ̸= ¯λ, and ¯λ is the solution to an optimization problem that is assumed
to be solved in these later works. Using this optimized variable to parametrise beliefs is
therefore a considerable departure from [1]. Contrary to the impression created by the way
it was referenced in [2,3], the older theory in [1] should be clearly distinguished from the
newer ones in these more recent papers.
8. Consequences for Friston, K. et al. 2014
Reference [4] argued for the same interpretation as [1], but there were some differences
in the argument.
The differences were the following:
• In [4], Equation (1) was formulated for “generalized states”, which we refer to here as
generalized coordinates. This means that the variable x is replaced by a multidimen-
sional variable denoted ˜x = (x, x′, x′′, ...).
• The Markov blanket structure was not explicitly deﬁned via Equation (2). Formally, it
was introduced directly (see [4] Equation (10)) in a less general form corresponding
to Equations (19) and (20) (at the same time, [ 1] is referenced in connection to the
Markov blanket so there seems to be no intention to replace the original deﬁnition
with the stronger one). Therefore, our observations concerning Steps 2 to 4 are not
directly relevant to this paper.
Entropy 2021, 23, 293 12 of 24
• The internal coordinate λ was renamed to r, and the role of matrix R was played by
the matrix −Q.
• The proof of the free energy lemma given in [4] was different. It (implicitly) suggested
setting the variational density equal to the ergodic conditional posterior.
• The proof of the free energy lemma no longer contained the proposition that the
gradient of the KL divergence of the variational density and the ergodic conditional
density vanish, i.e., Step 5.
• The proof also no longer contained the claim that the vanishing gradients of the KL
divergence of the variational density and the ergodic conditional density imply the
equality of those densities, i.e., Step 6 was not present.
The interpretation in terms of Bayesian inference was unchanged and still relied on
the equality of the variational and the ergodic conditional density.
Since there were no explicit generalized coordinate versions of Steps 2, 3, 5 and 6
in [4], we do not discuss those steps here. We only disprove the free energy lemma and
the claim that when the free energy lemma holds, the variational and ergodic conditional
density become equal. For this, we present a way to translate the counterexamples used in
Observations 4 and 5 into counterexamples in generalized coordinates. The interpretation
in terms of Bayesian inference given in [ 4] is therefore equally as unjustiﬁed as the one
in [1].
For completeness, we ﬁrst state the generalized coordinate versions of the stochastic
differential Equation (1):
˙˜x = f ( ˜x) +˜ω, (43)
the less general version of the Markov blanket structure Equation (2):
f ˜ψ( ˜ψ, ˜s, ˜a) = (Γ −Q) ˜ψ ˜ψ∇˜ψ ln p∗( ˜ψ, ˜s, ˜a, ˜r)
f˜s( ˜ψ, ˜s, ˜a) = (Γ −Q)˜s˜s∇˜s ln p∗( ˜ψ, ˜s, ˜a, ˜r)
f˜a(˜s, ˜a, ˜r) = (Γ −Q)˜a˜a∇˜a ln p∗( ˜ψ, ˜s, ˜a, ˜r)
f˜r(˜s, ˜a, ˜r) = (Γ −Q)˜r˜r∇˜r ln p∗( ˜ψ, ˜s, ˜a, ˜r),
(44)
the expression of the ˜a and ˜r components of the vector ﬁeld in terms of the marginalised
ergodic density Equations (19) and (20):
f˜a(˜s, ˜a, ˜r) = (Γ −Q)˜a˜a ·∇˜a ln p∗(˜s, ˜a, ˜r), (45)
f˜r(˜s, ˜a, ˜r) = (Γ −Q)˜r˜r ·∇˜r ln p∗(˜s, ˜a, ˜r), (46)
and in terms of free energy Equations (29) and (30):
f˜a(˜s, ˜a, ˜r) = (Q −Γ)˜a˜a ·∇˜a F(˜s, ˜a, ˜r), (47)
f˜r(˜s, ˜a, ˜r) = (Q −Γ)˜r˜r ·∇˜r F(˜s, ˜a, ˜r). (48)
The free energy lemma then requires that there exists q( ˜Ψ|˜r) such that the KL divergence
between p∗( ˜Ψ|˜s, ˜a, ˜r) vanishes. Without going into further details of the difference be-
tween the proof in [4] and that in [1], we can prove the former wrong by translating the
counterexample used for the latter into generalised coordinates.
Observation 6. There is a general way to translate a system in ordinary coordinates into a system
of generalised coordinates that corresponds to an inﬁnite number of independent copies of the original
system. This means all properties of the original system (e.g., linearity, ergodicity, the Gaussian and
Markovian property of the noise, Conditions 1 and 2, the properties of Γ, R, U) are preserved during
this translation.
Proof. By construction, see Appendix E.
Entropy 2021, 23, 293 13 of 24
This implies that the counterexamples used in proving Observations 4 and 5 directly
translate to the setting of the generalised coordinates. The free energy lemma is there-
fore also wrong for generalised coordinates, and the variational density q( ˜Ψ|˜r) is not
“ensured” [4] to be equal to the conditional ergodic density p∗( ˜Ψ|˜s, ˜a, ˜r).
9. Conclusions
We ﬁnd that the two different Markov blanket conditions proposed in [1–3] are inde-
pendent of each other. We then show that under both of those Markov blanket conditions,
among the six steps contained in the argument in [1], three do not hold independently of
each other. We also show that ﬁxing the second of those steps (Step 3) does not provide a
valid alternative. The line of reasoning of [1] therefore does not support its claim that the
internal coordinates of a Markov blanket “appear to have solved the problem of Bayesian
inference by encoding posterior beliefs about hidden (external) [coordinates], ...”. We also
show that using generalised coordinates as in [4] does not remedy the situation. Addition-
ally, we identify a technical error in [2] and an interpretational issue resulting from possibly
too strong assumptions (both Conditions 1 and 3) in [3]. We also highlight that the latter
publications both argued that it is the most likely internal coordinates given sensory and
active coordinates that encode posterior beliefs about external states instead of the internal
coordinates themselves. The resulting free energy principle and lemma are therefore a
different proposal. This is not subject to our technical critique.
Author Contributions: Conceptualization, M.B., F.A.P ., and R.K.; formal analysis, M.B. and F.A.P .;
funding acquisition, F.A.P . and R.K.; methodology, M.B., F.A.P ., and R.K.; visualization, M.B. and
F.A.P .; writing—original draft, M.B. and F.A.P .; writing—review and editing, M.B., F.A.P ., and R.K.
All authors read and agreed to the published version of the manuscript.
Funding: The work by Martin Biehl and Ryota Kanai on this publication was made possible through
the support of a grant from Templeton World Charity Foundation, Inc. The opinions expressed in
this publication are those of the authors and do not necessarily reﬂect the views of Templeton World
Charity Foundation, Inc. Martin Biehl and Ryota Kanai are also funded by the Japan Science and
Technology Agency (JST) CREST project. Felix A. Pollock acknowledges support from the Monash
University Network of Excellence for Consciousness and Complexity in the Conscious Brain.
Acknowledgments: All authors are grateful to Karl Friston and Thomas Parr for constructive
feedback on an earlier version of this work. We also want to thank Danijar Hafner for pointing us
to [9]. Martin Biehl wants to thank Yen Yu for helpful discussions on generalized coordinates.
Conﬂicts of Interest: The authors declare no conﬂict of interest. The funders had no role in the
design of the study; in the collection, analyses, or interpretation of data; in the writing of the
manuscript; nor in the decision to publish the results.
Appendix A. Counterexamples for Observation 1
Consider a four-dimensional linear system obeying Equation (1) for which there are
coordinates x = (ψ, s, a, λ) with nψ = ns = na = nλ = 1 and:
f (x) =Mx, (A1)
with the parametrisation:
M =


−1 m1 m2 m3
m2 −1 m2 m3
m3 m2 −1 m2
m3 m2 m1 −1

. (A2)
Entropy 2021, 23, 293 14 of 24
From Equation (9), it is clear that the system obeys Condition 1 if m3 = 0. In this case,
taking Γ to be the identity matrix, it is possible to show that:
Uψλ = − m2(m1 −m2 + 2)(m3
2 + m2
1m2 −2m1m2
2 −4m1 −2)
(m2
1 + m2
2 −4m2 + 4)(m2
1 + 5m2
2 −4m1m2 + 4m2 + 4). (A3)
For ﬁxed, ﬁnite m2, this is zero only for a few discrete values of m1, such as m1 = m2 −2;
that it is generically non-zero proves Equation (11). As a concrete example, the following:
M =


−1 −2/3 −2/3 0
−2/3 −1 −2/3 0
0 −2/3 −1 −2/3
0 −2/3 −2/3 −1

, (A4)
has:
R =


0 −1/8 3/8 0
1/8 0 0 −3/8
−3/8 0 0 1/8
0 3/8 −1/8 0

 (A5)
and (full rank and hence ergodic):
U =


236/255 127/255 −31/85 −12/85
127/255 274/255 206/255 31/85
31/85 206/255 274/255 127/255
−12/85 31/85 127/255 236/255

, (A6)
and hence ergodic density:
p∗(ψ, s, a, λ) =
√
28
2295π4 exp
[
− 1
255
(
137(a2 + s2) +118(ψ2 + λ2)
+127(ψs + aλ) +93(ψa + sλ) +206as −36ψλ
)]
, (A7)
which does not conditionally factorise.
Taking the same parametrisation as in Equation (A2) and ﬁxing m1 = m2 = −1/2, we
can search for a non-zero value of m3 that leads to Uψλ = 0 (equivalent to Condition 2
through Equation (10)). We ﬁnd such a value in the real root c ≃−0.08 of the quintic
equation 8c5 −4c4 −6c3 + 31c2 + 40c + 3 = 0; that is, with:
M =


−1 −1/2 −1/2 c
−1/2 −1 −1/2 c
c −1/2 −1 −1/2
c −1/2 −1/2 −1

, (A8)
which does not satisfy Condition 1, we have:
R =


0 −0.06 . . . 0.22 . . . 0
0.06 . . . 0 0 −0.22 . . .
−0.22 . . . 0 0 0.06 . . .
0 0.22 . . . −0.06 . . . 0

, (A9)
Entropy 2021, 23, 293 15 of 24
and:
U =


0.96 . . . 0.43 . . . 0.30 . . . 0
0.43 . . . 1.03 . . . 0.58 . . . 0.30 . . .
0.30 . . . 0.58 . . . 1.03 . . . 0.43 . . .
0 0.30 . . . 0.43 . . . 0.96 . . .

, (A10)
which has a non-zero determinant (i.e., the dynamics is ergodic) and an ergodic density
satisfying Condition 2. This proves Equation (12).
Appendix B. Counterexample for Step 3
Here, we consider a linear system, as in the previous Appendix. We again assume Γ
equal to the identity matrix and choose a force matrix of the form:
M =


−1 − 1
2
√
2 − 1
2
√
2 0
− 1
2
√
2 −1 −1
16 0
0 1
16 −1 − 1
2
√
2
0 1
2
√
2 − 1
2
√
2 −1


(A11)
which explicitly satisﬁes Condition 1 and has full rank such that the system is ergodic.
Using Equation (5), this leads to:
U =


1023
1057
260
√
2
1057
136
√
2
1057 0
260
√
2
1057
1091
1057 0 −136
√
2
1057
136
√
2
1057 0 1091
1057
260
√
2
1057
0 −136
√
2
1057
260
√
2
1057
1023
1057


(A12)
which shows that this system also satisﬁes Condition 2 since Uψλ = Uλψ = 0. We also ﬁnd:
R =


0 − 17
1786
√
2
479
1786
√
2 −62
893
17
1786
√
2 0 − 65
14288
479
1786
√
2
− 479
1786
√
2
65
14288 0 17
1786
√
2
62
893 − 479
1786
√
2 − 17
1786
√
2 0


, (A13)
which shows that all entries or R that can be non-zero for an anti-symmetric matrix are
non-zero. For the marginal ergodic density, we ﬁnd:
p∗(s, a, λ) = 239
16
√
2415π3/2 exp
[
−69a2
140 − 37as
70
√
2
+ 1
35
√
22aψ
−4867s2
9660 + 74sψ
2415 −8429ψ2
19320
] (A14)
The difference between the right-hand sides of Equations (17) and (19) is:
Ras∇s ln p∗(s, a, λ) +Raλ∇λ ln p∗(s, a, λ) =37a + 69
√
2λ −2563s
4830 ̸= 0, (A15)
which shows that Equation (19) is wrong in this example and therefore not generally
equivalent to Equation (17). Similarly, computing the difference between the right-hand
sides of Equations (18) and (20), one ﬁnds:
Rλs∇s ln p∗(s, a, λ) +Rλa∇a ln p∗(s, a, λ) =2a −
√
2λ + 27s
70
√
2
̸= 0, (A16)
Entropy 2021, 23, 293 16 of 24
and hence, Equation (20) is also incorrect in general.
Performing the same comparison for the difference between the general expression in
Equations (17) and (18) and the expressions taken from [2], one ﬁnds:
Rais∇s ln p∗(s, a, λ) =
73
(
296a + 552
√
2λ −8429s
)
1, 154, 370 ̸= 0 (A17)
for the difference between the right-hand sides of Equations (17) and (21), and:
Rλs∇s ln p∗(s, a, λ) =−
53
(
296a + 552
√
2λ −8429s
)
1, 154, 370
√
2
̸= 0, (A18)
for the difference between the right-hand sides of Equations (18) and (22). Therefore,
Equations (21) and (22) are also incorrect in general, even when Conditions 1 and 2
both hold.
Appendix C. Counterexamples for Step 4
We saw in Appendix B that Equations (19) and (20) are not generally equivalent to
Equation (4), even when Conditions 1 and 2 hold simultaneously. We now show that if we
instead use Equations (17) and (18), which are generally equivalent to Equation (4), the free
energy lemma does not hold in general.
The original free energy lemma requires that (see Equations (31) and (32)):
(Γ + R)aa ·∇a DKL[q(Ψ|λ)||p∗(Ψ|s, a, λ)] =0 (A19)
(Γ + R)λλ ·∇λ DKL[q(Ψ|λ)||p∗(Ψ|s, a, λ)] =0. (A20)
Replacing the partial gradient in Equations (29) and (30) with the full gradient and including
the entire matrix (Γ + R) lead to the corresponding requirement for the more general case:
(Ras ·∇s + (Γaa + Raa ) ·∇a + Raλ ·∇λ) DKL[q(Ψ|λ)||p∗(Ψ|s, a, λ)] =0 (A21)
(Rλs ·∇s + Rλa ·∇a + (Γλλ + Rλλ) ·∇λ) DKL[q(Ψ|λ)||p∗(Ψ|s, a, λ)] =0. (A22)
Similarly, the version based on the equations taken from [2] implies:
((Γaa + Raa ) ·∇a + Raλ ·∇λ) DKL[q(Ψ|λ)||p∗(Ψ|s, a, λ)] =0 (A23)
(Rλa ·∇a + (Γλλ + Rλλ) ·∇λ) DKL[q(Ψ|λ)||p∗(Ψ|s, a, λ)] =0. (A24)
Using the rules of Gaussian integration, we can write the logarithm of the conditional
ergodic density as:
ln p∗(ψ|s, a, λ) =−1
2 |U
1
2
ψψψ + U−1
2
ψψ Uψss + U−1
2
ψψ Uψaa + U−1
2
ψψ Uψλλ|2 + C, (A25)
Entropy 2021, 23, 293 17 of 24
with C a constant (and remembering each of ψ, s, a, and λ is a vector of coordinates in
general). We can then expand the derivatives of the KL divergence to express them in
terms of the coordinates:
∇s DKL[q(Ψ|λ)||p∗(ψ|s, a, λ)] =−
∫
dψ q(ψ|λ)∇s ln p∗(ψ|s, a, λ)
=UsψU−1
ψψ
(
Uψss + Uψaa
+ Uψλλ + Uψψ⟨ψ⟩q(Ψ|λ)
)
, (A26)
∇a DKL[q(Ψ|λ)||p∗(ψ|s, a, λ)] =−
∫
dψ q(ψ|λ)∇a ln p∗(ψ|s, a, λ)
=UaψU−1
ψψ
(
Uψss + Uψaa
+ Uψλλ + Uψψ⟨ψ⟩q(Ψ|λ)
)
, (A27)
∇λ DKL[q(Ψ|λ)||p∗(ψ|s, a, λ)] =
∫
dψ
[
(ln q(ψ|λ) −ln p∗(ψ|s, a, λ) +1)∇λq(ψ|λ)
−q(ψ|λ)∇λ ln p∗(ψ|s, a, λ)
]
=UλψU−1
ψψ
(
Uψss + Uψaa
+ Uψλλ + Uψψ⟨ψ⟩q(Ψ|λ)
)
+ ∇λ⟨ψ⟩q(Ψ|λ)
(
Uψss + Uψaa + Uψλλ
)
+ ∇λ
(
⟨ψTUψψψ⟩q(Ψ|λ) −H[q(Ψ|λ)]
)
, (A28)
with ⟨g(ψ)⟩q(Ψ|λ) := ∫
dψ q(ψ|λ)g(ψ) and H the Shannon entropy.
Substituting Equations (A27) and (A28) into Equations (A19) and (A20) leads to:
(Γaa + Raa )UaψU−1
ψψ
(
Uψss + Uψaa + Uψλλ + Uψψ⟨ψ⟩q(Ψ|λ)
)
= 0, (A29)
and:
0 =(Γλλ + Rλλ)UλψU−1
ψψ
(
Uψss + Uψaa + Uψλλ + Uψψ⟨ψ⟩q(Ψ|λ)
)
+ (Γλλ + Rλλ)∇λ⟨ψ⟩q(Ψ|λ)
(
Uψss + Uψaa + Uψλλ
)
+ (Γλλ + Rλλ)∇λ
(
⟨ψTUψψψ⟩q(Ψ|λ) −H[q(Ψ|λ)]
)
. (A30)
Since these must hold for all values of the coordinates, they put strong requirements on the
U and R matrices. Speciﬁcally,
(Γaa + Raa )UaψU−1
ψψ Uψs = 0, (A31)
(Γaa + Raa )UaψU−1
ψψ Uψa = 0, (A32)
(Γaa + Raa )UaψU−1
ψψ Uψλ = 0. (A33)
In other words, since Uψψ and Γaa must be nonzero for the dynamics to be ergodic, it must
be that Uψa = 0 (This is equivalent to p∗(Ψ|s, a, λ) =p∗(Ψ|s, λ). Therefore, if Condition 2
also holds, we must have p∗(Ψ|s, a, λ) =p∗(Ψ|s) in order for there to be a suitableq(Ψ|λ).).
Speciﬁcally, consider the system speciﬁed by the force matrix:
M =


−1 0 1
2 0
0 −1 0 0
0 0 −1 0
0 0 0 −1

 (A34)
Entropy 2021, 23, 293 18 of 24
which leads to:
R =


0 0 −1
4 0
0 0 0 0
1
4 0 0 0
0 0 0 0

 (A35)
and:
U =


16
17 0 −4
17 0
0 1 0 0
−4
17 0 18
17 0
0 0 0 1

. (A36)
Here, M is full rank, so the system is ergodic; clearly, it also satisﬁes Condition 1 due to
the structure of M. Since Ras = Raλ = Rλs = 0, it obeys Equations (19) and (20), and
since Qψλ = 0, it also obeys Condition 2. Additionally, we ﬁnd Uψa = −4/17, which is
a contradiction.
For the more general version, substituting Equations (A26)–(A28) into Equation (A21),
one ﬁnds:
0 =
((
RasUsψ + (Raa + Γaa )Uaψ + RaλUλψ
)
U−1
ψψ + Raλ∇λ⟨ψ⟩q(Ψ|λ)
)
Uψss
+
((
RasUsψ + (Raa + Γaa )Uaψ + RaλUλψ
)
U−1
ψψ + Raλ∇λ⟨ψ⟩q(Ψ|λ)
)
Uψaa
+
((
RasUsψ + (Raa + Γaa )Uaψ + RaλUλψ
)
U−1
ψψ + Raλ∇λ⟨ψ⟩q(Ψ|λ)
)
Uψλλ
+
(
RasUsψ + (Raa + Γaa )Uaψ + RaλUλψ
)
⟨ψ⟩q(Ψ|λ)
+ Raλ∇λ
(
⟨ψTUψψψ⟩q(Ψ|λ) −H[q(Ψ|λ)]
)
, (A37)
which, considering that the coordinates can take any values, implies that:
(
RasUsψ + (Raa + Γaa )Uaψ + RaλUλψ
)
U−1
ψψ + Raλ∇λ⟨ψ⟩q(Ψ|λ) (A38)
lies in a common (left) nullspace of Uψs, Uψa, and Uψλ. However, the existence of such
a nontrivial nullspace would imply that the corresponding subspace of ψ coordinates is
independent of the s, a, and λ coordinates (to see this, consider marginalising over their
complement in Equation (A25)). In other words, if only ψ coordinates that play a nontrivial
role in the dynamics are considered, then Equation (A21) must imply that the quantity in
Equation (A38) is zero and hence that:
Raλ∇λ⟨ψ⟩q(Ψ|λ) = −
(
RasUsψ + (Raa + Γaa )Uaψ + RaλUλψ
)
U−1
ψψ . (A39)
Entropy 2021, 23, 293 19 of 24
However, through a similar procedure, one ﬁnds that Equation (A22) is equivalent to:
0 =
((
RλsUsψ + RλaUaψ + (Γλλ + Rλλ)Uλψ
)
U−1
ψψ
+ (Γλλ + Rλλ)∇λ⟨ψ⟩q(Ψ|λ)
)
Uψss
+
((
RλsUsψ + RλaUaψ + (Γλλ + Rλλ)Uλψ
)
U−1
ψψ
+ (Γλλ + Rλλ)∇λ⟨ψ⟩q(Ψ|λ)
)
Uψaa
+
((
RλsUsψ + RλaUaψ + (Γλλ + Rλλ)Uλψ
)
U−1
ψψ
+ (Γλλ + Rλλ)∇λ⟨ψ⟩q(Ψ|λ)
)
Uψλλ
+
(
RλsUsψ + RλaUaψ + (Γλλ + Rλλ)Uλψ
)
⟨ψ⟩q(Ψ|λ)
+ (Γλλ + Rλλ)∇λ
(
⟨ψTUψψψ⟩q(Ψ|λ) −H[q(Ψ|λ)]
)
, (A40)
implying that:
(Γλλ + Rλλ)∇λ⟨ψ⟩q(Ψ|λ) = −
(
RλsUsψ + RλaUaψ + (Γλλ + Rλλ)Uλψ
)
U−1
ψψ . (A41)
Unless Raλ and (Γλλ + Rλλ) share a common nullspace or the U and R matrices are ﬁnely
tuned, then Equations (A39) and (A41) contradict one another. In this case, there cannot
exist a q(Ψ|λ) that satisﬁes both Equations (A21) and (A22), and hence, the modiﬁed free
energy lemma is invalid in general. In particular, using the example from Appendix B,
if we solve Equation (A39) for ∇λ⟨ψ⟩q(Ψ|λ), we ﬁnd:
∇λ⟨ψ⟩q(Ψ|λ) = −53
5 , (A42)
and from Equation (A41), we get:
∇λ⟨ψ⟩q(Ψ|λ) = 29
239, (A43)
which is a contradiction.
If we now perform the same procedure for Equations (A23) and (A24), we arrive at
the following conditions on the gradient of the variational density:
Raλ∇λ⟨ψ⟩q(Ψ|λ) = −
(
(Raa + Γaa )Uaψ + RaλUλψ
)
U−1
ψψ . (A44)
and:
Raλ∇λ⟨ψ⟩q(Ψ|λ) = −
(
RλaUaψ + (Γλλ + Rλλ)Uλψ
)
U−1
ψψ . (A45)
Even when Condition 2 holds and Uψλ = 0, these will be inconsistent in general. As a
speciﬁc counterexample, take the system with force matrix:
M =


−1 0 −1
2 0
0 −1 0 0
0 0 −1
√
3
2
0 0 0 −1
2

, (A46)
Entropy 2021, 23, 293 20 of 24
with corresponding:
R =


0 0 1
3
1
3
√
3
0 0 0 0
−1
3 0 0 −1√
3
− 1
3
√
3 0 1√
3 0


, (A47)
and:
U =


9
10 0 3
10 0
0 1 0 0
3
10 0 17
20 −
√
3
4
0 0 −
√
3
4
3
4

. (A48)
This model is ergodic (full rank U), and it satisﬁes both Conditions 1 and 2. Moreover,
the forces satisfy Equations (21) and (22). However, substituting the relevant elements of
the U and R matrices into Equation (A44), we ﬁnd:
∇λ⟨ψ⟩q(Ψ|λ) = 1√
3
, (A49)
but doing the same for Equation (A45) gives:
∇λ⟨ψ⟩q(Ψ|λ) = 1
3, (A50)
which is a contradiction.
Appendix D. Counterexample for Step 6
Here, we provide an example system for which Conditions 1 and 2, as well as Steps 2
to 5 are valid, but Step 6 fails. We use a system with:
f (x) =Mx (A51)
where:
M :=


−1 1/2 0 0
1/2 −1 1/2 0
0 1/2 −1 1/2
0 0 1/2 −1

. (A52)
This system is ergodic, satisﬁes Condition 1, and as we will will see, satisﬁes Equations (19)
and (20) as well. Using Equation (5), we ﬁnd:
R =


0 0 0 0
0 0 0 0
0 0 0 0
0 0 0 0

 (A53)
and from Equation (8):
U = −M (A54)
which means that Condition 2 is also satisﬁed.
Entropy 2021, 23, 293 21 of 24
This leads to the ergodic density:
p∗(ψ, s, a, λ) =
√
5
16π2 e−1
2 (ψ2−ψs+s2−sa+a2−aλ+λ2) (A55)
which can be used to check that Equations (19) and (20) hold for this example. The
conditional ergodic density is:
p∗(ψ|s, a, λ) =p∗(ψ|s) = 1√
2π
e−1
2 (ψ−1
2 s)
2
. (A56)
If we now deﬁne q(ψ|λ) =q(ψ) =exp(−(ψ −µ)2/2)/
√
2π as a Gaussian distribu-
tion with mean µ and variance one, we can compute the KL divergence to get:
DKL[q(Ψ)||p∗(Ψ|s, a, λ)] =K(s) =1
2
(
µ −1
2 s
)2
. (A57)
Clearly, for this choice of q(ψ|λ), the gradients with respect to a and λ of the KL
divergence vanish everywhere (Equations (35) and (36) hold). This also means we can
express fa, fλ in terms of a free energy, i.e., the free energy lemma holds for this system.
However, for any proposed bound c ≥0 on the KL divergence, there is a value of s for
which it is exceeded, whatever the choice of µ. Moreover, we can choose a µ such that the
KL divergence is larger than any given c, even when s = 0.
Appendix E. Translating Systems into Generalized Coordinate Systems
We show how to get a generalized coordinate system from a ﬁnite-dimensional system.
By deﬁnition, the generalized coordinates are inﬁnite-dimensional. For all n ∈N and a
coordinate x, they also include the n-th time derivative of x.
Assume as given an ergodic, linear, random dynamical system described by:
˙x = Mx + ω (A58)
where x = (x1, ...,xk) is a k-dimensional vector, M is a k ×k real-valued matrix, and ˙x :=
d
dt x. We can look at the second time derivative of the state by differentiating both sides:
d
dt ˙x = d
dt (Mx + ω) (A59)
¨x = M ˙x + ˙ω (A60)
Similarly for the third time derivative:
d
dt ¨x = d
dt (M ˙x + ˙ω) (A61)
= M ¨x + ¨ω (A62)
Similarly for all higher derivatives:
dn
dtn x = M dn−1
dtn−1 x + dn
dtn ω. (A63)
Entropy 2021, 23, 293 22 of 24
Now, deﬁne the generalized coordinates ˜x = (x, x′, x′′, ...) as:
x = x (A64)
x′= d
dt x (A65)
x′′= d2
dt2 x (A66)
... (A67)
x(n) = dn
dtn x (A68)
... (A69)
Deﬁne also:
˜ω := (ω, d
dt ω, d2
dt2 ω, ..., dn
dtn ω, ...). (A70)
Without further clariﬁcation, the derivatives of ω are not well deﬁned when the latter is
a Gaussian white noise process, as explicitly assumed in writing the vector ﬁeld f (x) in
terms of the ergodic density [6–8]. As discussed in [15], delta-correlated Markovian noise
is always a limiting approximation of noise with a ﬁnite correlation time. Meaningfully
taking the derivatives requires ﬁrst choosing a functional form for the (co)variance whose
limit is a delta function (another, more direct approach would be in terms of generalized
functions, but here too, additional information is required to specify the derivatives [16]).
However, different choices can lead to vastly different central moments of the generalized
noise distribution, including those that vanish or diverge at all orders. In the former case,
the process in terms of generalized coordinates may not be ergodic [17]; in the latter case,
the process is not well deﬁned. In general, it is not clear that Equation (4) holds in the
non-Markovian case, since the standard derivations in [ 6,7] and related works rely on
delta-correlated noise.
Here, we can therefore assume that the noise is such that the derivatives inEquation (A70)
can be treated as Markov and Gaussian. We also assume that dn
dtn ω is independently and
identically distributed to dn−1
dtn−1 ω for all n. Finally, we can then deﬁne the (inﬁnite) matrix
¯M as the block diagonal matrix with all blocks equal to M:
¯M :=


M 0 . . .
0 M
... ...

 (A71)
The time derivative ofω is independent of ω, as the changes are independent of the value of
ω. Therefore, we actually get an inﬁnite number of independent and identically distributed
systems. Using these deﬁnitions, we have:
˙˜x = ¯M ˜x + ˜ω. (A72)
These equations describe a random dynamical system composed of an inﬁnite number of
independent linear random dynamical systems, all governed by the same matrix M and
driven by independently and identically distributed noise. Since the ﬁrst of these systems
(for the variables x) is ergodic by assumption, all of the subsystems are also ergodic, and
therefore, the whole system is ergodic with the ergodic density equal to a product of the
original ergodic density:
¯p∗( ˜x) =p∗(x)p∗(x′)p∗(x′′) ··· p∗(x(n)) ··· . (A73)
Entropy 2021, 23, 293 23 of 24
Additionally, if M is such that:
Mψ ·(ψ, s, a, r)⊤= fψ(ψ, s, a) = (Γ −Q)ψψ∇ψ ln p∗(ψ, s, a, r)
Ms ·(ψ, s, a, r)⊤= fs(ψ, s, a) = (Γ −Q)ss∇s ln p∗(ψ, s, a, r)
Ma ·(ψ, s, a, r)⊤= fa(s, a, r) = (Γ −Q)aa ∇a ln p∗(ψ, s, a, r)
Mr ·(ψ, s, a, r)⊤= fr(s, a, r) = (Γ −Q)rr ∇r ln p∗(ψ, s, a, r),
(A74)
(which is the case for the M in the counterexample to Step 6) then for:
(x1, x2, x3, x4) : = (ψ, s, a, r)
(x′
1, x′
2, x′
3, x′
4) : = (ψ′, s′, a′, r′)
(x′′
1 , x′′
2 , x′′
3 , x′′
4 ) : = (ψ′′, s′′, a′′, r′′)
...
(x(n)
1 , x(n)
2 , x(n)
3 , x(n)
4 ) : = (ψ(n), s(n), a(n), r(n))
...,
(A75)
¯Q :=


Q 0 . . .
0 Q
... ...

, (A76)
¯Γ :=


Γ 0 . . .
0 Γ
... ...

, (A77)
and using Equation (8) and that the inverse of a block diagonal matrix is block diagonal:
¯U :=


U 0 . . .
0 U
... ...

, (A78)
we also have:
¯M ˜ψ ·( ˜ψ, ˜s, ˜a, ˜r)⊤= f ˜ψ( ˜ψ, ˜s, ˜a) = (¯Γ − ¯Q) ˜ψ ˜ψ∇˜ψ ln p∗( ˜ψ, ˜s, ˜a, ˜r)
¯M˜s ·( ˜ψ, ˜s, ˜a, ˜r)⊤= f˜s( ˜ψ, ˜s, ˜a) = (¯Γ − ¯Q)˜s˜s∇˜s ln p∗( ˜ψ, ˜s, ˜a, ˜r)
¯M˜a ·( ˜ψ, ˜s, ˜a, ˜r)⊤= f˜a(˜s, ˜a, ˜r) = (¯Γ − ¯Q)˜a˜a∇˜a ln p∗( ˜ψ, ˜s, ˜a, ˜r)
¯M˜r ·( ˜ψ, ˜s, ˜a, ˜r)⊤= f˜r(˜s, ˜a, ˜r) = (¯Γ − ¯Q)˜r˜r∇˜r ln p∗( ˜ψ, ˜s, ˜a, ˜r).
(A79)
The ergodic density of such a system is a product of the ergodic densities of the
original system Equation (A56):
¯p∗( ˜ψ, ˜s, ˜a, ˜r) =p∗(ψ, s, a, r)p∗(ψ′, s′, a′, r′)p∗(ψ′′, s′′, a′′, r′′) ··· . (A80)
Thus, any property of the original system is also a property of the generalized coordi-
nate system.
References
1. Friston, K. Life as we know it. J. R. Soc. Interface 2013, 10, 2013.0475. [CrossRef] [PubMed]
2. Friston, K. A free energy principle for a particular physics. arXiv 2019, arXiv:1906.10184.
Entropy 2021, 23, 293 24 of 24
3. Parr, T.; Da Costa, L.; Friston, K. Markov blankets, information geometry and stochastic thermodynamics. Philos. Trans. R. Soc. A
2019, 378, 2019.0159. [CrossRef] [PubMed]
4. Friston, K.; Sengupta, B.; Auletta, G. Cognitive Dynamics: From Attractors to Active Inference. Proc. IEEE 2014, 102, 427–445.
[CrossRef]
5. Friston, K.; Rigoli, F.; Ognibene, D.; Mathys, C.; Fitzgerald, T.; Pezzulo, G. Active inference and epistemic value. Cogn. Neurosci.
2015, 6, 187–214. [CrossRef] [PubMed]
6. Ao, P . Potential in stochastic differential equations: novel construction. J. Phys. A 2004, 37, L25–L30. [CrossRef]
7. Kwon, C.; Ao, P .; Thouless, D.J. Structure of stochastic dynamics near ﬁxed points. Proc. Natl. Acad. Sci. USA 2005,
102, 13029–13033. [CrossRef] [PubMed]
8. Kwon, C.; Ao, P . Nonequilibrium steady state of a stochastic system driven by a nonlinear drift force. Phys. Rev. E 2011,
84, 061106. [CrossRef] [PubMed]
9. Ma, Y.A.; Chen, T.; Fox, E.B. A complete recipe for stochastic gradient MCMC. In Proceedings of the 28th International Conference on
Neural Information Processing Systems—Volume 2 ; MIT Press: Montreal, QC, Canada, 2015; pp. 2917–2925.
10. Yuan, R.; Tang, Y.; Ao, P . SDE decomposition and A-type stochastic interpretation in nonequilibrium processes.Front. Phys. 2017,
12, 120201. [CrossRef]
11. Ao, P .; Chen, T.Q.; Shi, J.H. Dynamical Decomposition of Markov Processes without Detailed Balance. Chin. Phys. Lett. 2013,
30, 070201. [CrossRef]
12. Yuan, R.S.; Ma, Y.A.; Yuan, B.; Ao, P . Lyapunov function as potential function: A dynamical equivalence.Chin. Phys. B 2014,
23, 010505. [CrossRef]
13. Bishop, C. Pattern Recognition and Machine Learning; Information Science and Statistics; Springer: New York, NY, USA, 2006.
14. Cover, T.M.; Thomas, J.A. Elements of Information Theory; Wiley-Interscience: Hoboken, NJ, USA, 2006.
15. van Kampen, N.G. Stochastic Processes in Physics and Chemistry; North-Holland: Amsterdam, The Netherlands, 1981.
16. Oberguggenberger, M. Generalized Functions and Stochastic Processes. In Seminar on Stochastic Analysis, Random Fields and
Applications. Progress in Probability; Bolthausen, E., Dozzi, M., Russo, F., Eds.; Birkhäuser: Basel, Switzerland, 1995; Volume 36,
pp. 215–230.
17. Cornfeld, I.P .; Fomin, S.V .; Sinai, Y.G. Ergodic Theory; Springer: New York, NY, USA, 1982.