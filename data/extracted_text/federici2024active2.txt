Active Inference for Closed-loop transmit
beamsteering in Fetal Doppler Ultrasound
Beatrice Federici
Department of Electrical Engineering
Eindhoven University of Technology
Eindhoven, The Netherlands
b.federici@tue.nl
Ruud JG van Sloun
Department of Electrical Engineering
Eindhoven University of Technology
Eindhoven, The Netherlands
r.j.g.v.sloun@tue.nl
Massimo Mischi
Department of Electrical Engineering
Eindhoven University of Technology
Eindhoven, The Netherlands
m.mischi@tue.nl
Abstract—Doppler ultrasound is widely used to monitor fetal
heart rate during labor and pregnancy. Unfortunately, it is
highly sensitive to fetal and maternal movements, which can
cause the displacement of the fetal heart with respect to the
ultrasound beam, in turn reducing the Doppler signal-to-noise
ratio and leading to erratic, noisy, or missing heart rate readings.
To tackle this issue, we augment the conventional Doppler
ultrasound system with a rational agent that autonomously steers
the ultrasound beam to track the position of the fetal heart.
The proposed cognitive ultrasound system leverages a sequential
Monte Carlo method to infer the fetal heart position from
the power Doppler signal, and employs a greedy information-
seeking criterion to select the steering angle that minimizes the
positional uncertainty for future timesteps. The fetal heart rate
is then calculated using the Doppler signal at the estimated
fetal heart position. Our results show that the system can
accurately track the fetal heart position across challenging signal-
to-noise ratio scenarios, mainly thanks to its dynamic transmit
beam steering capability. Additionally, we find that optimizing
the transmit beamsteering to minimize positional uncertainty
also optimizes downstream heart rate estimation performance.
In conclusion, this work showcases the power of closed-loop
cognitive ultrasound in boosting the capabilities of traditional
systems.
Index Terms—action-perception, cognitive systems, Doppler
ultrasound
I. I NTRODUCTION
Fetal heart rate (HR) monitoring is critical to adequate prenatal
care, providing essential insight into the health and well-being
of the fetus. One of the most widely used and non-invasive
methods for monitoring fetal HR is Doppler ultrasound [1].
In fetal Doppler ultrasound, a transducer is carefully placed
on the maternal abdomen to insonify the fetal heart using an
ultrasound beam. The backscattered echoes are then recorded
and processed to detect motion (i.e. Doppler processing), from
which the HR is derived.
Despite its extensive use, Doppler ultrasound is highly sen-
sitive to both fetal and maternal movements, which can cause
the displacement of the fetal heart relative to the ultrasonic
beam [2]. When this happens, the signal-to-noise ratio (SNR)
of the Doppler signal drops significantly, resulting into erratic
This project is supported by the Chips Joint Undertaking (Grant Agreement
No. 101095792) and its members Finland, Germany, Ireland, the Netherlands,
Sweden, Switzerland. This work includes top-up funding from the Swiss State
Secretariat for Education, Research and Innovation.
and noisy HR traces or no HR tracing at all. Sometimes,
maternal insertion can also occur, where the system may
pick up and display the maternal HR [2]. During prolonged
periods of such weak and mixed signals, the fetus is not being
adequately monitored, and the clinical staff has to reposition
the ultrasound transducer.
To improve robustness to displacement, modern ultrasound
transducers for fetal HR monitoring often incorporate large
elements that generate relatively wide beams (e.g., an effective
radiating area at -12 dB of 4.47 ± 0.89 cm 2 [2]). While
this approach helps mitigate the impact of small displace-
ments, larger displacements such as fetal reorientation still
compromise the acquisition. Additionally, the wider beam has
a lower beamforming gain compared to tightly focused beams,
resulting in reduced resiliance to noise. Transducer design
therefore constitutes a trade-off between the achieved Dopper
SNR and its robustness to fetal movements.
In this work, we present an alternative approach. Instead
of widening the ultrasound beam to reduce the sensitivity
to displacement, we propose a closed-loop cognitive ultra-
sound system [3] that autonomously steers a highly focused
ultrasound beam to ensure that the heart is always properly
insonified, tracking displacements relative to the ultrasound
transducer. In practice, we adopt a phased array and control it
through a rational agent whose task is to sequentially select the
optimal focused transmit beam for tracking the position of the
fetal heart. To this end, the agent combines a sequential Monte
Carlo method (particle filter) to infer a Bayesian posterior fetal
heart position from the measured power Doppler signal at
timepoint t, with an information maximization strategy that
selects the future beam steering angle that is expected to
reduce the positional uncertainty the most at timepoint t + 1.
The one-dimensional Doppler signal at the estimated heart
position is then used to compute the HR.
The remainder of this paper is organized as follows. Sec-
tion II describes the proposed Doppler ultrasound system,
including the closed-loop probabilistic framework and the
HR estimation approach. Section III presents the experiments
conducted to evaluate the performance of the system in-silico
and in-vitro. We discuss the results in Section IV and conclude
in Section V.
arXiv:2410.04869v1  [eess.SP]  7 Oct 2024
Fig. 1: Closed-loop fetal Doppler ultrasound.
II. M ETHODS
We model the fetal heart as a moving Doppler target, with
unknown fetal HR and position. This target is observed by a
phased array transducer, which probes the external environ-
ment using a pulsed wave Doppler scheme with a focused
beam having a fixed focal depth and an adaptive steering
angle. At any time point t, a rational agent is tasked with the
selection of the optimal future steering angle, a∗
t+1 ∈ Θtx,
that maximizes information gain with respect to the future
state xt+1: the angular position of the Doppler target at
timestep t + 1. This steering action subsequently leads to a
new observation ˆyt+1 ∈ RNΘ , a clutter-filtered power Doppler
image beamformed on a polar grid (Θ, r) and subsequently
integrated across the depth.
Figure 1 illustrates the proposed closed-loop cognitive ul-
trasound system. It comprises a probabilistic generative model
and iterates between two steps: (1) perception, the updating
of the Bayesian posterior about fetal heart position, and (2)
action, the selection of an information-maximizing transmit
steering angle.
A. Generative Model
The agent’s generative model across Doppler observations
(y0:T ), angular fetal heart positions ( x0:T ), and beamsteering
actions (a0:T ) is given by:
p(y0:T , x0:T , a0:T ) = p(y0:T |x0:T , a0:T )p(a0:T |x0:T )p(x0:T ).
(1)
We assume that each measurement yt is conditionally in-
dependent of measurements at other time points given xt
and at and that the state dynamics can be described as a
first-order Markovian process. Hence, the state dynamics and
the measurement process are governed by the state transition
p(xt|xt−1) and the observation model p(yt|xt, at), respec-
tively. We adopt a linear Gaussian state transition dynam-
ics p(xt|xt−1) = N(xt−1, σx), and a Gaussian non-linear
observation model p(y|xt, at) = N(fy(xt; at), Σy), where
fy(·; at) : R1 → RNΘ maps the angular position of the target
to a simulated power Doppler measurement, considering an
approximate action-conditional transmit beam profile:
fy(xt; at) = e−(Θ−at)2
2bw e−(Θ−xt)2
2hw . (2)
B. Perception
Since our observation model p(yt|xt, at) is highly nonlinear
and high-dimensional, we use approximate Bayesian inference
to update the agent’s beliefs about the state given new obser-
vations and actions ˆ¯y0:t = {ˆy0:t, a0:t}. More specifically, we
use a particle-based approximation to the posterior q(x0:t|ˆ¯y0:t)
with a set of Np samples/particles and importance weights
{xi
t, wi
t}Np
i=1:
q(x0:t|ˆ¯y0:t) =
NpX
i=1
wi
tδ(xt − xi
t) , (3)
where we track the particles and weights using a sequential
Monte Carlo filtering method, the particle filter.
C. Action
Given the updated posterior, the agent selects the beam
steering angle, a∗
t+1, that minimizes the expected posterior
entropy. This is equivalent to selecting the action that max-
imizes the conditional mutual information between the state
and future observations [4]:
a∗
t+1 = max
at+1∈Θtx
I(xt+1, yt+1|at+1, ˆ¯y0:t)
= max
at+1∈Θtx
H(yt+1|at+1, ˆ¯y0:t) − H(yt+1|xt+1, at+1, ˆ¯y0:t) .
(4)
This reduces to maximizing the marginal differential entropy
of future observations as the uncertainty about yt+1 given xt
is independent of the action at+1 according to the defined
generative model p(ˆyt|xt, at) ∼ N(fy(xt, at); σy).
In practice, the agent uses the set of particles {xi
t, wi
t}Np
i=1 to
derive hypothetical futures states xi
t+1 ∼ p(xi
t+1|xi
t), using the
linear Gaussian state transition model. Then, for each possible
action at+1, the agent computes Np hypothetical measure-
ments {yi
t+1|at+1 ∼ p(yt+1|xi
t+1, at+1)}Np
i=1 and uses them
to approximate the marginal differential entropy, assuming a
marginal multivariate Gaussian distribution:
H(yt+1|at+1, ˆ¯y0:t) ∝ 1
2 log(|Σyt+1 (at+1, ˆ¯y0:t)|) , (5)
where Σyt+1 (at+1, ˆ¯y0:t) is the covariance of the marginal
p(yt+1|at+1, ˆ¯y0:t), which we approximate from the samples
{yi
t+1|at+1}Np
i=1.
D. Heart rate estimation
At each iteration, the posterior mean is used as a point
estimate of the angular position of the fetal heart: x∗
t =
Eq(x0:t|ˆ¯y0:t)(xt) = PNp
i=1 wi
txi
t. Its range r∗
t is derived by
searching for the maximum point in the power Doppler image
along x∗
t . The one-dimensional Doppler signal at the esti-
mated coordinates {x∗
t , r∗
t } is processed by an (open-source)
autocorrelation-based method [5] to compute the HR.
III. E XPERIMENTS
A. Validation Setup
The performance of the proposed framework was assessed
in-silico and in-vitro, comparing the performance of the
closed-loop system with an actively steered focused beam
with that of an open-loop system having a non-adaptive, fixed,
ultrasound beam steered at 0 rad.
For the in-silico analysis, we used the Verasonics ultrasound
simulator software [6]. We model the beating heart through a
set of point scatters distributed within a 2-cm-diameter disk
at a depth of 13 cm. The scatter points move concentrically,
following a sinusoidal motion having an amplitude compa-
rable with fetal cardiac wall displacements and a frequency
that yields a realistic HR. Fetal displacement relative to the
ultrasound transducer is simulated by moving the scatter points
laterally. We set a maximum relative displacement of 9 cm,
which, given the target depth, corresponds to an angular dis-
placement of 0.6 radians. We simulated static tissue scattering
by adding a random distribution of point scatters of low
reflectivity in the background. Imaging was simulated using
an s5-1 (Philips) probe geometry and transducer parameters.
For the in-vitro analysis, we built an experimental setup
based the one proposed by Hamelmann et al. [7]. As displayed
in Fig. 2, a chicken heart moves rhythmically along the axial-
direction through a chain of threads driven by a waveform
generator, and it is imaged by a submerged s5-1 (Philips)
phased array. To mimic the relative displacement between the
fetal heart and the transducer, the phased array is mounted
on a translation stage, which in our experiments was pro-
grammed to displace laterally according to a sinusoidal wave.
The maximum displacement with respect to the ultrasound
transducer was 8 cm, leading to an angular range of ±0.5 rad.
The distance between the phased array and the chicken heart
was around 13 cm. We added cornstarch (Maizena) to the
water tank to introduce some background scattering.
For both in-silico and in-vitro experiments, the focused
beam had a fixed focal depth of 13 cm and steering angle
between ±0.7 rad. The pulse repetition frequency was set to
1.5 kHz and the ensemble length to 1 s, which was needed to
cover the typical fetal HR range of 110 bpm-160 bpm. The
set of beamsteering actions Θtx considered by the agent spans
21 angles between -0.7 rad and +0.7 rad.
B. Results
A representative example of the in-silico offline experiments
is shown in Fig. 3, where we compared the performance of the
proposed adaptively-steered focused beam (green) with an ul-
trasound beam fixed at 0 rad (red), i.e. the best a-priori guess .
The adaptive strategy outperforms the fixed beam when the
target displaces substantially from the transducer location. As
visualized in Fig. 3a, the beam steering angle that maximizes
information gain I(xt+1, yt+1|at+1, ˆ¯y0:t) effectively tracks the
target angular position. By steering the beam close to the
target, the target signal benefits from both transmit and receive
beamforming gain, ensuring a strong signal and consistent
Fig. 2: Experimental setup, including a submerged Philips s5-
1 phased array probe manipulated by a translation stage and a
suspended chicken heart attached to an axial motion generator.
detection. In contrast, with a fixed steering angle, the target
eventually drifts outside the beam, causing the target Doppler
signal to fall below the noise level, leading to the tracking
errors visible in Fig. 3b and an inaccurate HR estimation
displayed in Fig. 3c.
We then quantified the performance of the proposed ap-
proach for different SNR conditions. To that end, we added
various levels of white Gaussian noise to the measured channel
data. Fig. 4 shows both the tracking MAE in radians and the
accuracy of fetal HR estimation with a tolerance of 5 bpm,
against the power Doppler SNR at the target depth without any
transmit focusing gain. The latter is computed by transmitting
with a single element and performing full coherent receive
focusing, clutter filtering, and power Doppler processing. The
proposed approach with an adaptively-steered focused beam
(continuous line) maintains excellent tracking performance and
accurate HR estimation for a wider range of SNR levels,
down to 0 dB. The fixed beam strategy (dashed line), instead,
is unable to properly track the target, dropping its Doppler
signal power below the noise level by not benefiting from an
optimized transmit beamforming gain, in turn resulting in an
inaccurate downstream HR estimate.
As for the in-vitro online experiments, we found that
the proposed closed-loop system can accurately track the
position of the chicken heart even when the Doppler target
is continuously moving, and the agent needs to infer its
position and the optimal steering angle on-the-fly. Over a target
trajectory spanning three periods of the sinusoidal waveform
controlling the probe’s lateral motion, we measured a tracking
mean absolute error of 0.03 rad and a 5-bpm HR accuracy
(|GT − HR| ≤5 bpm) of 82%. In terms of inference time,
the posterior state estimate and action selection are completed
in less than 1 s using a non-optimized implementation running
on a CPU.
IV. D ISCUSSION
This work presents a closed-loop cognitive ultrasound system
designed to improve the performance of current fetal Doppler
ultrasound systems. We propose to add, upstream the fetal
HR estimation task, an agent that sequentially selects the
optimal focused transmit beam to accurately track the fetal
heart angular position.
Our findings indicate that by adjusting the steering angle of
a focused beam to maximize expected information gain, the
(a) Steering Angle Selection
 (b) Angular Position Tracking
 (c) Heart Rate Estimate
Fig. 3: In-silico offline experiment comparing the performance of the proposed closed-loop system with adaptive focused beam
and an open-system with a focused beam fixed at 0 rad at an SNR of 10 dB. (a) Selected steering angle compared to the
Doppler target extent. (b) Angular position tracking over time. (c) Heart rate (HR) estimate over time compared to ground
truth (GT). Note how the HR estimation fails when the Doppler target moves out of the fixed transmit beam.
Fig. 4: Tracking mean absolute error (MAE) and heart rate
(HR) accuracy ( |GT − HR| ≤5 bpm) as a function of the
power Doppler signal-to-noise ratio (SNR), for the fixed and
adaptive beam steering policies.
closed-loop system demonstrates robustness against both noise
and displacement, effectively addressing the trade-offs faced
by most conventional non-adaptive systems.
We also found that the positional information maximization
objective aligns with the downstream fetal HR estimation
objective. Although the agent’s primary objective is to select
the beam steering angle that improves tracking of the Doppler
target, this adaptive beam steering also indirectly benefits
the downstream HR estimation task. In fact, to minimize
uncertainty in the target’s position, the agent tends to steer
the ultrasound beam towards the target. By focusing the beam
on the target, the Doppler signal benefits from both transmit
and receive beamforming, leading to a higher Doppler SNR
and a more accurate HR estimate.
Our generative model is relatively simple, and only loosely
approximates the true physical data generating process. Yet,
the model seems to be sufficiently accurate for facilitating
adequate posterior inference and action selection in both in-
silico and in-vitro experiments. For more complex environ-
ments and targets the modelling may need to be expanded,
e.g. by learning parts of the model from data (i.e. deep
generative modeling). Nevertheless, we here show that closed-
loop systems equipped with simple models can already signifi-
cantly enhance the overall system performance with favourable
robustness.
V. C ONCLUSION
In this work, we showcased the potential of closed-loop
ultrasound in boosting the capabilities of traditional ultrasound
imaging. We focused on improving the robustness of conven-
tional fetal HR monitoring systems against fetal and mater-
nal movements. To this end, we augmented a fetal Doppler
ultrasound system with a rational agent that autonomously
steers a focused transmit beam to accurately track the fetal
heart position. Our results show that by dynamically adjusting
the steering angle, this cognitive system delivers accurate HR
estimates in the presence of strong noise and substantial target
movement.
REFERENCES
[1] P. Hamelmann, R. Vullings, A. F. Kolen, J. W. Bergmans, J. O. van
Laar, P. Tortoli, and M. Mischi, “Doppler ultrasound technology for
fetal heart rate monitoring: a review,” IEEE transactions on ultrasonics,
ferroelectrics, and frequency control , vol. 67, no. 2, pp. 226–238, 2019.
[2] Philips, Instruction for Use Avalon Fetal Monitor FM20/30, FM40/50,
Avalon CL. Philips.
[3] R. J. Van Sloun, “Active inference and deep generative modeling for
cognitive ultrasound,” IEEE Transactions on Ultrasonics, Ferroelectrics,
and Frequency Control, pp. 1–1, 2024.
[4] D. V . Lindley, “On a measure of the information provided by an exper-
iment,” The Annals of Mathematical Statistics , vol. 27, no. 4, pp. 986–
1005, 1956.
[5] C. E. Valderrama, L. Stroux, N. Katebi, E. Paljug, R. Hall-Clifford,
P. Rohloff, F. Marzbanrad, and G. D. Clifford, “An open source
autocorrelation-based method for fetal heart rate estimation from one-
dimensional doppler ultrasound,” Physiological measurement , vol. 40,
no. 2, p. 025005, 2019.
[6] A. Cigier, F. Varray, and D. Garcia, “Simus: an open-source simulator for
medical ultrasound imaging. part ii: comparison with four simulators,”
Computer Methods and Programs in Biomedicine , vol. 220, p. 106774,
2022.
[7] P. Hamelmann, M. Mischi, A. F. Kolen, J. O. Van Laar, R. Vullings, and
J. W. Bergmans, “Fetal heart rate monitoring implemented by dynamic
adaptation of transmission power of a flexible ultrasound transducer
array,” Sensors, vol. 19, no. 5, p. 1195, 2019.