Local Max-Entropy and Free Energy Principles,
Belief Diffusions and their Singularities
OlivierPeltre
Univ.Artois,CNRS,CRIL,F-62300Lens,France
Abstract was notably shown to have exponential convergence on
the Ising model when K grows coarse [6], the choice of
AcomprehensivepictureofthreeBethe-Kikuchi
K thus offers a compromise between precision and com-
variational principles including their relationship
plexity. It was already known that CVM solutions may
to belief propagation (BP) algorithms on hyper-
be found by the Generalized Belief Propagation (GBP)
graphs is given. The structure of BP equations is
generalized to define continuous-time diffusions, algorithm of Yedidia, Freeman and Weiss [7, 8, 9] (and
solvinglocalizedversionsofthemax-entropyprin- knownforevenlongerwhenKisagraph[11]).Thisalgo-
ciple (A), the variational free energy principle (B), rithmishoweverfarfrombeingoptimal,andtherelacked
and a less usual equilibrium free energy princi- a comprehensive understanding of their correspondence
ple(C),LegendredualtoA.Bothcriticalpointsof including the relationship with a Bethe-Kikuchi max-
Bethe-Kikuchifunctionalsandstationarybeliefsare entropy principle (A) and its Legendre-dual free energy
shown to lie at the non-linear intersection of two
principle(C).
constraint surfaces, enforcing energy conservation
Weheredescribecontinuous-timediffusionequations
andmarginalconsistencyrespectively. Thehyper-
surface of singular beliefs, accross which equilib- on belief networks which smooth out most convergence
riabecomeunstableastheconstraintsurfacesmeet issuesofGBP,recoveredasatime-step1Eulerintegrator.
tangentially, isdescribedbypolynomialequations We then show that they solve the three different Bethe-
in the convex polytope of consistent beliefs. This Kikuchi variational problems, A, B and C, whose criti-
polynomialisexpressedbyaloopseriesexpansion calpointsareshowntolieattheintersectionoftwocon-
forgraphsofbinaryvariables. straint manifolds, enforcing energy conservation and belief
consistencyrespectively. Theformerconsistsofhomology
I. INTRODUCTION classesinachaincomplexoflocalobservables(C•,δ),the
latter consists of cohomology classes in the dual cochain
Boltzmann-Gibbs principles describe the equilibrium complex of local measures (C∗,d), but these two are re-
•
state pΩ = 1 e−HΩ ofastatisticalsytem,givenitshamil- lated by the non-linear correspondence mapping energy
ZΩ
tonian or energy function HΩ : EΩ → R, as solution to functions to local Gibbs states. While solutions to the
a collection of variational problems [1, 2]. Each one cor- max-entropyprincipleAarestationarystatesofadiabatic
respondstoadifferentsetofexternalconstraints(energy
diffusionalgorithms,preservingthemeanenergyE[HΩ],
ortemperature,volumeorpressure...) yettheyareallre- the variational free energy principle B (CVM) is solved
lated by Legendre transforms on the constraint parame- by isothermal diffusions, preserving the inverse tempera-
ters.However,evaluatingthepartitionfunctionZΩisim- ture β = 1/T. TheequilibriumfreeenergyprincipleCis
possibleforlargeconfigurationspacesEΩ,andthedesign dualtotheothertwo,asitoptimizesoverfibersofgauge-
ofefficientalgorithmsforestimating pΩ orasubsetofits transformedenergyfunctions,andnotoverconsistentbe-
marginalsisachallengewithcountlessapplications. liefs. Its solutions retract onto those of B and are also be
GivenahypergraphK ⊆ P(Ω)withverticesintheset foundbyisothermaldiffusions.
of variables Ω, the Bethe-Kikuchi principles A, B and C Fromaphysicalperspective,Bethe-Kikuchiprinciples
belowyieldtractablevariationalproblems,whereinstead couldbeviewedasmeretoolstoapproximatetheglobal
of the global distribution pΩ, one optimizes over a field and exact Boltzmann-Gibbs principles, although precise
of consistent local beliefs (p a ) a∈K . Controlling the range and powerful. The possible coexistence of multiple en-
of interactions independently of the size of the system, ergy values at a fixed temperature still reminds counter-
they exploit the asymptotic additivity of extensive ther- intuitive yet physical phenomena, such as surfusion and
modynamicfunctionals. ThefreeenergyprincipleB,also metastable equilibria. Recently, free energy principles,
known as the cluster variation method (CVM) [3, 4, 5], Bethe-Kikuchi approximations and BP algorithms also
1
3202
tcO
4
]hp-htam[
1v64920.0132:viXra
madetheirwaytoneuroscience[12,13,14,15],acontext of graphs, yet a true correspondence with the CVM on
whereitisnotveryclearwhataglobalprobabilitydistri- hypergraphs K ⊆ P(Ω) could bot be stated before the
bution pΩ ought to describe. The locality of interactions GBPalgorithmofYedidia,FreemanandWeissin2005[7],
is yet somehow materialized by neuron dendrites and whoseworkbridgedtwosubjectswithalonghistory.The
largerscalebrainconnectivity. Message-passinginsearch ideatoreplacethepartitionfunctionZΩbyasumoflocal
of consensus is an interesting and working metaphor of terms ∑ c Z , where coefficients c ∈ Z take care of
a∈K a a a
neuronalbehaviours,whichmightinthiscaseholdmore eliminating redundancies, was first introduced by Bethe
realitythanglobalvariationalprinciples. Theremarkable in1935,andgeneralizedbyKikuchiin1951[4]. Thetrun-
successofBPalgorithmsindecodingandstereovisionap- cated Mo¨bius inversion formula was only recognized by
plicationsdemonstratesthepotentialofmessage-passing Morita in 1957 [5], laying the CVM on systematic com-
schemesongraphstosolvedifficultproblems. However binatorialfoundations. Amongrecentreferences,see[28]
the success of BP algorithms on loopy networks is often forageneralintroductiontotheCVM.Theconvexregions
presented as an empirical coincidence, and a deeper un- of Bethe-Kikuchi free energies and loopy BP stability are
derstanding of their different regimes could provide the studied in [29, 30], while very interesting loop series ex-
missingtheoreticalguarantees. pansionsmaybefoundin[31]and[32]. Forapplications
Whatever the perspective, singularities of Bethe- ofBethe-Kikuchifreeenergiestoneuroscienceandactive
Kikuchi functionals and belief diffusions (in finite size) bayesianlearning,seealso[12,13,14].
are an important and interesting feature. They happen The unifying notion of graphical model describes
when the two constraint manifolds meet tangentially. A Markov random fields by their factorization properties,
stationary state crossing the singular surface will generi- which are in general stronger than their conditional in-
callybecomeunstable,attractedtowardsadifferentsheet dependence properties obtained by the Hammersley-
of the intersection. This would appear as a discontinu- Clifford theorem [33]. This work sheds a different light
ousjumpintheconvexpolytope Γ ofconsistentbeliefs. fromtheusualprobabilisticinterpretation,soastomake
0
We show that the singular stratification Σ¯1 = (cid:70) Σk is the most of the local structure of observation. The
k≥1
describedbypolynomialequationsin Γ . Theycompute mathematical constructions below thus mostly borrow
0
thecorankkoflinearizeddiffusion,restrictedtothesub- from algebraic topology and combinatorics. The refer-
spaceofinfinitesimalgaugetransformations. Forgraphs ence on combinatorics is Rota [34], and the general con-
ofbinaryvariables,thispolynomialiswrittenexplicitlyin struction for the cochain complex (C∗,d) dates back to
•
termsofaloopseriesexpansion. Grothendieck and Verdier [35]. It has been given a very
nicedescriptionbyMoerdijkinhisshortbook[36]. When
specializingthetheorytolocalizedstatisticalsystems,one
A Relatedwork
quickly arrives at the so-called pseudo-marginal extension
problem[37,38,39]whosesolutioniscloselyrelatedtothe
ThefirstoccurenceofBPasanapproximatebayesianin-
interactiondecompositiontheorem[37,40]. Thisfundamen-
ference scheme dates back to Gallager’s 1962 thesis [16]
talresultyieldsdirectsumdecompositionsforthefunctor
ondecoding,althoughitisoftenattributedtoPearl’s1982
oflocalobservables,usedintheproofoftheorem3below.
articleonbayesiantrees[17],whereitisexact. BPhasre-
ceived a lot of attention and new applications since then
although it is still mostly famous in the decoding con-
B MethodsandResults
text, on this see for instance [18, 19, 20, 21, 22] and [20]
foranexcellentreview. Intelecommunications,BPisthus This work brings together concepts and methods from
usedtoreconstructaparity-checkencodedsignalbyiter- algebraic topology, combinatorics, statistical physics and
atively updating beliefs until all the local constraints are informationtheory.Itshouldparticularlyinterestusersof
satisfied. Althoughtheassociatedfactorgraphhasloops, belief propagation algorithms, although we hope it will
BP works surprisingly well at reconstructing the signal. alsomotivateabroaderuseofBethe-Kikuchiinformation
See [23] for a numerical study of loopy BP and its sin- functionalsbeyondtheirprovendecodingapplications.It
gularities. As a marginal estimation algorithm, usecases is intended as a comprehensive but high-level reference
for BP and its generalizations to hypergraphs are quite onthesubjectforapluridisciplinaryaudience. Weexpect
universal. Other interesting applications for instance in- somereadersmightlackspecificvocabularyfromhomo-
clude (but are not limited to) computer stereovision [24] logical algebra, although we do not believe it necessary
andconditionalBoltzmannmachines[25]. Gaussianver- forunderstandingthecorrespondencetheorems. Wepro-
sions of BP also exist [26], from which one could for in- videspecificreferencestotheoryandapplicationswhere
stancerecoverthewellknownKa´lma´nfilteronahidden needed, and longer proofs are laid in appendix to avoid
Markovchain[20]. burdeningthemaintextforreadersmostlyinterestedby
The relationship with Bethe-Kikuchi approximations theresults.
is covered in the reference works [21, 11, 27] in the case Themainobjectoftheoryhereconsistsinwhatwecall
2
thecombinatorialchaincomplex (C•,δ,ζ). Thisisagraded theGibbsstatemapatinversetemperature β(marginal
vectorspace (cid:76) r≥0 C r ,acodifferentialδ : C r → C r−1 ,and consistency).
a combinatorial automorphism ζ : C → C , attached to
r r
anyhypergraphK withverticesinthesetofvariablesΩ. − VI. MESSAGE-PASSING EQUILIBRIA states the rigorous
Theoperatorsζ andδactingonC andC generatebelief correspondence between critical points and stationary
0 1
propagationequations,andanefficientimplementationis beliefs with theorems A, B and C. Singular subsets
made available at github.com/opeltre/topos. Although Σk ⊆ Γ 0 aredefinedbycomputingthedimensionofthe
deepernumericalexperimentsarenotinthescopeofthis intersectionofthetwotangentconstraintmanifolds,al-
article, this library was used to produce the level curves most everywhere transverse. The fact that it may be
ofaBethe-Kikuchifreeenergyinfigure6andthebench- describedbypolynomialequationsallowsfornumeri-
marksoffigure4. cal exploration of singularities, and motivate a deeper
Initial motivations were to arrive at a concise factor- studyrelatingthemtothetopologyofK.
izationofGBPalgorithms, andatarigorousproofofthe
correspondence between GBP fixed points and CVM so-
C Notations
lutions. Althoughdescribedearlier[8,9,10],therelacked
their relationship to a Bethe-Kikuchi max-entropy prin- LetΩdenoteafinitesetofindices,whichwemaycallthe
ciple A and its dual (equilibrium) free energy principle basespace. Weviewthepartialorderofregions(P(Ω),⊆)
C. The polynomial description of singular sets Σk ⊆ Γ asacategorywithauniquearrowb→awheneverb⊆a.
0
isalsonew, andtheirexplicitformulason binarygraphs Wewriteb⊂aonlywhenbisastrictsubsetofa,anduse
yield a very satisfying and most expected relationship consistentalphabeticalorderinnotationsaspossible. The
withthesubjectofloopseriesexpansions[30,31,32]. oppositecategory,denotedP(Ω)op,hasarrowsa→bfor
Thearticleisstructuredasfollows. b⊆a.
AfreesheafofmicrostatesE : P(Ω)op → Setwillthen
− II. GRAPHICAL MODELS AND GENERALIZED BELIEF map every region a ⊆ Ω to a finite local configuration
PROPAGATIONdefinesGibbsianensemblesaspositive spaceE = ∏ E. Inotherwords,thesectionsofE are
a i∈a i a
GraphicalModels(GMs). Thefactorizationpropertyof vertex colourings x a = (x i ) i∈a of a subset a ⊆ Ω, with
the probability density translates as a linear spanning colours x ∈ E for i ∈ a (called local microstates or con-
i i
property of its log-likelihood, called a K-local observ- figurations in physical terminology). As a contravariant
able. GBPequationsarethenprovidedalongwithclas- functor, E maps every inclusion b ⊆ a to the canonical
sicalexamples. restrictionπa→b,projectingE ontoE . Givenalocalsec-
a b
tionx ∈ E ,wewritex = πa→b(x ).
− III. MAX-ENTROPY AND FREE ENERGY PRINCIPLES a a a|b a
For every region a ⊆ Ω, we will write REa for the fi-
briefly reviews Boltzmann-Gibbs and Bethe-Kikuchi
nitedimensionalalgebraofrealobservableson E , write
principles so as to formulate the variational problems a
A,BandC,localizedversionsofthefundamentalprin-
REa ∗ foritslineardual,andwrite∆¯
a
= Prob(E
a
) ⊂ REa ∗
forthetopologicalsimplexofprobabilitymeasuresonE ,
ciples defining thermodynamic equilibrium in statisti- a
alsocalledstatesofthealgebraREa. Theopensimplexof
calphysics.
positivestateswillbedenoted∆ ⊂ ∆¯ .
a a
− IV. LOCAL STATISTICAL SYSTEMS is the core techni-
cal section, where we define the chain complex (C•,δ)
II. GRAPHICALMODELSANDGENERALIZED
of local observables, its dual complex (C∗,d) of local
• BELIEFPROPAGATION
densities,andthecombinatorialautomorphismsζ and
µ = ζ−1 acting on all the degrees of C•. These higher
A GraphicalModels
degree combinatorics of C for r >1 were described
r
previously in [9, chap. 3]. We here propose an inte- Inthispaper,ourmainobjectofstudyisaspecialclassof
gralnotationforthezetatransformmakingtheanalogy Markov Random Fields (MRFs), called Gibbsian ensem-
withgeometrymoreintuitive,inthespiritofRota[34]. blesin[33]althoughtheyarenowmorecommonlycalled
Graphical Models (GMs) in the decoding and machine
− V. BELIEFDIFFUSIONS uses the codifferential δ and its learningcontexts. GivenasetofverticesΩandarandom
conjugate under ζ to generate diffusion equations on colouringxΩ = (x
i
) i∈Ω,aGMessentiallycapturesthelo-
thecomplex (C•,δ,ζ). Weexplainunderwhichcondi- cality of interactions by a hypergraph K ⊆ P(Ω) over
tions a flux functional Φ : C 0 → C 1 yields solutions whichthedensityofxΩshouldfactorize. Thispropertyis
to problems A, B and C as stationary states of the dif- in general stronger than the Markov properties obtained
fusion dv = δΦ(v) on C . Its purpose is to explore a by the Hammersley-Clifford theorem (as conditional in-
dt 0
homology class [v] (energy conservation) until meeting dependence of separated regions only ensures factoriza-
the preimage Mβ ⊆ C of cohomology classes under tionovercliques[33]).
0
3
Definition 1. Given K ⊆ P(Ω) and a collection of factors global hamiltonian HΩ ∈ REΩ has a low-dimensional
f : E → Rfora ∈ K, the graphicalmodelparameterized sourcespace,butfailstobeinjective.InsectionIVwecon-
a a
by(f a ) a∈K istheprobabilitydistribution structachaincomplex (C•,δ), i.e. agradedvectorspace
C• = (cid:76)
r
n
=0
C
r
andadegree-1square-nulloperatorδ,
1 ∏
pΩ(xΩ) =
ZΩ a∈K
f
a
(xΩ|a ), (1)
REΩ ζΩ C δ C δ ... δ C , (5)
0 1 n
where ZΩ = ∑
EΩ
∏
a
f
a
is an (unknown) integral over EΩ,
calledthepartitionfunction. We showed that this complex is acyclic is an exact se-
quenceinpreviouswork[8,9]. Inotherwords,Ker(δ) =
It is common to represent GMs by their factor graph Im(δ) and Ker(ζΩ) = δC
1
. Degree-0 homology classes
(figure1.b),abipartitegraphwherevariablenodesi ∈ Ω [h] ∈C /δC thusyieldabijectiveparameterizationofK-
0 1
carryvariablesx i ∈ E i ,andfactornodesa∈ Kcarrylocal localobservables,thisisthestatementoftheorem3. The
functions f a : E a →R. Factorsa∈ Karethenlinkedtoall complexstructuremoreoverunderliesbeliefpropagation
nodes i ∈ a ⊆ Ω. However, this graph structure should algorithms,whichexploreahomologyclassh+δC ⊆C
1 0
not be confused with the partial order structure we use ofinteractionpotentials,andGBPisgeneralizedbydiffu-
formessage-passing(figures1.cand1.d). sionequationsoftheformv˙ = δΦ(v)insectionV.
In statistical physics, where the notion of graphical
modeloriginatesfrom,itismorecommontowritepΩasa
B GeneralizedBeliefPropagation
normalizedexponentialdensity 1 e−βHΩcalledtheGibbs
ZΩ
density. The function HΩ : EΩ → R is called hamiltonian The purpose of Belief Propagation (BP) or sum-product
ortotalenergyandthescalarparameter β = 1/T iscalled algorithms is to estimate the marginals (p a ) a∈K of a GM
inversetemperature. Thisvariableenergyscaleisoftenset pΩ ∈ ∆ Ω. Let us precise what is meant by beliefs early:
to 1 and omitted. We recommend references [1] and [2] this terminology distinguishes them from true marginals
fordeeperthermodynamicbackground. of a global distribution pΩ, which would admit a gen-
Assumingpositivityof pΩ, thefactorizationproperty uine probabilistic interpretation, were they practically
of a graphical model pΩ translates to a linear spanning computable by partial integration. Consistent beliefs are
propertyontheglobalhamiltonianHΩ = ∑
a
−ln f
a
. alsocalledfieldsofpseudo-marginals,becausetheysatisfy
the same gluing axioms as true marginals. Their exten-
Definition2. Wesaythataglobalobservable HΩ : EΩ → R sion to a global measure on EΩ may not always be cho-
is K-local with respect to the hypergraph K ⊆ P(Ω), when sen positive: this is known as the pseudo-marginal exten-
there exists a family of interaction potentials h a : E a → R sionproblem(see[38,37]and[39]foramodernapproach
suchthatforallxΩ ∈ EΩ, withsheaves). Beliefsrelaxtheconsistencyconstraint,al-
∑ thoughbeingpurposedtoreachaconsensualstate.
HΩ(xΩ) = h
a
(xΩ|a ). (2)
a∈K Definition 3. Beliefs (over K) are collection of local positive
probabilitydensitiesq ∈ ∆ = ∏ ∆ .
TheGibbsstateofthehamiltonian HΩ atinversetemperature 0 a∈K a
β >0isthepositiveprobabilitydistribution Beliefsaresaidconsistent,writtenq ∈ Γ 0 ,ifq b isthepush-
forwardofq underπa→b : E → E forallb⊂ainK.
a a b
1
pΩ(xΩ) = e −βHΩ(xΩ) , (3) The Generalized Belief Propagation (GBP) algorithm
ZΩ
of Yedidia et al. [7] is an important generalization of BP
and we denote the surjective Lie group morphism from global equations to hypergraphs K ⊆ P(Ω) (region graphs in
observablestoGibbsstatesby their terminology). Unlike BP on factor graphs, where
messages M a→i (x i ) respect the bipartite structure and
ρ
Ω
β :REΩ → ∆ Ω. (4) flow only from factors nodes to vertices, GBP iterates
uponmessages M a→b (x b )betweenanytworegionssuch
TheK-localGibbsianensembleistheimageofK-localobserv- thata⊃b,seefigure1.
β
ablesunderρ (foranyβ).
Ω
Definition 4. Given positive factors f ∈ C (the model pa-
0
ThenotionsofGibbsianensembles[33]andgraphical rameters,representingconditionalkernelsandlocalpriors)and
modelsareonlyequivalentuptoapositivityassumption positiveinitialmessages M(0) ∈ C (whichmaybesetto1or
1
on pΩ. Wealwaysassumepositivityof pΩ,althoughthis absorbedin f),theGBPequations
isnotalwaysthecaseindecodingapplications.
pote L n e t t ia C l 0 s ( , K an ) d = w ∏ ri a t ∈ e K C R 0 E = a d C e 0 n (K ot ) e b t y he as s s p u a m ce in o g fi K nt ⊆ era P ct ( i Ω on ) q b (t) (x b ) = Z 1 b c ∏ ⊆b f c (x b|c ) a ∏ ⊇c M a (t → ) c (x b|c ), (6)
to be fixed. In general, the map from (h ) ∈ C to the
a 0 a̸⊆b
4
Figure1:DifferentrepresentationsofK⊆P(Ω).HereKisa2-dimensionalsimplicialcomplex(a).Thefactorgraph(b)isconstructed
byjoiningeveryfactornodea∈K(squares)toitsvariablesi∈a(dots).Theregiongraph(c)insteadinsertsadirectededgebetween
anytworegionnodesa,b ∈ Ksuchthata ⊇ b. Thepartialorderstructureisequivalentlyrepresentedby(d),whereheightgivesa
betterimpressionoftheordering. In(c)and(d),non-primitivearrows(i.e. havinganon-trivialfactorization)areinorange,andthe
terminalregion∅isnotrepresented.
∑
q
(t)
(x ) C Examples
a a
M a (t → + c 1) (x c ) = M a (t → ) c (x c )· x a|c =
q
x (t c )
(x )
(7) 1. Markovchainsandtrees
c c A length-n Markov chain on Ω = {0,...,n} is local with
defineasequence(q,M) ∈ (∆ ×C )N . respect to the 1-graph K = K 0 ⊔K 1 ⊆ P(Ω) linking
0 1
every vertex 0 ≤ i < n to its successor i +1. Indi-
The evolution of q(t) only depends on the geometric vidual states of the Markov chain are denoted x i ∈ E i
for i ∈ Ω. This data extends to a contravariant functor
increment of messages M(t+1)/M(t). Setting M(0) = 1,
E : (K,⊆)op → Set mapping edges ij ∈ K to pairwise
GBP equations therefore also define a dynamical system
joint states E = E ×E, and with canonical projections
GBP : ∆ → ∆ , such that q(n) = GBPn(q(0)). It is clear ij i j
0 0 asarrows.
from (7) that consistency of beliefs q ∈ Γ 0 is equivalent to Given an input prior f (x ) := P(x ) and Markov
0 0 0
stationarityofmessages. Howeveritisnotobviousthatsta- transition kernels f j,j−1 (x j ,x j−1 ) := P(x j |x j−1 ) for 1 ≤
tionarityofbeliefsimpliesstationarityofmessages,andthis
j ≤ n, set other factors and messages to 1. BP and GBP
explainswhyGBPisusuallyviewedasadynamicalsys-
then coincide to exactly compute in n-steps the output
temonmessages. andhiddenposteriorsq (x ) =P(x )forj ≤ nas:
j j j
Weshowedthatstationarityofbeliefsdoesimplycon-
sistencyandstationarityofmessages[8,9],andcalledthis P(x j ) = ∑ P(x j |x j−1 )P(x j−1 ). (8)
property faithfulness of the GBP diffusion flux (see defini- xj−1 ∈Ej−1
tion13andproposition30below).Thispropertyiscrucial
to retrieve the consistent polytope Γ ⊆ ∆ as stationary Inthisparticularcase, thesum-productupdaterulethus
0 0
statesofthedynamicalsystemonbeliefs,andthusprop- simplyconsistsinarecurrenceofmatrix-vectormultipli-
erlydrawtheanalogybetweenGBPanddiffusion. cationsfor M j−1,j→j (x j ) = q j (x j ) = P(x j ). Theintegrand
5
of(8)alsoyieldstheexactpairwiseprobabilityP(x j−1 ,x j ) forartificialintelligence,andabayesianframeworkseems
bytheBayesrule. moresuitableforsuchaprogramthanone-wayparame-
The situation is very much similar for Markov trees, terizedfunctionsandfeed-forwardneuralnetworks.
i.e. when K is an acyclic graph. In this case, choosing
any leaf node x 0 as root, BP recursively computes the 3. Higher-orderrelations
bayesianposteriorsP(x )exactly,byintegratingtheprod-
uctP(x |x )P(x )overt j heparentstatex ∈ E whencom- When K ⊆ P(Ω)isageneralhypergraph,wemaywrite
j i i i i K = (cid:70) K bygradinghyperedgesa= {i ,...,i }accord-
p
of
u
P
ti
e
n
a
g
rl
t
’
h
s
e
or
m
ig
e
i
s
n
s
a
a
l
g
a
e
rt
M
icl
i
e
j→
o
j
n
(x
B
j )
ay
b
e
y
si
(
a
7
n
).
tr
T
e
h
e
i
s
s
[1
is
7]
t
.
he content ing to r the r ir dimension r, and write K− 0
1
= { r ∅} when
K contains the empty region (which we usually assume
A famous particular class of Markov trees consists of
alongwiththe∩-closureofK). WecalldimensionofKthe
hidden Markov chain models, for instance used by Fris-
greatestnsuchthatK
̸=∅
,andcallKann-graph.
toninneuroscience[12],andofwhichtheKa´lma´nfilteris n
Working with a coarse n-graph K with n ≥ 2 is use-
acontinuous-valuedgaussianversion[20].
ful even when the hamiltonian is local with respect to a
1-subgraph K′ ⊆ K. This is done by simply extending
2. SpinglassesandHopfieldnetworks K′-localfactors(f b ) b∈K′ by f a = 1foralla ∈ K ∖ K′. The
A spin glass is a1-graph K ⊆ P(Ω) whose verticescarry dimensionofthecoarserhypergraphKusedformessage-
a binary variable x ∈ {−1,+1} = E. In this case, any passingthusprovidesgreaterprecisionatthecostoflocal
i i
K-local hamiltonian HΩ : EΩ → R may be uniquely de- complexity,whichisthecostofpartialintegralsonE a for
maximal a ∈ K. From a physical perspective, this cor-
composedas:
respondstoapplyingKikuchi’sClusterVariationMethod
HΩ(xΩ) = h∅+ ∑ b
i
x
i
+ ∑ w
ij
x
i
x
j
(9) (CVM)[4,5]toaspinglasshamiltonianHΩ,givenby(9).
i∈K0 ij∈K1 Thereisalsogreateropportunityinconsideringhigher
order interactions h (x ) = h (x ,...,x ) for r ≥ 2
a a i0,...,ir i0 ir
Uniquenessofthisdecompositionisaconsequenceofthe to capture more subtle relations. Taking r = 2 with bi-
interactiondecompositiontheorem,see[37]and[40]. Oneof- naryvariables,theinteractiontermsw x x x mimicsat-
ijk i j k
ten drops the constant factor h∅ for its irrelevance in the tentionintransformernetworks. Inacontinuous-valued
Gibbsstatedefinition. case, where x ∈ R3 for instance describes atomic posi-
i
SpinglassesareformallyequivalenttotheIsingmodel tionsinamoleculeorcrystal,energycouldn’tbemadede-
offerromagnetism,theonlyconceptualdifferencesresid- pendentonbondangleswithoutthird-orderinteractions
inginarandomsamplingofbiasesb i ∼P(b i )andweights h ijk (x i ,x j ,x k ) [45]. Continuous variables are outside the
w ij ∼ P(w ij ), and in allowing for other graphs than cu- scopeofthisarticlebutwereferthereaderto[46,47,26]
bic lattices which describe homogeneous crystals. Bethe the Gaussian version of BP algorithms. See also [48] on
produced his now famous combinatorial approximation third-orderBoltzmannmachinesand[49,50]formorere-
schemein1935[3]toestimatetheIsingmodelfreeenergy. centhigher-orderattentionnetworkarchitectures.
BPworkssurprisinglywellatestimatingthetruelike-
lihoodsP(x )andP(x,x )byconsistentbeliefsq (x )and
j i j i i III. ENTROPYANDFREEENERGYPRINCIPLES
q (x,x ) even on loopy graphs. It may however show
ij i j
converge issues and increased errors as the temperature A Boltzmann-Gibbsvariationalprinciples
decreaseswhenKhasloops,whilethenumberofstation-
Inclassicalthermodynamics,astatisticalsystemΩisde-
arystatesgrowsquicklywiththenumberofloops. Inthe
scribedbyaconfigurationspace E (assumedfiniteinthe
cyclic case, each belief aggregates a product of messages
∏ i M ij→j (x j ) according to (6) before being summed over following) and a hamiltonian H : E → R measuring the
energy level of each configuration. Thermal equilibrium
in the computation of messages (7), and therefore does
withareservoiratinversetemperatureβ =1/Tdefinesthe
not reduce to a simple matrix-vector multiplication. See
so-called Gibbs state pβ ∈ Prob(E) by renormalization of
[18,19,23]formoreinformationonloopyBPbehaviour.
theBoltzmann-Gibbsdensitye−βH:
Spin glasses are also called Boltzmann machines [41]
in the context of generative machine learning. It is well pβ(x) = 1 e −βH(x) where Z = ∑ e −βH(x) . (10)
known that bipartite spin glasses, also called restricted Z
x∈E
Boltzmannmachines(RBMs), areequivalenttothe Hop-
Two different kindsof variational principles characterise
field model of associative memory whose phase transi-
theequilibriumstate pβ:
tions[42,43]havereceivedalotofattention. Thesephase
diagrams are generally obtained by the replica method • the max-entropy principle asserts that the Shannon
of Javanmard and Montanari [44] in the thermodynamic entropy S(p) = −∑ pln(p) is maximal under an
E
limit. Webelieveabroaderunderstandingofsuchphase internal energy constraint E [H] = U at equilib-
p
transitionsinneuralnetworkswouldbehighlybeneficial rium;
6
• the free energy principle asserts that the variational Theorem 2. Under the temperature constraint T = 1/β,
free energy Fβ(p,H) = E
p
[H]−TS(p) is minimal given a hamiltonian H
a
∈ REa, the minimum of variational
underthetemperatureconstraint T = 1/β atequi- freeenergyisreachedontheGibbsstate p∗ = 1 e−βHa,
librium;itisthenequaltothefreeenergy Fβ(H) =
a Za
−ln∑
E
e−βH. F
a
β(p
a
∗ ,H
a
) =
p
m
a ∈
i
∆
n
a
F
a
β(p
a
,H
a
). (15)
Althoughequation(10)givesthesolutiontobothoptimi- ItmoreovercoincideswiththeequilibriumfreeenergyF β(H ),
sationproblems,computingZnaivelyisusuallyimpossi- a a
bleforthesizeofEgrowsexponentiallywiththenumber F β(H ) = min Fβ(p ,H ) (16)
a a a a a
ofmicroscopicvariablesininteraction. pa ∈∆ a
The Legendre duality relating Shannon entropy and Although stated for every region a ⊆ Ω, theorem 2
freeenergiesisillustratedbytheorems1and2below,im-
only makes sense physically when applied to the global
plying the equivalence between entropy and free energy region Ω. Indeed, localfreeenergyprinciples(15)onre-
Boltzmann-Gibbsprinciples [1,2]. Propertiesofthermo- gions a ⊆ Ω totally neglect interactions with their sur-
dynamic functionals may be abstracted from the global roundings.Thelocalbeliefs(p a ) a∈K theydefinethushave
notion of physical equilibrium, and stated for every re-
verylittlechanceofbeingconsistent.
gion a ⊆ Ω as below. Local functionals will then be
recombined following the Bethe-Kikuchi approximation
B Bethe-Kikuchivariationalprinciples
schemeinthenextsubsection.
Wenowproceedtodefinelocalisedversionsofthemax-
Definition5. Foreverya⊆ Ωandβ >0,define: entropyandfreeenergyvariationalprinciples1and2,at-
tached to any hypergraph K ⊆ P(Ω). We recall that C
• theShannonentropyS a : ∆ a →Rby stands for the space of interaction potentials ∏
a∈K
REa 0 ,
S (p ) = − ∑ p ln(p ), (11) and that Γ 0 ⊆ ∆ 0 ⊆ REa ∗ denotes the convex polytope
a a a a of consistent beliefs (definition 3). Bethe-Kikuchi princi-
pleswillcharacterisefinitesetsofconsistentlocalbeliefs
• thevariationalfreeenergyF a β : ∆ a ×REa →Rby {p1,...,pm} ⊆ Γ 0 , in contrast with their global counter-
partsdefiningthetrueglobalGibbsstate pΩ ∈ ∆ Ω.
Fβ(p ,H ) =E [H ]− 1 S (p ), (12) Extensivethermodynamicfunctionalssuchasentropy
a a a pa a β a a andfreeenergiessatisfyanasymptoticadditivityproperty,
e.g. the entropy of a large piece of matter is the sum
• thefreeenergyF β :REa →Rby ofentropiesassociatedtoanydivisionintolargeenough
a constituents. Bethe-Kikuchi approximations thus consist
of computing only local terms (that is, restricted to a
F a β(H a ) = − 1 ln ∑ e −βHa. (13) tractable number of variables) before cumulating them in
β
a large weighted sum over regions a ∈ K where integral
coefficients c ∈ Z take care of eliminating redundan-
a
Legendre transforms may be carried with respect
cies. The coefficients c are uniquely determined by the
a
to local observables and beliefs directly, instead of the inclusion-exclusion principle ∑ c = 1 for all b ∈ K
a⊇b a
usual one-dimensional temperature or energy parame-
(corollary5). ForarecentintroductiontotheCVM[4,5],
ters. To do so, one should describe tangent fibers of ∆
a werefertoPelizzola’sarticle[28].
as T
pa
∆
a
≃ REa modR, so that additive energy con-
Let us first introduce the local max-entropy principle
stants span Lagrange multipliers for the normalisation
we shall be concerned with. As in the exact global case,
constraint⟨p ,1 ⟩ = 1. Foramoredetailedstudyofther-
a a the max-entropy principle (problem A) describes an iso-
modynamicfunctionals,wereferthereaderto[9,chap.4]
latedsystem. Itthereforetakesplacewithconstraintson
and[2]. theBethe-Kikuchimeanenergy Uˇ : ∆ ×C → R, given
0 0
forall p ∈ ∆ andallH ∈C by:
Theorem1. Underthemeanenergyconstraint⟨p ,H ⟩ = U, 0 0
a a
the maximum of Shannon entropy is reached on a Gibbs state Uˇ(p,H) = ∑ c E [H ] (17)
a pa a
p∗ = 1 e−βHa, a∈K
a Za
ProblemA. LetH ∈C denotelocalhamiltoniansandchoose
0
S a (p a ∗) = p m a ∈ a ∆ x a S a (p a ), (14) a Fi m nd ea b n e e li n e e fs rg p yU ∈ ∈ ∆ R c . ritical for the Bethe-Kikuchi entropy
⟨pa,Ha ⟩=U
Sˇ : ∆ →Rgivenb
0
y:
0
for some univocal value of the Lagrange multiplier β ∈ R, Sˇ(p) = ∑ c S (p ), (18)
a a a
calledinversetemperature.
a∈K
7
undertheconsistencyconstraint p ∈ Γ andthemeanenergy IV. LOCALSTATISTICALSYSTEMS
0
constraintUˇ(p,H) = U.
The Bethe-Kikuchi variational free energy principle, Inthefollowing,welet K ⊆ P(Ω)denoteafixedhyper-
problem B below, instead serves as a sound local substi- graphwithverticesinΩ = {1,...,N},andmoreoveras-
tutefordescribingathermostatedsystemattemperature sume that (K,⊆,∩) forms a semi-lattice. The following
T =1/β. constructions could be carried without the ∩-closure as-
sumption, but theorem 3 and the correspondence theo-
ProblemB. LetH ∈C denotelocalhamiltoniansandchoose
0
remsofsectionVIwouldbecomeone-way.
aninversetemperatureβ >0.
Findbeliefs p ∈ ∆ criticalfortheBethe-Kikuchivariational This section carries the construction of what we may
0
freeenergyFˇ : ∆
0
×C
0
→Rgivenby: callacombinatorialchaincomplex(C•,δ,ζ)oflocalobserv-
ables, recalling the necessary definitions and theorems
Fˇβ(p,H) = ∑ c a F a β(p a ,H a ), (19) from [9]. The first ingredient is the codifferential δ, sat-
a∈K isfyingδ2 = δδ =0andofdegree-1:
undertheconsistencyconstraint p ∈ Γ .
0
Problems A and B are both variational principles on
C
←δ−C ←δ−
...
←δ−C
. (21)
p ∈ Γ with the consistency constraint in common, but 0 1 n
0
with dual temperature and energy constraints respec-
tively. In contrast, the following free energy principle Thefirsthomology[C 0 ] = H 0 (C•,δ)willyieldabijective
(problem C) explores a subspace of local hamiltonians
parameterizationofK-localobservablesinREΩ,thisisthe
V ∈ C ,satisfyingwhatweshallviewasaglobalenergy statementoftheGausstheorem3. Ontheotherhand,the
0
conservation constraint in the next section. Let us write dualcochaincomplex
V∼ˇ H if and only if ∑ c V = ∑ c H as global observ-
a a a a a a
ablesonEΩ.
C ∗ −→ d C ∗ −→ d ... −→ d C ∗ (22)
ProblemCalsodescribesasystematequilibriumwith 0 1 n
athermostatatfixedtemperatureT =1/β.
ProblemC. LetH ∈C 0 denotelocalhamiltoniansandchoose will allow us to describe consistent beliefs p ∈ Γ 0 by the
aninversetemperatureβ >0. cocycle equation dp = 0, living in the dual cohomology
FindlocalhamiltoniansV ∈C 0 criticalfortheBethe-Kikuchi [C 0 ∗] = H0(C • ∗,d). The construction of (C • ∗,d) may be
freeenergyFˇβ :C →Rgivenby: traced back to Grothendieck and Verdier [35, 36], yet we
0
believetheinteractionofalgebraictopologywithcombi-
Fˇβ(V) = ∑ c F β(V ), (20) natoricspresentedheretobequiteoriginal.
a a a
a∈K
The zeta transform is here defined as a homogeneous
undertheenergyconservationconstraintV∼ˇ H. linearautomorphism ζ : C• → C•, andplaysarolevery
similartothatofadiscretespatialintegration,confirming
In contrast with the convex optimisation problems of
anintuitionofRota. Itsatisfiesremarkablecommutation
theorems 1 and 2, note that the concavity or convexity
relationswithδ,theGauss/Greeneformulas(44)and(45).
ofinformationfunctionalsisbrokenbytheBethe-Kikuchi
coefficientsc ∈ Z. Thisexplainswhymultiplesolutions Itsinverse µ iscalledtheMo¨biustransformandtherecip-
a
rocalpair(ζ,µ)extendsthefamousMo¨biusinversionfor-
toproblemsA,BandCmightcoexist,andwhytheycan-
mulas[34]todegreeshigherthan1inthenerveofK. All
not be found by simple convex optimisation algorithms.
these operatorswill comeinto playwhen factorizing the
We will instead introduce continuous-time ordinary dif-
GBP algorithm and defining Bethe-Kikuchi diffusions in
ferentialequationsinsectionV.Theirstructureisremark-
sectionV.
ablysimilartodiffusionorheatequations,althoughcom-
binatorial transformations may again break stability and Our localization procedure could be summarized as
uniquenessofstationarystates. follows. First, we restrict the sheaf E to a contravariant
On the Ising model, Schlijper showed that the CVM functor E
K
over K; then, we define a simplicial set N•E
K
error decays exponentially as K ⊆ P(Zd) grows coarse extending E
K
to the categorical1 nerve N•K by mapping
with respect to the range of interactions [6]. This result every strictly ordered chain a ⊃ ··· ⊃ a to its terminal
0 p
confirmstheheuristicargumentontheextensivityofen- configuration space E := E . In particular, the set
a0...ap ap
tropy,andreflectsthefastdecayofhigh-ordermutualin- N KdescribesthesupportofGBPmessages,whilehigher
1
formationsthatareomittedintheBethe-Kikuchientropy ordertermsprovideaprojectiveresolutionofK-localob-
[9,chap. 4]. servables.
1NottobeconfusedwiththeCˇechnerveofacovering,oftenusedtodefinesheafcohomology.Theyonlydifferbyabarycentricsubdivisionsothat
thetwocohomologytheoriesareisomorphic[51].
8
A Algebraictopology The functor of local densities RE∗ : P(Ω)op → Vect
is then defined by duality, mapping every a ⊆ Ω to
The functor of local observables RE : P(Ω) → Alg c maps the vector space of linear forms on REa. Its arrows con-
e a v rr e o r w y s re c g o i n on sis a t ⊆ of Ω na t t o ur t a h l e i c n o c m lu m sio u n ta s ti R ve E b alg ⊆ eb R ra Ea R , E w a. h I e t n s sist of partial integrations π ∗ a→b : REa ∗ → RE b ∗, also
calledmarginalprojections. Thisfunctorgeneratesadual
identifying each local algebra with a low dimensional cochain complex (C∗,d) which shall serve to describe
e su xt b e s n p s a io ce n o s f h R ou E l Ω d . b W e e m w a r d it e e e h˜ x a b pl : ic x i a t, (cid:55)→ and h b i ( d x e a n |b ti ) fy w h h ˜a b en w t i h th e p fo s r eu gl d o o b - a m l a p r r g o i b n a a b ls ili ( t p ie • a s ) a p ∈ Ω K ∈ ∈ ∆ Γ Ω 0 . ⊂ C 0 ∗,usedassubstitute
h foralla⊇botherwise.
b
Onemaythendefineachaincomplexoflocalobserv- Definition7. Thecochaincomplexof localdensities(C∗,d)
•
ables C• = C• (K,RE) indexed by the nerve of K as fol- is defined by C
r
∗ = L(C
r
) and the degree +1 differential d,
lows.ItsgradedcomponentsC r aredefinedfor1≤r ≤ n, whoseactiond :C∗ →C∗ isgivenby
0 1
wherendenotesthemaximallengthofastrictlyordered
chaininK,by: C r = ∏ REar . (23) dp a→b (x b ) = p b (x b )− x a| ∑ b =x b p a (x a ). (26)
a0 ⊃···⊃ar
Foreverystrictchain⃗a=a 0 ⊃ ··· ⊃a r inN r K,andevery whiled :C r ∗ →C r ∗ +1 actsby
0 ≤ j ≤ r,letusdenoteby⃗a(j) the j-faceof⃗a,obtainedby
r
removinga j . dq (x ) = ∑ (−1)jq (x )
⃗a ar+1 ⃗a(j) ar+1
Definition6. Thechaincomplexoflocalobservables(C•,δ) j=0
(27)
isdefinedby(23)andthedegree-1boundaryoperatorδ,whose +(−1)r+1 ∑ q (x )
⃗a(r+1) ar
actionδ :C 1 →C 0 isgivenby x ar|ar+1 =xar+1
∑ ∑
δφ b (x b ) = φ a→b (x b )− φ b→c (x b|c ), (24) Densitiessatisfyingdp = 0arecalledconsistent. Theconvex
a⊃b b⊃c polytopeofconsistentbeliefsisΓ = ∆ ∩Ker(d) ⊆C∗.
0 0 0
whileδ :C r+1 →C r actsby
The purpose of BP algorithms and their generaliza-
δψ (x ) = r ∑ +1 (−1)j ∑ ψ (x ). (25) tionsistoconvergetowardsconsistentbeliefsp ∈ Γ 0 .The
⃗b br
j=0 ⃗c(j)=⃗b
⃗c br |cr+1
t
n
o
on
b
-
e
l
l
i
i
n
e
e
fs
ar
p
G
∈
ib
C
bs
∗
c
w
or
i
r
l
e
l
s
t
p
h
o
u
n
s
de
b
n
e
ce
es
r
s
e
e
la
n
t
t
i
i
n
a
g
lt
p
o
o
t
t
h
e
e
nt
d
ia
y
l
n
s
a
h
m
∈
ic
C
o 0 f
0
Notethatb r =c r+1 forallj <r+1inthefirstrsumsof (25). GBP:
The classical identity a¯(i)(j) = a¯(j+1)(i) for all i < j, p (x ) = 1 e −βHa (xa ) with H (x ) = ∑ h (x ).
togetherwithlinearityandfunctorialityoftheinclusions a a Z a a b a|b
a b⊆a
RE b ⊆REa,impliesthedifferentialruleδ2 = δ◦δ =0. (28)
Onemayseeinformula(24)ananalogybetweenδand Themappingh (cid:55)→ HaboveisaninvertibleDirichletcon-
a discrete graph divergence, or the divergence operator volution [34] on C , analogous to a discrete integration
0
of geometry : theorem 3 below is a discrete yet statisti- over cones Ka ⊆ K. Although seemingly simple, this
cal version of the Gauss theorem on a manifold without mappingζ anditsinverseµsurelydeserveproperatten-
boundary. It gives a local criterion for the global equal- tion.
ityof K-localhamiltoniansandisproveninappendixA.
Thechaincomplex(C•,δ)canmoreoverbeprovenacyclic
(see [9, thm 2.17] and [35, 36]) when K is ∩-closed, the B Combinatorics
exact sequence(21) thendescribes thelinear subspace of
The combinatorial automorphisms ζ and µ we describe
K-localenergies,throughaprojectiveresolutionofthequo-
belowgeneralizewell-knownMo¨biusinversionformulason
tientC /δC .
0 1 C and C . The convolution structure in degrees r ≤ 1
0 1
Theorem 3 (Gauss). Assume K ⊆ P(Ω) is ∩-closed. Then originatesfromworksofDirichletinnumbertheory,and
thefollowingareequivalentforallh,h′ ∈C : wasthoroughlydescribedbyRota[34]ongeneralpartial
0
orders; let us also mention the interesting extension [52]
(i) theequality∑ h′ = ∑ h holdsinREΩ,
a∈K a a∈K a tomoregeneralcategories.
(ii) thereexists φ ∈C suchthath′ = h+δφ. Heuristically, ζ and µ might be viewed as combina-
1
torialmappingsfromintensivetoextensivelocalobserv-
In other words h′ and h are homologous, written h′ ∼ h or ables and reciprocally, which systematically solve what
h′ ∈ [h],ifandonlyiftheydefinethesameglobalhamiltonian. areknownasinclusion-exclusionprinciples.
9
Figure2: SchematicpicturesoftheGaussandGreeneformulas.Left:indegree0,theredcirclesrepresentregionsintheconeKabe-
ingsummedoverwhenevaluatingζ(v) a,whilebluearrowsrepresentcoboundarytermsofdKabeingsummedoverwhenevaluating
ζ(δφ) a,forv∈C 0 andφ∈C 1 .Right:indegree1,redarrowsrepresentfluxtermsinthe1-coneKab =K b a →Kbsummedbyζ(φ) a→b ,
whilebluetrianglesrepresentthecoboundary2-chainsofdKabsummedbyζ(δψ) a→b ,forφ∈C 1 andψ∈C 2 .
Definition8. Thezetatransformζ : C• → C• isthelinear andtheactionµ :C
r
→C
r
maybewrittenµ : Φ → φ,
homogeneousmorphismactingonC bylettingζ : h (cid:55)→ H,
∑
0 φ ⃗a (x ar ) = ∑ µ ar →br ··· ∑ µ a0 →b0 Φ ⃗b∩ (x ar |br ∩ ) (33)
H a (x a ) = h b (x a|b ), (29) br ⊆ar b0 ⊆a0
b⊆a
b0 ̸⊆b1
andactingonC r bylettingζ : φ (cid:55)→ Φ, where ⃗ b∩ :=b 0 ⊃ (b 0 ∩b 1 ) ⊃ ··· ⊃ (b 0 ∩···∩b r )in(33).
Φ (x ) = ∑ ··· ∑ φ (x ) (30) In (31), n is the maximal length of a strict chain in K.
⃗a ar ⃗b ar |br
Indegree0, thisyieldstheusualrecurrenceformulasfor
br ⊆ar b0 ⊆a0
b0 ̸⊆a1 µ a→b in terms of all the strict factorisations of a → b.
In practice, the matrix µ can be computed efficiently in
Notethatb ⊃ ··· ⊃b isalsoimplicitlyassumedin(30).
0 r a few steps by using any sparse tensor library. When K
describesagraph,oneforinstancehas(ζ−1)3 = 0. The
Definition 8 extends to C• the action of ζ on C
0
. The
nilpotency of ζ−1 furthermore ensures that µ = ζ−1 is
action ζ : C → C defined by (30) should not be con-
1 1 givenby(31)evenwithoutthe∩-closureassumption.The
fused with the convolution product of the incidence al-
gebraC˜ (K,Z),obtainedbyincludingdegeneratechains reader is referred to [9, thm 3.11] for the detailed proof
1
(identities)a ⊇ bin N˜ K ≃ N K⊔N K,andrestrictingto of(33),brieflysummarizedbelow.
1 0 1
integer coefficients. See for instance Rota [34] for details
Sketchofproof. The definitions of ζ and µ both exhibit a
onDirichletconvolution,and[9,chap. 3]forthemodule
formofrecursivityinthedegreer. Lettingi a : C r → C r−1
structureconsideredhere.
denote evaluation of the first region on a ∈ K, one for
Rememberweassume K ⊆ P(Ω) tobe ∩-closed2 for
instancehasonC forr ≥1:
r
theorem3tohold. Thisisalsonecessarytoobtaintheex-
plicitMo¨biusinversionformula(33)below. ζ(φ) = ∑ ζ(i φ) . (34)
a0...ar b0 a1...ar
Theorem4. TheMo¨biustransformµ = ζ−1 isgiveninall b0 ∈Ka a 1 0
degreesbyafinitesum:
TheaboveextendstoC byagreeingtoletζactasidentity
0
µ = ∑ n (−1)k(ζ−1)k (31) onC O − n 1 t : h = eo R t E h Ω er ⊇ ha R n E d b , 0 t , h a e nd M l o¨ e b tt i i u n s g tr a a 1 n = sfo ∅ rm i.e i . s K re a a 1 0 co = ve K re a0 d .
k=0 fromoperatorsν a :C r →C r−1 asµ(Φ) a0...ar = ν ar ...ν a0 Φ,
where:
Theactionofµ :C →C maybewrittenµ : H (cid:55)→ h,
0 0
h a (x a ) = b ∑ ⊆a µ a→b H b (x a|b ), (32) ν a0 (Φ) a1...ar = b0 ∑ ∈Ka a 1 0 µ a0 →b0 Φ b0 ∩(a1...ar ) (35)
2ThiscoincideswiththeregiongraphpropertyofYedidia,FreemanandWeiss[7],whendescribingthehypergraphKintheirlanguageofbipartite
regiongraphs.
10
The technical part of the proof then consists in proving Proof. NotethatinclusionsREc ⊆ RE b areimplicitin(39)
ν ◦ζ = ζ◦i , usingclassicalMo¨biusinversionformu- andbelow. Bydefinitionofζ :C →C andδ :C →C ,
a0 a0 0 0 1 0
las[9,lemma3.12].Oneconcludesthatµ(ζφ) iscom-
a0...ar (cid:18) (cid:19)
putedasν ...ν (ζφ) = ζ(i ...i φ) = φ . ∑ ∑ ∑
ar a0 ar a0 a0...ar ζ(δφ) b = φ a→c − φ c→d . (41)
Corollary5. Bethe-Kikuchicoefficientsareequivalentlyde-
c⊆b a⊃c d⊂c
finedbytheinclusion-exclusionprinciple(36)andtheexplicit Inboundfluxterms φ a→c suchthata ⊆ bcompensateall
Mo¨biusinversionformula(37): outbound flux terms φ c→d , which always satisfy c ⊆ b.
∑ c =1 forallb∈ K, (36) Thereforeonlyinboundfluxterms φ a→c suchthata ̸⊆ b
a
andc⊆bremain.
a⊇b
c b = ∑ µ a→b forallb∈ K. (37) ForeveryK 0 ,...,K r ⊆ K,letuswriteK 0 → ··· → K r
a⊇b for the subset N r K∩(K 0 ×···×K r ) of strictly ordered
Proof. Thisclassicalresultisjustζ∗(c) = 1 ⇔ c = µ∗(1), chains. We then define the following subsets of N•K to
denotingbyζ∗ andµ∗ thedualautomorphismsobtained strengthentheanalogywithgeometry. Theyaredepicted
infigure2.
byreversingthepartialorderonK. See[34].
Definition10. Foralla,binKletusdefine:
Forevery H ∈ C givenby H = ζh ⇔ h = µH,acon-
0
sequenceof(37)isthatforallxΩ ∈ EΩ,thetotalenergyis (a) Kb = {c∈ K|c⊆b} ⊆C theconebelowb,
0
exactlycomputedbytheBethe-Kikuchiapproximation:
(b) Ka = Ka∖ Kbtheinterconefromatob,
∑ h
a
(xΩ|a ) = ∑ c
b
H
b
(xΩ|b ). (38) b
a∈K b∈K (c) dKb = (cid:83) (Ka → Kb)thecoboundaryofKb
a∈K b
Including the maximal region Ω in K˜ = {Ω}∪K yields
ThenKb,Ka ⊆ N KanddKb ⊆ N K. Given⃗a = a ...a in
t s h u e re t s ot t a h l e e e n x e a rg ct y n o es f s (3 o 8 f ) t a h s e H B Ω eth = e- ζ K ( i h k ) u Ω c , h w i h en il e e r h g Ω y b = y 0 (3 e 7 n ) - . N r K and ⃗ b b = b 1 0 ...b r in N r−1 K, 1 we then recursiv 0 ely defi r ne
In contrast, writing S = ζs ∈ RK for the Mo¨bius inver- thefollowingsubsetsofN r Kforr ≥1:
b
si
y
on
pr
o
o
f
b
lo
le
c
m
al
s
e
A
ntr
a
o
n
p
d
ie
B
s,
n
th
e
e
gl
t
e
o
c
t
t
a
s
le
a
n
g
tr
lo
o
b
p
a
y
l
∑
m
c
u
b
t
S
u
b
al
co
in
m
fo
p
r
u
m
te
a
d
-
(d) Ka0...ar = K
a
a
1
0 → Ka1...ar ther-hyperconebelow⃗a,
o
ti
n
on
lo
s
o
u
p
m
y
m
hy
a
p
n
e
d
rg
s
r
Ω
ap
=
hs3
∑
. T
µ
h
Ω
i
→
sr
a
e
S
l
a
a
,
ti
w
on
h
s
i
h
ch
ip
d
b
o
e
e
tw
s
e
n
e
o
n
t
B
ca
e
n
th
c
e
e
-
l (e) dKb1...br = (cid:83) b0 ∈K Kb0b1...br thecoboundaryofKb1...br.
FollowingRota,wewanttothinkofζ asacombinato-
Kikuchi approximations and a truncated Mo¨bius inver-
rial form of spatial integration. For every r-field φ ∈ C
sionformulawasfirstrecognizedbyMoritain[5]. r
andintegrationdomainΣ ⊆ N K,letusintroducethefol-
Let us now describe the remarkable commutation re- r
lowingnotation:
lationssatisfiedbyζandδ.ReminiscentofGreeneformu-
las,theyconfirmtheintuitionofRotawhosawinMo¨bius (cid:90)
∑
inversionformulasadiscreteanalogywiththefundamen- φ = jΣ←⃗a (φ ⃗a ) (42)
Σ
taltheoremofcalculus[34]. Theyalsostrengthenthere- ⃗a∈Σ
s
u
e
s
m
ed
bl
t
e
o
nc
fi
e
n
o
d
f
h
G
a
B
r
P
m
w
on
it
i
h
c
P
fo
o
r
i
m
nc
s
ar
o
e´
n
’s
R
b
i
a
e
la
m
y
a
a
n
ge
n
a
ia
lg
n
o
m
rit
a
h
n
m
ifo
[5
ld
3
s
]
,
, wherejΣ←⃗a embedsREar intothelinearcolimit (cid:83) b∈Σ RE br
ofthelocalobservablesfunctoroverΣ,herealinearsub-
by solving local harmonic problems on subdomains and
spaceofthealgebraREΩ.
itera
T
t
h
iv
e
e
G
ly
a
u
u
p
ss
da
fo
ti
r
n
m
g
u
b
l
o
a
u
(
n
3
d
9)
ar
b
y
e
c
lo
o
w
nd
h
it
a
io
s
n
b
s
e
.
en particularly
Itfollowsthat (cid:82)
Ka0...ar
definesamapC
r
→REar,which
coincideswiththeevaluationofζ :C →C ona ...a ,
usefultofactorizetheGBPalgorithmthroughζ◦δin[8]. r r 0 r
Its simple proof will help understand the more general (cid:90)
φ = ζ(φ) . (43)
Greeneformula(44)below.
Ka0...ar
a0...ar
Proposition9(Gaussformula). Forall φ ∈C wehave:
1 TheGaussformula(39)maythenbegeneralizedtoallthe
∑ δφ c = ∑ ∑ φ a→c (39) degreesofC• bythepleasantformbelow,whichisonlya
c⊆b c⊆ba⊃c rewritingof[9,thm3.14].
a̸⊆b
Theorem6(Greeneformula). Forall φ ∈C wehave:
r
WhenΩ ∈ K,bothsidesof (39)involvetheactionofζ:
(cid:90) (cid:90)
ζ(δφ)
b
= ζ(φ)Ω→b (40)
Kb0...br
δφ =
dKb0...br
φ (44)
3Generalizingaclassicalresultontrees, weprovedthat sΩ alsovanishesonacyclicorretractablehypergraphs[9, chap. 6], althoughadeeper
topologicalunderstandingofthisunusualnotionofacyclicityindegreesn≥2iscalledfor.
11
Theorem6 is provedinappendixA. When Ω isin K, (i) energyconservation, askingthat ∑ v isfixedtoa
a∈K a
remarkthatthecoboundarydKb ofKb coincideswithK Ω givenglobalhamiltonianHΩ ∈REΩ,
b
by definition 10. More generally, dKa0...ar then coincides
with K
Ωa0...ar
andtheGreeneformula(44)takesthevery
(ii) belief consistency, asking that the local Gibbs states
p = ρβ(ζv)agreeandsatisfydp =0,i.e. p ∈ Γ .
succinctformζ◦δ = iΩ◦ζ,whereiΩ denotesevaluation 0
ofthefirstregiononΩ. If a potential h ∈ C satisfies (i), theorem 3 implies that
0
Letusfinallyexpresstheconjugateofδbythegraded there should always exist a heat flux φ ∈ C such that
1
automorphismζ intermsofBethe-Kikuchinumbers. The v = h+δφ, in other words v ∈ [h] is homologous to h.
followingpropositionwillyieldaconciseandefficientex- This naturally led us to generalize GBP update rules by
pressionfortheBethe-Kikuchidiffusionalgorithminsec- continuous-timetransportequationsonC [8,9,10]:
0
tionV.
dv
= δΦ(v). (47)
Theorem7. Letδˇ= ζ◦δ◦µandΦ ∈C suchthatΦ = ζϕ. dt
r
Thenforalla 1 ...a r inN r−1 K,onehas: Definition11. GivenafluxfunctionalΦ : C → C andan
0 1
(cid:90) inversetemperature β ∈ R,wecallisothermaldiffusionthe
δˇΦ a1...ar =
dKa1...ar
ϕ = Φˇ Ωa1...ar (45) vectorfieldX
Φ
β :C
0
→C
0
definedby:
where Φˇ Ωa1...ar denotes a Bethe-Kikuchi approximation of the X Φ β(v) = β 1 δΦ(βv) (48)
totalinboundfluxtoKa1...ar,givenby
The analytic submanifold Mβ ⊆ C defined below
Φˇ Ωa1...ar = ∑ c a0 Φ a0 (a0 ∩a1 )...(a0 ∩ar ) . (46) should be stationary under (47) for di 0 ffusion to solve
a0 ̸⊆a1 Bethe-Kikuchioptimisationproblems,asthebeliefconsis-
tencyconstraint(ii)imposesrestrictionsonthefluxfunc-
Ω ∈ Re K m , a a r s k in th t a h t i ( s 4 c 6 a ) s r e ed cΩ uce = st 1 o a Φˇ n Ω d a c 1 a ...a = r = 0 Φ fo Ω r a a 1 l .. l .a a r w ̸= h Ω en . t N io β na ⊆ lsΦ M : β C 0 de → scr C ib 1 e s s ui s t t e r d on fo g r e d r i c ff o u n s s i t o r n a . in T t h s, e b su y b a m ss a u n m ifo in ld g
Theproofoftheorem7iscarriedinappendixA.
Gibbsdensitiesnormalizedtoacommonmass.
Definition12. Denotebye−V ∈ C∗ theunnormalizedGibbs
V. BELIEFDIFFUSIONS 0
densitiesofV ∈ C . Foreveryinversetemperature β > 0,we
0
callconsistentmanifoldthesubspaceNβ ⊆C definedby
In this section, we describe dynamical equations that 0
solve Bethe-Kikuchi variational principles. Their com- Nβ = {v ∈C | e −βζv ∈Ker(d)} (49)
0
monstructurewillshedlightonthecorrespondencetheo-
remsA,BandCproveninsectionVI.Theirinformalstate- andcallprojectivelyconsistentmanifoldthelargerspace:
mentisthatsolutionstofreeenergyprinciples(problems
Mβ = {v ∈C |ρβ(ζv) ∈ Γ } (50)
BandC)canbothbefoundbyconservativeorisothermal 0 0
transportequationsonC 0 whichwedescribedin[10]. In WewriteN = N1andM = M1.
contrast, solving the max-entropy principle (problem A)
Note that Mβ only consists of a thickening of Nβ by
will require to let temperature vary until equilibrium, so
theactionofadditiveconstants,whichspanasubcomplex
as to satisfy the mean energy constraint. This calls for a
newkindofadiabaticdiffusionequationsonC ,satisfying
R• ⊆ C•. AlsoremarkthatNβ = β−1·N1 isascalingof
0 N forall β > 0,andMβ = β−1·M1 aswell. Itishence
energyconservationuptoscalingsonly.
sufficienttostudyisothermaldiffusionsattemperature1,
Tomakethemostoftheavailablelinearstructureson
(C•,δ,ζ),evolutionisfirstdescribedeitheratthelevelof see appendix B for more details on the consistent mani-
potentials v ∈ C or at the level of local hamiltonians folds.
0
V = ζv ∈ C 0 . We conclude this section by translating Definition13. WesaythatafluxfunctionalΦ :C 0 →C 1 is
thedynamiconbeliefsq = ρ(V) ∈ ∆ ,foraclearercom-
0 (a) consistentatβ >0if:
parison with GBP. Bethe-Kikuchi diffusion will not only
differfromGBPbyanarbitrarychoiceoftimestepε > 0, v ∈ Nβ ⇒ Φ(v) =0 (51)
butalsofromadegree-1Mo¨biusinversiononmessages.
(b) faithfulatβ >0ifmoreover:
A Isothermaldiffusion
δΦ(v) =0⇔ v ∈ Nβ. (52)
The purpose of isothermal diffusion is to solve the local
freeenergyprinciplesBandCbyenforcingtwodifferent We say that Φ is projectively consistent (resp. faithful) if (a)
typesofconstraintssimultaneouslyonv ∈C : (resp. (b))holdswhenMβ replacesNβ.
0
12
Figure3: Normofthefreeenergygradient||DV||over15timeunitsforBethe-Kikuchidiffusions(blue)andGBPdiffusions(red),
fordifferentvaluesofthetimestepparameterλ.Forλ=1/4(solidline),GBPdiffusionsometimesconvergesinspiteofoscillations;
forλ=1/2(dashedline),GBPdiffusionalmostneverconverges;andforλ=1(dottedline)GBPdiffusionexplodesevenfaster. On
theotherhand,λhasverylittleeffectonthefastconvergenceofBethe-Kikuchidiffusion. ThehypergraphKisthe2-horn–joinof
three2-simplices{(012),(013),(023)}–andcoefficientsoftheinitialpotentialh∈C aresampledfromnormalgaussians.
0
LetusnowconstructfluxfunctionalsΦ :C →C ad- TheBethe-KikuchidiffusionfluxΦ = −µ◦D◦ζ adds
0 1 BK
missiblefordiffusion. Althoughconsistencymaybeeas- a degree-1 Mo¨bius inversion (33) of GBP messages. The
ilyenforcedviafactorizationthroughthefollowingoper- isothermalvectorfieldX = δΦ isthencomputedby:
BK BK
ator, as the next proposition shows, proving faithfulness
remainsamoresubtlematter. ζ
X : C C
BK 0 0
Definition 14. (Free energy gradient) Let D : C 0 → C 1 de- δ −D (56)
notethesmoothfunctionaldefinedby:
C C
DV a→b (x b ) =V b (x b )+ln ∑ e −Va (xa ) (53) 1 µ 1
x a|b =x b Theconjugatecodifferentialδˇ= ζ◦δ◦µisthusoccurring
Proposition15. ForallV ∈C ,letq =e−V ∈C∗. Then in(56),andonemaysubstitutetheresultoftheorem7to
0 0
arriveataveryconciseandefficientexpressionofthecon-
dq =0 ⇔ DV =0. (54) jugatevectorfieldζ◦X ◦µ,governingtheevolutionof
BK
localhamiltonians.
ItfollowsthatthefluxfunctionalΦ = f ◦D◦ζ isconsistent
f From the perspective of local hamiltonians V = ζv,
foranysmooth f :C →C .
1 1 firstremarkthatinbothcasestheevolutionv˙ = δϕunder
Proof. Foralla⊃binK,itisclearthate−V b = π ∗ a→b(e−Va) diffusionreadsV˙ = ζ(δϕ),convenientlycomputedbythe
ifandonlyifV
b
= −lnπ
∗
a→b(e−Va). Gaussformula(39)onaconeKb:
In section V.C, we recover the discrete dynamic of dV (cid:90)
GBP by using the flux functional Φ GBP = −D◦ζ. The dt b = ζ(δϕ) b = dKb ϕ (57)
smooth dynamic on potentials integrates the vector field
X = δΦ onC ,computedbythediagram: WearguethattheGBPfluxΦ = −D(ζv) = −DVbelongs
GBP GBP 0
tothe”extensive”side,andshouldnotbeintegratedasis
X : C ζ C onthecoboundaryofKb. Infact,ifonewereabletocom-
GBP 0 0
(55)
pute the global free energy gradient DVΩ→b = −Φ Ω→b
δ −D forallb ∈ K,theeffectivehamiltoniansV b ′ = V b +Φ Ω→b
C wouldyieldthesoughtforGibbsstatemarginalsexactly.
1
Using the Bethe-Kikuchi flux ϕ = µΦ thus allows to
ThefluxfunctionalΦ GBP isfaithful(atβ =1). Seepropo- sum only ”intensive” flux terms entering Kb. Their in-
sition 30 in appendix for a proof, involving duality and tegral over dKb yields the Bethe-Kikuchi approximation
monotonicity arguments which we already gave in [8] Φˇ Ω→b of the global free energy gradient term Φ Ω→b by
and [9]. AlthoughseeminglyoptimalwhenKisagraph, theorem7:
we argued in [9, chap. 5] that the heat flux Φ intro-
GBP
d
ex
u
p
c
l
e
a
s
in
re
t
d
h
u
e
n
e
d
x
a
p
n
lo
c
s
ie
io
s
n
on
of
h
n
ig
o
h
rm
er
a
-o
li
r
z
d
a
e
ti
r
o
h
n
y
c
p
o
e
n
r
s
g
t
r
a
a
n
p
ts
h
.
s,which d
d
V
t
b = (cid:90)
dKb
ϕ = Φˇ Ω→b =
a
∑
̸⊆b
c a Φ a→a∩b . (58)
13
Substituting−DV forΦyields,aftersmallcombinatorial ΨU(v¯) = (cid:2) U −⟨ρ(ζv¯),h⟩ (cid:3) ·v¯ (62)
rearrangements,theexplicitformula[9,thm5.33]:
ItfollowsthatYΦ U = X
Φ
1 +ΨU relatesisothermalandadiabatic
dV b (x b ) = ∑ c (cid:20) −ln ∑ e −Va (xa ) (cid:21) −V (x ) (59) diffusions.
dt a b b Thedependencyinh ∈ C isimplicitin(61)and(62).
a∈K =x x
b
a|
|
a
a
∩
∩
b
b
It cannot be absorbed in the 0 definition of ΨU as v¯ ∈ C
0
is unaware of the reference energy scale, and the pair
In[10],weempiricallyshowedthattheBethe-Kikuchidif- (U,h) ∈ R×C is in fact necessary to define the mean
0
fusion flux improves convergence and relaxes the need energy constraint. One may write ΨU,h and Y Φ U,h when
to normalize beliefs at each step. Figure 3 also shows
thedependencyin h oughttobemadeexplicit,although
thatdiscreteintegratorsofX quicklyconvergeforlarge
BK hcanbeassumedfixedforpresentpurposes.
time steps λ where integrators of X require a value
GBP Asintheisothermalcase,itisnecessarytorestrictthe
of λ < 1/4 on the 2-horn K (the simplest 2-complex for flux functional Φ to enforce the belief consistency con-
which GBP is not exact). The flux Φ may me proven
BK straint (ii) at equilbrium. The same flux functionals may
faithfulatleastinaneighbourhoodofN,seeproposition
beusedforbothisothermalandadiabaticdiffusions.
31inappendix.
Proposition 17. Assume Φ : C → C is faithful. Then for
0 1
B Adiabaticdiffusion
allU ∈R,theadiabaticvectorfieldYΦ U isstationaryonv¯ ∈C
0
ifandonlyif p = ρ(ζv¯)isconsistentand⟨p,h⟩ = U.
In order to solve the localised max-entropy principle A,
Proof. Note that the r.h.s. of (60) naturally decomposes
one needs to let temperature vary so as to enforce the
into the direct sum δC ⊕Rv¯(t) for all t ∈ R, whenever
mean energy constraint. Theorem A will describe solu- 1
tions as dimensionless potentials v¯ ∈ C , satisfying both
the initial potential h = v¯(0) is not a boundary of C• (in
0 thatcase,totalandmeanenergiesvanish). Itfollowsthat
theconsistencyconstraint(ii)at β = 1andthefollowing
v¯(t) is always homologous to a multiple of h, and that
conservationcontraintreplacing(i):
∑
a∈K
v¯
a
(t)isalwaysequaltoamultipleof HΩ = ∑
a∈K
h
a
(i’) projective energy conservation, asking that ∑ v¯ is bytheorem3,andthatv¯(t)satisfiestheprojectiveenergy
a∈K a
fixedtoagivenlineRHΩ ⊆REΩ. conservationconstraint(i’). WhenΦisprojectivelyfaith-
ful, the direct sum decomposition furthermore implies
Fixareferencepotentialh ∈C 0 andletHΩ = ∑ a∈K h a . By thatadiabaticdiffusionisstationaryonv ∈C 0 ifandonly
theorem3, constraint(i’)isequivalenttotheexistenceof if local Gibbs states p = ρ(ζv) satisfy both the mean en-
β ∈ R and φ ∈ C 1 such that v¯ = βh+δφ. We therefore ergyconstraint⟨p,v⟩ = U andthebeliefconsistencycon-
equivalentlyrewrite(i’)asv¯ ∈ R[h] = Rh+δC 1 . Adding straint(ii),dp =0.
aradialsourcetermto(47),wemayenforceboth(i’)and
themeanenergyconstraintU =E[HΩ]asfollows. The inverse temperature β = T−1 of the system will
Given an energy value U ∈ R and a flux functional be defined at equilibrium as Lagrange multiplier of the
Φ : C → C ,wecalladiabaticdiffusionanordinarydiffer- meanenergyconstraint,bycriticalityofentropy(seee.g.
0 1
entialequationonC oftheform [1, 2] and section VI below). As we shall see, the Bethe-
0
Kikuchi entropy may have multiple critical points, and
dv¯ = δΦ(v¯)+ (cid:0) U −⟨p,h⟩ (cid:1) ·v¯ thereforemultiplevaluesoftemperaturemaycoexistata
dt (60) givenvalueofinternalenergy.
where p = ρ(ζv¯).
C Dynamiconbeliefs
It might seem paradoxical that the adiabatic diffusion in- Let us now describe the dynamic on beliefs q ∈ ∆ in-
0
cludes what looks like an energy source term, when
ducedbyisothermalandadiabaticdiffusionsonC . They
0
isothermal diffusion does not. The dynamical variable
both regularize and generalize the GBP algorithm of [7].
v¯ ∈ C here describes a dimensionless potential v¯ = βv
0 Inthefollowing, wedenoteby R• ⊆ C• thesubcomplex
givenv ∈C ,measuringenergiesdividedbyanunknown
0 spannedbylocalconstants.
temperature scale. The source term ΨU(v¯) ∈ Rv¯ below
Startingfromapotentialh ∈ C ,beliefsarerecovered
0
thereforedescribesavariationintemperatureratherthan through a Gibbs state map ρβ◦ζ for some β ∈ R +. The
avariationinenergy.
affine subspace [h] = h+δC satisfying (i) is therefore
1
Definition 16. Given a flux functional Φ : C → C , a po- mappedtoasmoothsubmanifoldof∆ 0 ,
0 1
tential h ∈ C 0 and a mean energy U ∈ R, we call adiabatic B := ρβ(cid:0) ζ[h] (cid:1) ⊂ ∆ . (63)
diffusionthevectorfieldYΦ U :C
0
→C
0
definedby: βh 0
On the other hand, the set of consistent beliefs Γ ⊆ ∆
0 0
YΦ U(v¯) = δΦ(v¯)+ΨU(v¯) (61) satisfying(ii)isaconvexpolytopeofC
0
∗(whosepreimage
14
underρβ◦ζ isMβ). Conservation(i)andconsistency(ii) m(t) = e−Φ GBP (v) = e−DV of (65) is equal to the geomet-
constraints thus describe the intersection B βh ∩Γ 0 when ricincrementofmessages M(t+1)/M(t) computedbythe
viewedin∆ 0 . Thenon-linearityhasshiftedfrom(ii)to(i) GBP update rule (7), so that the two algorithms coincide
inthispicture. for λ = 1. The parameter λ otherwise appears as expo-
In order to recover well-defined dynamical systems nentofmessagesin(64),leaving(65)unchanged.
on ∆ 0 , trajectories of potentials v ∈ C 0 under diffusion Becauseoneisusuallyonlyinterestedinthelong-term
should be assumed to consistently project on the quo- behaviour of diffusion and its convergence to stationary
tient C 0 /R 0 , i.e. to not depend on the addition of lo- states, the parameter λ usually does not have to be in-
cal energy constants λ ∈ R 0 ≃ RK. Classes of poten- finitesimal. Figure 4 shows the effect of varying λ on a
tialsv+R 0 areindeedinone-to-onecorrespondencewith 50x50Isinglattice. Choosingλ ≃1/2insteadof1already
classes of local hamiltonians ζ(v+R 0 ) = V+R 0 , them- greatly improves convergence [10], making belief diffu-
selvesinone-to-onecorrespondencewiththelocalGibbs sions suitable for a wider class of initial conditions than
statesq = ρβ(V) = 1 e−βV. BothGBPandBethe-Kikuchi plain GBP. For low temperatures (high β), numerical in-
Z
diffusionsnaturallydefineadynamiconC /R ≃ ∆ . stabilitiesoccurthatarenotescapedbyvaluesofλ ≃0.1,
0 0 0
asqreachesdistancesoforder10−5fromtheboundaryof
∆ . Perhaps higher-order integration schemes would be
0
Convergentruns beneficialinthisregime.
On hypergraphs, the Bethe-Kikuchi diffusion flux
100
90 Φ BK = µ◦Φ GBP alsobehavesbetterthanΦ GBP (theevo-
80 lutionofbeliefsisotherwiseidenticalwhenKisagraph).
70
Integrating(59)withatimestepλ ≥ 0yieldsthefollow-
60
% 50 ingdynamicon∆ 0 :
40
2
3
0
0
q (t+λ) ∝ q (t) · ∏
(cid:104)
m (t)
(cid:105)λca
(66)
b b a→a∩b
10 a∈K
0
1 2 dt=1 in 3 ver d s t e =0 te .5 mperat d 4 u t= re 0.1 5 6 m a (t → ) c = π ∗ a→c ( ( t) q a (t) ) (67)
q
c
Note that Mo¨bius inversion of messages allows for con-
Figure4: Effectofthetimestepparameterλonconvergenceof vergentunnormalisedalgorithms. Replacingthepropor-
diffusionsona50x50Isinglattice. Forλ = 1(blue),werecover tionalitysign∝of(66)byanequalityassignment,theal-
theGBPalgorithm. Resultsareverysimilarfor λ = 1/2(red) gorithmwillconvergetounormalizeddensitiesq whose
a
and λ = 1/10 (green). Coefficients of the 100 initial batched masses π
∗
a→∅ (q
a
) are all equal to q∅, the empty region
hamiltonians H ∈ C 0 are sampled from N(0,1). Note that takingcareofharmonizingnormalizationconstants.
1−tanh(β)estimatesthetypicaldistancetotheboundaryof∆
0 Adiabatic diffusions, on the other hand, only enforce
and1−tanh(6)≃10−5bringsnumericalinstabilities.
theprojectiveenergyconstraint(i’),soastofixaninternal
energy value U ∈ R. Energy scales acting as exponents
in the multiplicative Lie group ∆ , and the simple Eu-
0
LetusfirstrelatetheGBPequations(6)and(7)toadis- ler scheme of (60) with the Bethe-Kikuchi diffusion flux
crete integrator of the GBP diffusion flux X GBP , defined yields: Φ BK yields
by (55). The isothermal vector field X = δΦ can
GBP GBP
be approximately integrated by the simple Euler scheme q (t+λ) = 1 (cid:104) q (t) (cid:105)1+λψ · ∏ (cid:104) m (t) (cid:105)λca
v(t+λ) = (1+λX GBP )·v(t),whichyieldsforq = ρ(ζv) b Z b b a∈K a→a∩b (68)
whereψ = U −⟨q (t) ,h⟩.
q b (t+λ) (x b ) ∝ q b (t) (x b )· ∏(cid:2) m a (t → ) c (x b|c ) (cid:3)λ , (64)
a⊇c Themessagesremaingivenby(67),theystillcomputethe
a̸⊆b exponentialofthefreeenergygradiente−DV¯ forV¯ = ζv¯.
From a technical perspective, working with beliefs
∑
q
(t)
(x ) (bounded between 0 and 1) may help avoiding the nu-
a a
m a
(t
→
)
c (x c ) =
x a|c =
q
x
(t
c
)
(x )
(65)
m
fu
e
n
r
c
i
t
c
i
a
o
l
n
i
s
n
.
s
H
ta
o
b
w
ili
e
t
v
ie
e
s
r,
o
o
n
p
e
ti
m
m
a
iz
y
in
e
g
nc
th
ou
e
n
p
t
r
e
o
r
d
w
uc
it
t
h
of
lo
m
g
e
s
s
u
s
m
a
e
g
x
e
p
s
c c
computed by the exponential Gauss formula (64) is not
ExponentialversionsoftheGaussformula(39)shouldbe straightforward. Workingwithpotentialsandhamiltoni-
recognizedin(6)asin(64).Remarkthatthemessageterm ansinsteadallowstousesparsematrix-vectorproductsto
15
effectivelyparallelizediffusiononGPU,asimplemented Another distinction emerges from the local structure
inthetoposlibrary. of Bethe-Kikuchi approximations. It will be reflected in
thedualitybetweenbeliefs p ∈ ∆ andpotentialsv ∈ C ,
0 0
and between the differential d : C∗ → C∗ and the cod-
VI. MESSAGE-PASSINGEQUILIBRIA 0 1
ifferential δ : C → C . Bethe-Kikuchi principles thus
1 0
LetusnowshowthatproblemsA,BandCareallequiva- become reminiscent of harmonic problems, yet the non-
lenttosolvingbothlocalconsistencyconstraintsandenergy linear mapping ρ◦ζ : C 0 → ∆ 0 will allow for singular
conservationconstraints. Inotherwords,givenareference intersectionsofthetwoconstraintsurfaces,andmultiple
potentialh ∈C ,allthreeproblemsareequivalenttofind- numbersofstationarystates(seefigure5).
0
ingv ∈ [h]∩Mβ. In the statements of theorems A, B and C below, we
Itwill bemoreinformative tostudy [h]∩Nβ, resolv- assume a projectively faithful flux functional Φ : C 0 → C 1
ing the degeneracy of additive constants acting on Mβ. (see definition 13) is chosen. The faithful flux Φ GBP will
Itmayhappenthatthisintersectioniseverywheretrans-
fixNβ insteadofMβ,butenforcingbeliefnormalization
verse, asisthecaseonacyclicorretractablehypergraphs, ateachstepwouldturnitintoaprojectivelyfaithfulflux.
wheretruemarginalsmaybecomputedinafinitenumber Wesparethereaderwiththesetechnicaldetails, covered
of steps [9, thm. 6.26]. In general, theorem 8 shows that inmoredetailsin[9,chap. 5].
thesingularsubspaceS¯ ⊆ N wherebothconstraintsur- ProofsarefoundinappendixD.Recallthatnotations
1
faces are tangent can be described by polynomial equa- [h] = h+δC 1 and [Rh] = Rh+δC 1 stand for (lines of)
tions on the convex polytope Γ ⊆ ∆ . This important homologyclasses.
0 0
step towards a more systematic study of GBP equilibria TheoremA. LetU ∈ Randh ∈ C . Denotingby AU ⊆ C∗
0 0
suggeststheexistenceofphasetransitions,betweenboth the affine hyperplane where ⟨p,h⟩ = U, problem A is equiva-
different regimes of diffusion and different free energy
lentto:
landscapesinBethe-Kikuchiapproximations.
∂Sˇ(p)(cid:12)
(cid:12) =0
∂p (cid:12) Tp (Γ 0 ∩AU) (69)
⇔ p = ρ1(ζv¯) ∈ A U with v¯ ∈ [Rh]∩M1
In particular, critical potentials v¯ ∈ C coincide with fixed
0
pointsoftheadiabaticdiffusionYΦ U restrictedto[Rh].
Notethatanyv ∈ [h]∩Mβ yieldsareducedpotential
v¯ = βv lying in [βh]∩M1 by lemma 28, and therefore a
solutiontoproblemAofenergyU = ⟨ρ(ζv¯),h⟩.
TheformoftheoremAispreferredbecauseitinvolves
a simpler intersection problem in C : between the linear
0
subspace [Rh] = Rh+δC , the consistent manifold M1
1
that does not depend on β, and the non-linear mean en-
ergyconstraint⟨ρ1(ζv¯),h⟩ = U. Thepossiblemultiplicity
ofsolutionsforagivenenergyconstraintU mayoccurfor
Figure5: CuspidalsingularityoftheBethe-Kikuchivariational differentvaluesoftheLagrangemultiplierβ.
freeenergy(reddot). ThestationarymanifoldN istangentto TheoremB. Letβ >0,h ∈C . ProblemBisequivalentto:
0
thespaceofgaugetransformationsδC onthesingularsubspace
1
S 1 (redline).Atthecusp,S 1 istangenttobothN andδC 1 .
∂Fˇβ(p,H)(cid:12)
(cid:12) =0
∂p (cid:12) Tp Γ 0 (70)
⇔ p = ρβ(ζv)withv ∈ [h]∩Mβ
A Correspondencetheorems
In particular, critical potentials v ∈ C coincide with fixed
0
ThedifferencebetweenproblemsA,BandCmostlycon-
pointsoftheisothermaldiffusionX β restrictedto[h].
sists in which sets of variables are viewed as constraints Φ
and which are viewed as degrees of freedom. The max- Theorem B rigorously states the correspondence of
entropy principle A treats β as a free variable and U as Yedidia,FreemanandWeiss[7]betweenstationarystates
a constraint, while free energy principles B and C treat of GBP and critical points of the CVM, which general-
β as a constraint and U as a free variable. Solutions to izedthewell-knowncorrespondenceongraphs[11]. The
problemsA,BandCstillshareacommongeometricde- statementabovemakesthenotionofstationarystatemore
scription,involvingintersectionsoftheform[h]∩Mβfor precise and our rigorous proof avoids any division by
agivenpotentialh ∈C . Bethe-Kikuchicoefficientsthankstolemma19.
0
16
BeforeformulatingthestatementoftheoremC,letus wewrite δψ+λ ∈ δC +Λ forthegeneralexpressionof
1
denote by c : C → C the multiplication by Bethe- differentialsatacriticalpoint. ThespaceΛonlydepends
0 0
Kikuchicoefficients.Onemayshowthatc =0whenever ontheotherconstraintsathand: Λ = R forproblemA,
b 0
bisnotanintersectionofmaximalregionsa ,...,a ∈ K. andΛ =Rh+R forproblemB(additiveconstantsinR
1 n 0 0
However,assumingthatKisthe∩-closureofasetofmax- aredualtonormalizationconstraints,and h ∈ C isdual
0
imalregionsdoesnotalwaysimplytheinvertibilityof c. totheinternalenergyconstraint⟨p,h⟩ = U).
Whencisnotinvertible,problemCwillexhibitanaffine TheformofBethe-Kikuchifunctionalsnaturallyleads
degeneracyalongKer(c). to express ∂ Sˇ and ∂ Fˇ as cV for some V ∈ C , through
p p 0
standard computations of partial derivatives. Writing
Definition 18. Let us call M + β = {v+b|v ∈ Mβ,b ∈ V = ζv, the remaining difficulty consists in showing
Ker(cζ)} ⊆ C 0 theweaklyconsistentmanifold. Inparticu- that cV = δψ+λ is equivalent to v = δφ+λ for some
lar,M + β = Mβ whencisinvertible. φ ∈ C 1 . This difficult step is greatly eased by lemma 19,
whichstatesthat[v] = [µV] = [cV]coincideashomology
Alinearretractionrβ : Mβ → Mβ willbedefinedby classes.
+
equation (126) in the proof of theorem C below. It maps Incontrast,theoremCworksunderenergyconstraints
solutionsofproblemContothoseofB.Fromtheperspec- onthepotentialw ∈ [h] ⊆C ,yieldinglocalhamiltonians
0
tiveofbeliefs,thisretractionsimplyconsistsoffillingthe V = ζw,buttheconsistencyof p = ρ(V)isnotenforced
blankswiththepartialintegrationfunctor. as a constraint. The linear form ∂ V Fˇ will be written cp,
whichliesinKer(dζ∗) = Im(ζδ)⊥ whencritical,because
TheoremC. Letβ >0,h ∈C 0 ,problemCisequivalentto: oftheenergyconservationconstraintonV ∈ ζ(h+δC ).
1
Thisonlyimpliesq = ζ∗(cp) ∈ Ker(d)ingeneral,yetwe
∂Fˇβ(V)(cid:12)
(cid:12) =0 will conclude that p and q must agree on all the regions
∂V (cid:12) TVζ[h] (71) b where c
b
̸= 0, so that the affine degeneracy of solu-
⇔ V = ζwwithw ∈ [h]∩Mβ tions(absentinAandB)iscompletelysupportedbythe
+
non-maximalregionsthatcancelc. Theconsistentbeliefs
Theweaklyconsistentpotentialsw ∈ [h]∩Mβ canbeunivo- q ∈ Γ 0 thensolveB.
+
callymappedonto[h]∩Mβ byaretractionrβ. Theycoincide
B Singularities
withfixedpointsoftheisothermaldiffusionX β restrictedto[h]
Φ
whencisinvertible,andwithitspreimageunderrβ otherwise. Let us say that v ∈ N is singular if T v N ∩δC 1 ̸= 0, and
callsingulardegreeofvthenumber
To prove theorems A, B and C we will need the fol-
lowinglemma,whichisrathersubtleinspiteofitsappar- cork v =dim(T v N ∩δC 1 ). (72)
entsimplicity(see[9,Section4.3.3]fordetailedformulas).
When p = ρ(ζv),accordingto(63)cork coincideswith
Thelemmastatesthatmultiplicationbycisequivalentto v
Mo¨biusinversionuptoaboundaryterminC 0 . cork p =dim(Ker(d)∩T p B v ). (73)
Lemma19. ThereexistsalinearfluxmapΨ : C → C such
0 1 Both numbers measure the singularity of the canonical
thatc−µ = δΨ.
projection N → C /δC onto homology classes, a sub-
0 1
mersionifandonlyifcork =0everywhereonN.
Proofoflemma19. Theorem 3 faithfully characterizes the v
homology classes [h] of C 0 /δC 1 by their global hamilto- Definition20(Singularsets). Forallk ∈N,let
nian HΩ = ∑
a
h
a
when K is ∩-closed (see [9, cor. 2.14]).
ThereforeexactnessofBethe-Kikuchienergy(38),implies (a) S k := {cork v = k} ⊆ N,
that h = µH and cH arealwayshomologous, sothatthe
(b) Σ := {cork = k} ⊆ Γ ,
imageofc−µiscontainedinδC .Onemaythereforecon- k p 0
1
structanarbitrary Ψ : C 0 → C 1 suchthat c−µ = δΨ by denotethesingularstratificationsofN andΓ 0 respectively.
linearity. ThefluxvaluestakenbyΨareonlyconstrained
in C /δC , as Ker(δ) and Im(δ) coincide on positive de- Figure5depictsasituationwhereS 1 isnon-empty.We
1 2
referthereadertoThom[54]andBoardman[55]formore
greesi.e. C• isacyclic[9,thm. 2.17].
detailsonsingularitytheory.
TheproofsoftheoremsAandB(detailedinappendix) WeshowthatthesingularsetsΣkaredefinedbypoly-
may then be summarized as follows. Under consistency nomial equations in Γ . Singularities will therefore be
0
constraints on a critical belief p ∈ Γ ⊆ C∗, the adjunc- located on the completion Σ¯1 of a smooth hypersurface
0 0
tion d = δ∗ first implies that the variations cancel on Σ1 ⊆ Γ ,whichmaybepossiblyempty. Inparticularthe
0
Ker(d) =Im(δ)⊥.AslinearformsonC∗,∂ Sˇand∂ Fˇ can intersections N ∩[v] and Γ ∩B are almost everywhere
0 p p 0 v
thereforelieinδC throughLagrangemultipliersδψ,and transverse.
1
17
Inwhatfollows,wedenotebyR[∆ 0 ](resp. R(∆ 0 ))the the sense that the restriction of η pa to RE b ⊆ REa coin-
algebra of polynomials (resp. rational functions) on the cideswithη foralla⊇bbyconsistencyof p. Thedirect
p
b
span of ∆
0
⊆ C
0
∗, by R[λ] the algebra of polynomials in sum of the η
pa
defines a scalar product η
p
on C•, which
the real variable λ. For a vector space E, the Lie algebra wedenoteby⟨−,−⟩ .
p
ofitsendomorphismsisdenotedgl(E). DenotebyEa→btheorthogonalprojectionREa →RE
b
p
with respect to η , for all a ⊇ b. This is the conditional
Theorem8. Thereexistsapolynomialχ ∈ R[∆ ]⊗R[λ],of pa
0 expectation operator on observables, adjoint of the em-
degreedim(δC 1 )inλ ∈R,suchthatforall p ∈ Γ 0 : beddingsRE b ⊆REa. Defining∇ p :C 0 →C 1 by(77):
p ∈ Σk ⇔ χ p (λ)hasroot1ofmultiplicityk (74) ∇ p (V ′) a→b =V b ′−Ea p →b[V a ′], (78)
Weshallprovetheorem8bycomputingthecorankof propositions15and22implythatforall p = ρ(ζv) ∈ Γ 0 ,
linearizeddiffusionrestrictedtoδC 1 . T v N =Ker(∇ p ◦ζ) =Ker(T v (D◦ζ)). (79)
Assumegivenafaithfulfluxfunctional Φ : C → C ,
satisfying the axioms of definition 13, for instanc 0 e Φ 1 . Therestrictionof η p totangentfibersT v N for p = ρ(ζv)
The isothermal diffusion XΦ = δΦ then only fixes GB N P , moreovermakesN aRiemannianmanifold.
defined by Φ = 0, while evolution remains parallel to Itisworthmentioningthat∇ p istheadjointofδforthe
δC
1
. Linearizing XΦ in the neighbourhood of v ∈ N
metricη
p
onC•,andthereforeextendstoadegree1differ-
w th h u i s c y h i s e t l a d b s i a li n ze e s n δ d C om b o y rp co h n is s m tru T c v t X io Φ n. o T n h C e 0 , si o n f g k u e l r a n r e d l e T g v r N ee , e th n e ti p al ro o j n ec C ti • on [9 s , E pr a p o → p b 5 w .8 it ] h . T th h e is in fo c l l l u o s w io s n f s ro j a m ←b a , d a ju s n id c e ti n o t n ify o - f
of v therefore comp
1
utes the corank of T
v
XΦ restricted to
ingC• withitsdualC
•
∗ throughη
p
,theoperator∇
p
then
representsd. However,notethatδC istheorthogonalof
boundaries, 1
Ker(∇ ) = ζ(T N)butnotofKer(∇ ◦ζ) =T N,which
p v p v
cork v = cork(T v XΦ| δC1 ). (75) mayintersectδC 1 .
Proposition23. Forallϕ ∈C andall p ∈ Γ ,onehas:
By faithfulness of Φ = −D ◦ζ, one may explicitly 1 0
GBP (cid:90) (cid:20)(cid:90) (cid:21)
computecork v viaminorsofthesparsematrix ∇ p ζ(δϕ) a→b = ϕ − Ea p →b ϕ
dKb dKa
T v X GBP = δ◦(T ζv D)◦ζ. (76) (cid:90) (cid:20)(cid:90) (cid:21) (80)
= ϕ − Ea→b ϕ
Letting p = ρ(ζv), theorem 8 will easily follow from Kab p Ka Ω→K
b
a
lemma 21, stating that cork p = cork v , and from propo- Proof. SubstitutingtheGaussformula(39)into(78)yields
sition22,whichimpliesthatT v X GBP hasrationalfunction thefirstline. WemaythenpartitionthecoboundarydKb
coefficientsin p. by source as K Ω → Kb = (K Ω⊔Ka) → Kb, and dKa by
b a b
Lemma21. If p = ρ(ζv) ∈ Γ 0 thencork p = cork v . t (cid:82) arge ϕ t a ∈ s K R a Ω E b → is fi K x a ed = b K y a Ω Ea → →b ( t K o b a r ⊔ em K o b v ). e t A h l e so re n d o u t n e d th an at t
dKb p
Theproofsoflemma21andtheorem8aredelayedto terms and obtain the second line (see definition 10 for
theendofthissubsection. Takingacloserlookatthelin- notations : K Ω here denotes the complement of Ka, and
a
earizedstructureofT v N beforehandwillyieldaninter- Kab = K Ω → Kb).
a
esting description of singularities by conservation equa-
tions on 1-fields ϕ ∈ C (proposition 23) which we shall Proofoftheorem8. ForallV ∈C 0 ,coefficientsofthelinear
1
use to give an explicit expression for χ on binary graphs mapT V D = ∇ p arerationalfunctionsofp = ρ(V)in(77).
inthenextsubsection.
ThecoefficientsofEa
p
→bareindeedgivenaccordingtothe
Bayesrule,foralla⊇binK,as
Proposition22. ForallV ∈ C ,themapT D : C → C is
0 V 0 1 p (x )
expressedintermsof p = ρ(V)by p a (x a |x b ) = ∑ a p a (y ) ∈ R(∆ 0 ). (81)
a a
[T V D·V ′] a→b (x b ) =V b ′(x b )−E pa [V a ′|x b ] (77) y a|b =x b
Asδandζhaveintegercoefficients,itfollowsthatT X
forallV′ ∈C ,alla⊃binKandallx ∈ E . v GBP
0 b b givenby(76),isobtainedbyevaluatingarationalfunction
oflinearmapsL ∈R(∆ )⊗gl(C )at p = ρ(ζv).
Proof. Thiscomputationmaybefoundin[9, prop. 4.14]. 0 0
ByIm(L) ⊆ δC , wemaydefinearestrictedoperator
It consists in differentiating the conditional free energy 1
term−ln∑
x a|b =x b
e−Va (xa ) withrespecttoV
a
∈REa.
g
L
l
′
(
∈
δC
R
)
(∆
→
0 )
R
⊗
[λ
g
]
l(
t
δ
h
C
en
1 )
g
.
i
T
v
h
e
e
s
c
a
h
n
a
e
r
x
a
p
ct
r
e
e
r
s
i
s
s
i
t
o
ic
n
polynomialmap
1
(η pa N ) a o ∈ t K et s h u a c t h a t n h y at p η ∈ pa ( Γ U 0 a d ,V efi a ) n : e = sa E f p a a m [U il a y V a o ] f , l c o o c n a s l is m te e n tr t i i c n s det (cid:16) λ−1+L ′ p (cid:17) δC1 = χ Q (p ( , p λ ) ) (82)
18
Figure6: LevelcurvesoftheBethefreeenergyFˇaccrossacuspidalsingularity(reddot),forincreasingvaluesoftheexternalmag-
neticfield(lefttoright).Oneachplot,thehorizontalaxisU∈C representsvariationsininversetemperature(i.e.aparameter),while
0
theverticalaxisV ∈ζ(δC )representsa1D-fiberofequivalentenergies(i.e.anoptimizationvariable).ConvexityintheV-axisislost
1
whentemperaturedropsastwoadditionalcriticalpointsstemfromthesingularity(rightofthedashedline). AlsonoticeFˇ acquires
asharpstepwhenthemagneticfieldincreases.
Itisclearfrom(81)thatthepolesofQ(p)lieonthebound- very similar loop expansions for the Bethe-Kikuchi ap-
ary of Γ as p > 0 for all a ∈ K inside Γ ; furthermore proximationerrorandtheanalysisofBPstability.
0 a 0
Q(p)doesnotdependonλ. WhenK ⊆ P(Ω)isagraph,wesimplywriteij ∈ Kfor
Themultiplicityoftheroot λ = 1in χ p (λ) = χ(p,λ) edgesandi ∈ Kforvertices(insteadof{i,j}and{i}).Our
therefore computes the dimension of Ker(L′), which is ∩-closureassumptionusuallyimpliesthat ∅∈ Kandthe
p
precisely cork v by (75). Lemma 21 finally implies that nerve of K is then a simplicial set of dimension 2. How-
χ p (1) = 0isapolynomialequationin pofΣ¯1 = (cid:83) k≥1 Σk, ever,asN 2 Konlyconsistsofchainsij →i →∅ andE∅is
definedbycork p ≥1. Onemaycomputecork p byevalu- a point (unit for ×), C 2 is only spanned by additive con-
atingderivatives∂jχ/∂λj atλ =1torecoverthesingular stantsandcoincideswithR 2 .
stratification. We denote by K′ = K ∖{∅} the associated graph in
amoreusualsense,whosenerve N•K′ isofdimension1.
Proofoflemma21. Let us stress that both points of view Thenotationi ⌢ j willindicatethati isaneighbourof j
(v ∈ N and p ∈ Γ 0 )aremeanttobeidentical,wereitnot inKandK′,wheneverij ∈ K.
fortheactionofadditiveconstants. TheGibbsstatemap
ρ◦ζ induces a quotient diffeomorphism ∆ 0 ≃ C 0 /R 0 , Proposition24(Kirchhoffformula). Given p ∈ Γ 0 ,denote
send N s o N te t t o ha Γ t 0 N and ∩ v R + 0 δ = C 1 µ to (R B ) v b is y a de s fi u n p i p ti l o e n m . ent of δR 1 a by → Z 1 b (p) ∈ ⊆ N 1 C K 1 a th n e d subspacedefinedbyE p b [ϕ a→b ] = 0forall
(seeappendixB).Theexistenceofaterminalelement(by
∑
∩-c
c
los
=
ur
1
e
(
a
c
s
o
s
r
u
o
m
lla
p
r
t
y
io
5
n
,
)
se
in
e
d
a
e
ls
e
o
d
a
i
p
m
p
p
e
l
n
ie
d
s
ix
th
B
a
)
t
a
µ
n
(
d
1)
th
s
a
u
t
m
µ(
s
R
to
) ϕ jk→k
=Ej
p
k→k (cid:20) ∑
ϕ ij→j
(cid:21)
(83)
b b
i⌢j
isnotacoboundaryofδC bytheorem3.
1
This implies that δR ⊆ R (acting on [v] but triv-
ially on B v ) does not int
1
ersect N
0
, and that the intersec- foralljk → k ∈ N 1 K. Thencork p =dimZ 1
(p)
.
tionofδC withN ∩R reducestozero. Theintersections
T N ∩δC 1 andT (Γ ∩ 0 B )mustthereforehavesamedi- Proof. Firstassumethatϕ ∈C 1 isorthogonaltoR 1 forη p .
m v ension. 1 p 0 v Letting(1 a→b )denotethecanonicalgeneratorsof R 1 ,we
then have E p
b
[ϕ a→b ] = 0 = η p (ϕ,1 a→b ) for all a → b in
C LoopyGraphs N 1 K, and in particular ϕ a→∅ = 0 for all a ∈ K. Let C 1 ′
denotethespaceofsuchfieldsorthogonaltoR .
1
Inthecaseofgraphs,wemaygivepolynomialequations Assumenowinadditionthatδϕ ∈Ker(∇ p ◦ζ).Itthen
forthesingularstrata Σk explicitly. Theyareobtainedas followsfromproposition23thatforalljk → k ∈ N 1 K,
aloopseriesexpansionbyfocusingontheactionofdiffu-
(cid:90) (cid:20)(cid:90) (cid:21)
sion on fluxes φ ∈ C
1
, via the remarkable Kirchhoff for-
ϕ
=Ejk→k
ϕ (84)
mula (83) below. The reader may find in [29, 30, 31, 32] K (jk)→K(k) p K Ω →K (jk)
(k) (jk) (k)
19
Equation (83)is equivalentto cancelling ther.h.s. of (80) LetusalsodenotebyE :C′ →C′ theedgepropagator
p 1 1
in its second form when ϕ ∈ C 1 ′, as all the ϕ a→∅ vanish. (cid:20) (cid:21)
Its l.h.s. reduces to ϕ jk→k while the r.h.s. sums inbound E p (ϕ) jk→k =Ej p k→k ∑ ϕ ij→j , (89)
fluxesϕ ij→j oversourceedgesij ̸⊆ jk,containingthetar- i⌢j
get j ⊆ jk,j ̸⊆ k (brackets in (84) are used to avoid am-
so that (83) is the eigenvalue equation ϕ = E (ϕ). One
p
biguousinterpretationofnotationsindefinition10).
mayrecovercork inthecharacteristicpolynomialofE ,
p p
We showed that (83) describes Ker(∇ ◦ζ◦δ) under
p whichwecomputeexplicitlyforbinaryvariables.
the assumption that ϕ ⊥ R . Recalling that cork is the
dimensionofKer(∇ p ◦ζ)∩ 1 δC 1 ,wemaycompute p cork p Definition25. Defineadirectedgraphstructure G on N 1 K′,
as corank of the restriction of ∇ ◦ζ◦δ to a supplement byincludingalledgesoftheform(ij → j)▷(jk → k)fori ̸= k.
p
ofKer(δ). Nowasδ = ∇∗ p forthemetricη p ,thesubspace TheedgesofG describeallnon-vanishingcoefficients
∇ p C 0 ⊆C 1 issuchasupplement. ofthematrixE p . HowevernotethatcoefficientsofE p are
Let us show that ∇ C contains C′. Given ϕ ∈ C′, indexedbyliftsofanedge(ij → j)▷(jk → k)toapairof
p 0 1 1
theorthogonalprojectionsofϕ ij→j ∈REj andϕ ij→i ∈REi configurations(x j ,x k ) ∈ E∗ j ×E k ∗ ingeneral.
ontoREj ∩REi = RE∅ = Rvanishforeveryedgeij ∈ K Letusnowrestricttobinaryvariablesforsimplicity,so
by the assumption ϕ ⊥ R . We may thus choose V
thattheedgesofGareinbijectionwiththenon-vanishing
1 ij coefficientsofE ∈ R(∆ )⊗gl(C′). ThecoefficientofE
in REij ≃ REi ⊗REj ⊃ REi +REj that projects onto p 0 1 p
attachedtoanedge(ij → j)▷(jk → k)actuallydoesnot
−ϕ ij→i ∈ REi and −ϕ ij→j ∈ REj. Letting V i = 0 for all dependoni,asitconsistsinprojectingobservablesonjto
vertex i ∈ K and V∅ = 0, we may get V ∈ C
0
such that
observablesonkwiththemetricinducedbyp by(89). It
∇ V = ϕ,as jk
p maythusbedenotedη (p)fornow.Anexplicitformwill
jk
begivenby(96)below,whichissymmetricinjandk.
∇ p (V) ij→j =0−Ei p j→j[V ij ] = ϕ ij→j (85) Definition 26. Denote by SkG ⊂ S(N K′) the set of per-
1
mutationswithexactlym−kfixedpoints,compatiblewithG.
f C o ′ r ⊆ all ∇ ij → C j co ∈ ns N is 1 t K s , o a f n c d oc ∇ yl p e V s a , → co ∅ rk = 0 is fo g r re a a l t l e a r o ∈ r K eq . u A a s l Anyγ ∈SkG decomposesasaproductofl(γ)disjointcycles.
1 p 0 p
thanthecorankof∇
p
◦ζ◦δrestrictedtoC
1
′. Theorem9. Assumex
i
∈ E
i
isabinaryvariableforalli ∈ K.
ThesubspaceR′ = R ∩∇ C containstheremaining Then p ∈ Σ¯s ifandonlyif(λ−1)s dividesthepolynomial
1 1 p 0
cocyclicdegreesoffreedomas m
χ (λ) = ∑ λm−k ∑ (−1)l(γ)Λ [γ], (90)
p p
∇ C =C ′ ⊕
⊥
R ′ . (86)
k≥0 γ∈SkG
p 0 1 1 whereΛ [γ]istheproductofcoefficientsofE accrossγ
p p
However,asweshownintheproofoflemma21,thesub- γ
spaceδR 1 ′ ⊆ δR 1 doesnotintersectKer(∇ p ◦ζ),whileitis Λ p [γ] = ∏ η jk (p), (91)
stable under diffusion. Therefore R′ does not contribute ij→j▷jk→k
1
tocork p and andwhere η (p)canbechosenas(96)below,inanorthonor-
jk
malsystemofcoordinatesforη .
p
cork p = cork(∇ p ◦ζ◦δ |C′ ). (87)
1 Notethatfactorizingγasγ ...γ ,onehas:
1 l(γ)
l(γ)
The Kirchhoff formula (83) will allow us to relate the Λ [γ] = ∏Λ [γ ]. (92)
p p s
emergenceofsingularitiestothetopologyof K. Justlike
s=1
steadyelectriccurrentscannotflowaccrossopencircuits,
WemaycallΛ [γ ]theloopeigenvalueofγ .
it is clear (83) will not admit any non-trivial solutions p s s
when K is a tree. However, unlike electric currents, the Proofoftheorem9. Proposition24impliesthatcork isthe
p
zero-meanconstraintexcludesscalarfluxes,fixedbycon- multiplicity of 1 as eigenvalue of E , in other words the
p
ditional expectation operators. Multiple loops will thus dimension of Ker(1−E ) ⊆ C′. Let us show that χ (λ)
p 1 p
needtocollaboratefornon-trivialsolutionstoappear. doescomputethecharacteristicpolynomialofE .
p
Fixing p ∈ Γ 0 , denote by C 1 ′ ⊆ C 1 the orthogonal of Consider a matrix M : Rm → Rm, whose diagonal
localconstantsforη p asabove. Choosingaconfiguration coefficients all vanish, and write Sk m ⊆ S m for the set of
o
i
∈ E
i
and letting E
i
∗ = E
i
∖{o
i
} for each vertex i, one permutationshavingexactlym−kfixedpoints.Usingthe
hasanisomorphism: Leibnizformula,onegetsforχ (λ) =det(λ−M):
M
m
C 1 ′ ≃ ∏ RE∗ j (88) χ M (λ) = ∑ λm−k ∑ ε(σ)(−1)k ∏ M e,σ(e) (93)
ij→j∈N1K′ k=0 σ∈Sk
m
e̸∈Fix(σ)
20
Figure7: Computationofχp (1)onthedumbellandthetagraphs. Thesumoflistedmonomialssumsto0when p ∈ Σ¯1issingular.
Everyedge jkinthebasegraphK′ givesrisetoapair jk → kand jk → jofverticesinG. ThisexplainswhyeveryedgeofK′ may
bewalkedthroughinbothdirections,althoughU-turnsarenotpermittedas jk → jand jk → jarenotadjacentinG. Theprecise
topologyofK′ (includingitsvertices)doesnotreallymatterhere,asloopeigenvaluesΛ
p
[γ]onlycomputeproductsofcoefficients
accrosscycles.
The signature of a length-k cycle σ ∈ Sk has signature nates,wethusdefineu as:
m j
ε(σ) = (−1)k−1.Bymultiplicativityofε(σ),itfollowsthat
(cid:32) − (cid:33)
foreveryproductofdisjointcyclesσ = σ ...σ ∈Sk , 1 p
1 l m u j = (cid:113) + − · −p j + (95)
p p j
j j
(−1)kε(σ) = (−1)l (94)
Because Ejk→k[u ] has zero mean too, it must lie in Ru .
p j k
Therefore (90) computes the characteristic polynomial of Hence,Ejk→k[u
] = η (p)·u whereη (p)isfoundas:
p j jk k jk
E ,whosediagonalcoefficientsdovanish.
p
p
++
p
−−−p +−
p
−+
jk jk jk jk
η jk (p) = (cid:113) (96)
p
+
p
−·p +
p
−
Letusexpresstheη (p)inanorthonormalsystemof j j k k
jk
coordinates,convenientforthesymmetryin jandkitin-
duces. The √ price to pay is that η jk (p) becomes a rational Thescalingfactorη jk (p)issymmetricin jandkasEj p k→k
functionin pandnotinp,butthischoicegreatlysimpli- isa(self-adjoint)projectorinREjk ≃ R4. Thereadermay
fies computations. We write x ∈ {±} with p ± = p (±) check (96) by performing the 2x2 matrix-vector product
i i i
and p i ± j ± = p ij (±±),etc. p kj ·u j and dividing the resulting vector by p k , accord-
ing to the Bayes rule, then substituting for p and p the
For ϕ ∈ C 1 ′, each flux term ϕ ij→j may be constrained marginalsofp whennecessary.Again,west j resstha k tthe
jk
toa1-dimensionalsubspaceRu j ofREj ≃ R2, chosenso image of u j must lie in Ru k by the zero-mean constraint
that E pj [u j ] = 0 and E pj [u2 j ] = 1. In the (+,−) coordi- u j ,u k ⊥R.
21
(cid:113)
Lettingg = p + p − denotethegeometricmeanof p ACKNOWLEDGEMENTS
j j j j
andlettingu˜ = g u forallj:
j j j ThisworkhasbenefitedfromthesupportoftheAIChair
EXPEKCTATION (ANR-19-CHIA-0005-01) of the French
g
Ejk→k[u˜
] =
j
η (p)u˜ = η˜ (p)u˜ (97) NationalResearchAgency(ANR).
p j g jk k jk k
k IamverygratefultoYae¨lFre´gier,PierreMarquisand
Fre´de´ricKorichefortheirsupportinLens, andtoDaniel
leads to coefficients η˜ (p) that are no longer symmetric,
jk Bennequin, Gre´goire Sergeant-Perthuis and Juan-Pablo
butarerationalfunctionsof p. Notethattheproductsof
Vigneauxforfosteringmyinterestingraphicalmodels.
theη (p)andη˜ (p)accrossacycleγ ∈SkGdocoincide.
jk jk
References
VII. CONCLUSION
[1] E.T.Jaynes. InformationTheoryandStatisticalMe-
chanics. PhysicalReview,106(4):620–630,May1957.
Belief propagation algorithms and their relationship to
Bethe-Kikuchi optimization problems were the corner- [2] C.-M. Marle. From Tools in Symplectic and Pois-
stone motivation for this work. We produced the most sonGeometrytoSouriau’sTheoriesofStatisticalMe-
comprehensivepictureofthisvastsubjectthatwasinour chanicsandThermodynamics. Entropy,18,072016.
power, although loop series expansions [30, 29, 31, 32]
[3] H. A. Bethe and W. L. Bragg. Statistical Theory
surelywouldhavedeservedmoreattention.
of Superlattices. Proceedings of the Royal Society of
Therichstructureownedbythecomplex(C•,δ,ζ)was
London. Series A - Mathematical and Physical Sciences,
a surprise to uncover, in a field usually dominated by
150(871):552–575,1935.
statistics. We hope the length of this article will be seen
asanefforttomotivatetheunfriendlywaysofMo¨biusin- [4] R. Kikuchi. A Theory of Cooperative Phenomena.
version formulas and homological algebra, and demon- Phys.Rev.,81:988–1003,Mar1951.
strates their reach and expressivity in a localized the-
[5] T.Morita. ClusterVariationMethodofCooperative
ory of statistical systems. This intimate relationship be-
Phenomena and its Generalization I. Journal of the
tween combinatorics and algebraic topology (culminat-
PhysicalSocietyofJapan,12(7):753–755,1957.
ing in theorems 3 and 6) has not been described to our
knowledge, althoughbothsubjectsareclassicalandwell [6] A.G.Schlijper. Convergenceofthecluster-variation
coveredindividually. method in the thermodynamic limit. Phys. Rev. B,
From a practical perspective, we showed that belief 27:6841–6848,Jun1983.
propagation algorithms are time-step 1 Euler integrators
[7] J. Yedidia, W. Freeman, and Y. Weiss. Constructing
of continuous-time diffusion equations on (C•,δ,ζ). We
FreeEnergyApproximationsandGeneralizedBelief
proposetocalltheseODEsbeliefdiffusions,as”diffusions”
Propagation Algorithms. IEEE Transactions on Infor-
suggest(i)aconservationequationoftheformv˙ = δΦ(v),
mationTheory,51(7):2282–2312,Jul2005.
while ”belief” recalls (ii) that their purpose is to con-
verge on consistent pseudo-marginals, critical for Bethe- [8] O.Peltre. AHomologicalApproachtoBeliefPropa-
Kikuchi information functionals. The GBP algorithm of- gationandBetheApproximations. InF.Nielsenand
fered a spatial compromise between precision and com- F. Barbaresco, editors, Geometric Science of Informa-
plexity in the choice of the hypergraph K ⊆ P(Ω); our tion, pages 218–227, Cham, 2019. Springer Interna-
diffusionequationsofferatemporalcompromisebetween tionalPublishing.
runtimeandstability. Theythusallowforawiderrange
[9] O. Peltre. Message-Passing Algorithms and Homology.
ofinitialconditionsandapplications.
The`ses,Universite´ ParisCite´,Dec2020.
Belief diffusions, in their isothermal and adiabatic
form,solvelocalizedversionsofthemax-entropy(A)and [10] O. Peltre. Belief Propagation as Diffusion. In
free energy principles (B and C). The associated Bethe- F. Nielsen and F. Barbaresco, editors, Geometric Sci-
Kikuchifunctionalshaveapiecewiseconstantnumberof ence of Information, pages 547–556, Cham, 2021.
critical points, whose discontinuities are located on the SpringerInternationalPublishing.
projection of S¯ ⊆ N on the quotient space of param-
1 [11] S. Ikeda, T. Tanaka, and S.-i. Amari. Stochastic
eters C /δC . A stationary point in N crossing S¯ will
0 1 1 Reasoning, FreeEnergy, andInformationGeometry.
become unstable and forced onto a different sheet of the
NeuralComputation,16(9):1779–1810,092004.
intersectionwithhomologyclasses.Thiswouldappearas
adiscontinuousjumpintheconvexpolytopeΓ ,happen- [12] K.J.Friston, T.Parr, andB.deVries. TheGraphical
0
inganytimeaconsistentbelief p ∈ Γ crossesthesingular Brain: BeliefPropagationandActiveInference. Net-
0
spaceΣ¯ . worksNeuroscience,1(4):381–414,2017.
1
22
[13] T. Parr, D. Markovic, S. J. Kiebel, and K. J. Friston. [26] M.Me´zard. Mean-FieldMessage-PassingEquations
Neuronal Message Passing Using Mean-field, Bethe intheHopfieldModelanditsGeneralizations. Phys-
and Marginal Approximations. Scientific Reports, 9, icalReviewE,95(2),Feb2017.
2019.
[27] M. Me´zard and A. Montanari. Information, Physics
[14] D. Rudrauf, D. Bennequin, I. Granic, G. Landini, andComputation. OxfordUniversityPress,2009.
K.Friston,andK.Williford. AMathematicalModel
[28] A.Pelizzola. ClusterVariationMethodinStatistical
ofEmbodiedConsciousness. JournalofTheoreticalBi-
Physics and Probabilistic Graphical Models. ArXiv,
ology,428:106–131,2017.
abs/cond-mat/0508216,2005.
[15] J. Sa´nchez-Can˜izares. The Free Energy Principle: [29] J. M. Mooij and H. J. Kappen. Sufficient Con-
Good Science and Questionable Philosophy in a ditions for Convergence of the Sum–Product Al-
GrandUnifyingTheory. Entropy,23(2),2021. gorithm. IEEE Transactions on Information Theory,
53(12):4422–4437,Dec2007.
[16] R.G.Gallager. Low-DensityParity-CheckCodes. MIT
Press,1963. [30] Y. Watanabe and K. Fukumizu. Graph Zeta Func-
tionintheBetheFreeEnergyandLoopyBeliefProp-
[17] J. Pearl. Reverend Bayes on Inference Engines: A agation. In Y. Bengio, D. Schuurmans, J. Lafferty,
Distributed Hierachical Approach. In AAAI-82 Pro- C.Williams,andA.Culotta,editors,AdvancesinNeu-
ceedings,1982. ralInformationProcessingSystems,volume22.Curran
Associates,Inc.,2009.
[18] Y. Weiss. Belief Propagation and Revision in Net-
workswithLoops. Technicalreport,MIT,1997. [31] R. Mori. New Understanding of the Bethe Ap-
proximation and the Replica Method. ArXiv,
[19] K.P.Murphy,Y.Weiss,andM.I.Jordan.LoopyBelief abs/1303.2168,2013.
PropagationforApproximateInference: AnEmpiri-
[32] E. B. Sudderth, M. J. Wainwright, and A. S. Willsky.
calStudy. InUAI,1999.
LoopSeriesandBetheVariationalBoundsinAttrac-
[20] F. Kschischang, B. Frey, and H.-A. Loeliger. Factor tiveGraphicalModels. InNIPS,2007.
GraphsandtheSum-ProductAlgorithm.IEEETrans-
[33] J. M. Hammersley and P. E. Clifford. Markov Ran-
actionsonInformationTheory,47(2):498–519,2001.
dom Fields on Finite Graphs and Lattices. Unpub-
lishedmanuscript,1971.
[21] J.S.Yedidia,W.T.Freeman,andY.Weiss. BetheFree
Energy, Kikuchi Approximations, and Belief Prop- [34] G.-C. Rota. On the Foundations of Combinato-
agation Algorithms. Technical Report TR2001-16, rial Theory - I. Theory of Mo¨bius Functions. Z.
MERL - Mitsubishi Electric Research Laboratories, Warscheinlichkeitstheorie,2:340–368,1964.
Cambridge,MA02139,May2001.
[35] J.-L. Verdier and A. Grothendieck. V: Cohomologie
[22] S. Sharifi Tehrani, C. Jego, B. Zhu, and W. J. Gross. danslesTopos. SGA-4,2,1972.
Stochastic Decoding of Linear Block Codes With
[36] I. Moerdijk. Classifying Spaces and Classifying Topoi.
High-Density Parity-Check Matrices. IEEE Transac-
Springer,1995.
tionsonSignalProcessing,56(11):5733–5739,2008.
[37] H. G. Kellerer. Maßtheoretische Marginalprobleme.
[23] C. Knoll and F. Pernkopf. On Loopy Belief Propa-
MathematischeAnnalen,153(3):168–198,Jun1964.
gation – Local Stability Analysis for Non-Vanishing
Fields. InUncertaintyinArtificialIntelligence,2017. [38] N. Vorob’ev. Consistent Families of Measures and
theirExtensions. TheoryofProbabilityanditsApplica-
[24] J.Sun,N.-N.Zheng,andH.-Y.Shum. StereoMatch- tions,7(2):147–164,1962.
ing Using Belief Propagation. IEEE Transactions on
[39] S. Abramsky and A. Brandenburger. The Sheaf-
Pattern Analysis and Machine Intelligence, 25(7):787–
theoretic Structure of Non-Locality and Contextual-
800,2003.
ity. NewJournalofPhysics,13,2011.
[25] W. Ping and A. Ihler. Belief Propagation in Condi-
[40] F. Matu´sˇ. Discrete Marginal Problem for Complex
tional RBMs for Structured Prediction. In Proceed-
Measures. Kybernetika,24:36–46,1988.
ingsofthe20thInternationalConferenceonArtificialIn-
telligence and Statistics, volume 54 of Proceedings of [41] D. H. Ackley, G. E. Hinton, and T. J. Sejnowski. A
Machine Learning Research, pages 1141–1149. PMLR, Learning Algorithm for Boltzmann Machines. Cog-
2017. nitiveScience,9(1):147–169,1985.
23
[42] A. Bovier and B. M. Niederhauser. The spin-glass [55] J. Boardman et al. Singularities of Differentiable
phase-transition in the hopfield model with p-spin Maps.PublicationsMathe´matiquesdel’IHE´S,33:21–57,
interactions. AdvancesinTheoreticalandMathematical 1967.
Physics,5:1001–1046,2001.
A. GAUSS-GREENEFORMULAS
[43] A. Barra, G. Genovese, P. Sollich, and D. Tantari.
Phase Diagram of Restricted Boltzmann Machines
Proofoftheorem3. Letusfirstshow(i) ⇒ (ii), statingthat
and Generalized Hopfield Networks with arbitrary
∑ δφ = 0 vanishes for all φ ∈ C . Recall that the
priors. PhysicalReviewE,97(2):022310,2018. ca a n ∈ o K nica a linclusionsREc ⊂RE b ⊂REΩ 1 areimplicitin:
[44] A.JavanmardandA.Montanari. StateEvolutionfor
∑ ∑ ∑
General Approximate Message Passing Algorithms, δφ b = φ a→b − φ b→c (98)
b∈K a⊃b c⊂b
with Applications to Spatial Coupling. Information
andInference:AJournaloftheIMA,2(2):115–144,2013. Both sums run over the strict 1-chains of N K, therefore
1
(98) vanishes as a K-local observable in REΩ and δC is
[45] A.Klipfel,Z.Bouraoui,O.Peltre,Y.Fregier,N.Har- 1
containedinthekernelofthetotalenergymapC →REΩ.
rati, and A. Sayede. Equivariant Message Passing 0
Showing(ii)⇒(i)ismoreinvolved,asitreliesonthe
NeuralNetworkforCrystalMaterialDiscovery. Pro-
interaction decomposition theorem (see [37, 40, 51] and
ceedings of the AAAI Conference on Artificial Intelli-
[9, section 2.3.2]) which requires K to be ∩-closed. This
gence,37(12):14304–14311,Jun.2023.
theoremstatesthatonemaychooseaconsistentfamilyof
[46] Y. Weiss and W. T. Freeman. Correctness of Belief interactionsubspacesZ a ⊆REa suchthatforalla∈ K:
Propagation in Gaussian Graphical Models of Ar-
bitrary Topology. Neural Computation, 13(10):2173– REa = (cid:77) Z b (99)
2200,102001. b⊆a
[47] E. Gouillart, F. Krzakala, M. Mezard, and L. Zde- Foreverya⊇b∈ K,letusdenotebyZ a→b theprojection
borova´. Belief-Propagation Reconstruction for Dis- ofREa ontoZ b cancellingoneveryZ c forc̸=b.
crete Tomography. Inverse Problems, 29(3):035003, Given h ∈ C 0 such that ∑ a h a = 0, define φ ∈ C 1 by
2013. letting φ a→b = −Z a→b (h a )foralla ⊃ binK. Thenδφis
givenby:
[48] T.Sejnowski. Higher-orderBoltzmannmachines. In
NeuralNetworksforComputing, volume151ofAmer- δφ b = − ∑ Z a→b (h a )+ ∑ Z b→c (h b ) (100)
ican Institute of Physics Conference Series, pages 398– a⊇b c⊆b
403,August1987.
Thesecondsumoverc ⊆ breconstructsh
b
∈ RE b. Tosee
[49] C.W.J.Goh,C.Bodnar,andP.Lio`. SimplicialAtten- thatthefirstsumovera ⊇ bvanishes,oneshouldnotice
tionNetworks,2022. thatRE b∩RE b′ =RE b∩b′ isastrictsubspaceofRE b when-
everb′ doesnotcontainb. Thisimpliesthatitsprojection
[50] M. Hajij, G. Zamzmi, T. Papamarkou, N. Miolane,
ontoZ vanishes,andthattheprojectionof∑ h onto
A. Guzma´n-Sa´enz, K. N. Ramamurthy, T. Birdal, b a∈K a
Z isgivenbythefirsttermof(100). Thereforeδφ = hby
T. K. Dey, S. Mukherjee, S. N. Samaga, N. Livesay, b
assumption,andδC coincideswiththespaceofzero-sum
R. Walters, P. Rosen, and M. T. Schaub. Topological 1
potentials.
DeepLearning: GoingBeyondGraphData,2023.
Proofoftheorem6. Denote by E the set of chains ⃗a ∈
[51] D.Bennequin,O.Peltre,G.Sergeant-Perthuis,andJ.- j
P. Vigneaux. Extrafine Sheaves and Interaction De- N r+1 K such that⃗a(j) lies in the hypercone Kb0...br, for all
compositions. (preprint). Under revision for Alge- 0 ≤ j ≤ r+1. Fromdefinitionofδ,thel.h.s. of(44)then
braicandGeometricTopology.,2023. rewrites
(cid:90) r+1
[52] T. Leinster. The Euler Characteristic of a Category. δφ = ∑ ∑ (−1)jφ ⃗a . (101)
DocumentaMathematica,13:21–49,2008.
Kb0...br
j=0⃗a∈E j
[53] H.Poincare´. The´orieduPotentielNewtonien, Coursde Let⃗c =⃗a(j) ∈ Kb0...br for j > 0. Let us show that⃗a also
laSorbonne1894–1895. Carre´ etNaud,Paris,France, belongstoeitherE j−1 orE j+1 .ByconstructionofE j ,agree-
1899. ingtoletc j+1 =b j+1 =∅ andb 0 = Ω,wehave:
[54] R. Thom. Les Singularite´s des Applications (i) a =c ∈ K bi fori < j,
Diffe´rentiables. Annales de l’institut Fourier, 6:43–87,
i i bi+1
1956. (ii) a j−1 ⊃a j ⊃a j+1 ,
24
(iii) a k+1 =c k ∈ K b b k k +1 fork ≥ j. L in e c t lu u s s io re n c - a e l x l c t l h u a s t io c b n 0 p = rin − c µ i ˜ p Ω l → e b is 0 ( in se d e e [ e 3 d 4] so o l r v c e h d ec b k y t ζ h ˜µ˜ at = th 1 e
The I n f ⃗ a a( j j− ⊆ 1) b ∈ j , K th b e 0. n ..b a r, j a ⊃ s(i a ii j+ ) 1 is ̸⊆ sat b is j+ fie 1 d im fo p r li k es ≥ a j j − ∈ 1 K . b b j j +1 . o w n h C e ˜ r 0 e ). Φˇ W Ω e a1 n .. o .a w r i c s la g i i m ve t n ha b t y ϕ ( − 46 ϕ ) ˜ f m or ay al b l e a 1 ex . p .. r a e r ss ∈ ed N a r s − µ˜ 1 Φ K ˇ, ,
If a j ̸⊆ b j , then b j−1 ⊇ a j−1 ⊃ a j implies a j ∈ K b b j j−1. and B Φ y ˇ a l 0 o .. c .a a r li = ty 0 o f f o µ r ˜, a o ll n a e 0 e . a . s . i a ly r ∈ ch N ec r k K s . that (µ˜Φˇ) a0...ar = 0
Then⃗a(j+1) ∈ Kb0...br,as(i)issatisfiedfori ≤ j. whena 0 ̸= Ω,asΦˇ vanisheson N r K byconstruction. To
WejustprovedE j ⊆ E j−1 ∪E j+1 forall0 < j ≤ r+1, see that (−µ˜Φˇ)Ωa1...ar is given by (106), first write from
and the reader may easily check that (i) and (iii) do also definitionoftheMo¨biustransform:
i
t a
m
o lte
p
d r
l
e n
y
t a e
t
t r
h
e m
a
d
t
in s
E
u e
j
m
∩
w
E
o h
k
f ic (
=
h 10
∅
c 1 h ),
f
a
o
i i . n
r
e s .
|k
⃗ d a
−
o ∈ n
j|
o
>
E t 0 li
1
e a
.
r i
T
e n
h
n E
e
o 1
r
.
e
t k
on
il
l
l
y
ed
re
b
m
y
a
t
i
h
n
e
s (µ˜Φˇ)Ωa1...ar =
br
∑
⊆ar
µ ar →br ···
b b 1 1
∑
̸⊆ ⊆ b a1 2
µ a1 →b1
(107)
T It h f e o C n l o l ⃗ o a n ( w s 1 i ) s d = e th r a ⃗ a a t 0 a ∈ ⃗a 2 E . ∈ . 0 . , a E s r o 0 + ∖ 1 th ∈ a E t 1 ⃗ K a i ( b f 0 0 ) . a .. n = br d i a f o 1 a a n n 2 ly d .. i o . f a n a r l + y 0 1 i ̸⊆ f ∈ a 0 K b 0 b ⊆ 0 a .. b . n b 0 d r. . then expand Φˇ (Ωb1 µ ... Ω br → )∩ Ω a Φ s ˇ ( a Ωb s 1 u .. m .br ) o ∩ v , er b 0 ̸⊆ b 1 of flux
a j+1 ∈ K b b j j +1 for all 0 ≤ j ≤ r, which is equivalent to c tu u t m in u g lan (4 t 6 s ) c d b0 e Φ fi ˇ n (b i 0 n .. g .br Φ ) ˇ ∩ . = Wri − ti µ n Ω g → (Ω b0 b Φ ( . b . 0. . .. b br ) ) ∩ ∩ , b = y c su . b . s . t c i-
⃗a∈ dKb0...br bydefinition10. where c 0 = Ω and c j = b j ∩c j−1 , 1 assoc r iativity 0 of the r
P
C
r
•
o
(
o
K˜
f
,
o
R
ft
E
h
)
eo
t
r
h
e
e
m
h
7
y
.
p
D
er
e
g
n
r
o
a
t
p
e
h
b
a
y
n
K
d
˜
c
=
om
K
p
∪
le
{
x
Ω
o
}
bt
a
a
n
in
d
ed
by
b
C
y
˜ •
ap
=
-
i
Φ
n
b
te
0 ∩
rs
(b
e
0
c
∩
ti
c
o
1 )
n
...(
i
b
n
0
d
∩
e
cr
e
)
d
.
ensuresthatΦ (b0...br )∩ coincideswith
pending the global region Ω. The complex C• then nat- Havingshowedthatϕ−ϕ˜ = µ˜Φˇ,orequivalentlythat
urally embeds into C˜ • as a linear subspace, defined by ζ˜(ϕ−ϕ˜) = Φˇ, we may now conclude the proof using
iΩ =0whenΩ ̸∈ K. Thefirstequalityin(45), (104)toget:
δˇΦ
a1...ar
= (cid:90)
dKa1...ar
ϕ, (102) δˇΦ a1...ar = ζ˜(ϕ−ϕ˜)Ωa1...ar = Φˇ Ωa1...ar . (108)
simply consists in a Gauss formula (44) on Ka1...ar for
δˇΦ = ζ(δµΦ) = ζ(δϕ).AlsorecallthatdKa1...ar = K˜Ωa1...ar B. CONSISTENTMANIFOLDS
fromdefinition10.
FirstassumethatK = K˜ containsΩ. Then(46)follows
LettingR• ⊆ C• denotethesubcomplexspannedbycon-
stant local observables, note that the Gibbs state map ρβ
fromζ = µ−1asinthiscasecΩ =1andc
a
=0fora̸= Ω:
is invariant under the addition of energy constants, and
ζ(δϕ) a1...ar = ζ(ϕ)Ωa1...ar = Φ Ωa1...ar . (103) factorizesthroughadiffeomorphismC 0 /R 0 → ∆ 0 . Itfol-
lowsthatMβ ≃ Nβ+R coincideswiththeorbitofNβ
AssumenowthatΩ ̸∈ K. TheGaussformula(102)above 0
undertheadditionoflocalconstantsinR .
0
thenconsistsinatruncatedMo¨biusinversioninstead(i.e. However remark that µ(R) ⊆ R acts on Nβ, as lo-
0
aBethe-Kikuchiapproximation)whichwemaywrite
calhamiltonians H = ζ(h)arethenshiftedbyaconstant
ζ(δϕ)
a1...ar
= ζ˜(ϕ)Ωa1...ar = ζ˜(µΦ)Ωa1...ar (104) t
m
er
o
m
nm
w
a
h
s
ic
s.
h
O
re
n
s
e
ca
m
le
a
s
y
a
d
ll
e
t
c
h
o
e
m
G
p
i
o
b
s
b
e
s
R
de
a
n
s
si
µ
ti
(
e
R
s
)
e−
⊕
H
δ
t
R
o
,
a
a
c
s
om-
whereζ˜denotesthezetaautomorphismofC˜ •. Thisisnot
∑ ∑
0 1
theinverseoftheMo¨biusautomorphismµofC•,andwe µ a→b = c b =1 (109)
writeµ˜ = ζ˜−1. a⊇b b⊇∅
By Φ ∈ C• ⊂ C˜ •, rememberthattheevaluation iΩ of followsfromtheexistenceofaterminalelement(assumed
thefirstregiononΩcancelsΦ. Thusζ˜(µ˜Φ)Ωa1...ar = 0so heretobetheemptyset ∅ )andcorollary5. Thefactthat
that µ(1) does not sum to zero implies that it generates the
ζ˜(µΦ)Ωa1...ar = ζ˜(cid:0) (µ−µ˜)Φ(cid:1)
Ωa1...ar
. (105) o
H
n
e
l
n
y
c
n
e,
o
M
n-t
β
riv
≃
ia
N
lh
β
o
×
mo
δR
log
.
yclassof R
0
/δR
1
bytheorem3.
Let ϕ˜ = µ˜Φ. The Mo¨bius transform is local in the sense 1
Thefollowinglemmaprovidesanexplicitretractionof
that (µ˜Φ) only contains terms Φ with b ⊆ a .
Therefore
a
ϕ
0
˜
...ar
= ϕ whenever
b
a
0...b
̸=
r
Ω. F
0
rom it
0
s
Mβ ontoNβ.
definition(3 a 3 0 ) .. , .a w r hena a 0 0. = ..ar Ωweget: 0 Lemma27. Let Fβ : C 0 → R 0 denotethedirectsum⊕F a β of
localfreeenergymaps(definition5). Thenanaturalretraction
ϕ˜ Ωa1...ar = ∑ µ ar →br ··· ∑ µ a1 →b1 rβ : Mβ → Nβ isdefinedbylettingforallv ∈ Mβ:
br ⊆ar b b 1 1 ̸⊆ ⊆ b a1 2 (106) rβ(v) = v−µ (cid:0) Fβ(ζv) (cid:1) . (110)
∑ µΩ→b0 Φ
(b0...br
)∩.
Forallv ∈ Mβ,onehasv ∈ Nβ ifandonlyifFβ(ζv) =0.
b0 ̸⊆b1
25
Proof. The result is easily proved by observing that both faithful, andthat Φ (56)islocallyfaithful(i.e. anysta-
BK
ζ and µ are equivariant under the action of R , and that tionarypotentialsufficientlyclosetotheconsistentman-
0
Fβ(V) computes −lnZ , i.e. freeenergiesvanishifand ifold is consistent), although global faithfulness of Φ
a a BK
onlyiftheGibbsdensitiese−βVa arenormalised. shouldbeconjectured.
Lemma28. Forall β > 0, Nβ istheimageof N1 underthe Proposition30. TheGBPdiffusionflux Φ GBP = −D◦ζ is
scalingv (cid:55)→ β−1v. faithful. EquivalentlyforallV = ζv ∈C 0 wehave:
δ(DV) =0 ⇔ DV =0. (113)
Proof. Thisdirectlyfollowsfromdefinition12,asρβ(v) =
ρ(βv). Proof. By d = δ∗, first recall that we have for all ϕ ∈ C
1
andq ∈C∗ theduality(integrationbyparts)formula:
0
Extension to zero or negative inverse temperatures
⟨q|δϕ⟩ = ⟨dq|ϕ⟩. (114)
woulddescribeinfinitesimalandreversedinteractionsre-
spectively. Althoughnotphysical,negativetemperatures Assumenowthatϕ = DVliesinKer(δ). Then⟨dq|ϕ⟩ =0
describeanaturalsymmetryof∆ 0 whichisdiffeomorphic for all q ∈ C∗ by (114). Choosing local (unnormalized)
0
tothequotientLiegroupC 0 /R 0 underρ,energyscalings Gibbs densities for q = e−V ∈ C∗, let us show that
β ∈Ractingasexponentsin∆ 0 . ⟨dq|DV⟩ = 0 implies DV = 0 by a 0 monotonicity argu-
ment.
Proposition 29. Let u = r1(0) ∈ N1 denote the consistent
ExpandingthedualitybracketofC∗×C yields
potentialshavinguniformGibbsdensities. Thenv ∈ T N1 if 1 1
u
andonlyifV = ζvsatisfies: ⟨dq|DV⟩ = ∑ ∑ dq a→b (x b )·DV a→b (x b ), (115)
a→b x b
V (x ) =E [V |x ] =
|E
b
|
∑ V (x ) (111) andweclaimthatthesummandsof(115)identicallyvan-
b b ρ(0) a b |E | a a
a x a|b =x b ish. Indeedwehavefromdefinition
foralla⊃binKandallx b ∈ E b . dq a→b (x b ) =e −V b (x b )− ∑ e −Va (xa ) , (116)
x a|b =x b
Equation(111)describesconsistencyforsystemshav- (cid:18) (cid:19)
ing infinitesimal interactions with respect to the energy DV a→b (x b ) =V b (x b )− −ln ∑ e −Va (xa ) , (117)
scale(hightemperaturelimit).Inthenon-interactingcase, x a|b =x b
acanonicalchoiceofinteractionsubspacesZ a ⊆REa,where and y (cid:55)→ −lny is strictly decreasing. The signs of
(cid:18) (cid:19)⊥ dq a→b (x b ) and DV a→b (x b ) therefore disagree for every
Z a ⊆ ∑ RE b forη ρ(0) (112) a→binN 1 Kandeveryx b ∈ E b ,sothat(115)isavanish-
ingsumofnon-positiveterms,i.e. asumofzeroes.
b⊆a
Noticingthatdq
a→b
(x
b
) =0ismoreoverequivalentto
furtherallowstodescribeT u N1asthesetofthosev ∈C 0 DV a→b (x b ) = 0,weconcludethatDV = dq = 0,i.e. that
such that v ∈ Z for all a ∈ K [9, section 5.2.1]. The Gibbsdensitiesareconsistentwheneverδ(DV) =0.
a a
metricη ρ(0) isinducedbyuniformbeliefs(seesectionVI), Proposition 31. The Bethe-Kikuchi diffusion flux Φ =
BK
so that conditional expectations of (111) are orthogonal
−µ◦D◦ζ islocallyfaithful: thereexistsanopenneighbour-
projections for η . Note that such an orthogonal de-
ρ(0) hoodV ofN suchthatforallv ∈ V ⊆C ,
composition, compatible with the metric η = η , is 0
p ρ(0)
onlypossiblebecauseallvariablesareindependentinthe δΦ (v) =0⇔ v ∈ N. (118)
BK
high-temperaturelimit.
Proof. Given v ∈ N and w ∈ T C ≃ C , we denote
v 0 0
by p = ρ(ζv) ∈ Γ the consistent beliefs defined by v,
0
C. FAITHFULNESSPROOFS and by T X : T C → T C the differential of X at
v BK v 0 0 0 BK
v. Let us show that the linearized stationarity condition
ThefaithfulnesspropertiesofadiffusionfluxΦ :C 0 →C 1 T v X BK (w) =0impliesw ∈T v N.
(definition 13) relate the stationary potentials under dif- Letting W = ζw ∈ ζ(T N) ⊆ C , by linearizing
fusion, for which δΦ(v) = 0, with consistent potentials v 0
the evolution of local hamiltonians (59), we claim that
which satisfy e−ζv ∈ Ker(d). The latter is equivalent to T X (w) =0ifandonlyifforallb∈ Kandallx ∈ E ,
v BK b b
D(ζv) = 0 (where D : C → C is the non-linear free
energygradient,definition 0 14). 1 W b (x b ) = ∑ c a E pa [W a |x b|a∩b ]. (119)
Althoughprovingthatanyconsistentpotentialissta- a∈K
tionary is straightforward when Φ is built from D ◦ζ, The reader may check that conditional free energies of
proving the converse is more difficult due to the non- (59) linearize to conditional expectations with respect to
linearity of D. Below we prove that Φ (55) is indeed p ∈ Γ (see[9,prop. 4.14]otherwise).
GBP 0
26
Inordertofactorizethesumoverregionsinsideasin- form δφ ∈ δC . The mean energy constraint ⟨p,h⟩ = U,
1
gle conditional expectation, we choose a global measure as usual, yields the inverse temperature β as a Lagrange
pΩ ∈ REΩ∗ suchthat p
a
isthe pushforwardof pΩ forall multiplier for terms of the form βh ∈ Rh. The normali-
a ∈ K. This is always possible by consistency of p ∈ Γ sation constraints ⟨p ,1 ⟩ = 1 for all a ∈ K finally yield
0 a a
and acyclicity of (C
•
∗,d) [9, thm. 2.17]. Altough pΩ can- additiveconstantsλ ∈RK.
notalwaysbechosennon-negative,withaslightabuseof Aclassicalcomputationyieldsthedifferentialoflocal
notationletuswrite entropiesasT S = ⟨·,−ln(p )⟩ mod R. Theycoin-
p b b b
cidewith⟨·,V¯′⟩forallV¯′ ∈ −ln(p )+Ronthetangent
E pΩ [WΩ|x a ] = ∑ pΩ(x p Ω) ( W x Ω ) (xΩ) . (120) fibersof∆ b =P b rob(E b ),d b uetothet b angentnormalisation
xΩ|a =xa a a constraint. Therefore piscriticalifandonlyifthereexists
β ∈R, φ ∈C andλ ∈RK suchthat:
1
W
so
a
th
∈
at
R
E
Ea
pa
⊆
[W
R
a |
E
x
Ω
a∩
,
b
a
]
nd
=
a
E
ll
p
x
Ω
a
[
∩
W
b
a
∈
|x a
E
∩
a
b
∩
]
b
f
.
o
B
r
e
a
c
l
a
l
u
a
s
,
e
b
W
∈
a
K
d
,
o
a
e
l
s
l
Sˇ ∗ (p) a = c a (V¯ a −1 a ) = βh a +δφ a +λ a 1 a . (123)
notdependonthevariablesoutsideawealsohave By lemma 19 we know that cV¯ and v¯ = µV¯ are homol-
E [W |x ] =E [W |x ] (121) ogous: v¯ = cV¯ −δΨ(cV¯). Lemma 19 therefore implies
pΩ a b|a∩b pΩ a b that(123)isequivalenttov¯ ∈ βh+δC +λwithλ ∈ RK.
1
R fo E r b a . l T lx h b is ∈ le E ts b u ,w st h o e r r e e w R r E it a e ∩b th is e id sa e t n io ti n fi a e r d ity w c it o h n i d ts iti i o m n a ( g 1 e 1 i 9 n ) T ob h s e e o r r v e a m ble 3 s , a R p • pli ⊆ ed C to •, th im e p su li b e c s o t m ha p t le R x 0 of de c c o o n m st p an o t se l s oc a a s l
R⊕δR . Up to a boundary term of δR ⊆ δC , the lo-
as 1 1 1
cal constants λ ∈ RK = R can therefore be absorbed
0
W b (x b ) =E pΩ (cid:20) ∑ c a W a (cid:12) (cid:12) (cid:12) (cid:12) x b (cid:21) =E pΩ [WΩ|x b ], (122) i E n n t f o or a ci s n in g g t l h e e co c n on st s a t n ra t in λ t ′ ⟨ ∈ p, R v¯′⟩ so = th β a ⟨ t p v¯ ,h ∈ ⟩ = βh β + U δ , C o 1 n + th R e .
a∈K equivalent potentials v¯′ ∈ v¯ +R, we may finally get
whichimpliescompatibilityofW ∈ C 0 underthecondi- v¯′ ∈ βh+δC 1 by ⟨p,δC 1 ⟩ = 0. Each critical p ∈ Γ 0
tional expectation functor, i.e. E [W |x ] = W (x ) for hence defines a unique potential v¯′ ∈ [βh]∩M1 satisfy-
all c ⊆ b and x ∈ E . The cons p t b rain b t t c hat loca c l h c amil- ing p = ρ1(ζv¯′)and⟨p,v¯′⟩ = βU.
c c
tonians are conditional expectations of a common global
energyWΩ = ∑
a
c
a
W
a
= ∑
a
w
a
preciselydefinesthetan- P
ci
r
s
o
e
of
p
o
r
f
o
t
o
h
f
e
c
o
a
re
n
m
b
B
e
.
fo
V
u
e
n
r
d
ys
in
im
[9
il
,
a
t
r
h
t
m
ot
4
h
.2
a
2
t
]
o
.
fAabovethepre-
gentmanifoldζ(T N) =Ker(T D)(see[9,section5.2.1]
v ζv
ordifferentiateD). Thereforew ∈T v N. ProofoftheoremC. Given H = ζh ∈ C and β > 0, let
0
We showed that the stationary fiber Ker(T v X BK ) co- V = ζv ∈ C 0 beasolutiontoproblemC.Theenergycon-
i v nc ∈ id N es . w T it h h e th st e at c i o o n n s a i r s y te m nt a t n a i n fo g l e d nt co fi n b t e a r in T s v N N, b a y ss c u o m ns in is g - strainton v ∈ h+δC 1 implies Fˇ ∗ β(V) |Im(ζδ) = 0withthe
tencyofΦ BK butwedonotknowwhetheritisconnected. differentialFˇ ∗ β :C 0 →C 0 ∗ givenby:
ThevectorfieldX = δΦ beinganalytic,onemaystill
provethatconnect B e K dcomp B o K nentsofthestationarymani- Fˇ ∗ β(V) a = c a ρβ(V a ). (124)
foldareseparatedtoconstructthedesiredneighbourhood
For any subspace B ⊆ C , let us write B⊥ ⊆ C∗ for the
V ⊇ N. 0 0
orthogonaldual(orannihilator)of B. Letting p = ρβ(V)
D. CORRESPONDENCEPROOFS
criticality is then equivalent to F∗ β(V) = cp ∈ Im(ζδ)⊥.
Recall that d = δ∗ by definition and denote by ζ∗ : q (cid:55)→
ProofoftheoremA. Given U ∈ R and h ∈ C , let p ∈ Γ q◦ζ theadjointofζ:
0 0
be a solution to problem A, with ⟨p,h⟩ = U. Defining
local energies V¯ = ζv¯ ∈ C 0 by V¯ b = −lnp b for all b, cp ∈Im(ζδ)⊥ ⇔ ζ ∗(cp) ∈Im(δ)⊥
the consistency of p implies v¯ ∈ M1 as p = ρ1(V¯) = (125)
ρ1(ζv¯). Thesameargumentholdsforanyotherpotential ⇔ ζ ∗(cp) ∈Ker(d).
v¯′ ∈ v¯+RK, equal to v¯ up to additive energy constants.
Therefore V is critical for Fˇβ if and only if ζ∗(cp) =
ThisfollowsfromtheinvarianceofGibbsstatesunderad- |Im(ζδ)
ditiveconstants,i.e. ρ1(ζv¯′) = ρ1(ζv¯)isconsistentforall ζ∗(cρβ(V))isconsistent.
v¯′ ∈ v¯+RK,andv¯′ ∈ M1. Assume p ∈ Ker(d) is consistent. Then by the dual
Let us now show that the constraints ⟨p,h⟩ = U and formoflemma19involving(δΨ)∗ = Ψ∗dwhichvanishes
dp = 0 also imply v¯ ∈ [βh] for some β ∈ R. By du- on Ker(d), we have cp = µ∗p and ζ∗(cp) = p is con-
ality, recalling that δ = d∗, we know that ⟨q,u⟩ = 0 for sistent as well. This shows that any consistent potential
all q ∈ Ker(d) if and only if u ∈ Im(δ). The consis- v ∈ [h]∩Mβ yieldsacriticalpointV = ζv oftheBethe-
tencyconstrainthenceyieldsLagrangemultipliersofthe KikuchienergyFˇβ(V).
27
Reciprocally assume q = ζ∗(cp) ∈ Ker(d), then relationcV = cW impliesv−w = µ(V−W) ∈ Ker(cζ),
µ∗(q) = cq by lemma 19 and cq = cp, which means that sothatv ∈ [h]∩Mβ isweaklyconsistentbydefinitionof
+
p b andq b coincideonanyb ∈ K suchthatc b ̸= 0. Letus Mβ .
defineenergiesW = ζw ∈C by: +
0 Theretractionrβ : Mβ → Mβ isdescribedmoresuc-
+
W = − 1 ln(q )+F β(V ). (126) cinctly via its conjugate Rβ = ζ ◦rβ ◦µ acting on local
b β b b b energiesV = ζv ∈C :
0
O on b e se s r e v e i s n t g h t a h t a c t p q = = c ρ q β i ( m W p ) li a e n s d cV F b β = (W c b W ) = . B F y b β l ( e V m b m )f a or 1 a 9 l w lb e , Rβ(V) b = − β 1 ln ∑ c a π ∗ a→b(cid:0) ρ a β(V a ) (cid:1) −F b β(V b ), (127)
a⊇b
getµV ∈ µW+δC sothatthepotentialsw = µW satisfy
1
the global energy constraint [w] = [v] = [h]. By the as- which amounts to applying the linear projection ζ∗c on
sumptionq ∈ Ker(d)thisshowsthatw ∈ [h]∩Mβ. The beliefsbeforechoosingenergiesas(126).
28